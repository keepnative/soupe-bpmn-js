/*! @keepnative/soupe-bpmn-js - bpmn-modeler v3.0.0 | (c) 2014, 2015 camunda Services GmbH | bpmn.io/license */
!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.SoupeBpmnJS=f()}}(function(){var define;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){module.exports=_dereq_(29)},{29:29}],2:[function(_dereq_,module,exports){"use strict";function PropertiesActivator(eventBus,priority){var self=this;priority=priority||DEFAULT_PRIORITY,eventBus.on("propertiesPanel.isEntryVisible",priority,function(e){return self.isEntryVisible(e.entry,e.element)}),eventBus.on("propertiesPanel.isPropertyEditable",priority,function(e){return self.isPropertyEditable(e.entry,e.propertyName,e.element)})}var DEFAULT_PRIORITY=1e3;PropertiesActivator.$inject=["eventBus","translate"],module.exports=PropertiesActivator,PropertiesActivator.prototype.isEntryVisible=function(entry,element){return!0},PropertiesActivator.prototype.isPropertyEditable=function(entry,propertyName,element){return!0}},{}],3:[function(_dereq_,module,exports){"use strict";function isToggle(node){return"checkbox"===node.type||"radio"===node.type}function isSelect(node){return"select-one"===node.type}function isContentEditable(node){return domAttr(node,"contenteditable")}function getPropertyPlaceholders(node){var selector="input[name], textarea[name], [data-value], [contenteditable]",placeholders=domQuery.all(selector,node);return placeholders&&placeholders.length||!domMatches(node,selector)||(placeholders=[node]),placeholders}function getFormControls(node,all){var controls=domQuery.all("input[name], textarea[name], select[name], [contenteditable]",node);return controls&&controls.length||(controls=domMatches(node,"option")?[node]:controls),all||(controls=filter(controls,function(node){return!domClosest(node,"."+HIDE_CLASS)})),controls}function getFormControlValuesInScope(entryNode){var values={},controlNodes=getFormControls(entryNode);return forEach(controlNodes,function(controlNode){var value=controlNode.value,name=domAttr(controlNode,"name")||domAttr(controlNode,"data-name");isToggle(controlNode)?value=controlNode.checked?!domAttr(controlNode,"value")||controlNode.value:null:isContentEditable(controlNode)&&(value=controlNode.innerText),null!==value&&(values[name]=value)}),values}function getFormControlValues(entryNode){var values,listContainer=domQuery("[data-list-entry-container]",entryNode);if(listContainer){values=[];var listNodes=listContainer.children||[];forEach(listNodes,function(listNode){values.push(getFormControlValuesInScope(listNode))})}else values=getFormControlValuesInScope(entryNode);return values}function valueEqual(value,oldValue){return!(value&&!oldValue)&&keys(value).concat(keys(oldValue)).every(function(key){return value[key]===oldValue[key]})}function valuesEqual(values,oldValues){return isArray(values)?values.length===oldValues.length&&values.every(function(v,idx){return valueEqual(v,oldValues[idx])}):valueEqual(values,oldValues)}function extractEntries(tabs){return indexBy(flattenDeep(map(flattenDeep(map(tabs,"groups")),"entries")),"id")}function extractGroups(tabs){return indexBy(flattenDeep(map(tabs,"groups")),"id")}function PropertiesPanel(config,eventBus,modeling,propertiesProvider,commandStack,canvas,translate){this._eventBus=eventBus,this._modeling=modeling,this._commandStack=commandStack,this._canvas=canvas,this._propertiesProvider=propertiesProvider,this._translate=translate,this._init(config)}function setInputValue(node,value){var selection,contentEditable=isContentEditable(node),oldValue=contentEditable?node.innerText:node.value;void 0===value&&(value=""),oldValue!==value&&(document.activeElement===node&&(selection=updateSelection(getSelection(node),oldValue,value)),contentEditable?node.innerText=value:node.value=value,selection&&setSelection(node,selection))}function setSelectValue(node,value){void 0!==value&&(node.value=value)}function setToggleValue(node,value){var nodeValue=node.value;node.checked=value===nodeValue||!domAttr(node,"value")&&value}function setTextValue(node,value){node.textContent=value}function getSelection(node){return isContentEditable(node)?getContentEditableSelection(node):{start:node.selectionStart,end:node.selectionEnd}}function getContentEditableSelection(node){var selection=window.getSelection(),focusNode=selection.focusNode,focusOffset=selection.focusOffset,anchorOffset=selection.anchorOffset;if(!focusNode)throw new Error("not selected");if(!node.contains(focusNode))throw new Error("not selected");return{start:Math.min(focusOffset,anchorOffset),end:Math.max(focusOffset,anchorOffset)}}function setSelection(node,selection){isContentEditable(node)?setContentEditableSelection(node,selection):(node.selectionStart=selection.start,node.selectionEnd=selection.end)}function setContentEditableSelection(node,selection){var focusNode,domRange,domSelection;focusNode=node.firstChild||node,domRange=document.createRange(),domRange.setStart(focusNode,selection.start),domRange.setEnd(focusNode,selection.end),domSelection=window.getSelection(),domSelection.removeAllRanges(),domSelection.addRange(domRange)}var domify=_dereq_(179),domQuery=_dereq_(182),domRemove=_dereq_(183),domClasses=_dereq_(175),domClosest=_dereq_(177),domAttr=_dereq_(174),domDelegate=_dereq_(178),domMatches=_dereq_(181),forEach=_dereq_(91),filter=_dereq_(89),get=_dereq_(167),keys=_dereq_(168),isEmpty=_dereq_(160),isArray=_dereq_(159),xor=_dereq_(87),debounce=_dereq_(96),updateSelection=_dereq_(185),scrollTabs=_dereq_(184),getBusinessObject=_dereq_(69).getBusinessObject,HIDE_CLASS="bpp-hidden";PropertiesPanel.$inject=["config.propertiesPanel","eventBus","modeling","propertiesProvider","commandStack","canvas","translate"],module.exports=PropertiesPanel,PropertiesPanel.prototype._init=function(config){var eventBus=this._eventBus,self=this;eventBus.on("root.added",function(e){self.update(e.element)}),eventBus.on("selection.changed",function(e){var newElement=e.newSelection[0];self.update(newElement)}),eventBus.on(["propertiesPanel.changed","propertiesPanel.resized"],function(event){var tabBarNode=domQuery(".bpp-properties-tab-bar",self._container);if(tabBarNode){var scroller=scrollTabs.get(tabBarNode);scroller||(scroller=scrollTabs(tabBarNode,{selectors:{tabsContainer:".bpp-properties-tabs-links",tab:".bpp-properties-tabs-links li",ignore:".bpp-hidden",active:".bpp-active"}}),scroller.on("scroll",function(newActiveNode,oldActiveNode,direction){var linkNode=domQuery("[data-tab-target]",newActiveNode),tabId=domAttr(linkNode,"data-tab-target");self.activateTab(tabId)})),scroller.update()}}),eventBus.on("elements.changed",function(e){var current=self._current,element=current&&current.element;element&&-1!==e.elements.indexOf(element)&&self.update(element)}),eventBus.on("elementTemplates.changed",function(){var current=self._current,element=current&&current.element;element&&self.update(element)}),eventBus.on("diagram.destroy",function(){self.detach()}),this._container=domify('<div class="bpp-properties-panel"></div>'),this._bindListeners(this._container),config&&config.parent&&this.attachTo(config.parent)},PropertiesPanel.prototype.attachTo=function(parentNode){if(!parentNode)throw new Error("parentNode required");this.detach(),parentNode.get&&parentNode.constructor.prototype.jquery&&(parentNode=parentNode.get(0)),"string"==typeof parentNode&&(parentNode=domQuery(parentNode));var container=this._container;parentNode.appendChild(container),this._emit("attach")},PropertiesPanel.prototype.detach=function(){var container=this._container,parentNode=container.parentNode;parentNode&&(this._emit("detach"),parentNode.removeChild(container))},PropertiesPanel.prototype.activateTab=function(tab){var tabId="string"==typeof tab?tab:tab.id,current=this._current,panelNode=current.panel,allTabNodes=domQuery.all(".bpp-properties-tab",panelNode),allTabLinkNodes=domQuery.all(".bpp-properties-tab-link",panelNode);forEach(allTabNodes,function(tabNode){var currentTabId=domAttr(tabNode,"data-tab");domClasses(tabNode).toggle("bpp-active",tabId===currentTabId)}),forEach(allTabLinkNodes,function(tabLinkNode){var tabLink=domQuery("[data-tab-target]",tabLinkNode),currentTabId=domAttr(tabLink,"data-tab-target");domClasses(tabLinkNode).toggle("bpp-active",tabId===currentTabId)})},PropertiesPanel.prototype.update=function(element){var current=this._current,needsCreate=!0;void 0===element&&(element=this._canvas.getRootElement());var newTabs=this._propertiesProvider.getTabs(element);if(current&&current.element===element&&(needsCreate=this._entriesChanged(current,newTabs)),needsCreate){if(current){var activeTabId,activeTabNode=domQuery(".bpp-properties-tab.bpp-active",current.panel);activeTabNode&&(activeTabId=domAttr(activeTabNode,"data-tab")),domRemove(current.panel)}this._current=this._create(element,newTabs),activeTabId?this.activateTab(activeTabId):this.activateTab(this._current.tabs[0])}this._current&&this._updateActivation(this._current),this._emit("changed")},PropertiesPanel.prototype._entriesChanged=function(current,newTabs){var oldEntryIds=keys(current.entries),newEntryIds=keys(extractEntries(newTabs));return!isEmpty(xor(oldEntryIds,newEntryIds))},PropertiesPanel.prototype._emit=function(event){this._eventBus.fire("propertiesPanel."+event,{panel:this,current:this._current})},PropertiesPanel.prototype._bindListeners=function(container){function handleInput(event,element){var inputNode=event.delegateTarget,entryNode=domClosest(inputNode,"[data-entry]");if(entryNode){var eventHandlerId=domAttr(inputNode,"data-blur"),entryId=domAttr(entryNode,"data-entry"),entry=self.getEntry(entryId);if(self.executeAction(entry,entryNode,eventHandlerId,event)){var values=getFormControlValues(entryNode);self.applyChanges(entry,values,entryNode)}self.updateState(entry,entryNode)}}var self=this,handleChange=function(event){var entryId,entry,node=domClosest(event.delegateTarget,"[data-entry]");if(node){entryId=domAttr(node,"data-entry"),entry=self.getEntry(entryId);var values=getFormControlValues(node);if("change"===event.type){var onChangeAction=event.delegateTarget.getAttribute("data-on-change");if(onChangeAction){if(!self.executeAction(entry,node,onChangeAction,event))return self.update(self._current.element)}}self.applyChanges(entry,values,node),self.updateState(entry,node)}};domDelegate.bind(container,"input, textarea, [contenteditable]","input",debounce(handleChange,300)),domDelegate.bind(container,"input, textarea, select, [contenteditable]","change",handleChange),domDelegate.bind(container,"[data-action]","click",function(event){var inputNode=event.delegateTarget,entryNode=domClosest(inputNode,"[data-entry]"),actionId=domAttr(inputNode,"data-action"),entryId=domAttr(entryNode,"data-entry"),entry=self.getEntry(entryId);if(self.executeAction(entry,entryNode,actionId,event)){var values=getFormControlValues(entryNode);self.applyChanges(entry,values,entryNode)}self.updateState(entry,entryNode)}),domDelegate.bind(container,"[data-blur]","blur",handleInput,!0),domDelegate.bind(container,".bpp-properties-tabs-links [data-tab-target]","click",function(event){event.preventDefault();var delegateTarget=event.delegateTarget,tabId=domAttr(delegateTarget,"data-tab-target");self.activateTab(tabId)})},PropertiesPanel.prototype.updateState=function(entry,entryNode){this.updateShow(entry,entryNode),this.updateDisable(entry,entryNode)},PropertiesPanel.prototype.updateShow=function(entry,node){var current=this._current;if(current){var showNodes=domQuery.all("[data-show]",node)||[];forEach(showNodes,function(showNode){var expr=domAttr(showNode,"data-show"),fn=get(entry,expr);if(fn){var scope=domClosest(showNode,"[data-scope]")||node;fn(current.element,node,showNode,scope)||!1?domClasses(showNode).remove(HIDE_CLASS):domClasses(showNode).add(HIDE_CLASS)}})}},PropertiesPanel.prototype.updateDisable=function(entry,node){var current=this._current;if(current){var nodes=domQuery.all("[data-disable]",node)||[];forEach(nodes,function(currentNode){var expr=domAttr(currentNode,"data-disable"),fn=get(entry,expr);if(fn){var scope=domClosest(currentNode,"[data-scope]")||node,shouldDisable=fn(current.element,node,currentNode,scope)||!1;domAttr(currentNode,"disabled",shouldDisable?"":null)}})}},PropertiesPanel.prototype.executeAction=function(entry,entryNode,actionId,event){var current=this._current;if(current){var fn=get(entry,actionId);if(fn){var scopeNode=domClosest(event.target,"[data-scope]")||entryNode;return fn.apply(entry,[current.element,entryNode,event,scopeNode])}}},PropertiesPanel.prototype.applyChanges=function(entry,values,containerElement){var element=this._current.element;if(!valuesEqual(values,entry.oldValues)){var commandToExecute,command=entry.set(element,values,containerElement);isArray(command)?command.length&&(commandToExecute={cmd:"properties-panel.multi-command-executor",context:flattenDeep(command)}):commandToExecute=command,commandToExecute?this._commandStack.execute(commandToExecute.cmd,commandToExecute.context||{element:element}):this.update(element)}},PropertiesPanel.prototype.applyValidationErrors=function(validationErrors,entryNode){var valid=!0,controlNodes=getFormControls(entryNode,!0);return forEach(controlNodes,function(controlNode){var name=domAttr(controlNode,"name")||domAttr(controlNode,"data-name"),error=validationErrors&&validationErrors[name],errorMessageNode=domQuery(".bpp-error-message",controlNode.parentNode);error?(valid=!1,errorMessageNode||(errorMessageNode=domify("<div></div>"),domClasses(errorMessageNode).add("bpp-error-message"),controlNode.parentNode.insertBefore(errorMessageNode,controlNode.nextSibling)),errorMessageNode.innerHTML=error,domClasses(controlNode).add("invalid")):(domClasses(controlNode).remove("invalid"),errorMessageNode&&controlNode.parentNode.removeChild(errorMessageNode))}),valid},PropertiesPanel.prototype.validate=function(entry,values,entryNode){var self=this,current=this._current,valid=!0;if(entryNode=entryNode||domQuery('[data-entry="'+entry.id+'"]',current.panel),values instanceof Array)for(var listContainer=domQuery("[data-list-entry-container]",entryNode),listEntryNodes=listContainer.children||[],i=0;i<values.length;i++){var listValue=values[i];if(entry.validateListItem){var validationErrors=entry.validateListItem(current.element,listValue,entryNode,i),listEntryNode=listEntryNodes[i];valid=self.applyValidationErrors(validationErrors,listEntryNode)&&valid}}else entry.validate&&(this.validationErrors=entry.validate(current.element,values,entryNode),valid=self.applyValidationErrors(this.validationErrors,entryNode)&&valid);return valid},PropertiesPanel.prototype.getEntry=function(id){return this._current&&this._current.entries[id]};var flattenDeep=_dereq_(85),indexBy=_dereq_(92),map=_dereq_(93);PropertiesPanel.prototype._create=function(element,tabs){if(!element)return null;var containerNode=this._container,panelNode=this._createPanel(element,tabs);containerNode.appendChild(panelNode);var entries=extractEntries(tabs);return{tabs:tabs,groups:extractGroups(tabs),entries:entries,element:element,panel:panelNode}},PropertiesPanel.prototype._bindTemplate=function(element,entry,values,entryNode,idx){function isPropertyEditable(entry,propertyName){return eventBus.fire("propertiesPanel.isPropertyEditable",{entry:entry,propertyName:propertyName,element:element})}var eventBus=this._eventBus,inputNodes=getPropertyPlaceholders(entryNode);forEach(inputNodes,function(node){var name,newValue,editable;"value"in node||"true"===isContentEditable(node)?(name=domAttr(node,"name")||domAttr(node,"data-name"),newValue=values[name],editable=isPropertyEditable(entry,name),editable&&entry.editable&&(editable=entry.editable(element,entryNode,node,name,newValue,idx)),domAttr(node,"readonly",editable?null:""),domAttr(node,"disabled",editable?null:""),entry.setControlValue?entry.setControlValue(element,entryNode,node,name,newValue,idx):isToggle(node)?setToggleValue(node,newValue):isSelect(node)?setSelectValue(node,newValue):setInputValue(node,newValue)):(name=domAttr(node,"data-value"),newValue=values[name],entry.setControlValue?entry.setControlValue(element,entryNode,node,name,newValue,idx):setTextValue(node,newValue))})},PropertiesPanel.prototype._updateActivation=function(current){function isEntryVisible(entry){return eventBus.fire("propertiesPanel.isEntryVisible",{entry:entry,element:element})}function isGroupVisible(group,element,groupNode){return"function"!=typeof group.enabled||group.enabled(element,groupNode)}function isTabVisible(tab,element){return"function"!=typeof tab.enabled||tab.enabled(element)}function toggleVisible(node,visible){domClasses(node).toggle(HIDE_CLASS,!visible)}function checkActiveTabVisibility(node,visible){var isActive=domClasses(node).has("bpp-active");!visible&&isActive&&self.activateTab(current.tabs[0])}function updateLabel(element,selector,text){var labelNode=domQuery(selector,element);labelNode&&(labelNode.textContent=text)}var self=this,eventBus=this._eventBus,element=current.element,panelNode=current.panel;forEach(current.tabs,function(tab){var tabNode=domQuery("[data-tab="+tab.id+"]",panelNode),tabLinkNode=domQuery("[data-tab-target="+tab.id+"]",panelNode).parentNode,tabVisible=!1;forEach(tab.groups,function(group){var groupVisible=!1,groupNode=domQuery("[data-group="+group.id+"]",tabNode);forEach(group.entries,function(entry){var entryNode=domQuery('[data-entry="'+entry.id+'"]',groupNode),entryVisible=isEntryVisible(entry);groupVisible=groupVisible||entryVisible,toggleVisible(entryNode,entryVisible);var values="get"in entry?entry.get(element,entryNode):{};if(values instanceof Array){for(var listEntryContainer=domQuery("[data-list-entry-container]",entryNode),existingElements=listEntryContainer.children||[],i=0;i<values.length;i++){var listValue=values[i],listItemNode=existingElements[i];listItemNode||(listItemNode=domify(entry.createListEntryTemplate(listValue,i,listEntryContainer)),listEntryContainer.appendChild(listItemNode)),domAttr(listItemNode,"data-index",i),self._bindTemplate(element,entry,listValue,listItemNode,i)}for(var entriesToRemove=existingElements.length-values.length,j=0;j<entriesToRemove;j++)listEntryContainer.removeChild(listEntryContainer.lastChild)}else self._bindTemplate(element,entry,values,entryNode);self.updateState(entry,entryNode),self.validate(entry,values,entryNode),entry.oldValues=getFormControlValues(entryNode)}),"function"==typeof group.label&&updateLabel(groupNode,".group-label",group.label(element,groupNode)),groupVisible=groupVisible&&isGroupVisible(group,element,groupNode),tabVisible=tabVisible||groupVisible,toggleVisible(groupNode,groupVisible)}),tabVisible=tabVisible&&isTabVisible(tab,element),toggleVisible(tabNode,tabVisible),toggleVisible(tabLinkNode,tabVisible),checkActiveTabVisibility(tabNode,tabVisible)}),updateLabel(panelNode,"[data-label-id]",getBusinessObject(element).id||"")},PropertiesPanel.prototype._createPanel=function(element,tabs){var self=this,panelNode=domify('<div class="bpp-properties"></div>'),headerNode=domify('<div class="bpp-properties-header"><div class="label" data-label-id></div><div class="search"><input type="search" placeholder="Search for property" /><button><span>Search</span></button></div></div>'),tabBarNode=domify('<div class="bpp-properties-tab-bar"></div>'),tabLinksNode=domify('<ul class="bpp-properties-tabs-links"></ul>'),tabContainerNode=domify('<div class="bpp-properties-tabs-container"></div>');return panelNode.appendChild(headerNode),forEach(tabs,function(tab,tabIndex){if(!tab.id)throw new Error("tab must have an id");var tabNode=domify('<div class="bpp-properties-tab" data-tab="'+tab.id+'"></div>'),tabLinkNode=domify('<li class="bpp-properties-tab-link"><a href data-tab-target="'+tab.id+'">'+tab.label+"</a></li>"),groups=tab.groups;forEach(groups,function(group){if(!group.id)throw new Error("group must have an id");var groupNode=domify('<div class="bpp-properties-group" data-group="'+group.id+'"><span class="group-toggle"></span><span class="group-label">'+group.label+"</span></div>");groupNode.querySelector(".group-toggle").addEventListener("click",function(evt){domClasses(groupNode).toggle("group-closed"),evt.preventDefault(),evt.stopPropagation()}),groupNode.addEventListener("click",function(evt){!evt.defaultPrevented&&domClasses(groupNode).has("group-closed")&&domClasses(groupNode).remove("group-closed")}),forEach(group.entries,function(entry){if(!entry.id)throw new Error("entry must have an id");var html=entry.html;"string"==typeof html&&(html=domify(html)),html.get&&html.constructor.prototype.jquery&&(html=html.get(0));var entryNode=domify('<div class="bpp-properties-entry" data-entry="'+entry.id+'"></div>');forEach(entry.cssClasses||[],function(cssClass){domClasses(entryNode).add(cssClass)}),entryNode.appendChild(html),groupNode.appendChild(entryNode),self.updateState(entry,entryNode)}),tabNode.appendChild(groupNode)}),tabLinksNode.appendChild(tabLinkNode),tabContainerNode.appendChild(tabNode)}),tabBarNode.appendChild(tabLinksNode),panelNode.appendChild(tabBarNode),panelNode.appendChild(tabContainerNode),panelNode}},{159:159,160:160,167:167,168:168,174:174,175:175,177:177,178:178,179:179,181:181,182:182,183:183,184:184,185:185,69:69,85:85,87:87,89:89,91:91,92:92,93:93,96:96}],4:[function(_dereq_,module,exports){"use strict";function selectedOption(selectBox){if(selectBox.selectedIndex>=0)return selectBox.options[selectBox.selectedIndex].value}function selectedType(elementSyntax,inputNode){return selectedOption(domQuery(elementSyntax,inputNode))}function getRoot(businessObject){for(var parent=businessObject;parent.$parent;)parent=parent.$parent;return parent}function filterElementsByType(objectList,type){var list=objectList||[],result=[];return forEach(list,function(obj){is(obj,type)&&result.push(obj)}),result}function findRootElementsByType(businessObject,referencedType){return filterElementsByType(getRoot(businessObject).rootElements,referencedType)}function removeAllChildren(domElement){for(;domElement.firstChild;)domElement.removeChild(domElement.firstChild)}function addEmptyParameter(list){return list.push({label:"",value:"",name:""})}function refreshOptionsModel(businessObject,referencedType){var model=[],referableObjects=findRootElementsByType(businessObject,referencedType);return forEach(referableObjects,function(obj){model.push({label:(obj.name||"")+" (id="+obj.id+")",value:obj.id,name:obj.name})}),model}function updateOptionsDropDown(domSelector,businessObject,referencedType,entryNode){var options=refreshOptionsModel(businessObject,referencedType);addEmptyParameter(options);var selectBox=domQuery(domSelector,entryNode);return domClear(selectBox),forEach(options,function(option){var optionEntry=domify('<option value="'+option.value+'">'+option.label+"</option>");selectBox.appendChild(optionEntry)}),options}function isIdValid(bo,idValue){var assigned=bo.$model.ids.assigned(idValue),idExists=assigned&&assigned!==bo;return!idValue||idExists?"Element must have an unique id.":validateId(idValue)}function validateId(idValue){return idValue=stripPlaceholders(idValue),containsSpace(idValue)?"Id must not contain spaces.":ID_REGEX.test(idValue)?void 0:QNAME_REGEX.test(idValue)?"Id must not contain prefix.":"Id must be a valid QName."}function containsSpace(value){return SPACE_REGEX.test(value)}function stripPlaceholders(idValue){return idValue.replace(PLACEHOLDER_REGEX,"$1")}function nextId(prefix){return new Ids([32,32,1]).nextPrefixed(prefix)}function triggerClickEvent(element){var evt;if(document.createEvent){try{evt=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0})}catch(e){evt=document.createEvent("MouseEvent"),evt.initEvent("click",!0,!0)}return element.dispatchEvent(evt)}return evt=document.createEventObject(),element.fireEvent("onclick",evt)}var domQuery=_dereq_(182),domClear=_dereq_(176),is=_dereq_(69).is,forEach=_dereq_(91),domify=_dereq_(179),Ids=_dereq_(83),SPACE_REGEX=/\s/,QNAME_REGEX=/^([a-z][\w-.]*:)?[a-z_][\w-.]*$/i,ID_REGEX=/^[a-z_][\w-.]*$/i,PLACEHOLDER_REGEX=/\$\{([^\}]*)\}/g;module.exports.selectedOption=selectedOption,module.exports.selectedType=selectedType,module.exports.getRoot=getRoot,module.exports.filterElementsByType=filterElementsByType,module.exports.findRootElementsByType=findRootElementsByType,module.exports.removeAllChildren=removeAllChildren,module.exports.addEmptyParameter=addEmptyParameter,module.exports.refreshOptionsModel=refreshOptionsModel,module.exports.updateOptionsDropDown=updateOptionsDropDown,module.exports.isIdValid=isIdValid,module.exports.validateId=validateId,module.exports.containsSpace=containsSpace,module.exports.nextId=nextId,module.exports.triggerClickEvent=triggerClickEvent},{176:176,179:179,182:182,69:69,83:83,91:91}],5:[function(_dereq_,module,exports){"use strict";function CreateAndReferenceElementHandler(elementRegistry,bpmnFactory){this._elementRegistry=elementRegistry,this._bpmnFactory=bpmnFactory}function ensureNotNull(prop,name){if(!prop)throw new Error(name+" required");return prop}var elementHelper=_dereq_(23);CreateAndReferenceElementHandler.$inject=["elementRegistry","bpmnFactory"],module.exports=CreateAndReferenceElementHandler,CreateAndReferenceElementHandler.prototype.execute=function(context){var referencingObject=ensureNotNull(context.referencingObject,"referencingObject"),referenceProperty=ensureNotNull(context.referenceProperty,"referenceProperty"),newObject=ensureNotNull(context.newObject,"newObject"),newObjectContainer=ensureNotNull(context.newObjectContainer,"newObjectContainer"),newObjectParent=ensureNotNull(context.newObjectParent,"newObjectParent"),changed=[context.element],referencedObject=elementHelper.createElement(newObject.type,newObject.properties,newObjectParent,this._bpmnFactory);return context.referencedObject=referencedObject,newObjectContainer.push(referencedObject),context.previousReference=referencingObject[referenceProperty],referencingObject[referenceProperty]=referencedObject,context.changed=changed,changed},CreateAndReferenceElementHandler.prototype.revert=function(context){var referencingObject=context.referencingObject,referenceProperty=context.referenceProperty,previousReference=context.previousReference,referencedObject=context.referencedObject,newObjectContainer=context.newObjectContainer;return referencingObject.set(referenceProperty,previousReference),newObjectContainer.splice(newObjectContainer.indexOf(referencedObject),1),context.changed}},{23:23}],6:[function(_dereq_,module,exports){"use strict";function CreateBusinessObjectListHandler(elementRegistry,bpmnFactory){this._elementRegistry=elementRegistry,this._bpmnFactory=bpmnFactory}function ensureNotNull(prop,name){if(!prop)throw new Error(name+" required");return prop}function ensureList(prop,name){if(!prop||"[object Array]"!==Object.prototype.toString.call(prop))throw new Error(name+" needs to be a list");return prop}var forEach=_dereq_(91),elementHelper=_dereq_(23);CreateBusinessObjectListHandler.$inject=["elementRegistry","bpmnFactory"],module.exports=CreateBusinessObjectListHandler,CreateBusinessObjectListHandler.prototype.execute=function(context){var currentObject=ensureNotNull(context.currentObject,"currentObject"),propertyName=ensureNotNull(context.propertyName,"propertyName"),newObjects=ensureList(context.newObjects,"newObjects"),changed=[context.element],childObjects=[],self=this;return forEach(newObjects,function(obj){var element=elementHelper.createElement(obj.type,obj.properties,currentObject,self._bpmnFactory);childObjects.push(element)}),context.childObject=childObjects,context.previousChilds=currentObject[propertyName],currentObject[propertyName]=childObjects,context.changed=changed,changed},CreateBusinessObjectListHandler.prototype.revert=function(context){var currentObject=context.currentObject,propertyName=context.propertyName,previousChilds=context.previousChilds;return currentObject.set(propertyName,previousChilds),context.changed}},{23:23,91:91}],7:[function(_dereq_,module,exports){"use strict";function MultiCommandHandler(commandStack){this._commandStack=commandStack}var forEach=_dereq_(91);MultiCommandHandler.$inject=["commandStack"],module.exports=MultiCommandHandler,MultiCommandHandler.prototype.preExecute=function(context){var commandStack=this._commandStack;forEach(context,function(command){commandStack.execute(command.cmd,command.context)})}},{91:91}],8:[function(_dereq_,module,exports){"use strict";function UpdateBusinessObjectHandler(elementRegistry){this._elementRegistry=elementRegistry}function getRoot(businessObject){for(var parent=businessObject;parent.$parent;)parent=parent.$parent;return parent}function getProperties(businessObject,propertyNames){return reduce(propertyNames,function(result,key){return result[key]=businessObject.get(key),result},{})}function setProperties(businessObject,properties){forEach(properties,function(value,key){businessObject.set(key,value)})}var reduce=_dereq_(171),is=_dereq_(69).is,keys=_dereq_(168),forEach=_dereq_(91);UpdateBusinessObjectHandler.$inject=["elementRegistry"],module.exports=UpdateBusinessObjectHandler,UpdateBusinessObjectHandler.prototype.execute=function(context){var element=context.element,businessObject=context.businessObject,rootElements=getRoot(businessObject).rootElements,referenceType=context.referenceType,referenceProperty=context.referenceProperty,changed=[element];if(!element)throw new Error("element required");if(!businessObject)throw new Error("businessObject required");var properties=context.properties,oldProperties=context.oldProperties||getProperties(businessObject,keys(properties));return void 0!==referenceType&&void 0!==referenceProperty&&forEach(rootElements,function(rootElement){is(rootElement,referenceType)&&rootElement.id===properties[referenceProperty]&&(properties[referenceProperty]=rootElement)}),setProperties(businessObject,properties),context.oldProperties=oldProperties,context.changed=changed,changed},UpdateBusinessObjectHandler.prototype.revert=function(context){var oldProperties=context.oldProperties;return setProperties(context.businessObject,oldProperties),context.changed}},{168:168,171:171,69:69,91:91}],9:[function(_dereq_,module,exports){"use strict";function UpdateBusinessObjectListHandler(elementRegistry,bpmnFactory){this._elementRegistry=elementRegistry,this._bpmnFactory=bpmnFactory}function ensureNotNull(prop,name){if(!prop)throw new Error(name+"required");return prop}var forEach=_dereq_(91);UpdateBusinessObjectListHandler.$inject=["elementRegistry","bpmnFactory"],module.exports=UpdateBusinessObjectListHandler,UpdateBusinessObjectListHandler.prototype.execute=function(context){var referencePropertyName,currentObject=ensureNotNull(context.currentObject,"currentObject"),propertyName=ensureNotNull(context.propertyName,"propertyName"),updatedObjectList=context.updatedObjectList,objectsToRemove=context.objectsToRemove||[],objectsToAdd=context.objectsToAdd||[],changed=[context.element];context.referencePropertyName&&(referencePropertyName=context.referencePropertyName);var objectList=currentObject[propertyName];if(context.previousList=currentObject[propertyName],updatedObjectList)currentObject[propertyName]=updatedObjectList;else{var listCopy=[];if(forEach(objectList,function(object){-1==objectsToRemove.indexOf(object)&&listCopy.push(object)}),listCopy=listCopy.concat(objectsToAdd),listCopy.length>0||!referencePropertyName)currentObject[propertyName]=listCopy;else if(referencePropertyName){var parentObject=currentObject.$parent
;parentObject.set(referencePropertyName,void 0)}}return context.changed=changed,changed},UpdateBusinessObjectListHandler.prototype.revert=function(context){var currentObject=context.currentObject,propertyName=context.propertyName,previousList=context.previousList,parentObject=currentObject.$parent;return context.referencePropertyName&&parentObject.set(context.referencePropertyName,currentObject),currentObject.set(propertyName,previousList),context.changed}},{91:91}],10:[function(_dereq_,module,exports){"use strict";function CommandInitializer(eventBus,commandStack){eventBus.on("diagram.init",function(){forEach(HANDLERS,function(handler,id){commandStack.registerHandler(id,handler)})})}var forEach=_dereq_(91),HANDLERS={"properties-panel.update-businessobject":_dereq_(8),"properties-panel.create-and-reference":_dereq_(5),"properties-panel.create-businessobject-list":_dereq_(6),"properties-panel.update-businessobject-list":_dereq_(9),"properties-panel.multi-command-executor":_dereq_(7)};CommandInitializer.$inject=["eventBus","commandStack"],module.exports={__init__:[CommandInitializer]}},{5:5,6:6,7:7,8:8,9:9,91:91}],11:[function(_dereq_,module,exports){"use strict";var getBusinessObject=_dereq_(69).getBusinessObject,cmdHelper=_dereq_(22),entryFieldDescription=_dereq_(14),checkbox=function(options,defaultParameters){var resource=defaultParameters,label=options.label||resource.id,canBeDisabled=!!options.disabled&&"function"==typeof options.disabled,canBeHidden=!!options.hidden&&"function"==typeof options.hidden,description=options.description;return resource.html='<input id="camunda-'+resource.id+'" type="checkbox" name="'+options.modelProperty+'" '+(canBeDisabled?'data-disable="isDisabled"':"")+(canBeHidden?'data-show="isHidden"':"")+' /><label for="camunda-'+resource.id+'" '+(canBeDisabled?'data-disable="isDisabled"':"")+(canBeHidden?'data-show="isHidden"':"")+">"+label+"</label>",description&&(resource.html+=entryFieldDescription(description)),resource.get=function(element){var bo=getBusinessObject(element),res={};return res[options.modelProperty]=bo.get(options.modelProperty),res},resource.set=function(element,values){var res={};return res[options.modelProperty]=!!values[options.modelProperty],cmdHelper.updateProperties(element,res)},"function"==typeof options.set&&(resource.set=options.set),"function"==typeof options.get&&(resource.get=options.get),canBeDisabled&&(resource.isDisabled=function(){return options.disabled.apply(resource,arguments)}),canBeHidden&&(resource.isHidden=function(){return!options.hidden.apply(resource,arguments)}),resource.cssClasses=["bpp-checkbox"],resource};module.exports=checkbox},{14:14,22:22,69:69}],12:[function(_dereq_,module,exports){"use strict";var assign=_dereq_(166),find=_dereq_(90),domQuery=_dereq_(182),selectEntryFactory=_dereq_(17),entryFieldDescription=_dereq_(14),comboBox=function(options){var selectOptions=options.selectOptions,modelProperty=options.modelProperty,customValue=options.customValue||"custom",customName=options.customName||"custom "+modelProperty,description=options.description,isCustomValue=function(value){return void 0!==value[modelProperty]&&!find(selectOptions,function(option){return value[modelProperty]===option.value})},comboOptions=assign({},options);comboOptions.showCustomInput=function(element,node){var selectBox=domQuery('[data-entry="'+options.id+'"] select',node.parentNode);return!!selectBox&&selectBox.value===customValue},comboOptions.get=function(element,node){var value=options.get(element,node),modifiedValues={};return isCustomValue(value)?(modifiedValues[modelProperty]=customValue,modifiedValues["custom-"+modelProperty]=value[modelProperty],modifiedValues):(modifiedValues[modelProperty]=value[modelProperty]||"",modifiedValues)},comboOptions.set=function(element,values,node){var modifiedValues={};return values[modelProperty]===customValue?modifiedValues[modelProperty]=values["custom-"+modelProperty]||"":options.emptyParameter&&""===values[modelProperty]?modifiedValues[modelProperty]=void 0:modifiedValues[modelProperty]=values[modelProperty],options.set(element,modifiedValues,node)},comboOptions.selectOptions.push({name:customName,value:customValue});var comboBoxEntry=assign({},selectEntryFactory(comboOptions,comboOptions));return comboBoxEntry.html+='<div class="bpp-field-wrapper bpp-combo-input" data-show="showCustomInput"><input id="camunda-'+options.id+'-input" type="text" name="custom-'+modelProperty+'"  /></div>',description&&(comboBoxEntry.html+=entryFieldDescription(description)),comboBoxEntry};module.exports=comboBox},{14:14,166:166,17:17,182:182,90:90}],13:[function(_dereq_,module,exports){"use strict";function ensureNotNull(prop){if(!prop)throw new Error(prop+" must be set.");return prop}function EntryFactory(){}var getBusinessObject=_dereq_(69).getBusinessObject,textInputField=_dereq_(20),checkboxField=_dereq_(11),selectBoxField=_dereq_(17),comboBoxField=_dereq_(12),textBoxField=_dereq_(19),validationAwareTextInputField=_dereq_(21),tableField=_dereq_(18),labelEntry=_dereq_(15),link=_dereq_(16),cmdHelper=_dereq_(22),setDefaultParameters=function(options){var defaultGet=function(element){var bo=getBusinessObject(element),res={},prop=ensureNotNull(options.modelProperty);return res[prop]=bo.get(prop),res},defaultSet=function(element,values){var res={},prop=ensureNotNull(options.modelProperty);return""!==values[prop]?res[prop]=values[prop]:res[prop]=void 0,cmdHelper.updateProperties(element,res)},defaultValidate=function(){return{}};return{id:options.id,description:options.description||"",get:options.get||defaultGet,set:options.set||defaultSet,validate:options.validate||defaultValidate,html:""}};EntryFactory.textField=function(options){return textInputField(options,setDefaultParameters(options))},EntryFactory.validationAwareTextField=function(options){return validationAwareTextInputField(options,setDefaultParameters(options))},EntryFactory.checkbox=function(options){return checkboxField(options,setDefaultParameters(options))},EntryFactory.textBox=function(options){return textBoxField(options,setDefaultParameters(options))},EntryFactory.selectBox=function(options){return selectBoxField(options,setDefaultParameters(options))},EntryFactory.comboBox=function(options){return comboBoxField(options)},EntryFactory.table=function(options){return tableField(options)},EntryFactory.label=function(options){return labelEntry(options)},EntryFactory.link=function(options){return link(options)},module.exports=EntryFactory},{11:11,12:12,15:15,16:16,17:17,18:18,19:19,20:20,21:21,22:22,69:69}],14:[function(_dereq_,module,exports){"use strict";function linkify(text){return text.replace(MARKDOWN_LINK_REGEX,'<a href="$2" target="_blank">$1</a>')}var MARKDOWN_LINK_REGEX=/\[([^\)]+)\]\(([^\]]+)\)/g;module.exports=function(description){return'<div class="bpp-field-description">'+(description=linkify(description))+"</div>"}},{}],15:[function(_dereq_,module,exports){"use strict";var label=function(options){return{id:options.id,html:'<label data-value="label" data-show="showLabel" class="entry-label'+(options.divider?" divider":"")+'"></label>',get:function(element,node){return"function"==typeof options.get?options.get(element,node):{label:options.labelText}},showLabel:function(element,node){return"function"!=typeof options.showLabel||options.showLabel(element,node)}}};module.exports=label},{}],16:[function(_dereq_,module,exports){"use strict";var utils=_dereq_(4),entryFieldDescription=_dereq_(14),link=function(options,defaultParameters){var id=options.id,label=options.label||id,hideLink=options.hideLink,canBeHidden="function"==typeof hideLink,getClickableElement=options.getClickableElement,description=options.description,resource={id:id};return resource.html='<a data-action="linkSelected" '+(canBeHidden?'data-show="hideLink" ':"")+'class="bpp-entry-link'+(options.cssClasses?" "+options.cssClasses:"")+'">'+label+"</a>",description&&(resource.html+=entryFieldDescription(description)),resource.linkSelected=function(element,node,event,scopeNode){if("function"==typeof getClickableElement){var link=getClickableElement.apply(resource,[element,node,event,scopeNode]);link&&utils.triggerClickEvent(link)}return!1},canBeHidden&&(resource.hideLink=function(){return!hideLink.apply(resource,arguments)}),resource};module.exports=link},{14:14,4:4}],17:[function(_dereq_,module,exports){"use strict";var domify=_dereq_(179),forEach=_dereq_(91),entryFieldDescription=_dereq_(14),isList=function(list){return!(!list||"[object Array]"!==Object.prototype.toString.call(list))},addEmptyParameter=function(list){return list.concat([{name:"",value:""}])},createOption=function(option){return'<option value="'+option.value+'">'+option.name+"</option>"},selectbox=function(options,defaultParameters){var resource=defaultParameters,label=options.label||resource.id,selectOptions=options.selectOptions||[{name:"",value:""}],modelProperty=options.modelProperty,emptyParameter=options.emptyParameter,canBeDisabled=!!options.disabled&&"function"==typeof options.disabled,canBeHidden=!!options.hidden&&"function"==typeof options.hidden,description=options.description;return emptyParameter&&(selectOptions=addEmptyParameter(selectOptions)),resource.html='<label for="camunda-'+resource.id+'"'+(canBeDisabled?'data-disable="isDisabled" ':"")+(canBeHidden?'data-show="isHidden" ':"")+">"+label+'</label><select id="camunda-'+resource.id+'-select" name="'+modelProperty+'"'+(canBeDisabled?'data-disable="isDisabled" ':"")+(canBeHidden?'data-show="isHidden" ':"")+" data-value>",isList(selectOptions)&&forEach(selectOptions,function(option){resource.html+='<option value="'+option.value+'">'+(option.name||"")+"</option>"}),resource.html+="</select>",description&&"function"===(options.showCustomInput,!1)&&(resource.html+=entryFieldDescription(description)),resource.setControlValue=function(element,entryNode,inputNode,inputName,newValue){if("function"==typeof selectOptions){var options=selectOptions(element,inputNode);if(options){for(;inputNode.firstChild;)inputNode.removeChild(inputNode.firstChild);forEach(options,function(option){var template=domify(createOption(option));inputNode.appendChild(template)})}}void 0!==newValue&&(inputNode.value=newValue)},canBeDisabled&&(resource.isDisabled=function(){return options.disabled.apply(resource,arguments)}),canBeHidden&&(resource.isHidden=function(){return!options.hidden.apply(resource,arguments)}),resource.cssClasses=["dropdown"],resource};module.exports=selectbox},{14:14,179:179,91:91}],18:[function(_dereq_,module,exports){"use strict";function createInputRowTemplate(properties,canRemove){var template=TABLE_ROW_DIV_SNIPPET;return template+=createInputTemplate(properties,canRemove),template+=canRemove?DELETE_ROW_BUTTON_SNIPPET:"",template+="</div>"}function createInputTemplate(properties,canRemove){var columns=properties.length,template="";return forEach(properties,function(prop){template+='<input class="bpp-table-row-columns-'+columns+" "+(canRemove?"bpp-table-row-removable":"")+'" id="camunda-table-row-cell-input-value" type="text" name="'+prop+'" />'}),template}function createLabelRowTemplate(labels){var template=TABLE_ROW_DIV_SNIPPET;return template+=createLabelTemplate(labels),template+="</div>"}function createLabelTemplate(labels){var columns=labels.length,template="";return forEach(labels,function(label){template+='<label class="bpp-table-row-columns-'+columns+'">'+label+"</label>"}),template}function pick(elements,properties){return(elements||[]).map(function(elem){var newElement={};return forEach(properties,function(prop){newElement[prop]=elem[prop]||""}),newElement})}function diff(element,node,values,oldValues,editable){return filter(values,function(value,idx){return!valueEqual(element,node,value,oldValues[idx],editable,idx)})}function valueEqual(element,node,value,oldValue,editable,idx){return!(value&&!oldValue)&&keys(value).concat(keys(oldValue)).every(function(key){var n=value[key]||void 0,o=oldValue[key]||void 0;return!editable(element,node,key,idx)||n===o})}function getEntryNode(node){return domClosest(node,"[data-entry]",!0)}function getContainer(node){return domQuery("div[data-list-entry-container]",node)}function getSelection(node){return{start:node.selectionStart,end:node.selectionEnd}}function setSelection(node,selection){node.selectionStart=selection.start,node.selectionEnd=selection.end}var cmdHelper=_dereq_(22),domQuery=_dereq_(182),domAttr=_dereq_(174),domClosest=_dereq_(177),filter=_dereq_(89),forEach=_dereq_(91),keys=_dereq_(168),domify=_dereq_(179),entryFieldDescription=_dereq_(14),updateSelection=_dereq_(185),TABLE_ROW_DIV_SNIPPET='<div class="bpp-field-wrapper bpp-table-row">',DELETE_ROW_BUTTON_SNIPPET='<button class="clear" data-action="deleteElement"><span>X</span></button>';module.exports=function(options){var id=options.id,modelProperties=options.modelProperties,labels=options.labels,description=options.description,labelRow=createLabelRowTemplate(labels),getElements=options.getElements,removeElement=options.removeElement,canRemove="function"==typeof removeElement,addElement=options.addElement,canAdd="function"==typeof addElement,addLabel=options.addLabel||"Add Value",updateElement=options.updateElement,canUpdate="function"==typeof updateElement,editable=options.editable||function(){return!0},setControlValue=options.setControlValue,show=options.show,canBeShown="function"==typeof show,elements=function(element,node){return pick(getElements(element,node),modelProperties)},factory={id:id,html:(canAdd?'<div class="bpp-table-add-row" '+(canBeShown?'data-show="show"':"")+"><label>"+addLabel+'</label><button class="add" data-action="addElement"><span>+</span></button></div>':"")+'<div class="bpp-table" data-show="showTable"><div class="bpp-field-wrapper bpp-table-row">'+labelRow+"</div><div data-list-entry-container></div></div>"+(description?entryFieldDescription(description):""),get:function(element,node){var boElements=elements(element,node,this.__invalidValues),invalidValues=this.__invalidValues;return delete this.__invalidValues,forEach(invalidValues,function(value,idx){var element=boElements[idx];forEach(modelProperties,function(prop){element[prop]=value[prop]})}),boElements},set:function(element,values,node){var action=this.__action||{};if(delete this.__action,"delete-element"===action.id)return removeElement(element,node,action.idx);if("add-element"===action.id)return addElement(element,node);if(canUpdate){var commands=[],valuesToValidate=values;"function"!=typeof options.validate&&(valuesToValidate=diff(element,node,values,elements(element,node),editable));var self=this;return forEach(valuesToValidate,function(value){var validationError,idx=values.indexOf(value);if("function"==typeof options.validate&&(validationError=options.validate(element,value,node,idx)),validationError)self.__invalidValues=self.__invalidValues||{},self.__invalidValues[idx]=value,commands.push(cmdHelper.updateProperties(element,{}));else{var cmd=updateElement(element,value,node,idx);cmd&&commands.push(cmd)}}),commands}},createListEntryTemplate:function(value,index,selectBox){return createInputRowTemplate(modelProperties,canRemove)},addElement:function(element,node,event,scopeNode){var template=domify(createInputRowTemplate(modelProperties,canRemove));return getContainer(node).appendChild(template),this.__action={id:"add-element"},!0},deleteElement:function(element,node,event,scopeNode){var container=getContainer(node),rowToDelete=event.delegateTarget.parentNode,idx=parseInt(domAttr(rowToDelete,"data-index"),10);return container.removeChild(rowToDelete),this.__action={id:"delete-element",idx:idx},!0},editable:function(element,rowNode,input,prop,value,idx){var entryNode=domClosest(rowNode,"[data-entry]");return editable(element,entryNode,prop,idx)},show:function(element,entryNode,node,scopeNode){return entryNode=getEntryNode(entryNode),show(element,entryNode,node,scopeNode)},showTable:function(element,entryNode,node,scopeNode){entryNode=getEntryNode(entryNode);var elems=elements(element,entryNode);return elems&&elems.length&&(!canBeShown||show(element,entryNode,node,scopeNode))},validateListItem:function(element,value,node,idx){if("function"==typeof options.validate)return options.validate(element,value,node,idx)}};return setControlValue&&(factory.setControlValue=function(element,rowNode,input,prop,value,idx){var selection,entryNode=getEntryNode(rowNode),isReadOnly=domAttr(input,"readonly"),oldValue=input.value;void 0===value&&(value=""),isReadOnly&&oldValue===value||(document.activeElement===input&&(selection=updateSelection(getSelection(input),oldValue,value)),setControlValue(element,entryNode,input,prop,value,idx),selection&&setSelection(input,selection))}),factory}},{14:14,168:168,174:174,177:177,179:179,182:182,185:185,22:22,89:89,91:91}],19:[function(_dereq_,module,exports){"use strict";var entryFieldDescription=_dereq_(14),textBox=function(options,defaultParameters){var resource=defaultParameters,label=options.label||resource.id,canBeShown=!!options.show&&"function"==typeof options.show,description=options.description;return resource.html='<label for="camunda-'+resource.id+'" '+(canBeShown?'data-show="isShown"':"")+">"+label+'</label><div class="bpp-field-wrapper" '+(canBeShown?'data-show="isShown"':"")+'><div contenteditable="true" id="camunda-'+resource.id+'" name="'+options.modelProperty+'" /></div>',description&&(resource.html+=entryFieldDescription(description)),canBeShown&&(resource.isShown=function(){return options.show.apply(resource,arguments)}),resource.cssClasses=["bpp-textbox"],resource};module.exports=textBox},{14:14}],20:[function(_dereq_,module,exports){"use strict";var domQuery=_dereq_(182),entryFieldDescription=_dereq_(14),textField=function(options,defaultParameters){var defaultButtonAction=function(element,inputNode){return domQuery('input[name="'+options.modelProperty+'"]',inputNode).value="",!0},defaultButtonShow=function(element,inputNode){return""!==domQuery('input[name="'+options.modelProperty+'"]',inputNode).value},resource=defaultParameters,label=options.label||resource.id,dataValueLabel=options.dataValueLabel,buttonLabel=options.buttonLabel||"X",actionName=void 0!==options.buttonAction?options.buttonAction.name:"clear",actionMethod=void 0!==options.buttonAction?options.buttonAction.method:defaultButtonAction,showName=void 0!==options.buttonShow?options.buttonShow.name:"canClear",showMethod=void 0!==options.buttonShow?options.buttonShow.method:defaultButtonShow,canBeDisabled=!!options.disabled&&"function"==typeof options.disabled,canBeHidden=!!options.hidden&&"function"==typeof options.hidden,description=options.description;return resource.html='<label for="camunda-'+resource.id+'" '+(canBeDisabled?'data-disable="isDisabled" ':"")+(canBeHidden?'data-show="isHidden" ':"")+(dataValueLabel?'data-value="'+dataValueLabel+'"':"")+">"+label+'</label><div class="bpp-field-wrapper" '+(canBeDisabled?'data-disable="isDisabled"':"")+(canBeHidden?'data-show="isHidden"':"")+'><input id="camunda-'+resource.id+'" type="text" name="'+options.modelProperty+'" '+(canBeDisabled?'data-disable="isDisabled"':"")+(canBeHidden?'data-show="isHidden"':"")+' /><button class="'+actionName+'" data-action="'+actionName+'" data-show="'+showName+'" '+(canBeDisabled?'data-disabled="isDisabled"':"")+(canBeHidden?' data-show="isHidden"':"")+"><span>"+buttonLabel+"</span></button></div>",description&&(resource.html+=entryFieldDescription(description)),resource[actionName]=actionMethod,resource[showName]=showMethod,canBeDisabled&&(resource.isDisabled=function(){return options.disabled.apply(resource,arguments)}),canBeHidden&&(resource.isHidden=function(){return!options.hidden.apply(resource,arguments)}),resource.cssClasses=["bpp-textfield"],resource};module.exports=textField},{14:14,182:182}],21:[function(_dereq_,module,exports){"use strict";var textField=_dereq_(20),validationAwareTextField=function(options,defaultParameters){var modelProperty=options.modelProperty;defaultParameters.get=function(element,node){var value=this.__lastInvalidValue;delete this.__lastInvalidValue;var properties={};return properties[modelProperty]=void 0!==value?value:options.getProperty(element,node),properties},defaultParameters.set=function(element,values,node){var validationErrors=validate.apply(this,[element,values,node]),propertyValue=values[modelProperty];if(validationErrors&&validationErrors[modelProperty])return this.__lastInvalidValue=propertyValue,options.setProperty(element,{},node);var properties={};return properties[modelProperty]=propertyValue,options.setProperty(element,properties,node)};var validate=defaultParameters.validate=function(element,values,node){var value=values[modelProperty]||this.__lastInvalidValue,property={};return property[modelProperty]=value,options.validate(element,property,node)};return textField(options,defaultParameters)};module.exports=validationAwareTextField},{20:20}],22:[function(_dereq_,module,exports){"use strict";var CmdHelper={};module.exports=CmdHelper,CmdHelper.updateProperties=function(element,properties){return{cmd:"element.updateProperties",context:{element:element,properties:properties}}},CmdHelper.updateBusinessObject=function(element,businessObject,newProperties){return{cmd:"properties-panel.update-businessobject",context:{element:element,businessObject:businessObject,properties:newProperties}}},CmdHelper.addElementsTolist=function(element,businessObject,listPropertyName,objectsToAdd){return{cmd:"properties-panel.update-businessobject-list",context:{element:element,currentObject:businessObject,propertyName:listPropertyName,objectsToAdd:objectsToAdd}}},CmdHelper.removeElementsFromList=function(element,businessObject,listPropertyName,referencePropertyName,objectsToRemove){return{cmd:"properties-panel.update-businessobject-list",context:{element:element,currentObject:businessObject,propertyName:listPropertyName,referencePropertyName:referencePropertyName,objectsToRemove:objectsToRemove}}},CmdHelper.addAndRemoveElementsFromList=function(element,businessObject,listPropertyName,referencePropertyName,objectsToAdd,objectsToRemove){return{cmd:"properties-panel.update-businessobject-list",context:{element:element,currentObject:businessObject,propertyName:listPropertyName,referencePropertyName:referencePropertyName,objectsToAdd:objectsToAdd,objectsToRemove:objectsToRemove}}},CmdHelper.setList=function(element,businessObject,listPropertyName,updatedObjectList){return{cmd:"properties-panel.update-businessobject-list",context:{element:element,currentObject:businessObject,propertyName:listPropertyName,updatedObjectList:updatedObjectList}}}},{}],23:[function(_dereq_,module,exports){"use strict";var ElementHelper={};module.exports=ElementHelper,ElementHelper.createElement=function(elementType,properties,parent,factory){var element=factory.create(elementType,properties);return element.$parent=parent,element}},{}],24:[function(_dereq_,module,exports){"use strict";var getBusinessObject=_dereq_(69).getBusinessObject,is=_dereq_(69).is,forEach=_dereq_(91),EventDefinitionHelper={};module.exports=EventDefinitionHelper,EventDefinitionHelper.getEventDefinition=function(element,eventType){var bo=getBusinessObject(element),eventDefinition=null;return bo.eventDefinitions&&forEach(bo.eventDefinitions,function(event){is(event,eventType)&&(eventDefinition=event)}),eventDefinition},EventDefinitionHelper.getTimerEventDefinition=function(element){return this.getEventDefinition(element,"bpmn:TimerEventDefinition")},EventDefinitionHelper.getMessageEventDefinition=function(element){return this.getEventDefinition(element,"bpmn:MessageEventDefinition")},EventDefinitionHelper.getSignalEventDefinition=function(element){return this.getEventDefinition(element,"bpmn:SignalEventDefinition")},EventDefinitionHelper.getErrorEventDefinition=function(element){return this.getEventDefinition(element,"bpmn:ErrorEventDefinition")},EventDefinitionHelper.getEscalationEventDefinition=function(element){return this.getEventDefinition(element,"bpmn:EscalationEventDefinition")},EventDefinitionHelper.getCompensateEventDefinition=function(element){return this.getEventDefinition(element,"bpmn:CompensateEventDefinition")},EventDefinitionHelper.getLinkEventDefinition=function(element){return this.getEventDefinition(element,"bpmn:LinkEventDefinition")},EventDefinitionHelper.getConditionalEventDefinition=function(element){return this.getEventDefinition(element,"bpmn:ConditionalEventDefinition")}},{69:69,91:91}],25:[function(_dereq_,module,exports){"use strict";var cmdHelper=_dereq_(22),elementHelper=_dereq_(23),is=_dereq_(69).is,ExtensionElementsHelper={},getExtensionElements=function(bo){return bo.get("extensionElements")};ExtensionElementsHelper.getExtensionElements=function(bo,type){var extensionElements=getExtensionElements(bo);if(void 0!==extensionElements){var extensionValues=extensionElements.get("values");if(void 0!==extensionValues){var elements=extensionValues.filter(function(value){return is(value,type)});if(elements.length)return elements}}},ExtensionElementsHelper.addEntry=function(bo,element,entry,bpmnFactory){var extensionElements=bo.get("extensionElements");return extensionElements?cmdHelper.addElementsTolist(element,extensionElements,"values",[entry]):(extensionElements=elementHelper.createElement("bpmn:ExtensionElements",{values:[entry]},bo,bpmnFactory),{extensionElements:extensionElements})},ExtensionElementsHelper.removeEntry=function(bo,element,entry){var extensionElements=bo.get("extensionElements");return extensionElements?cmdHelper.removeElementsFromList(element,extensionElements,"values","extensionElements",[entry]):{}},module.exports=ExtensionElementsHelper},{22:22,23:23,69:69}],26:[function(_dereq_,module,exports){"use strict";var ModelUtil=_dereq_(69),is=ModelUtil.is,getBusinessObject=ModelUtil.getBusinessObject,eventDefinitionHelper=_dereq_(24),extensionsElementHelper=_dereq_(25),ImplementationTypeHelper={};module.exports=ImplementationTypeHelper,ImplementationTypeHelper.isServiceTaskLike=function(element){return is(element,"camunda:ServiceTaskLike")},ImplementationTypeHelper.isDmnCapable=function(element){return is(element,"camunda:DmnCapable")},ImplementationTypeHelper.isExternalCapable=function(element){return is(element,"camunda:ExternalCapable")},ImplementationTypeHelper.isTaskListener=function(element){return is(element,"camunda:TaskListener")},ImplementationTypeHelper.isExecutionListener=function(element){return is(element,"camunda:ExecutionListener")},ImplementationTypeHelper.isListener=function(element){return this.isTaskListener(element)||this.isExecutionListener(element)},ImplementationTypeHelper.isSequenceFlow=function(element){return is(element,"bpmn:SequenceFlow")},ImplementationTypeHelper.getServiceTaskLikeBusinessObject=function(element){if(is(element,"bpmn:IntermediateThrowEvent")||is(element,"bpmn:EndEvent")){var messageEventDefinition=eventDefinitionHelper.getMessageEventDefinition(element);messageEventDefinition&&(element=messageEventDefinition)}return this.isServiceTaskLike(element)&&getBusinessObject(element)},ImplementationTypeHelper.getImplementationType=function(element){var bo=this.getServiceTaskLikeBusinessObject(element);if(!bo){if(!this.isListener(element))return;bo=element}if(this.isDmnCapable(bo)){if(void 0!==bo.get("camunda:decisionRef"))return"dmn"}if(this.isServiceTaskLike(bo)){if(void 0!==extensionsElementHelper.getExtensionElements(bo,"camunda:Connector"))return"connector"}if(this.isExternalCapable(bo)){if("external"===bo.get("camunda:type"))return"external"}if(void 0!==bo.get("camunda:class"))return"class";if(void 0!==bo.get("camunda:expression"))return"expression";if(void 0!==bo.get("camunda:delegateExpression"))return"delegateExpression";if(this.isListener(bo)){if(void 0!==bo.get("script"))return"script"}}},{24:24,25:25,69:69}],27:[function(_dereq_,module,exports){"use strict";function getElements(bo,type,prop){var elems=extensionElementsHelper.getExtensionElements(bo,type)||[];return prop?(elems[0]||{})[prop]||[]:elems}function getParameters(element,prop,insideConnector){var inputOutput=InputOutputHelper.getInputOutput(element,insideConnector);return inputOutput&&inputOutput.get(prop)||[]}var ModelUtil=_dereq_(69),is=ModelUtil.is,getBusinessObject=ModelUtil.getBusinessObject,extensionElementsHelper=_dereq_(25),implementationTypeHelper=_dereq_(26),InputOutputHelper={};module.exports=InputOutputHelper,InputOutputHelper.getInputOutput=function(element,insideConnector){if(!insideConnector){return(getElements(getBusinessObject(element),"camunda:InputOutput")||[])[0]}var connector=this.getConnector(element);return connector&&connector.get("inputOutput")},InputOutputHelper.getConnector=function(element){var bo=implementationTypeHelper.getServiceTaskLikeBusinessObject(element);return bo&&(getElements(bo,"camunda:Connector")||[])[0]},InputOutputHelper.getInputParameters=function(element,insideConnector){return getParameters.apply(this,[element,"inputParameters",insideConnector])},InputOutputHelper.getOutputParameters=function(element,insideConnector){return getParameters.apply(this,[element,"outputParameters",insideConnector])},InputOutputHelper.getInputParameter=function(element,insideConnector,idx){return this.getInputParameters(element,insideConnector)[idx]},InputOutputHelper.getOutputParameter=function(element,insideConnector,idx){return this.getOutputParameters(element,insideConnector)[idx]},InputOutputHelper.isInputOutputSupported=function(element,insideConnector){var bo=getBusinessObject(element);return insideConnector||is(bo,"bpmn:FlowNode")&&!is(bo,"bpmn:StartEvent")&&!is(bo,"bpmn:BoundaryEvent")&&!(is(bo,"bpmn:SubProcess")&&bo.get("triggeredByEvent"))},InputOutputHelper.areOutputParametersSupported=function(element,insideConnector){var bo=getBusinessObject(element);return insideConnector||!is(bo,"bpmn:EndEvent")&&!bo.loopCharacteristics}},{25:25,26:26,69:69}],28:[function(_dereq_,module,exports){"use strict";var is=_dereq_(69).is,getBusinessObject=_dereq_(69).getBusinessObject,cmdHelper=_dereq_(22),ParticipantHelper={};module.exports=ParticipantHelper,ParticipantHelper.modifyProcessBusinessObject=function(element,property,values){if(!is(element,"bpmn:Participant"))return{};var bo=getBusinessObject(element).get("processRef"),properties={};return properties[property]=values[property],cmdHelper.updateBusinessObject(element,bo,properties)},ParticipantHelper.getProcessBusinessObject=function(element,propertyName){if(!is(element,"bpmn:Participant"))return{};var bo=getBusinessObject(element).get("processRef"),properties={};return properties[propertyName]=bo.get(propertyName),properties}},{22:22,69:69}],29:[function(_dereq_,module,exports){module.exports={__depends__:[_dereq_(10),_dereq_(79)],__init__:["propertiesPanel"],propertiesPanel:["type",_dereq_(3)]}},{10:10,3:3,79:79}],30:[function(_dereq_,module,exports){"use strict";var is=_dereq_(69).is,isAny=_dereq_(67).isAny,isEventSubProcess=_dereq_(68).isEventSubProcess,getBusinessObject=_dereq_(69).getBusinessObject,eventDefinitionHelper=_dereq_(24),forEach=_dereq_(91),message=_dereq_(41),signal=_dereq_(43),error=_dereq_(38),escalation=_dereq_(39),timer=_dereq_(44),compensation=_dereq_(35),condition=_dereq_(36);module.exports=function(group,element,bpmnFactory,elementRegistry,translate){if(forEach(["bpmn:StartEvent","bpmn:EndEvent","bpmn:IntermediateThrowEvent","bpmn:BoundaryEvent","bpmn:IntermediateCatchEvent"],function(event){if(is(element,event)){var messageEventDefinition=eventDefinitionHelper.getMessageEventDefinition(element),signalEventDefinition=eventDefinitionHelper.getSignalEventDefinition(element);messageEventDefinition&&message(group,element,bpmnFactory,messageEventDefinition),signalEventDefinition&&signal(group,element,bpmnFactory,signalEventDefinition)}}),is(element,"bpmn:ReceiveTask")&&message(group,element,bpmnFactory,getBusinessObject(element)),forEach(["bpmn:StartEvent","bpmn:BoundaryEvent","bpmn:EndEvent"],function(event){if(is(element,event)){
var errorEventDefinition=eventDefinitionHelper.getErrorEventDefinition(element);if(errorEventDefinition){var isCatchingErrorEvent=is(element,"bpmn:StartEvent")||is(element,"bpmn:BoundaryEvent");error(group,element,bpmnFactory,errorEventDefinition,isCatchingErrorEvent,isCatchingErrorEvent)}}}),forEach(["bpmn:StartEvent","bpmn:BoundaryEvent","bpmn:IntermediateThrowEvent","bpmn:EndEvent"],function(event){if(is(element,event)){var showEscalationCodeVariable=is(element,"bpmn:StartEvent")||is(element,"bpmn:BoundaryEvent"),escalationEventDefinition=eventDefinitionHelper.getEscalationEventDefinition(element);escalationEventDefinition&&escalation(group,element,bpmnFactory,escalationEventDefinition,showEscalationCodeVariable)}}),forEach(["bpmn:StartEvent","bpmn:BoundaryEvent","bpmn:IntermediateCatchEvent"],function(event){if(is(element,event)){var timerEventDefinition=eventDefinitionHelper.getTimerEventDefinition(element);timerEventDefinition&&timer(group,element,bpmnFactory,timerEventDefinition)}}),forEach(["bpmn:EndEvent","bpmn:IntermediateThrowEvent"],function(event){if(is(element,event)){var compensateEventDefinition=eventDefinitionHelper.getCompensateEventDefinition(element);compensateEventDefinition&&compensation(group,element,bpmnFactory,compensateEventDefinition,elementRegistry)}}),isAny(element,["bpmn:BoundaryEvent","bpmn:IntermediateThrowEvent","bpmn:IntermediateCatchEvent"])||is(element,"bpmn:StartEvent")&&isEventSubProcess(element.parent)){var conditionalEventDefinition=eventDefinitionHelper.getConditionalEventDefinition(element);conditionalEventDefinition&&condition(group,element,bpmnFactory,conditionalEventDefinition,elementRegistry)}}},{24:24,35:35,36:36,38:38,39:39,41:41,43:43,44:44,67:67,68:68,69:69,91:91}],31:[function(_dereq_,module,exports){"use strict";var entryFactory=_dereq_(13),getBusinessObject=_dereq_(69).getBusinessObject,utils=_dereq_(4),cmdHelper=_dereq_(22);module.exports=function(group,element,translate){group.entries.push(entryFactory.validationAwareTextField({id:"id",label:translate("Id"),modelProperty:"id",getProperty:function(element){return getBusinessObject(element).id},setProperty:function(element,properties){return element=element.labelTarget||element,cmdHelper.updateProperties(element,properties)},validate:function(element,values){var idValue=values.id,bo=getBusinessObject(element),idError=utils.isIdValid(bo,idValue);return idError?{id:idError}:{}}}))}},{13:13,22:22,4:4,69:69}],32:[function(_dereq_,module,exports){"use strict";function getLinkEventDefinition(element){var bo=getBusinessObject(element),linkEventDefinition=null;return bo.eventDefinitions&&forEach(bo.eventDefinitions,function(eventDefinition){is(eventDefinition,"bpmn:LinkEventDefinition")&&(linkEventDefinition=eventDefinition)}),linkEventDefinition}var is=_dereq_(69).is,getBusinessObject=_dereq_(69).getBusinessObject,entryFactory=_dereq_(13),cmdHelper=_dereq_(22),forEach=_dereq_(91);module.exports=function(group,element,translate){forEach(["bpmn:IntermediateThrowEvent","bpmn:IntermediateCatchEvent"],function(event){if(is(element,event)){var linkEventDefinition=getLinkEventDefinition(element);if(linkEventDefinition){var entry=entryFactory.textField({id:"link-event",label:translate("Link Name"),modelProperty:"link-name"});entry.get=function(){return{"link-name":linkEventDefinition.get("name")}},entry.set=function(element,values){var newProperties={name:values["link-name"]};return cmdHelper.updateBusinessObject(element,linkEventDefinition,newProperties)},group.entries.push(entry)}}})}},{13:13,22:22,69:69,91:91}],33:[function(_dereq_,module,exports){"use strict";var nameEntryFactory=_dereq_(42),is=_dereq_(69).is;module.exports=function(group,element,translate){if(!is(element,"bpmn:Collaboration")){var options;is(element,"bpmn:TextAnnotation")&&(options={modelProperty:"text"}),group.entries=group.entries.concat(nameEntryFactory(element,options,translate))}}},{42:42,69:69}],34:[function(_dereq_,module,exports){"use strict";var is=_dereq_(69).is,entryFactory=_dereq_(13),participantHelper=_dereq_(28),getBusinessObject=_dereq_(69).getBusinessObject,nameEntryFactory=_dereq_(42),utils=_dereq_(4);module.exports=function(group,element,translate){var businessObject=getBusinessObject(element);if((is(element,"bpmn:Process")||is(element,"bpmn:Participant")&&businessObject.get("processRef"))&&is(element,"bpmn:Participant")){var idEntry=entryFactory.validationAwareTextField({id:"process-id",label:translate("Process Id"),modelProperty:"processId"});idEntry.get=function(element){return{processId:participantHelper.getProcessBusinessObject(element,"id").id}},idEntry.set=function(element,values){return participantHelper.modifyProcessBusinessObject(element,"id",{id:values.processId})},idEntry.validate=function(element,values){var idValue=values.processId,bo=getBusinessObject(element),processIdError=utils.isIdValid(bo.processRef,idValue);return processIdError?{processId:processIdError}:{}},group.entries.push(idEntry);var processNameEntry=nameEntryFactory(element,{id:"process-name",label:translate("Process Name")})[0];processNameEntry.get=function(element){return participantHelper.getProcessBusinessObject(element,"name")},processNameEntry.set=function(element,values){return participantHelper.modifyProcessBusinessObject(element,"name",values)},group.entries.push(processNameEntry)}}},{13:13,28:28,4:4,42:42,69:69}],35:[function(_dereq_,module,exports){"use strict";function getContainedActivities(element){return getFlowElements(element,"bpmn:Activity")}function getContainedBoundaryEvents(element){return getFlowElements(element,"bpmn:BoundaryEvent")}function getFlowElements(element,type){return utils.filterElementsByType(element.flowElements,type)}function isCompensationEventAttachedToActivity(activity,boundaryEvents){var activityId=activity.id;return!!find(boundaryEvents,function(boundaryEvent){var compensateEventDefinition=eventDefinitionHelper.getCompensateEventDefinition(boundaryEvent),attachedToRef=boundaryEvent.attachedToRef;return compensateEventDefinition&&attachedToRef&&attachedToRef.id===activityId})}function canActivityBeCompensated(activity,boundaryEvents){return is(activity,"bpmn:SubProcess")&&!activity.triggeredByEvent||is(activity,"bpmn:CallActivity")||isCompensationEventAttachedToActivity(activity,boundaryEvents)}function getActivitiesForCompensation(element){var boundaryEvents=getContainedBoundaryEvents(element);return filter(getContainedActivities(element),function(activity){return canActivityBeCompensated(activity,boundaryEvents)})}function getActivitiesForActivityRef(element){var bo=getBusinessObject(element),parent=bo.$parent,activitiesForActivityRef=getActivitiesForCompensation(parent);return is(parent,"bpmn:SubProcess")&&parent.triggeredByEvent&&(parent=parent.$parent)&&(activitiesForActivityRef=activitiesForActivityRef.concat(getActivitiesForCompensation(parent))),activitiesForActivityRef}function createActivityRefOptions(element){var options=[{value:""}],activities=getActivitiesForActivityRef(element);return forEach(activities,function(activity){var activityId=activity.id,name=(activity.name?activity.name+" ":"")+"(id="+activityId+")";options.push({value:activityId,name:name})}),options}var entryFactory=_dereq_(13),cmdHelper=_dereq_(22),eventDefinitionHelper=_dereq_(24),utils=_dereq_(4),getBusinessObject=_dereq_(69).getBusinessObject,is=_dereq_(69).is,forEach=_dereq_(91),find=_dereq_(90),filter=_dereq_(89);module.exports=function(group,element,bpmnFactory,compensateEventDefinition,elementRegistry){group.entries.push(entryFactory.checkbox({id:"wait-for-completion",label:"Wait for Completion",modelProperty:"waitForCompletion",get:function(element,node){return{waitForCompletion:compensateEventDefinition.waitForCompletion}},set:function(element,values){return values.waitForCompletion=values.waitForCompletion||void 0,cmdHelper.updateBusinessObject(element,compensateEventDefinition,values)}})),group.entries.push(entryFactory.selectBox({id:"activity-ref",label:"Activity Ref",selectOptions:createActivityRefOptions(element),modelProperty:"activityRef",get:function(element,node){var activityRef=compensateEventDefinition.activityRef;return activityRef=activityRef&&activityRef.id,{activityRef:activityRef||""}},set:function(element,values){var activityRef=values.activityRef||void 0;return activityRef=activityRef&&getBusinessObject(elementRegistry.get(activityRef)),cmdHelper.updateBusinessObject(element,compensateEventDefinition,{activityRef:activityRef})}}))}},{13:13,22:22,24:24,4:4,69:69,89:89,90:90,91:91}],36:[function(_dereq_,module,exports){"use strict";function createFormalExpression(parent,body,bpmnFactory){return body=body||void 0,elementHelper.createElement("bpmn:FormalExpression",{body:body},parent,bpmnFactory)}var entryFactory=_dereq_(13),elementHelper=_dereq_(23),cmdHelper=_dereq_(22);module.exports=function(group,element,bpmnFactory,conditionalEventDefinition){var getValue=function(modelProperty){return function(element){var modelPropertyValue=conditionalEventDefinition.get("camunda:"+modelProperty),value={};return value[modelProperty]=modelPropertyValue,value}},setValue=function(modelProperty){return function(element,values){var props={};return props["camunda:"+modelProperty]=values[modelProperty]||void 0,cmdHelper.updateBusinessObject(element,conditionalEventDefinition,props)}};group.entries.push(entryFactory.textField({id:"condition",label:"Condition",modelProperty:"condition",get:function(element){var condition=conditionalEventDefinition.get("condition");return{condition:condition&&condition.get("body")||""}},set:function(element,values){var condition=conditionalEventDefinition.get("condition");return""===values.condition?cmdHelper.updateBusinessObject(element,conditionalEventDefinition,{condition:void 0}):condition?cmdHelper.updateBusinessObject(element,condition,{body:values.condition||void 0}):(condition=createFormalExpression(conditionalEventDefinition,values.condition,bpmnFactory),cmdHelper.updateBusinessObject(element,conditionalEventDefinition,{condition:condition}))},validate:function(element,values){if(""===values.condition)return{condition:"Must provide a value"}}})),group.entries.push(entryFactory.textField({id:"variableName",label:"Variable Name",modelProperty:"variableName",get:getValue("variableName"),set:setValue("variableName")})),group.entries.push(entryFactory.textField({id:"variableEvent",label:"Variable Event",description:"Specify more than one variable change event as a comma separated list.",modelProperty:"variableEvent",get:getValue("variableEvent"),set:setValue("variableEvent")}))}},{13:13,22:22,23:23}],37:[function(_dereq_,module,exports){"use strict";var entryFactory=_dereq_(13),cmdHelper=_dereq_(22);module.exports=function(element,definition,bpmnFactory,options){var id=options.id||"element-property",label=options.label,referenceProperty=options.referenceProperty,modelProperty=options.modelProperty||"name",shouldValidate=options.shouldValidate||!1,entry=entryFactory.textField({id:id,label:label,modelProperty:modelProperty,get:function(element,node){var reference=definition.get(referenceProperty),props={};return props[modelProperty]=reference&&reference.get(modelProperty),props},set:function(element,values,node){var reference=definition.get(referenceProperty),props={};return props[modelProperty]=values[modelProperty]||void 0,cmdHelper.updateBusinessObject(element,reference,props)},hidden:function(element,node){return!definition.get(referenceProperty)}});return shouldValidate&&(entry.validate=function(element,values,node){if(definition.get(referenceProperty)&&!values[modelProperty]){var validationErrors={};return validationErrors[modelProperty]="Must provide a value",validationErrors}}),[entry]}},{13:13,22:22}],38:[function(_dereq_,module,exports){"use strict";var entryFactory=_dereq_(13),cmdHelper=_dereq_(22),eventDefinitionReference=_dereq_(40),elementReferenceProperty=_dereq_(37);module.exports=function(group,element,bpmnFactory,errorEventDefinition,showErrorCodeVariable,showErrorMessageVariable){var getValue=function(modelProperty){return function(element){var modelPropertyValue=errorEventDefinition.get("camunda:"+modelProperty),value={};return value[modelProperty]=modelPropertyValue,value}},setValue=function(modelProperty){return function(element,values){var props={};return props["camunda:"+modelProperty]=values[modelProperty]||void 0,cmdHelper.updateBusinessObject(element,errorEventDefinition,props)}};group.entries=group.entries.concat(eventDefinitionReference(element,errorEventDefinition,bpmnFactory,{label:"Error",elementName:"error",elementType:"bpmn:Error",referenceProperty:"errorRef",newElementIdPrefix:"Error_"})),group.entries=group.entries.concat(elementReferenceProperty(element,errorEventDefinition,bpmnFactory,{id:"error-element-name",label:"Error Name",referenceProperty:"errorRef",modelProperty:"name",shouldValidate:!0})),group.entries=group.entries.concat(elementReferenceProperty(element,errorEventDefinition,bpmnFactory,{id:"error-element-code",label:"Error Code",referenceProperty:"errorRef",modelProperty:"errorCode"})),showErrorCodeVariable&&group.entries.push(entryFactory.textField({id:"errorCodeVariable",label:"Error Code Variable",modelProperty:"errorCodeVariable",get:getValue("errorCodeVariable"),set:setValue("errorCodeVariable")})),showErrorMessageVariable&&group.entries.push(entryFactory.textField({id:"errorMessageVariable",label:"Error Message Variable",modelProperty:"errorMessageVariable",get:getValue("errorMessageVariable"),set:setValue("errorMessageVariable")}))}},{13:13,22:22,37:37,40:40}],39:[function(_dereq_,module,exports){"use strict";var entryFactory=_dereq_(13),cmdHelper=_dereq_(22),eventDefinitionReference=_dereq_(40),elementReferenceProperty=_dereq_(37);module.exports=function(group,element,bpmnFactory,escalationEventDefinition,showEscalationCodeVariable){group.entries=group.entries.concat(eventDefinitionReference(element,escalationEventDefinition,bpmnFactory,{label:"Escalation",elementName:"escalation",elementType:"bpmn:Escalation",referenceProperty:"escalationRef",newElementIdPrefix:"Escalation_"})),group.entries=group.entries.concat(elementReferenceProperty(element,escalationEventDefinition,bpmnFactory,{id:"escalation-element-name",label:"Escalation Name",referenceProperty:"escalationRef",modelProperty:"name",shouldValidate:!0})),group.entries=group.entries.concat(elementReferenceProperty(element,escalationEventDefinition,bpmnFactory,{id:"escalation-element-code",label:"Escalation Code",referenceProperty:"escalationRef",modelProperty:"escalationCode"})),showEscalationCodeVariable&&group.entries.push(entryFactory.textField({id:"escalationCodeVariable",label:"Escalation Code Variable",modelProperty:"escalationCodeVariable",get:function(element){return{escalationCodeVariable:escalationEventDefinition.get("camunda:escalationCodeVariable")}},set:function(element,values){return cmdHelper.updateBusinessObject(element,escalationEventDefinition,{"camunda:escalationCodeVariable":values.escalationCodeVariable||void 0})}}))}},{13:13,22:22,37:37,40:40}],40:[function(_dereq_,module,exports){"use strict";function getSelectBox(node){return domQuery(selector,node.parentElement)}function findElementById(eventDefinition,type,id){var elements=utils.findRootElementsByType(eventDefinition,type);return find(elements,function(element){return element.id===id})}var cmdHelper=_dereq_(22),domQuery=_dereq_(182),domify=_dereq_(179),domAttr=_dereq_(174),forEach=_dereq_(91),find=_dereq_(90),elementHelper=_dereq_(23),utils=_dereq_(4),selector="select[name=selectedElement]";module.exports=function(element,definition,bpmnFactory,options){var elementName=options.elementName||"",elementType=options.elementType,referenceProperty=options.referenceProperty,newElementIdPrefix=options.newElementIdPrefix||"elem_",label=options.label||"",description=options.description||"",entries=[];return entries.push({id:"event-definitions-"+elementName,description:description,html:'<div class="bpp-row bpp-select"><label for="camunda-'+elementName+'">'+label+'</label><div class="bpp-field-wrapper"><select id="camunda-'+elementName+'" name="selectedElement" data-value></select><button class="add" id="addElement" data-action="addElement"><span>+</span></button></div></div>',get:function(element,entryNode){utils.updateOptionsDropDown(selector,definition,elementType,entryNode);var reference=definition.get(referenceProperty);return{selectedElement:reference&&reference.id||""}},set:function(element,values){var selection=values.selectedElement,props={};if(!selection||void 0===selection)return props[referenceProperty]=void 0,cmdHelper.updateBusinessObject(element,definition,props);var commands=[],selectedElement=findElementById(definition,elementType,selection);if(!selectedElement){var root=utils.getRoot(definition);selectedElement=elementHelper.createElement(elementType,{name:selection},root,bpmnFactory),commands.push(cmdHelper.addAndRemoveElementsFromList(element,root,"rootElements",null,[selectedElement]))}return props[referenceProperty]=selectedElement,commands.push(cmdHelper.updateBusinessObject(element,definition,props)),commands},addElement:function(element,inputNode){var id=utils.nextId(newElementIdPrefix),optionTemplate=domify('<option value="'+id+'"> (id='+id+")</option>"),selectBox=getSelectBox(inputNode);return selectBox.insertBefore(optionTemplate,selectBox.firstChild),forEach(selectBox,function(option){option.value===id?domAttr(option,"selected","selected"):domAttr(option,"selected",null)}),!0}}),entries}},{174:174,179:179,182:182,22:22,23:23,4:4,90:90,91:91}],41:[function(_dereq_,module,exports){"use strict";var eventDefinitionReference=_dereq_(40),elementReferenceProperty=_dereq_(37);module.exports=function(group,element,bpmnFactory,messageEventDefinition){group.entries=group.entries.concat(eventDefinitionReference(element,messageEventDefinition,bpmnFactory,{label:"Message",elementName:"message",elementType:"bpmn:Message",referenceProperty:"messageRef",newElementIdPrefix:"Message_"})),group.entries=group.entries.concat(elementReferenceProperty(element,messageEventDefinition,bpmnFactory,{id:"message-element-name",label:"Message Name",referenceProperty:"messageRef",modelProperty:"name",shouldValidate:!0}))}},{37:37,40:40}],42:[function(_dereq_,module,exports){"use strict";var entryFactory=_dereq_(13);module.exports=function(element,options,translate){options=options||{};var id=options.id||"name",label=options.label||translate("Name"),modelProperty=options.modelProperty||"name";return[entryFactory.textBox({id:id,label:label,modelProperty:modelProperty})]}},{13:13}],43:[function(_dereq_,module,exports){"use strict";var eventDefinitionReference=_dereq_(40),elementReferenceProperty=_dereq_(37);module.exports=function(group,element,bpmnFactory,signalEventDefinition){group.entries=group.entries.concat(eventDefinitionReference(element,signalEventDefinition,bpmnFactory,{label:"Signal",elementName:"signal",elementType:"bpmn:Signal",referenceProperty:"signalRef",newElementIdPrefix:"Signal_"})),group.entries=group.entries.concat(elementReferenceProperty(element,signalEventDefinition,bpmnFactory,{id:"signal-element-name",label:"Signal Name",referenceProperty:"signalRef",modelProperty:"name",shouldValidate:!0}))}},{37:37,40:40}],44:[function(_dereq_,module,exports){"use strict";function getTimerDefinitionType(timer){return void 0!==timer.get("timeDate")?"timeDate":void 0!==timer.get("timeCycle")?"timeCycle":void 0!==timer.get("timeDuration")?"timeDuration":void 0}function createFormalExpression(parent,body,bpmnFactory){return body=body||void 0,elementHelper.createElement("bpmn:FormalExpression",{body:body},parent,bpmnFactory)}function TimerEventDefinition(group,element,bpmnFactory,timerEventDefinition){var selectOptions=[{value:"timeDate",name:"Date"},{value:"timeDuration",name:"Duration"},{value:"timeCycle",name:"Cycle"}];group.entries.push(entryFactory.selectBox({id:"timer-event-definition-type",label:"Timer Definition Type",selectOptions:selectOptions,emptyParameter:!0,modelProperty:"timerDefinitionType",get:function(element,node){return{timerDefinitionType:getTimerDefinitionType(timerEventDefinition)||""}},set:function(element,values){var props={timeDuration:void 0,timeDate:void 0,timeCycle:void 0},newType=values.timerDefinitionType;if(values.timerDefinitionType){var value,oldType=getTimerDefinitionType(timerEventDefinition);if(oldType){value=timerEventDefinition.get(oldType).get("body")}props[newType]=createFormalExpression(timerEventDefinition,value,bpmnFactory)}return cmdHelper.updateBusinessObject(element,timerEventDefinition,props)}})),group.entries.push(entryFactory.textField({id:"timer-event-definition",label:"Timer Definition",modelProperty:"timerDefinition",get:function(element,node){var type=getTimerDefinitionType(timerEventDefinition),definition=type&&timerEventDefinition.get(type);return{timerDefinition:definition&&definition.get("body")}},set:function(element,values){var type=getTimerDefinitionType(timerEventDefinition),definition=type&&timerEventDefinition.get(type);if(definition)return cmdHelper.updateBusinessObject(element,definition,{body:values.timerDefinition||void 0})},validate:function(element){var type=getTimerDefinitionType(timerEventDefinition),definition=type&&timerEventDefinition.get(type);if(definition){if(!definition.get("body"))return{timerDefinition:"Must provide a value"}}},hidden:function(element){return!getTimerDefinitionType(timerEventDefinition)}}))}var elementHelper=_dereq_(23),cmdHelper=_dereq_(22),entryFactory=_dereq_(13);module.exports=TimerEventDefinition},{13:13,22:22,23:23}],45:[function(_dereq_,module,exports){"use strict";function createGeneralTabGroups(element,bpmnFactory,elementRegistry,translate){var generalGroup={id:"general",label:"",entries:[]};return idProps(generalGroup,element,translate),nameProps(generalGroup,element,translate),processProps(generalGroup,element,translate),jbpmProcessProps(generalGroup,element,translate),serviceTaskDelegateProps(generalGroup,element,bpmnFactory),userTaskProps(generalGroup,element,translate),scriptProps(generalGroup,element,bpmnFactory,translate),linkProps(generalGroup,element),callActivityProps(generalGroup,element,bpmnFactory),eventProps(generalGroup,element,bpmnFactory,elementRegistry),sequenceFlowProps(generalGroup,element,bpmnFactory,translate),gatewayProps(generalGroup,element,translate),[generalGroup]}function createInputOutputParametersTabGroups(element,bpmnFactory,translate){var inputOutputParametersGroup={id:"input-output",label:"",entries:[]},options=inputOutput(inputOutputParametersGroup,element,bpmnFactory,null,translate),inputOutputParameterGroup={id:"input-output-parameter",entries:[],enabled:function(element,node){return options.getSelectedParameter(element,node)},label:translate("Parameter Detail")};return inputOutputParameter(inputOutputParameterGroup,element,bpmnFactory,options,translate),[inputOutputParametersGroup,inputOutputParameterGroup]}function createImportsAndGlobalsTabGroups(element,bpmnFactory,translate){var importsGroup={id:"imports",label:translate("Imports"),entries:[]};importsProps(importsGroup,element,bpmnFactory,translate);var globalsGroup={id:"globals",label:translate("Globals"),entries:[]};return globalsProps(globalsGroup,element,bpmnFactory,translate),[importsGroup,globalsGroup]}function JBPMPropertiesProvider(eventBus,bpmnFactory,elementRegistry,translate){PropertiesActivator.call(this,eventBus),this.getTabs=function(element){return[{id:"general",label:translate("General"),groups:createGeneralTabGroups(element,bpmnFactory,elementRegistry,translate)},{id:"input-output-paramters",label:translate("Input/Output Parameters"),groups:createInputOutputParametersTabGroups(element,bpmnFactory,translate)},{id:"imports",label:translate("Imports & Globals"),groups:createImportsAndGlobalsTabGroups(element,bpmnFactory,translate)}]}}var inherits=_dereq_(84),PropertiesActivator=_dereq_(2),processProps=_dereq_(34),eventProps=_dereq_(30),linkProps=_dereq_(32),idProps=_dereq_(31),nameProps=_dereq_(33),jbpmProcessProps=_dereq_(53),serviceTaskDelegateProps=_dereq_(56),userTaskProps=_dereq_(57),callActivityProps=_dereq_(47),sequenceFlowProps=_dereq_(55),gatewayProps=_dereq_(48),scriptProps=_dereq_(54),globalsProps=_dereq_(49),importsProps=_dereq_(50),inputOutput=_dereq_(52),inputOutputParameter=_dereq_(51);JBPMPropertiesProvider.$inject=["eventBus","bpmnFactory","elementRegistry","translate"],inherits(JBPMPropertiesProvider,PropertiesActivator),module.exports=JBPMPropertiesProvider},{2:2,30:30,31:31,32:32,33:33,34:34,47:47,48:48,49:49,50:50,51:51,52:52,53:53,54:54,55:55,56:56,57:57,84:84}],46:[function(_dereq_,module,exports){module.exports={__init__:["propertiesProvider"],propertiesProvider:["type",_dereq_(45)]}},{45:45}],47:[function(_dereq_,module,exports){"use strict";function getCallableType(element){var bo=getBusinessObject(element),boCalledElement=bo.get("calledElement"),boCaseRef=bo.get("jbpm:caseRef"),callActivityType="";return void 0!==boCalledElement?callActivityType="bpmn":void 0!==boCaseRef&&(callActivityType="cmmn"),callActivityType}var getBusinessObject=_dereq_(69).getBusinessObject,is=_dereq_(69).is,entryFactory=_dereq_(13),callable=_dereq_(58),cmdHelper=_dereq_(22),flattenDeep=_dereq_(85),assign=_dereq_(166),DEFAULT_PROPS={calledElement:void 0,"jbpm:calledElementBinding":"latest","jbpm:calledElementVersion":void 0,"jbpm:caseRef":void 0,"jbpm:caseBinding":"latest","jbpm:caseVersion":void 0};module.exports=function(group,element,bpmnFactory){is(element,"jbpm:CallActivity")&&(group.entries.push(entryFactory.selectBox({id:"callActivity",label:"CallActivity Type",selectOptions:[{name:"BPMN",value:"bpmn"},{name:"CMMN",value:"cmmn"}],emptyParameter:!0,modelProperty:"callActivityType",get:function(element,node){return{callActivityType:getCallableType(element)}},set:function(element,values,node){var type=values.callActivityType,props=assign({},DEFAULT_PROPS);return"bpmn"===type?props.calledElement="":"cmmn"===type&&(props["jbpm:caseRef"]=""),cmdHelper.updateProperties(element,props)}})),group.entries.push(callable(element,bpmnFactory,{getCallableType:getCallableType})),group.entries=flattenDeep(group.entries))}},{13:13,166:166,22:22,58:58,69:69,85:85}],48:[function(_dereq_,module,exports){"use strict";var is=_dereq_(69).is,entryFactory=(_dereq_(69).getBusinessObject,_dereq_(13));module.exports=function(group,element,translate){(is(element,"bpmn:EventBasedGateway")||is(element,"bpmn:ComplexGateway")||is(element,"bpmn:ExclusiveGateway")||is(element,"bpmn:InclusiveGateway")||is(element,"bpmn:ParallelGateway"))&&group.entries.push(entryFactory.selectBox({id:"gatewayDirection",description:translate("Gateway Direction"),label:translate("Gateway Direction"),modelProperty:"gatewayDirection",selectOptions:[{name:translate("Diverging"),value:"Diverging"},{name:translate("Converging"),value:"Converging"},{name:translate("Mixed"),value:"Mixed"},{name:translate("Unspecified"),value:"Unspecified"}]}))}},{13:13,69:69}],49:[function(_dereq_,module,exports){"use strict";var is=_dereq_(69).is,getBusinessObject=_dereq_(69).getBusinessObject,extensionElementsHelper=_dereq_(25),elementHelper=_dereq_(23),cmdHelper=_dereq_(22),entryfactory=_dereq_(13),forEach=_dereq_(91);module.exports=function(group,element,bpmnFactory,translate){function getParent(element,node){return getBusinessObject(element).extensionElements}function createParent(element){var bo=getBusinessObject(element),parent=elementHelper.createElement("bpmn:ExtensionElements",{values:[]},bo,bpmnFactory);return{cmd:cmdHelper.updateProperties(element,{extensionElements:parent}),parent:parent}}var bo;if(is(element,"bpmn:Process")&&(bo=getBusinessObject(element)),bo){var DEFAULT_PROPERTIES=["identifier","type"];group.entries.push(entryfactory.table({id:"globals",modelProperties:DEFAULT_PROPERTIES,labels:[translate("Identifier"),translate("Type")],addLabel:translate("Add Global"),getElements:function(element,node){return extensionElementsHelper.getExtensionElements(bo,"drools:Global")},addElement:function(element,node){var commands=[],parent=getParent(element,node);if(!parent){var result=createParent(element);parent=result.parent,commands.push(result.cmd)}var propertyProps={};forEach(DEFAULT_PROPERTIES,function(prop){propertyProps[prop]=void 0});var globalElement=elementHelper.createElement("drools:Global",propertyProps,parent,bpmnFactory);return commands.push(cmdHelper.addElementsTolist(element,parent,"values",[globalElement])),commands},updateElement:function(element,value,node,idx){var property=extensionElementsHelper.getExtensionElements(bo,"drools:Global")[idx];return forEach(DEFAULT_PROPERTIES,function(prop){value[prop]=value[prop]||void 0}),cmdHelper.updateBusinessObject(element,property,value)},validate:function(element,value,node,idx){var validationError={},hasError=!1;forEach(DEFAULT_PROPERTIES,function(prop){value[prop]||(validationError[prop]=translate("Value of ["+prop+"] must be not empty and unique."),hasError=!0)})},removeElement:function(element,node,idx){var commands=[],parent=getParent(element,node),currentProperty=extensionElementsHelper.getExtensionElements(bo,"drools:Global")[idx];return commands.push(cmdHelper.removeElementsFromList(element,parent,"values",null,[currentProperty])),commands}}))}}},{13:13,22:22,23:23,25:25,69:69,91:91}],50:[function(_dereq_,module,exports){"use strict";var is=_dereq_(69).is,getBusinessObject=_dereq_(69).getBusinessObject,extensionElementsHelper=_dereq_(25),elementHelper=_dereq_(23),cmdHelper=_dereq_(22),entryfactory=_dereq_(13),forEach=_dereq_(91);module.exports=function(group,element,bpmnFactory,translate){function getParent(element,node){return getBusinessObject(element).extensionElements}function createParent(element){var bo=getBusinessObject(element),parent=elementHelper.createElement("bpmn:ExtensionElements",{values:[]},bo,bpmnFactory);return{cmd:cmdHelper.updateProperties(element,{extensionElements:parent}),parent:parent}}var bo;if(is(element,"bpmn:Process")&&(bo=getBusinessObject(element)),bo){var DEFAULT_PROPERTIES=["name"];group.entries.push(entryfactory.table({id:"imports",modelProperties:DEFAULT_PROPERTIES,labels:[translate("Type Name")],addLabel:translate("Add Import"),getElements:function(element,node){return extensionElementsHelper.getExtensionElements(bo,"drools:Import")},addElement:function(element,node){var commands=[],parent=getParent(element,node);if(!parent){var result=createParent(element);parent=result.parent,commands.push(result.cmd)}var propertyProps={};forEach(DEFAULT_PROPERTIES,function(prop){propertyProps[prop]=void 0});var importElement=elementHelper.createElement("drools:Import",propertyProps,parent,bpmnFactory);return commands.push(cmdHelper.addElementsTolist(element,parent,"values",[importElement])),commands},updateElement:function(element,value,node,idx){var property=extensionElementsHelper.getExtensionElements(bo,"drools:Import")[idx];return forEach(DEFAULT_PROPERTIES,function(prop){value[prop]=value[prop]||void 0}),cmdHelper.updateBusinessObject(element,property,value)},validate:function(element,value,node,idx){var validationError={},hasError=!1;forEach(DEFAULT_PROPERTIES,function(prop){value[prop]||(validationError[prop]=translate("Value of ["+prop+"] must be not empty and unique."),hasError=!0)})},removeElement:function(element,node,idx){var commands=[],parent=getParent(element,node),currentProperty=extensionElementsHelper.getExtensionElements(bo,"drools:Import")[idx];return commands.push(cmdHelper.removeElementsFromList(element,parent,"values",null,[currentProperty])),commands}}))}}},{13:13,22:22,23:23,25:25,69:69,91:91}],51:[function(_dereq_,module,exports){"use strict";var inputOutputParameter=_dereq_(64),assign=_dereq_(166);module.exports=function(group,element,bpmnFactory,options,translate){group.entries=group.entries.concat(inputOutputParameter(element,bpmnFactory,assign({},options),translate))}},{166:166,64:64}],52:[function(_dereq_,module,exports){
"use strict";var inputOutput=_dereq_(63);module.exports=function(group,element,bpmnFactory,options,translate){var inputOutputEntry=inputOutput(element,bpmnFactory,options,translate);return group.entries=group.entries.concat(inputOutputEntry.entries),{getSelectedParameter:inputOutputEntry.getSelectedParameter}}},{63:63}],53:[function(_dereq_,module,exports){"use strict";var is=_dereq_(69).is,entryFactory=_dereq_(13);module.exports=function(group,element,translate){is(element,"jbpm:Process")&&group.entries.push(entryFactory.textField({id:"toDoUrl",description:translate("ToDo url for this user task"),label:translate("ToDo Url"),modelProperty:"toDoUrl"}))}},{13:13,69:69}],54:[function(_dereq_,module,exports){"use strict";var getBusinessObject=_dereq_(69).getBusinessObject,is=_dereq_(69).is,entryFactory=_dereq_(13),cmdHelper=_dereq_(22),scriptlib=_dereq_(66);module.exports=function(group,element,bpmnFactory,translate){var bo;if(is(element,"bpmn:ScriptTask")&&(bo=getBusinessObject(element)),bo){var script=scriptlib("scriptFormat","script",!1,translate);group.entries.push({id:"script-implementation",description:"Implementation for a Script.",label:translate("Script"),html:script.template,get:function(element){return script.get(element,bo)},set:function(element,values,containerElement){var properties=script.set(element,values,containerElement);return cmdHelper.updateProperties(element,properties)},validate:function(element,values){return script.validate(element,values)},script:script,cssClasses:["pp-textfield"]}),group.entries.push(entryFactory.textField({id:"scriptResultVariable",description:"Result Variable of a Service Task Script",label:translate("Result Variable"),modelProperty:"scriptResultVariable",get:function(element,propertyName){return{scriptResultVariable:bo.get("jbpm:resultVariable")}},set:function(element,values,containerElement){return cmdHelper.updateProperties(element,{"jbpm:resultVariable":values.scriptResultVariable})}}))}}},{13:13,22:22,66:66,69:69}],55:[function(_dereq_,module,exports){"use strict";var is=_dereq_(69).is,getBusinessObject=_dereq_(69).getBusinessObject,domQuery=_dereq_(182),cmdHelper=_dereq_(22),elementHelper=_dereq_(23),scriptlib=_dereq_(66);module.exports=function(group,element,bpmnFactory,translate){var bo;if(is(element,"bpmn:SequenceFlow")&&(bo=getBusinessObject(element)),bo){var script=scriptlib("language","body",!0,translate);group.entries.push({id:"condition",description:translate("Configure the implementation of the task."),label:translate("Condition"),html:'<div class="pp-row"><label for="cam-condition-type">'+translate("Condition Type")+'</label><div class="pp-field-wrapper"><select id="cam-condition-type" name="conditionType" data-value><option value="expression">'+translate("Expression")+'</option><option value="script">'+translate("Script")+'</option><option value="" selected></option></select></div></div><div class="pp-row"><label for="cam-condition" data-show="isExpression">'+translate("Expression")+'</label><div class="pp-field-wrapper" data-show="isExpression"><input id="cam-condition" type="text" name="condition" /><button class="clear" data-action="clear" data-show="canClear"><span>X</span></button></div><div data-show="isScript">'+script.template+"</div></div>",get:function(element,propertyName){var conditionExpression=bo.conditionExpression,values={},conditionType="";if(conditionExpression){void 0!==conditionExpression.language?(conditionType="script",values=script.get(element,conditionExpression)):(conditionType="expression",values.condition=conditionExpression.get("body"))}return values.conditionType=conditionType,values},set:function(element,values,containerElement){var conditionType=values.conditionType,conditionProps={body:void 0};if("script"===conditionType)conditionProps=script.set(element,values,containerElement);else{var condition=values.condition;conditionProps.body=condition}var update={conditionExpression:void 0};return conditionType&&(update.conditionExpression=elementHelper.createElement("bpmn:FormalExpression",conditionProps,bo,bpmnFactory)),cmdHelper.updateBusinessObject(element,bo,update)},validate:function(element,values){var validationResult={};return values.condition||"expression"!==values.conditionType?"script"===values.conditionType&&(validationResult=script.validate(element,values)):validationResult.condition="Must provide a value",validationResult},isExpression:function(element,inputNode){var conditionType=domQuery("select[name=conditionType]",inputNode);if(conditionType.selectedIndex>=0)return"expression"===conditionType.options[conditionType.selectedIndex].value},isScript:function(element,inputNode){var conditionType=domQuery("select[name=conditionType]",inputNode);if(conditionType.selectedIndex>=0)return"script"===conditionType.options[conditionType.selectedIndex].value},clear:function(element,inputNode){return domQuery("input[name=condition]",inputNode).value="",!0},canClear:function(element,inputNode){return""!==domQuery("input[name=condition]",inputNode).value},script:script,cssClasses:["pp-textfield"]})}}},{182:182,22:22,23:23,66:66,69:69}],56:[function(_dereq_,module,exports){"use strict";function getImplementationType(element){return ImplementationTypeHelper.getImplementationType(element)}function getBusinessObject(element){return ImplementationTypeHelper.getServiceTaskLikeBusinessObject(element)}function isDmnCapable(element){return ImplementationTypeHelper.isDmnCapable(element)}function isExternalCapable(element){return ImplementationTypeHelper.isExternalCapable(element)}function isServiceTaskLike(element){return ImplementationTypeHelper.isServiceTaskLike(element)}var ImplementationTypeHelper=_dereq_(26),InputOutputHelper=_dereq_(27),implementationType=_dereq_(62),delegate=_dereq_(59),external=_dereq_(61),callable=_dereq_(58),resultVariable=_dereq_(65),entryFactory=_dereq_(13),domQuery=_dereq_(182),domClosest=_dereq_(177),domClasses=_dereq_(175);module.exports=function(group,element,bpmnFactory){if(isServiceTaskLike(getBusinessObject(element))){var hasDmnSupport=isDmnCapable(element),hasExternalSupport=isExternalCapable(getBusinessObject(element));group.entries=group.entries.concat(implementationType(element,bpmnFactory,{getBusinessObject:getBusinessObject,getImplementationType:getImplementationType,hasDmnSupport:hasDmnSupport,hasExternalSupport:hasExternalSupport,hasServiceTaskLikeSupport:!0})),group.entries=group.entries.concat(delegate(element,bpmnFactory,{getBusinessObject:getBusinessObject,getImplementationType:getImplementationType})),group.entries=group.entries.concat(resultVariable(element,bpmnFactory,{getBusinessObject:getBusinessObject,getImplementationType:getImplementationType,hideResultVariable:function(element,node){return"expression"!==getImplementationType(element)}})),hasExternalSupport&&(group.entries=group.entries.concat(external(element,bpmnFactory,{getBusinessObject:getBusinessObject,getImplementationType:getImplementationType}))),hasDmnSupport&&(group.entries=group.entries.concat(callable(element,bpmnFactory,{getCallableType:getImplementationType})));var isConnector=function(element){return"connector"===getImplementationType(element)};group.entries.push(entryFactory.link({id:"configureConnectorLink",label:"Configure Connector",getClickableElement:function(element,node){var panel=domClosest(node,"div.djs-properties-panel");return domQuery('a[data-tab-target="connector"]',panel)},hideLink:function(element,node){var link=domQuery("a",node);if(link.innerHTML=link.textContent="",domClasses(link).remove("pp-error-message"),isConnector(element)){return InputOutputHelper.getConnector(element).get("connectorId")?link.textContent="Configure Connector":(link.innerHTML='<span class="pp-icon-warning"></span> Must configure Connector',domClasses(link).add("pp-error-message")),!1}return!0}}))}}},{13:13,175:175,177:177,182:182,26:26,27:27,58:58,59:59,61:61,62:62,65:65}],57:[function(_dereq_,module,exports){"use strict";var is=_dereq_(69).is,entryFactory=_dereq_(13);module.exports=function(group,element,translate){if(is(element,"jbpm:UserTask")){group.entries.push(entryFactory.textField({id:"ActorId",description:translate("Actor of the User Task"),label:translate("Actor Id"),modelProperty:"ActorId"})),group.entries.push(entryFactory.textField({id:"RoleCodes",description:translate("Roles of this User Task"),label:translate("Role Codes"),modelProperty:"RoleCodes"})),group.entries.push(entryFactory.textField({id:"OrganizationLevel",description:translate("Organization Level"),label:translate("Organization Level"),modelProperty:"OrganizationLevel"}));var booleanSelectOptions=[{value:"false",name:translate("No")},{value:"true",name:translate("Yes")}];group.entries.push(entryFactory.selectBox({id:"Multi-User",description:translate("Multi-User"),label:translate("Multi-User"),modelProperty:"Multi-User",selectOptions:booleanSelectOptions})),group.entries.push(entryFactory.selectBox({id:"Skippable",description:translate("Skippable"),label:translate("Skippable"),modelProperty:"Skippable",selectOptions:booleanSelectOptions})),group.entries.push(entryFactory.textField({id:"Priority",description:translate("Priority"),label:translate("Priority"),modelProperty:"Priority"})),group.entries.push(entryFactory.textField({id:"toDoUrl",description:translate("ToDo url for this user task"),label:translate("ToDo Url"),modelProperty:"toDoUrl"}))}}},{13:13,69:69}],58:[function(_dereq_,module,exports){"use strict";function getJbpmInWithBusinessKey(element){var jbpmIn=[],bo=getBusinessObject(element),jbpmInParams=extensionElementsHelper.getExtensionElements(bo,"jbpm:In");return jbpmInParams&&forEach(jbpmInParams,function(param){param.businessKey&&jbpmIn.push(param)}),jbpmIn}function setBusinessKey(element,bpmnFactory){var bo=getBusinessObject(element),commands=[],extensionElements=bo.extensionElements;extensionElements||(extensionElements=elementHelper.createElement("bpmn:ExtensionElements",{values:[]},bo,bpmnFactory),commands.push(cmdHelper.updateProperties(element,{extensionElements:extensionElements})));var jbpmIn=elementHelper.createElement("jbpm:In",{businessKey:"#{execution.processBusinessKey}"},extensionElements,bpmnFactory);return commands.push(cmdHelper.addAndRemoveElementsFromList(element,extensionElements,"values","extensionElements",[jbpmIn],[])),commands}function deleteBusinessKey(element){var jbpmInExtensions=getJbpmInWithBusinessKey(element),commands=[];return forEach(jbpmInExtensions,function(elem){commands.push(extensionElementsHelper.removeEntry(getBusinessObject(element),element,elem))}),commands}function isSupportedCallableType(type){return-1!==["bpmn","cmmn","dmn"].indexOf(type)}var cmdHelper=_dereq_(22),entryFactory=_dereq_(13),elementHelper=_dereq_(23),extensionElementsHelper=_dereq_(25),resultVariable=_dereq_(65),getBusinessObject=_dereq_(69).getBusinessObject,is=_dereq_(69).is,forEach=_dereq_(91),attributeInfo={bpmn:{element:"calledElement",binding:"jbpm:calledElementBinding",version:"jbpm:calledElementVersion"},cmmn:{element:"jbpm:caseRef",binding:"jbpm:caseBinding",version:"jbpm:caseVersion"},dmn:{element:"jbpm:decisionRef",binding:"jbpm:decisionRefBinding",version:"jbpm:decisionRefVersion"}},bindingOptions=[{name:"latest",value:"latest"},{name:"deployment",value:"deployment"},{name:"version",value:"version"}],mapDecisionResultOptions=[{name:"singleEntry",value:"singleEntry"},{name:"singleResult",value:"singleResult"},{name:"collectEntries",value:"collectEntries"},{name:"resultList",value:"resultList"}];module.exports=function(element,bpmnFactory,options){function getAttribute(element,prop){var type=getCallableType(element);return(attributeInfo[type]||{})[prop]}function getCallActivityBindingValue(element){var type=getCallableType(element),bo=getBusinessObject(element),attr=(attributeInfo[type]||{}).binding;return bo.get(attr)}var getCallableType=options.getCallableType,entries=[];return entries.push(entryFactory.textField({id:"callable-element-ref",dataValueLabel:"callableElementLabel",modelProperty:"callableElementRef",get:function(element,node){var callableElementRef,attr=getAttribute(element,"element");if(attr){callableElementRef=getBusinessObject(element).get(attr)}var label="",type=getCallableType(element);return"bpmn"===type?label="Called Element":"cmmn"===type?label="Case Ref":"dmn"===type&&(label="Decision Ref"),{callableElementRef:callableElementRef,callableElementLabel:label}},set:function(element,values,node){var newCallableElementRef=values.callableElementRef,attr=getAttribute(element,"element"),props={};return props[attr]=newCallableElementRef||"",cmdHelper.updateProperties(element,props)},validate:function(element,values,node){var elementRef=values.callableElementRef;return isSupportedCallableType(getCallableType(element))&&!elementRef?{callableElementRef:"Value must provide a value."}:{}},disabled:function(element,node){return!isSupportedCallableType(getCallableType(element))}})),entries.push(entryFactory.selectBox({id:"callable-binding",label:"Binding",selectOptions:bindingOptions,modelProperty:"callableBinding",get:function(element,node){var callableBinding,attr=getAttribute(element,"binding");if(attr){callableBinding=getBusinessObject(element).get(attr)||"latest"}return{callableBinding:callableBinding}},set:function(element,values,node){var binding=values.callableBinding,attr=getAttribute(element,"binding"),attrVer=getAttribute(element,"version"),props={};return props[attr]=binding,props[attrVer]=void 0,cmdHelper.updateProperties(element,props)},disabled:function(element,node){return!isSupportedCallableType(getCallableType(element))}})),entries.push(entryFactory.textField({id:"callable-version",label:"Version",modelProperty:"callableVersion",get:function(element,node){var callableVersion,attr=getAttribute(element,"version");if(attr){callableVersion=getBusinessObject(element).get(attr)}return{callableVersion:callableVersion}},set:function(element,values,node){var version=values.callableVersion,attr=getAttribute(element,"version"),props={};return props[attr]=version||void 0,cmdHelper.updateProperties(element,props)},validate:function(element,values,node){var version=values.callableVersion;return isSupportedCallableType(getCallableType(element))&&"version"===getCallActivityBindingValue(element)&&!version?{callableVersion:"Value must provide a value."}:{}},disabled:function(element,node){return!isSupportedCallableType(getCallableType(element))||"version"!==getCallActivityBindingValue(element)}})),is(getBusinessObject(element),"bpmn:CallActivity")&&entries.push(entryFactory.checkbox({id:"callable-business-key",label:"Business Key",modelProperty:"callableBusinessKey",get:function(element,node){var jbpmIn=getJbpmInWithBusinessKey(element);return{callableBusinessKey:!!(jbpmIn&&jbpmIn.length>0)}},set:function(element,values,node){return values.callableBusinessKey?setBusinessKey(element,bpmnFactory):deleteBusinessKey(element)}})),entries=entries.concat(resultVariable(element,bpmnFactory,{id:"dmn-resultVariable",getBusinessObject:getBusinessObject,getImplementationType:getCallableType,hideResultVariable:function(element,node){return"dmn"!==getCallableType(element)}})),entries.push(entryFactory.selectBox({id:"dmn-map-decision-result",label:"Map Decision Result",selectOptions:mapDecisionResultOptions,modelProperty:"mapDecisionResult",get:function(element,node){return{mapDecisionResult:getBusinessObject(element).get("jbpm:mapDecisionResult")||"resultList"}},set:function(element,values,node){return cmdHelper.updateProperties(element,{"jbpm:mapDecisionResult":values.mapDecisionResult||"resultList"})},disabled:function(element,node){var bo=getBusinessObject(element),resultVariable=bo.get("jbpm:resultVariable");return!("dmn"===getCallableType(element)&&void 0!==resultVariable)}})),entries}},{13:13,22:22,23:23,25:25,65:65,69:69,91:91}],59:[function(_dereq_,module,exports){"use strict";function isDelegate(type){return-1!==DELEGATE_TYPES.indexOf(type)}function getAttribute(type){return PROPERTIES[type]}function getDelegationLabel(type){switch(type){case"class":return"Java Class";case"expression":return"Expression";case"delegateExpression":return"Delegate Expression";default:return""}}var entryFactory=_dereq_(13),cmdHelper=_dereq_(22),DELEGATE_TYPES=["class","expression","delegateExpression"],PROPERTIES={class:"jbpm:class",expression:"jbpm:expression",delegateExpression:"jbpm:delegateExpression"};module.exports=function(element,bpmnFactory,options){var getImplementationType=options.getImplementationType,getBusinessObject=options.getBusinessObject;return[entryFactory.textField({id:"delegate",label:"Value",dataValueLabel:"delegationLabel",modelProperty:"delegate",get:function(element,node){var bo=getBusinessObject(element),type=getImplementationType(element),attr=getAttribute(type),label=getDelegationLabel(type);return{delegate:bo.get(attr),delegationLabel:label}},set:function(element,values,node){var bo=getBusinessObject(element),type=getImplementationType(element),attr=getAttribute(type),prop={};return prop[attr]=values.delegate||"",cmdHelper.updateBusinessObject(element,bo,prop)},validate:function(element,values,node){return isDelegate(getImplementationType(element))&&!values.delegate?{delegate:"Must provide a value"}:{}},disabled:function(element,node){return!isDelegate(getImplementationType(element))}})]}},{13:13,22:22}],60:[function(_dereq_,module,exports){"use strict";function getSelectBox(node,id){var currentTab=domClosest(node,"div.djs-properties-tab");return domQuery("select[name=selectedExtensionElement]"+(id?"[id=cam-extensionElements-"+id+"]":""),currentTab)}function getSelected(node,id){var selectBox=getSelectBox(node,id);return{value:(selectBox||{}).value,idx:(selectBox||{}).selectedIndex}}function generateElementId(prefix){return prefix+="_",utils.nextId(prefix)}var getBusinessObject=_dereq_(69).getBusinessObject,domQuery=_dereq_(182),domClosest=_dereq_(177),domify=_dereq_(179),forEach=_dereq_(91),elementHelper=_dereq_(23),cmdHelper=_dereq_(22),utils=_dereq_(4);module.exports=function(element,bpmnFactory,options){var id=options.id,prefix=options.prefix||"elem",label=options.label||id,idGeneration=!1!==options.idGeneration||options.idGeneration,modelProperty=options.modelProperty||"id",getElements=options.getExtensionElements,createElement=options.createExtensionElement,canCreate="function"==typeof createElement,removeElement=options.removeExtensionElement,canRemove="function"==typeof removeElement,onSelectionChange=options.onSelectionChange,hideElements=options.hideExtensionElements,canBeHidden="function"==typeof hideElements,setOptionLabelValue=options.setOptionLabelValue,defaultSize=options.size||5,resizable=options.resizable,selectionChanged=function(element,node,event,scope){if("function"==typeof onSelectionChange)return onSelectionChange(element,node,event,scope)},createOption=function(value){return'<option value="'+value+'" data-value data-name="extensionElementValue">'+value+"</option>"},initSelectionSize=function(selectBox,optionsLength){resizable&&(selectBox.size=optionsLength>defaultSize?optionsLength:defaultSize)};return{id:id,html:'<div class="pp-row pp-element-list" '+(canBeHidden?'data-show="hideElements"':"")+'><label for="cam-extensionElements-'+id+'">'+label+'</label><div class="pp-field-wrapper"><select id="cam-extensionElements-'+id+'"name="selectedExtensionElement" size="'+defaultSize+'" data-list-entry-container data-on-change="selectElement"></select>'+(canCreate?'<button class="add" id="cam-extensionElements-create-'+id+'" data-action="createElement"><span>+</span></button>':"")+(canRemove?'<button class="clear" id="cam-extensionElements-remove-'+id+'" data-action="removeElement" data-disable="disableRemove"><span>-</span></button>':"")+"</div></div>",get:function(element,node){var elements=getElements(element),result=[];forEach(elements,function(elem){result.push({extensionElementValue:elem.get(modelProperty)})});var selectBox=getSelectBox(node.parentNode,id);return initSelectionSize(selectBox,result.length),result},set:function(element,values,node){var action=this.__action;delete this.__action;var bo=getBusinessObject(element),extensionElements=bo.get("extensionElements");if("create-extension-element"===action.id){var commands=[];return extensionElements||(extensionElements=elementHelper.createElement("bpmn:ExtensionElements",{values:[]},bo,bpmnFactory),commands.push(cmdHelper.updateProperties(element,{extensionElements:extensionElements}))),commands.push(createElement(element,extensionElements,action.value)),commands}if("remove-extension-element"===action.id)return removeElement(element,extensionElements,action.value,action.idx)},createListEntryTemplate:function(value,index,selectBox){return initSelectionSize(selectBox,selectBox.options.length+1),createOption(value.extensionElementValue)},deselect:function(element,node){getSelectBox(node,id).selectedIndex=-1},getSelected:function(element,node){return getSelected(node,id)},setControlValue:function(element,node,option,property,value,idx){node.value=value,setOptionLabelValue?setOptionLabelValue(element,node,option,property,value,idx):node.text=value},createElement:function(element,node){var generatedId;idGeneration&&(generatedId=generateElementId(prefix));var selectBox=getSelectBox(node,id),template=domify(createOption(generatedId));return selectBox.appendChild(template),selectBox.lastChild.selected="selected",selectionChanged(element,node),initSelectionSize(selectBox,selectBox.options.length),this.__action={id:"create-extension-element",value:generatedId},!0},removeElement:function(element,node){var selection=getSelected(node,id),selectBox=getSelectBox(node,id);return selectBox.removeChild(selectBox.options[selection.idx]),initSelectionSize(selectBox,selectBox.options.length),this.__action={id:"remove-extension-element",value:selection.value,idx:selection.idx},!0},hideElements:function(element,entryNode,node,scopeNode){return!hideElements(element,entryNode,node,scopeNode)},disableRemove:function(element,entryNode,node,scopeNode){return(getSelected(entryNode,id)||{}).idx<0},selectElement:selectionChanged}}},{177:177,179:179,182:182,22:22,23:23,4:4,69:69,91:91}],61:[function(_dereq_,module,exports){"use strict";var entryFactory=_dereq_(13),cmdHelper=_dereq_(22);module.exports=function(element,bpmnFactory,options){function isExternal(element){return"external"===getImplementationType(element)}var getImplementationType=options.getImplementationType,getBusinessObject=options.getBusinessObject;return[entryFactory.textField({id:"externalTopic",label:"Topic",modelProperty:"externalTopic",get:function(element,node){return{externalTopic:getBusinessObject(element).get("jbpm:topic")}},set:function(element,values,node){var bo=getBusinessObject(element);return cmdHelper.updateBusinessObject(element,bo,{"jbpm:topic":values.externalTopic})},validate:function(element,values,node){return isExternal(element)&&!values.externalTopic?{externalTopic:"Must provide a value"}:{}},disabled:function(element,node){return!isExternal(element)}})]}},{13:13,22:22}],62:[function(_dereq_,module,exports){"use strict";var entryFactory=_dereq_(13),cmdHelper=_dereq_(22),extensionElementsHelper=_dereq_(25),elementHelper=_dereq_(23),assign=_dereq_(166),map=_dereq_(93),DEFAULT_DELEGATE_PROPS=["class","expression","delegateExpression"],DELEGATE_PROPS={"jbpm:class":void 0,"jbpm:expression":void 0,"jbpm:delegateExpression":void 0,"jbpm:resultVariable":void 0},DMN_CAPABLE_PROPS={"jbpm:decisionRef":void 0,"jbpm:decisionRefBinding":"latest","jbpm:decisionRefVersion":void 0,"jbpm:mapDecisionResult":"resultList"},EXTERNAL_CAPABLE_PROPS={"jbpm:type":void 0,"jbpm:topic":void 0},DEFAULT_OPTIONS=[{value:"class",name:"Java Class"},{value:"expression",name:"Expression"},{value:"delegateExpression",name:"Delegate Expression"}],DMN_OPTION=[{value:"dmn",name:"DMN"}],EXTERNAL_OPTION=[{value:"external",name:"External"}],CONNECTOR_OPTION=[{value:"connector",name:"Connector"}],SCRIPT_OPTION=[{value:"script",name:"Script"}];module.exports=function(element,bpmnFactory,options){var getType=options.getImplementationType,getBusinessObject=options.getBusinessObject,hasDmnSupport=options.hasDmnSupport,hasExternalSupport=options.hasExternalSupport,hasServiceTaskLikeSupport=options.hasServiceTaskLikeSupport,hasScriptSupport=options.hasScriptSupport,entries=[],selectOptions=DEFAULT_OPTIONS.concat([]);return hasDmnSupport&&(selectOptions=selectOptions.concat(DMN_OPTION)),hasExternalSupport&&(selectOptions=selectOptions.concat(EXTERNAL_OPTION)),hasServiceTaskLikeSupport&&(selectOptions=selectOptions.concat(CONNECTOR_OPTION)),hasScriptSupport&&(selectOptions=selectOptions.concat(SCRIPT_OPTION)),selectOptions.push({value:""}),entries.push(entryFactory.selectBox({id:"implementation",description:"Configure the implementation of the task.",label:"Implementation",selectOptions:selectOptions,modelProperty:"implType",get:function(element,node){return{implType:getType(element)||""}},set:function(element,values,node){var bo=getBusinessObject(element),oldType=getType(element),newType=values.implType,props=assign({},DELEGATE_PROPS);if(-1!==DEFAULT_DELEGATE_PROPS.indexOf(newType)){var newValue="";-1!==DEFAULT_DELEGATE_PROPS.indexOf(oldType)&&(newValue=bo.get("jbpm:"+oldType)),props["jbpm:"+newType]=newValue}hasDmnSupport&&(props=assign(props,DMN_CAPABLE_PROPS),"dmn"===newType&&(props["jbpm:decisionRef"]="")),hasExternalSupport&&(props=assign(props,EXTERNAL_CAPABLE_PROPS),"external"===newType&&(props["jbpm:type"]="external",props["jbpm:topic"]="")),hasScriptSupport&&(props["jbpm:script"]=void 0,"script"===newType&&(props["jbpm:script"]=elementHelper.createElement("jbpm:Script",{},bo,bpmnFactory)));var commands=[];if(commands.push(cmdHelper.updateBusinessObject(element,bo,props)),hasServiceTaskLikeSupport){var connectors=extensionElementsHelper.getExtensionElements(bo,"jbpm:Connector");if(commands.push(map(connectors,function(connector){return extensionElementsHelper.removeEntry(bo,element,connector)})),"connector"===newType){var extensionElements=bo.get("extensionElements");extensionElements||(extensionElements=elementHelper.createElement("bpmn:ExtensionElements",{values:[]},bo,bpmnFactory),commands.push(cmdHelper.updateBusinessObject(element,bo,{extensionElements:extensionElements})));var connector=elementHelper.createElement("jbpm:Connector",{},extensionElements,bpmnFactory);commands.push(cmdHelper.addAndRemoveElementsFromList(element,extensionElements,"values","extensionElements",[connector],[]))}}return commands}})),entries}},{13:13,166:166,22:22,23:23,25:25,93:93}],63:[function(_dereq_,module,exports){"use strict";function getInputOutput(element,insideConnector){return inputOutputHelper.getInputOutput(element,insideConnector,"jbpm:InputOutput")}function getConnector(element){return inputOutputHelper.getConnector(element,"jbpm:InputOutput")}function getInputParameters(element,insideConnector){return inputOutputHelper.getInputParameters(element,insideConnector,"jbpm:InputOutput")}function getOutputParameters(element,insideConnector){return inputOutputHelper.getOutputParameters(element,insideConnector,"jbpm:InputOutput")}function getInputParameter(element,insideConnector,idx){return inputOutputHelper.getInputParameter(element,insideConnector,idx,"jbpm:InputOutput")}function getOutputParameter(element,insideConnector,idx){return inputOutputHelper.getOutputParameter(element,insideConnector,idx,"jbpm:InputOutput")}function createElement(type,parent,factory,properties){return elementHelper.createElement(type,properties,parent,factory)}function createInputOutput(parent,bpmnFactory,properties){return createElement("jbpm:InputOutput",parent,bpmnFactory,properties)}function createParameter(type,parent,bpmnFactory,properties){return createElement(type,parent,bpmnFactory,properties)}function ensureInputOutputSupported(element,insideConnector){return inputOutputHelper.isInputOutputSupported(element,insideConnector)}function ensureOutparameterSupported(element,insideConnector){return inputOutputHelper.areOutputParametersSupported(element,insideConnector)}var getBusinessObject=_dereq_(69).getBusinessObject,elementHelper=_dereq_(23),extensionElementsHelper=_dereq_(25),inputOutputHelper=_dereq_(27),cmdHelper=_dereq_(22),extensionElementsEntry=_dereq_(60);module.exports=function(element,bpmnFactory,options,translate){options=options||{};var insideConnector=!!options.insideConnector,idPrefix=options.idPrefix||"",getSelected=function(element,node){var selection=inputEntry&&inputEntry.getSelected(element,node)||{idx:-1},parameter=getInputParameter(element,insideConnector,selection.idx);return!parameter&&outputEntry&&(selection=outputEntry.getSelected(element,node),parameter=getOutputParameter(element,insideConnector,selection.idx)),parameter},result={getSelectedParameter:getSelected},entries=result.entries=[];if(!ensureInputOutputSupported(element))return result;var newElement=function(type,prop,factory){return function(element,extensionElements,value){var commands=[],inputOutput=getInputOutput(element,insideConnector);if(!inputOutput){var parent=insideConnector?getConnector(element):extensionElements;inputOutput=createInputOutput(parent,bpmnFactory,{inputParameters:[],outputParameters:[]}),insideConnector?commands.push(cmdHelper.updateBusinessObject(element,parent,{inputOutput:inputOutput})):commands.push(cmdHelper.addAndRemoveElementsFromList(element,extensionElements,"values","extensionElements",[inputOutput],[]))}var newElem=createParameter(type,inputOutput,bpmnFactory,{name:value});return commands.push(cmdHelper.addElementsTolist(element,inputOutput,prop,[newElem])),commands}},removeElement=function(getter,prop,otherProp){return function(element,extensionElements,value,idx){var inputOutput=getInputOutput(element,insideConnector),parameter=getter(element,insideConnector,idx),commands=[];commands.push(cmdHelper.removeElementsFromList(element,inputOutput,prop,null,[parameter]));var firstLength=inputOutput.get(prop).length-1,secondLength=(inputOutput.get(otherProp)||[]).length;if(!firstLength&&!secondLength)if(insideConnector){var connector=getConnector(element);commands.push(cmdHelper.updateBusinessObject(element,connector,{inputOutput:void 0}))}else commands.push(extensionElementsHelper.removeEntry(getBusinessObject(element),element,inputOutput));return commands}},setOptionLabelValue=function(getter){return function(element,node,option,property,value,idx){var parameter=getter(element,insideConnector,idx);option.text=(value||"")+(parameter.value?" : "+parameter.value:"")}},inputEntry=extensionElementsEntry(element,bpmnFactory,{id:idPrefix+"inputs",label:translate("Input Parameters"),modelProperty:"name",prefix:"Input",resizable:!0,createExtensionElement:newElement("jbpm:InputParameter","inputParameters"),removeExtensionElement:removeElement(getInputParameter,"inputParameters","outputParameters"),getExtensionElements:function(element){return getInputParameters(element,insideConnector)},onSelectionChange:function(element,node,event,scope){outputEntry&&outputEntry.deselect(element,node)},setOptionLabelValue:setOptionLabelValue(getInputParameter)});if(entries.push(inputEntry),ensureOutparameterSupported(element,insideConnector)){var outputEntry=extensionElementsEntry(element,bpmnFactory,{id:idPrefix+"outputs",label:translate("Output Parameters"),modelProperty:"name",prefix:"Output",resizable:!0,createExtensionElement:newElement("jbpm:OutputParameter","outputParameters"),removeExtensionElement:removeElement(getOutputParameter,"outputParameters","inputParameters"),getExtensionElements:function(element){return getOutputParameters(element,insideConnector)},onSelectionChange:function(element,node,event,scope){inputEntry.deselect(element,node)},setOptionLabelValue:setOptionLabelValue(getOutputParameter)});entries.push(outputEntry)}return result}},{22:22,23:23,25:25,27:27,60:60,69:69}],64:[function(_dereq_,module,exports){"use strict";function ensureInputOutputSupported(element,insideConnector){
return inputOutputHelper.isInputOutputSupported(element,insideConnector)}var inputOutputHelper=_dereq_(27),cmdHelper=_dereq_(22),utils=_dereq_(4),entryFactory=_dereq_(13);module.exports=function(element,bpmnFactory,options,translate){options=options||{};var insideConnector=!!options.insideConnector,idPrefix=options.idPrefix||"",getSelected=options.getSelectedParameter;if(!ensureInputOutputSupported(element,insideConnector))return[];var entries=[],isSelected=function(element,node){return getSelected(element,node)};return entries.push(entryFactory.validationAwareTextField({id:idPrefix+"parameterName",label:translate("Name"),modelProperty:"name",getProperty:function(element,node){return(getSelected(element,node)||{}).name},setProperty:function(element,values,node){var param=getSelected(element,node);return cmdHelper.updateBusinessObject(element,param,values)},validate:function(element,values,node){var bo=getSelected(element,node),validation={};if(bo){var nameValue=values.name;nameValue?utils.containsSpace(nameValue)&&(validation.name="Name must not contain spaces"):validation.name="Parameter must have a name"}return validation},disabled:function(element,node){return!isSelected(element,node)}})),entries.push(entryFactory.textBox({id:idPrefix+"parameterType-text",label:translate("Value"),modelProperty:"value",get:function(element,node){return{value:(getSelected(element,node)||{}).value}},set:function(element,values,node){var param=getSelected(element,node);return values.value=values.value||void 0,cmdHelper.updateBusinessObject(element,param,values)},show:function(element,node){var bo=getSelected(element,node);return bo&&!bo.definition}})),entries}},{13:13,22:22,27:27,4:4}],65:[function(_dereq_,module,exports){"use strict";var is=_dereq_(69).is,assign=_dereq_(166),entryFactory=_dereq_(13),cmdHelper=_dereq_(22);module.exports=function(element,bpmnFactory,options){var getBusinessObject=options.getBusinessObject,hideResultVariable=options.hideResultVariable,id=options.id||"resultVariable",resultVariableEntry=entryFactory.textField({id:id,label:"Result Variable",modelProperty:"resultVariable",get:function(element,node){return{resultVariable:getBusinessObject(element).get("jbpm:resultVariable")}},set:function(element,values,node){var bo=getBusinessObject(element),resultVariable=values.resultVariable||void 0,props={"jbpm:resultVariable":resultVariable};return is(bo,"jbpm:DmnCapable")&&!resultVariable&&(props=assign({"jbpm:mapDecisionResult":"resultList"},props)),cmdHelper.updateBusinessObject(element,bo,props)},disabled:function(element,node){if("function"==typeof hideResultVariable)return hideResultVariable.apply(resultVariableEntry,arguments)}});return[resultVariableEntry]}},{13:13,166:166,22:22,69:69}],66:[function(_dereq_,module,exports){"use strict";function getScriptType(node){return utils.selectedType("select[name=scriptType]",node.parentElement)}var domQuery=_dereq_(182),utils=_dereq_(4);module.exports=function(scriptLanguagePropName,scriptValuePropName,isFormatRequired,translate){return{template:'<div class="pp-row pp-textfield"><label for="cam-script-format">'+translate("Script Format")+'</label><div class="pp-field-wrapper"><select id="cam-script-format" name="scriptFormat" data-value><option value="http://www.w3.org/1999/XPath" selected>'+translate("XPath 1.0")+'</option><option value="http://www.java.com/java">'+translate("Java")+'</option><option value="http://www.mvel.org/2.0">'+translate("MVEL 2.0")+'</option><option value="http://www.javascript.com/javascript">'+translate("JavaScript")+'</option></select><button class="clear" data-action="script.clearScriptFormat" data-show="script.canClearScriptFormat"><span>X</span></button></div></div><div class="pp-row"><label for="cam-script-type">'+translate("Script Type")+'</label><div class="pp-field-wrapper"><select id="cam-script-type" name="scriptType" data-value><option value="script" selected>'+translate("Inline Script")+'</option><option value="scriptResource">'+translate("External Resource")+'</option></select></div></div><div class="pp-row pp-textfield"><label for="cam-script-resource-val" data-show="script.isScriptResource">'+translate("Resource")+'</label><div class="pp-field-wrapper" data-show="script.isScriptResource"><input id="cam-script-resource-val" type="text" name="scriptResourceValue" /><button class="clear" data-action="script.clearScriptResource" data-show="script.canClearScriptResource"><span>X</span></button></div></div><div class="pp-row"><label for="cam-script-val" data-show="script.isScript">'+translate("Script")+'</label><div class="pp-field-wrapper" data-show="script.isScript"><textarea id="cam-script-val" type="text" name="scriptValue"></textarea></div></div>',get:function(element,bo){var values={},boScriptResource=bo.get("jbpm:resource"),boScript=bo.get(scriptValuePropName),boScriptFormat=bo.get(scriptLanguagePropName);return void 0!==boScriptResource?(values.scriptResourceValue=boScriptResource,values.scriptType="scriptResource"):(values.scriptValue=boScript,values.scriptType="script"),values.scriptFormat=boScriptFormat,values},set:function(element,values,containerElement){var scriptFormat=values.scriptFormat,scriptType=values.scriptType,scriptResourceValue=values.scriptResourceValue,scriptValue=values.scriptValue,update={"jbpm:resource":void 0};return update[scriptValuePropName]=void 0,update[scriptLanguagePropName]=void 0,isFormatRequired?update[scriptLanguagePropName]=scriptFormat||"":""!==scriptFormat&&(update[scriptLanguagePropName]=scriptFormat),"scriptResource"===scriptType?update["jbpm:resource"]=scriptResourceValue||"":update[scriptValuePropName]=scriptValue||"",update},validate:function(element,values){var validationResult={};return"script"!==values.scriptType||values.scriptValue||(validationResult.scriptValue="Must provide a value"),"scriptResource"!==values.scriptType||values.scriptResourceValue||(validationResult.scriptResourceValue="Must provide a value"),!isFormatRequired||values.scriptFormat&&0!==values.scriptFormat.length||(validationResult.scriptFormat="Must provide a value"),validationResult},clearScriptFormat:function(element,inputNode,btnNode,scopeNode){return domQuery("select[name=scriptFormat]",scopeNode).value="",!0},canClearScriptFormat:function(element,inputNode,btnNode,scopeNode){return""!==domQuery("select[name=scriptFormat]",scopeNode).value},clearScriptResource:function(element,inputNode,btnNode,scopeNode){return domQuery("input[name=scriptResourceValue]",scopeNode).value="",!0},canClearScriptResource:function(element,inputNode,btnNode,scopeNode){return""!==domQuery("input[name=scriptResourceValue]",scopeNode).value},clearScript:function(element,inputNode,btnNode,scopeNode){return domQuery("textarea[name=scriptValue]",scopeNode).value="",!0},canClearScript:function(element,inputNode,btnNode,scopeNode){return""!==domQuery("textarea[name=scriptValue]",scopeNode).value},isScriptResource:function(element,inputNode,btnNode,scopeNode){return"scriptResource"===getScriptType(scopeNode)},isScript:function(element,inputNode,btnNode,scopeNode){return"script"===getScriptType(scopeNode)}}}},{182:182,4:4}],67:[function(_dereq_,module,exports){"use strict";function isAny(element,types){return any(types,function(t){return is(element,t)})}function getParent(element,anyType){for("string"==typeof anyType&&(anyType=[anyType]);element=element.parent;)if(isAny(element,anyType))return element;return null}var any=_dereq_(88),is=_dereq_(69).is;module.exports.isAny=isAny,module.exports.getParent=getParent},{69:69,88:88}],68:[function(_dereq_,module,exports){"use strict";function hasEventDefinition(element,eventType){var bo=getBusinessObject(element),hasEventDefinition=!1;return bo.eventDefinitions&&forEach(bo.eventDefinitions,function(event){is(event,eventType)&&(hasEventDefinition=!0)}),hasEventDefinition}var is=_dereq_(69).is,getBusinessObject=_dereq_(69).getBusinessObject,forEach=_dereq_(91);module.exports.isExpanded=function(element){return!is(element,"bpmn:CallActivity")&&(is(element,"bpmn:SubProcess")?!!getBusinessObject(element).di.isExpanded:!is(element,"bpmn:Participant")||!!getBusinessObject(element).processRef)},module.exports.isInterrupting=function(element){return element&&!1!==getBusinessObject(element).isInterrupting},module.exports.isEventSubProcess=function(element){return element&&!!getBusinessObject(element).triggeredByEvent},module.exports.hasEventDefinition=hasEventDefinition,module.exports.hasErrorEventDefinition=function(element){return hasEventDefinition(element,"bpmn:ErrorEventDefinition")},module.exports.hasEscalationEventDefinition=function(element){return hasEventDefinition(element,"bpmn:EscalationEventDefinition")},module.exports.hasCompensateEventDefinition=function(element){return hasEventDefinition(element,"bpmn:CompensateEventDefinition")}},{69:69,91:91}],69:[function(_dereq_,module,exports){"use strict";function is(element,type){var bo=getBusinessObject(element);return bo&&"function"==typeof bo.$instanceOf&&bo.$instanceOf(type)}function getBusinessObject(element){return element&&element.businessObject||element}module.exports.is=is,module.exports.getBusinessObject=getBusinessObject},{}],70:[function(_dereq_,module,exports){function ClassList(el){if(!el||!el.nodeType)throw new Error("A DOM element reference is required");this.el=el,this.list=el.classList}try{var index=_dereq_(76)}catch(err){var index=_dereq_(76)}var re=/\s+/,toString=Object.prototype.toString;module.exports=function(el){return new ClassList(el)},ClassList.prototype.add=function(name){if(this.list)return this.list.add(name),this;var arr=this.array();return~index(arr,name)||arr.push(name),this.el.className=arr.join(" "),this},ClassList.prototype.remove=function(name){if("[object RegExp]"==toString.call(name))return this.removeMatching(name);if(this.list)return this.list.remove(name),this;var arr=this.array(),i=index(arr,name);return~i&&arr.splice(i,1),this.el.className=arr.join(" "),this},ClassList.prototype.removeMatching=function(re){for(var arr=this.array(),i=0;i<arr.length;i++)re.test(arr[i])&&this.remove(arr[i]);return this},ClassList.prototype.toggle=function(name,force){return this.list?(void 0!==force?force!==this.list.toggle(name,force)&&this.list.toggle(name):this.list.toggle(name),this):(void 0!==force?force?this.add(name):this.remove(name):this.has(name)?this.remove(name):this.add(name),this)},ClassList.prototype.array=function(){var className=this.el.getAttribute("class")||"",str=className.replace(/^\s+|\s+$/g,""),arr=str.split(re);return""===arr[0]&&arr.shift(),arr},ClassList.prototype.has=ClassList.prototype.contains=function(name){return this.list?this.list.contains(name):!!~index(this.array(),name)}},{76:76}],71:[function(_dereq_,module,exports){var matches=_dereq_(77);module.exports=function(element,selector,checkYoSelf,root){for(element=checkYoSelf?{parentNode:element}:element,root=root||document;(element=element.parentNode)&&element!==document;){if(matches(element,selector))return element;if(element===root)return}}},{77:77}],72:[function(_dereq_,module,exports){try{var closest=_dereq_(73)}catch(err){var closest=_dereq_(73)}try{var event=_dereq_(74)}catch(err){var event=_dereq_(74)}exports.bind=function(el,selector,type,fn,capture){return event.bind(el,type,function(e){var target=e.target||e.srcElement;e.delegateTarget=closest(target,selector,!0,el),e.delegateTarget&&fn.call(el,e)},capture)},exports.unbind=function(el,type,fn,capture){event.unbind(el,type,fn,capture)}},{73:73,74:74}],73:[function(_dereq_,module,exports){function closest(el,selector,scope){for(scope=scope||document.documentElement;el&&el!==scope;){if(matches(el,selector))return el;el=el.parentNode}return matches(el,selector)?el:null}try{var matches=_dereq_(77)}catch(err){var matches=_dereq_(77)}module.exports=closest},{77:77}],74:[function(_dereq_,module,exports){function detect(){bind=window.addEventListener?"addEventListener":"attachEvent",unbind=window.removeEventListener?"removeEventListener":"detachEvent",prefix="addEventListener"!==bind?"on":""}var bind,unbind,prefix;exports.bind=function(el,type,fn,capture){return bind||detect(),el[bind](prefix+type,fn,capture||!1),fn},exports.unbind=function(el,type,fn,capture){return unbind||detect(),el[unbind](prefix+type,fn,capture||!1),fn}},{}],75:[function(_dereq_,module,exports){var bind=window.addEventListener?"addEventListener":"attachEvent",unbind=window.removeEventListener?"removeEventListener":"detachEvent",prefix="addEventListener"!==bind?"on":"";exports.bind=function(el,type,fn,capture){return el[bind](prefix+type,fn,capture||!1),fn},exports.unbind=function(el,type,fn,capture){return el[unbind](prefix+type,fn,capture||!1),fn}},{}],76:[function(_dereq_,module,exports){module.exports=function(arr,obj){if(arr.indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i)if(arr[i]===obj)return i;return-1}},{}],77:[function(_dereq_,module,exports){function match(el,selector){if(!el||1!==el.nodeType)return!1;if(vendor)return vendor.call(el,selector);for(var nodes=query.all(selector,el.parentNode),i=0;i<nodes.length;++i)if(nodes[i]==el)return!0;return!1}try{var query=_dereq_(78)}catch(err){var query=_dereq_(78)}var proto=Element.prototype,vendor=proto.matches||proto.webkitMatchesSelector||proto.mozMatchesSelector||proto.msMatchesSelector||proto.oMatchesSelector;module.exports=match},{78:78}],78:[function(_dereq_,module,exports){function one(selector,el){return el.querySelector(selector)}exports=module.exports=function(selector,el){return el=el||document,one(selector,el)},exports.all=function(selector,el){return el=el||document,el.querySelectorAll(selector)},exports.engine=function(obj){if(!obj.one)throw new Error(".one callback required");if(!obj.all)throw new Error(".all callback required");return one=obj.one,exports.all=obj.all,exports}},{}],79:[function(_dereq_,module,exports){module.exports={translate:["value",_dereq_(80)]}},{80:80}],80:[function(_dereq_,module,exports){"use strict";module.exports=function(template,replacements){return replacements=replacements||{},template.replace(/{([^}]+)}/g,function(_,key){return replacements[key]||"{"+key+"}"})}},{}],81:[function(_dereq_,module,exports){function parse(html,doc){if("string"!=typeof html)throw new TypeError("String expected");doc||(doc=document);var m=/<([\w:]+)/.exec(html);if(!m)return doc.createTextNode(html);html=html.replace(/^\s+|\s+$/g,"");var tag=m[1];if("body"==tag){var el=doc.createElement("html");return el.innerHTML=html,el.removeChild(el.lastChild)}var wrap=map[tag]||map._default,depth=wrap[0],prefix=wrap[1],suffix=wrap[2],el=doc.createElement("div");for(el.innerHTML=prefix+html+suffix;depth--;)el=el.lastChild;if(el.firstChild==el.lastChild)return el.removeChild(el.firstChild);for(var fragment=doc.createDocumentFragment();el.firstChild;)fragment.appendChild(el.removeChild(el.firstChild));return fragment}module.exports=parse;var bugTestDiv,innerHTMLBug=!1;"undefined"!=typeof document&&(bugTestDiv=document.createElement("div"),bugTestDiv.innerHTML='  <link/><table></table><a href="/a">a</a><input type="checkbox"/>',innerHTMLBug=!bugTestDiv.getElementsByTagName("link").length,bugTestDiv=void 0);var map={legend:[1,"<fieldset>","</fieldset>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],_default:innerHTMLBug?[1,"X<div>","</div>"]:[0,"",""]};map.td=map.th=[3,"<table><tbody><tr>","</tr></tbody></table>"],map.option=map.optgroup=[1,'<select multiple="multiple">',"</select>"],map.thead=map.tbody=map.colgroup=map.caption=map.tfoot=[1,"<table>","</table>"],map.polyline=map.ellipse=map.polygon=map.circle=map.text=map.line=map.path=map.rect=map.g=[1,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1">',"</svg>"]},{}],82:[function(_dereq_,module,exports){var hat=module.exports=function(bits,base){if(base||(base=16),void 0===bits&&(bits=128),bits<=0)return"0";for(var digits=Math.log(Math.pow(2,bits))/Math.log(base),i=2;digits===1/0;i*=2)digits=Math.log(Math.pow(2,bits/i))/Math.log(base)*i;for(var rem=digits-Math.floor(digits),res="",i=0;i<Math.floor(digits);i++){var x=Math.floor(Math.random()*base).toString(base);res=x+res}if(rem){var b=Math.pow(base,rem),x=Math.floor(Math.random()*b).toString(base);res=x+res}var parsed=parseInt(res,base);return parsed!==1/0&&parsed>=Math.pow(2,bits)?hat(bits,base):res};hat.rack=function(bits,base,expandBy){var fn=function(data){var iters=0;do{if(iters++>10){if(!expandBy)throw new Error("too many ID collisions, use more bits");bits+=expandBy}var id=hat(bits,base)}while(Object.hasOwnProperty.call(hats,id));return hats[id]=data,id},hats=fn.hats={};return fn.get=function(id){return fn.hats[id]},fn.set=function(id,value){return fn.hats[id]=value,fn},fn.bits=bits||128,fn.base=base||16,fn}},{}],83:[function(_dereq_,module,exports){"use strict";function Ids(seed){if(!(this instanceof Ids))return new Ids(seed);seed=seed||[128,36,1],this._seed=seed.length?hat.rack(seed[0],seed[1],seed[2]):seed}var hat=_dereq_(82);module.exports=Ids,Ids.prototype.next=function(element){return this._seed(element||!0)},Ids.prototype.nextPrefixed=function(prefix,element){var id;do{id=prefix+this.next(!0)}while(this.assigned(id));return this.claim(id,element),id},Ids.prototype.claim=function(id,element){this._seed.set(id,element||!0)},Ids.prototype.assigned=function(id){return this._seed.get(id)||!1},Ids.prototype.unclaim=function(id){delete this._seed.hats[id]},Ids.prototype.clear=function(){var id,hats=this._seed.hats;for(id in hats)this.unclaim(id)}},{82:82}],84:[function(_dereq_,module,exports){"function"==typeof Object.create?module.exports=function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}},{}],85:[function(_dereq_,module,exports){function flattenDeep(array){return(array?array.length:0)?baseFlatten(array,!0):[]}var baseFlatten=_dereq_(114);module.exports=flattenDeep},{114:114}],86:[function(_dereq_,module,exports){function last(array){var length=array?array.length:0;return length?array[length-1]:void 0}module.exports=last},{}],87:[function(_dereq_,module,exports){function xor(){for(var index=-1,length=arguments.length;++index<length;){var array=arguments[index];if(isArrayLike(array))var result=result?arrayPush(baseDifference(result,array),baseDifference(array,result)):array}return result?baseUniq(result):[]}var arrayPush=_dereq_(102),baseDifference=_dereq_(109),baseUniq=_dereq_(130),isArrayLike=_dereq_(148);module.exports=xor},{102:102,109:109,130:130,148:148}],88:[function(_dereq_,module,exports){module.exports=_dereq_(94)},{94:94}],89:[function(_dereq_,module,exports){function filter(collection,predicate,thisArg){var func=isArray(collection)?arrayFilter:baseFilter;return predicate=baseCallback(predicate,thisArg,3),func(collection,predicate)}var arrayFilter=_dereq_(100),baseCallback=_dereq_(106),baseFilter=_dereq_(111),isArray=_dereq_(159);module.exports=filter},{100:100,106:106,111:111,159:159}],90:[function(_dereq_,module,exports){var baseEach=_dereq_(110),createFind=_dereq_(139),find=createFind(baseEach);module.exports=find},{110:110,139:139}],91:[function(_dereq_,module,exports){var arrayEach=_dereq_(99),baseEach=_dereq_(110),createForEach=_dereq_(140),forEach=createForEach(arrayEach,baseEach);module.exports=forEach},{110:110,140:140,99:99}],92:[function(_dereq_,module,exports){var createAggregator=_dereq_(134),indexBy=createAggregator(function(result,value,key){result[key]=value});module.exports=indexBy},{134:134}],93:[function(_dereq_,module,exports){function map(collection,iteratee,thisArg){var func=isArray(collection)?arrayMap:baseMap;return iteratee=baseCallback(iteratee,thisArg,3),func(collection,iteratee)}var arrayMap=_dereq_(101),baseCallback=_dereq_(106),baseMap=_dereq_(122),isArray=_dereq_(159);module.exports=map},{101:101,106:106,122:122,159:159}],94:[function(_dereq_,module,exports){function some(collection,predicate,thisArg){var func=isArray(collection)?arraySome:baseSome;return thisArg&&isIterateeCall(collection,predicate,thisArg)&&(predicate=void 0),"function"==typeof predicate&&void 0===thisArg||(predicate=baseCallback(predicate,thisArg,3)),func(collection,predicate)}var arraySome=_dereq_(103),baseCallback=_dereq_(106),baseSome=_dereq_(128),isArray=_dereq_(159),isIterateeCall=_dereq_(150);module.exports=some},{103:103,106:106,128:128,150:150,159:159}],95:[function(_dereq_,module,exports){var getNative=_dereq_(146),nativeNow=getNative(Date,"now"),now=nativeNow||function(){return(new Date).getTime()};module.exports=now},{146:146}],96:[function(_dereq_,module,exports){function debounce(func,wait,options){function cancel(){timeoutId&&clearTimeout(timeoutId),maxTimeoutId&&clearTimeout(maxTimeoutId),lastCalled=0,maxTimeoutId=timeoutId=trailingCall=void 0}function complete(isCalled,id){id&&clearTimeout(id),maxTimeoutId=timeoutId=trailingCall=void 0,isCalled&&(lastCalled=now(),result=func.apply(thisArg,args),timeoutId||maxTimeoutId||(args=thisArg=void 0))}function delayed(){var remaining=wait-(now()-stamp);remaining<=0||remaining>wait?complete(trailingCall,maxTimeoutId):timeoutId=setTimeout(delayed,remaining)}function maxDelayed(){complete(trailing,timeoutId)}function debounced(){if(args=arguments,stamp=now(),thisArg=this,trailingCall=trailing&&(timeoutId||!leading),!1===maxWait)var leadingCall=leading&&!timeoutId;else{maxTimeoutId||leading||(lastCalled=stamp);var remaining=maxWait-(stamp-lastCalled),isCalled=remaining<=0||remaining>maxWait;isCalled?(maxTimeoutId&&(maxTimeoutId=clearTimeout(maxTimeoutId)),lastCalled=stamp,result=func.apply(thisArg,args)):maxTimeoutId||(maxTimeoutId=setTimeout(maxDelayed,remaining))}return isCalled&&timeoutId?timeoutId=clearTimeout(timeoutId):timeoutId||wait===maxWait||(timeoutId=setTimeout(delayed,wait)),leadingCall&&(isCalled=!0,result=func.apply(thisArg,args)),!isCalled||timeoutId||maxTimeoutId||(args=thisArg=void 0),result}var args,maxTimeoutId,result,stamp,thisArg,timeoutId,trailingCall,lastCalled=0,maxWait=!1,trailing=!0;if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);if(wait=wait<0?0:+wait||0,!0===options){var leading=!0;trailing=!1}else isObject(options)&&(leading=!!options.leading,maxWait="maxWait"in options&&nativeMax(+options.maxWait||0,wait),trailing="trailing"in options?!!options.trailing:trailing);return debounced.cancel=cancel,debounced}var isObject=_dereq_(163),now=_dereq_(95),FUNC_ERROR_TEXT="Expected a function",nativeMax=Math.max;module.exports=debounce},{163:163,95:95}],97:[function(_dereq_,module,exports){function restParam(func,start){if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return start=nativeMax(void 0===start?func.length-1:+start||0,0),function(){for(var args=arguments,index=-1,length=nativeMax(args.length-start,0),rest=Array(length);++index<length;)rest[index]=args[start+index];switch(start){case 0:return func.call(this,rest);case 1:return func.call(this,args[0],rest);case 2:return func.call(this,args[0],args[1],rest)}var otherArgs=Array(start+1);for(index=-1;++index<start;)otherArgs[index]=args[index];return otherArgs[start]=rest,func.apply(this,otherArgs)}}var FUNC_ERROR_TEXT="Expected a function",nativeMax=Math.max;module.exports=restParam},{}],98:[function(_dereq_,module,exports){(function(global){function SetCache(values){var length=values?values.length:0;for(this.data={hash:nativeCreate(null),set:new Set};length--;)this.push(values[length])}var cachePush=_dereq_(133),getNative=_dereq_(146),Set=getNative(global,"Set"),nativeCreate=getNative(Object,"create");SetCache.prototype.push=cachePush,module.exports=SetCache}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{133:133,146:146}],99:[function(_dereq_,module,exports){function arrayEach(array,iteratee){for(var index=-1,length=array.length;++index<length&&!1!==iteratee(array[index],index,array););return array}module.exports=arrayEach},{}],100:[function(_dereq_,module,exports){function arrayFilter(array,predicate){for(var index=-1,length=array.length,resIndex=-1,result=[];++index<length;){var value=array[index];predicate(value,index,array)&&(result[++resIndex]=value)}return result}module.exports=arrayFilter},{}],101:[function(_dereq_,module,exports){function arrayMap(array,iteratee){for(var index=-1,length=array.length,result=Array(length);++index<length;)result[index]=iteratee(array[index],index,array);return result}module.exports=arrayMap},{}],102:[function(_dereq_,module,exports){function arrayPush(array,values){for(var index=-1,length=values.length,offset=array.length;++index<length;)array[offset+index]=values[index];return array}module.exports=arrayPush},{}],103:[function(_dereq_,module,exports){function arraySome(array,predicate){for(var index=-1,length=array.length;++index<length;)if(predicate(array[index],index,array))return!0;return!1}module.exports=arraySome},{}],104:[function(_dereq_,module,exports){function assignWith(object,source,customizer){for(var index=-1,props=keys(source),length=props.length;++index<length;){var key=props[index],value=object[key],result=customizer(value,source[key],key,object,source);(result===result?result===value:value!==value)&&(void 0!==value||key in object)||(object[key]=result)}return object}var keys=_dereq_(168);module.exports=assignWith},{168:168}],105:[function(_dereq_,module,exports){function baseAssign(object,source){return null==source?object:baseCopy(source,keys(source),object)}var baseCopy=_dereq_(107),keys=_dereq_(168);module.exports=baseAssign},{107:107,168:168}],106:[function(_dereq_,module,exports){function baseCallback(func,thisArg,argCount){var type=typeof func;return"function"==type?void 0===thisArg?func:bindCallback(func,thisArg,argCount):null==func?identity:"object"==type?baseMatches(func):void 0===thisArg?property(func):baseMatchesProperty(func,thisArg)}var baseMatches=_dereq_(123),baseMatchesProperty=_dereq_(124),bindCallback=_dereq_(131),identity=_dereq_(172),property=_dereq_(173);module.exports=baseCallback},{123:123,124:124,131:131,172:172,173:173}],107:[function(_dereq_,module,exports){function baseCopy(source,props,object){object||(object={});for(var index=-1,length=props.length;++index<length;){var key=props[index];object[key]=source[key]}return object}module.exports=baseCopy},{}],108:[function(_dereq_,module,exports){var isObject=_dereq_(163),baseCreate=function(){function object(){}return function(prototype){if(isObject(prototype)){object.prototype=prototype;var result=new object;object.prototype=void 0}return result||{}}}();module.exports=baseCreate},{163:163}],109:[function(_dereq_,module,exports){function baseDifference(array,values){var length=array?array.length:0,result=[];if(!length)return result;var index=-1,indexOf=baseIndexOf,isCommon=!0,cache=isCommon&&values.length>=LARGE_ARRAY_SIZE?createCache(values):null,valuesLength=values.length;cache&&(indexOf=cacheIndexOf,isCommon=!1,values=cache);outer:for(;++index<length;){var value=array[index];if(isCommon&&value===value){for(var valuesIndex=valuesLength;valuesIndex--;)if(values[valuesIndex]===value)continue outer;result.push(value)}else indexOf(values,value,0)<0&&result.push(value)}return result}var baseIndexOf=_dereq_(118),cacheIndexOf=_dereq_(132),createCache=_dereq_(138),LARGE_ARRAY_SIZE=200;module.exports=baseDifference},{118:118,132:132,138:138}],110:[function(_dereq_,module,exports){var baseForOwn=_dereq_(116),createBaseEach=_dereq_(136),baseEach=createBaseEach(baseForOwn);module.exports=baseEach},{116:116,136:136}],111:[function(_dereq_,module,exports){function baseFilter(collection,predicate){var result=[];return baseEach(collection,function(value,index,collection){predicate(value,index,collection)&&result.push(value)}),result}var baseEach=_dereq_(110);module.exports=baseFilter},{110:110}],112:[function(_dereq_,module,exports){function baseFind(collection,predicate,eachFunc,retKey){var result;return eachFunc(collection,function(value,key,collection){if(predicate(value,key,collection))return result=retKey?key:value,!1}),result}module.exports=baseFind},{}],113:[function(_dereq_,module,exports){function baseFindIndex(array,predicate,fromRight){for(var length=array.length,index=fromRight?length:-1;fromRight?index--:++index<length;)if(predicate(array[index],index,array))return index;return-1}module.exports=baseFindIndex},{}],114:[function(_dereq_,module,exports){function baseFlatten(array,isDeep,isStrict,result){result||(result=[]);for(var index=-1,length=array.length;++index<length;){var value=array[index];isObjectLike(value)&&isArrayLike(value)&&(isStrict||isArray(value)||isArguments(value))?isDeep?baseFlatten(value,isDeep,isStrict,result):arrayPush(result,value):isStrict||(result[result.length]=value)}return result}var arrayPush=_dereq_(102),isArguments=_dereq_(158),isArray=_dereq_(159),isArrayLike=_dereq_(148),isObjectLike=_dereq_(153);module.exports=baseFlatten},{102:102,148:148,153:153,158:158,159:159}],115:[function(_dereq_,module,exports){var createBaseFor=_dereq_(137),baseFor=createBaseFor();module.exports=baseFor},{137:137}],116:[function(_dereq_,module,exports){function baseForOwn(object,iteratee){return baseFor(object,iteratee,keys)}var baseFor=_dereq_(115),keys=_dereq_(168);module.exports=baseForOwn},{115:115,168:168}],117:[function(_dereq_,module,exports){function baseGet(object,path,pathKey){if(null!=object){void 0!==pathKey&&pathKey in toObject(object)&&(path=[pathKey]);for(var index=0,length=path.length;null!=object&&index<length;)object=object[path[index++]];return index&&index==length?object:void 0}}var toObject=_dereq_(156);module.exports=baseGet},{156:156}],118:[function(_dereq_,module,exports){function baseIndexOf(array,value,fromIndex){if(value!==value)return indexOfNaN(array,fromIndex);for(var index=fromIndex-1,length=array.length;++index<length;)if(array[index]===value)return index;return-1}var indexOfNaN=_dereq_(147);module.exports=baseIndexOf},{147:147}],119:[function(_dereq_,module,exports){function baseIsEqual(value,other,customizer,isLoose,stackA,stackB){return value===other||(null==value||null==other||!isObject(value)&&!isObjectLike(other)?value!==value&&other!==other:baseIsEqualDeep(value,other,baseIsEqual,customizer,isLoose,stackA,stackB))}var baseIsEqualDeep=_dereq_(120),isObject=_dereq_(163),isObjectLike=_dereq_(153);module.exports=baseIsEqual},{120:120,153:153,163:163}],120:[function(_dereq_,module,exports){function baseIsEqualDeep(object,other,equalFunc,customizer,isLoose,stackA,stackB){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=arrayTag,othTag=arrayTag;objIsArr||(objTag=objToString.call(object),objTag==argsTag?objTag=objectTag:objTag!=objectTag&&(objIsArr=isTypedArray(object))),othIsArr||(othTag=objToString.call(other),othTag==argsTag?othTag=objectTag:othTag!=objectTag&&(othIsArr=isTypedArray(other)));var objIsObj=objTag==objectTag,othIsObj=othTag==objectTag,isSameTag=objTag==othTag;if(isSameTag&&!objIsArr&&!objIsObj)return equalByTag(object,other,objTag);if(!isLoose){var objIsWrapped=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),othIsWrapped=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(objIsWrapped||othIsWrapped)return equalFunc(objIsWrapped?object.value():object,othIsWrapped?other.value():other,customizer,isLoose,stackA,stackB)}if(!isSameTag)return!1;stackA||(stackA=[]),stackB||(stackB=[]);for(var length=stackA.length;length--;)if(stackA[length]==object)return stackB[length]==other;stackA.push(object),stackB.push(other);var result=(objIsArr?equalArrays:equalObjects)(object,other,equalFunc,customizer,isLoose,stackA,stackB);return stackA.pop(),stackB.pop(),result}
var equalArrays=_dereq_(141),equalByTag=_dereq_(142),equalObjects=_dereq_(143),isArray=_dereq_(159),isTypedArray=_dereq_(165),argsTag="[object Arguments]",arrayTag="[object Array]",objectTag="[object Object]",objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,objToString=objectProto.toString;module.exports=baseIsEqualDeep},{141:141,142:142,143:143,159:159,165:165}],121:[function(_dereq_,module,exports){function baseIsMatch(object,matchData,customizer){var index=matchData.length,length=index,noCustomizer=!customizer;if(null==object)return!length;for(object=toObject(object);index--;){var data=matchData[index];if(noCustomizer&&data[2]?data[1]!==object[data[0]]:!(data[0]in object))return!1}for(;++index<length;){data=matchData[index];var key=data[0],objValue=object[key],srcValue=data[1];if(noCustomizer&&data[2]){if(void 0===objValue&&!(key in object))return!1}else{var result=customizer?customizer(objValue,srcValue,key):void 0;if(!(void 0===result?baseIsEqual(srcValue,objValue,customizer,!0):result))return!1}}return!0}var baseIsEqual=_dereq_(119),toObject=_dereq_(156);module.exports=baseIsMatch},{119:119,156:156}],122:[function(_dereq_,module,exports){function baseMap(collection,iteratee){var index=-1,result=isArrayLike(collection)?Array(collection.length):[];return baseEach(collection,function(value,key,collection){result[++index]=iteratee(value,key,collection)}),result}var baseEach=_dereq_(110),isArrayLike=_dereq_(148);module.exports=baseMap},{110:110,148:148}],123:[function(_dereq_,module,exports){function baseMatches(source){var matchData=getMatchData(source);if(1==matchData.length&&matchData[0][2]){var key=matchData[0][0],value=matchData[0][1];return function(object){return null!=object&&(object[key]===value&&(void 0!==value||key in toObject(object)))}}return function(object){return baseIsMatch(object,matchData)}}var baseIsMatch=_dereq_(121),getMatchData=_dereq_(145),toObject=_dereq_(156);module.exports=baseMatches},{121:121,145:145,156:156}],124:[function(_dereq_,module,exports){function baseMatchesProperty(path,srcValue){var isArr=isArray(path),isCommon=isKey(path)&&isStrictComparable(srcValue),pathKey=path+"";return path=toPath(path),function(object){if(null==object)return!1;var key=pathKey;if(object=toObject(object),(isArr||!isCommon)&&!(key in object)){if(null==(object=1==path.length?object:baseGet(object,baseSlice(path,0,-1))))return!1;key=last(path),object=toObject(object)}return object[key]===srcValue?void 0!==srcValue||key in object:baseIsEqual(srcValue,object[key],void 0,!0)}}var baseGet=_dereq_(117),baseIsEqual=_dereq_(119),baseSlice=_dereq_(127),isArray=_dereq_(159),isKey=_dereq_(151),isStrictComparable=_dereq_(154),last=_dereq_(86),toObject=_dereq_(156),toPath=_dereq_(157);module.exports=baseMatchesProperty},{117:117,119:119,127:127,151:151,154:154,156:156,157:157,159:159,86:86}],125:[function(_dereq_,module,exports){function baseProperty(key){return function(object){return null==object?void 0:object[key]}}module.exports=baseProperty},{}],126:[function(_dereq_,module,exports){function basePropertyDeep(path){var pathKey=path+"";return path=toPath(path),function(object){return baseGet(object,path,pathKey)}}var baseGet=_dereq_(117),toPath=_dereq_(157);module.exports=basePropertyDeep},{117:117,157:157}],127:[function(_dereq_,module,exports){function baseSlice(array,start,end){var index=-1,length=array.length;start=null==start?0:+start||0,start<0&&(start=-start>length?0:length+start),end=void 0===end||end>length?length:+end||0,end<0&&(end+=length),length=start>end?0:end-start>>>0,start>>>=0;for(var result=Array(length);++index<length;)result[index]=array[index+start];return result}module.exports=baseSlice},{}],128:[function(_dereq_,module,exports){function baseSome(collection,predicate){var result;return baseEach(collection,function(value,index,collection){return!(result=predicate(value,index,collection))}),!!result}var baseEach=_dereq_(110);module.exports=baseSome},{110:110}],129:[function(_dereq_,module,exports){function baseToString(value){return null==value?"":value+""}module.exports=baseToString},{}],130:[function(_dereq_,module,exports){function baseUniq(array,iteratee){var index=-1,indexOf=baseIndexOf,length=array.length,isCommon=!0,isLarge=isCommon&&length>=LARGE_ARRAY_SIZE,seen=isLarge?createCache():null,result=[];seen?(indexOf=cacheIndexOf,isCommon=!1):(isLarge=!1,seen=iteratee?[]:result);outer:for(;++index<length;){var value=array[index],computed=iteratee?iteratee(value,index,array):value;if(isCommon&&value===value){for(var seenIndex=seen.length;seenIndex--;)if(seen[seenIndex]===computed)continue outer;iteratee&&seen.push(computed),result.push(value)}else indexOf(seen,computed,0)<0&&((iteratee||isLarge)&&seen.push(computed),result.push(value))}return result}var baseIndexOf=_dereq_(118),cacheIndexOf=_dereq_(132),createCache=_dereq_(138),LARGE_ARRAY_SIZE=200;module.exports=baseUniq},{118:118,132:132,138:138}],131:[function(_dereq_,module,exports){function bindCallback(func,thisArg,argCount){if("function"!=typeof func)return identity;if(void 0===thisArg)return func;switch(argCount){case 1:return function(value){return func.call(thisArg,value)};case 3:return function(value,index,collection){return func.call(thisArg,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(thisArg,accumulator,value,index,collection)};case 5:return function(value,other,key,object,source){return func.call(thisArg,value,other,key,object,source)}}return function(){return func.apply(thisArg,arguments)}}var identity=_dereq_(172);module.exports=bindCallback},{172:172}],132:[function(_dereq_,module,exports){function cacheIndexOf(cache,value){var data=cache.data;return("string"==typeof value||isObject(value)?data.set.has(value):data.hash[value])?0:-1}var isObject=_dereq_(163);module.exports=cacheIndexOf},{163:163}],133:[function(_dereq_,module,exports){function cachePush(value){var data=this.data;"string"==typeof value||isObject(value)?data.set.add(value):data.hash[value]=!0}var isObject=_dereq_(163);module.exports=cachePush},{163:163}],134:[function(_dereq_,module,exports){function createAggregator(setter,initializer){return function(collection,iteratee,thisArg){var result=initializer?initializer():{};if(iteratee=baseCallback(iteratee,thisArg,3),isArray(collection))for(var index=-1,length=collection.length;++index<length;){var value=collection[index];setter(result,value,iteratee(value,index,collection),collection)}else baseEach(collection,function(value,key,collection){setter(result,value,iteratee(value,key,collection),collection)});return result}}var baseCallback=_dereq_(106),baseEach=_dereq_(110),isArray=_dereq_(159);module.exports=createAggregator},{106:106,110:110,159:159}],135:[function(_dereq_,module,exports){function createAssigner(assigner){return restParam(function(object,sources){var index=-1,length=null==object?0:sources.length,customizer=length>2?sources[length-2]:void 0,guard=length>2?sources[2]:void 0,thisArg=length>1?sources[length-1]:void 0;for("function"==typeof customizer?(customizer=bindCallback(customizer,thisArg,5),length-=2):(customizer="function"==typeof thisArg?thisArg:void 0,length-=customizer?1:0),guard&&isIterateeCall(sources[0],sources[1],guard)&&(customizer=length<3?void 0:customizer,length=1);++index<length;){var source=sources[index];source&&assigner(object,source,customizer)}return object})}var bindCallback=_dereq_(131),isIterateeCall=_dereq_(150),restParam=_dereq_(97);module.exports=createAssigner},{131:131,150:150,97:97}],136:[function(_dereq_,module,exports){function createBaseEach(eachFunc,fromRight){return function(collection,iteratee){var length=collection?getLength(collection):0;if(!isLength(length))return eachFunc(collection,iteratee);for(var index=fromRight?length:-1,iterable=toObject(collection);(fromRight?index--:++index<length)&&!1!==iteratee(iterable[index],index,iterable););return collection}}var getLength=_dereq_(144),isLength=_dereq_(152),toObject=_dereq_(156);module.exports=createBaseEach},{144:144,152:152,156:156}],137:[function(_dereq_,module,exports){function createBaseFor(fromRight){return function(object,iteratee,keysFunc){for(var iterable=toObject(object),props=keysFunc(object),length=props.length,index=fromRight?length:-1;fromRight?index--:++index<length;){var key=props[index];if(!1===iteratee(iterable[key],key,iterable))break}return object}}var toObject=_dereq_(156);module.exports=createBaseFor},{156:156}],138:[function(_dereq_,module,exports){(function(global){function createCache(values){return nativeCreate&&Set?new SetCache(values):null}var SetCache=_dereq_(98),getNative=_dereq_(146),Set=getNative(global,"Set"),nativeCreate=getNative(Object,"create");module.exports=createCache}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{146:146,98:98}],139:[function(_dereq_,module,exports){function createFind(eachFunc,fromRight){return function(collection,predicate,thisArg){if(predicate=baseCallback(predicate,thisArg,3),isArray(collection)){var index=baseFindIndex(collection,predicate,fromRight);return index>-1?collection[index]:void 0}return baseFind(collection,predicate,eachFunc)}}var baseCallback=_dereq_(106),baseFind=_dereq_(112),baseFindIndex=_dereq_(113),isArray=_dereq_(159);module.exports=createFind},{106:106,112:112,113:113,159:159}],140:[function(_dereq_,module,exports){function createForEach(arrayFunc,eachFunc){return function(collection,iteratee,thisArg){return"function"==typeof iteratee&&void 0===thisArg&&isArray(collection)?arrayFunc(collection,iteratee):eachFunc(collection,bindCallback(iteratee,thisArg,3))}}var bindCallback=_dereq_(131),isArray=_dereq_(159);module.exports=createForEach},{131:131,159:159}],141:[function(_dereq_,module,exports){function equalArrays(array,other,equalFunc,customizer,isLoose,stackA,stackB){var index=-1,arrLength=array.length,othLength=other.length;if(arrLength!=othLength&&!(isLoose&&othLength>arrLength))return!1;for(;++index<arrLength;){var arrValue=array[index],othValue=other[index],result=customizer?customizer(isLoose?othValue:arrValue,isLoose?arrValue:othValue,index):void 0;if(void 0!==result){if(result)continue;return!1}if(isLoose){if(!arraySome(other,function(othValue){return arrValue===othValue||equalFunc(arrValue,othValue,customizer,isLoose,stackA,stackB)}))return!1}else if(arrValue!==othValue&&!equalFunc(arrValue,othValue,customizer,isLoose,stackA,stackB))return!1}return!0}var arraySome=_dereq_(103);module.exports=equalArrays},{103:103}],142:[function(_dereq_,module,exports){function equalByTag(object,other,tag){switch(tag){case boolTag:case dateTag:return+object==+other;case errorTag:return object.name==other.name&&object.message==other.message;case numberTag:return object!=+object?other!=+other:object==+other;case regexpTag:case stringTag:return object==other+""}return!1}var boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",numberTag="[object Number]",regexpTag="[object RegExp]",stringTag="[object String]";module.exports=equalByTag},{}],143:[function(_dereq_,module,exports){function equalObjects(object,other,equalFunc,customizer,isLoose,stackA,stackB){var objProps=keys(object),objLength=objProps.length;if(objLength!=keys(other).length&&!isLoose)return!1;for(var index=objLength;index--;){var key=objProps[index];if(!(isLoose?key in other:hasOwnProperty.call(other,key)))return!1}for(var skipCtor=isLoose;++index<objLength;){key=objProps[index];var objValue=object[key],othValue=other[key],result=customizer?customizer(isLoose?othValue:objValue,isLoose?objValue:othValue,key):void 0;if(!(void 0===result?equalFunc(objValue,othValue,customizer,isLoose,stackA,stackB):result))return!1;skipCtor||(skipCtor="constructor"==key)}if(!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;if(objCtor!=othCtor&&"constructor"in object&&"constructor"in other&&!("function"==typeof objCtor&&objCtor instanceof objCtor&&"function"==typeof othCtor&&othCtor instanceof othCtor))return!1}return!0}var keys=_dereq_(168),objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty;module.exports=equalObjects},{168:168}],144:[function(_dereq_,module,exports){var baseProperty=_dereq_(125),getLength=baseProperty("length");module.exports=getLength},{125:125}],145:[function(_dereq_,module,exports){function getMatchData(object){for(var result=pairs(object),length=result.length;length--;)result[length][2]=isStrictComparable(result[length][1]);return result}var isStrictComparable=_dereq_(154),pairs=_dereq_(170);module.exports=getMatchData},{154:154,170:170}],146:[function(_dereq_,module,exports){function getNative(object,key){var value=null==object?void 0:object[key];return isNative(value)?value:void 0}var isNative=_dereq_(162);module.exports=getNative},{162:162}],147:[function(_dereq_,module,exports){function indexOfNaN(array,fromIndex,fromRight){for(var length=array.length,index=fromIndex+(fromRight?0:-1);fromRight?index--:++index<length;){var other=array[index];if(other!==other)return index}return-1}module.exports=indexOfNaN},{}],148:[function(_dereq_,module,exports){function isArrayLike(value){return null!=value&&isLength(getLength(value))}var getLength=_dereq_(144),isLength=_dereq_(152);module.exports=isArrayLike},{144:144,152:152}],149:[function(_dereq_,module,exports){function isIndex(value,length){return value="number"==typeof value||reIsUint.test(value)?+value:-1,length=null==length?MAX_SAFE_INTEGER:length,value>-1&&value%1==0&&value<length}var reIsUint=/^\d+$/,MAX_SAFE_INTEGER=9007199254740991;module.exports=isIndex},{}],150:[function(_dereq_,module,exports){function isIterateeCall(value,index,object){if(!isObject(object))return!1;var type=typeof index;if("number"==type?isArrayLike(object)&&isIndex(index,object.length):"string"==type&&index in object){var other=object[index];return value===value?value===other:other!==other}return!1}var isArrayLike=_dereq_(148),isIndex=_dereq_(149),isObject=_dereq_(163);module.exports=isIterateeCall},{148:148,149:149,163:163}],151:[function(_dereq_,module,exports){function isKey(value,object){var type=typeof value;return!!("string"==type&&reIsPlainProp.test(value)||"number"==type)||!isArray(value)&&(!reIsDeepProp.test(value)||null!=object&&value in toObject(object))}var isArray=_dereq_(159),toObject=_dereq_(156),reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/;module.exports=isKey},{156:156,159:159}],152:[function(_dereq_,module,exports){function isLength(value){return"number"==typeof value&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}var MAX_SAFE_INTEGER=9007199254740991;module.exports=isLength},{}],153:[function(_dereq_,module,exports){function isObjectLike(value){return!!value&&"object"==typeof value}module.exports=isObjectLike},{}],154:[function(_dereq_,module,exports){function isStrictComparable(value){return value===value&&!isObject(value)}var isObject=_dereq_(163);module.exports=isStrictComparable},{163:163}],155:[function(_dereq_,module,exports){function shimKeys(object){for(var props=keysIn(object),propsLength=props.length,length=propsLength&&object.length,allowIndexes=!!length&&isLength(length)&&(isArray(object)||isArguments(object)),index=-1,result=[];++index<propsLength;){var key=props[index];(allowIndexes&&isIndex(key,length)||hasOwnProperty.call(object,key))&&result.push(key)}return result}var isArguments=_dereq_(158),isArray=_dereq_(159),isIndex=_dereq_(149),isLength=_dereq_(152),keysIn=_dereq_(169),objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty;module.exports=shimKeys},{149:149,152:152,158:158,159:159,169:169}],156:[function(_dereq_,module,exports){function toObject(value){return isObject(value)?value:Object(value)}var isObject=_dereq_(163);module.exports=toObject},{163:163}],157:[function(_dereq_,module,exports){function toPath(value){if(isArray(value))return value;var result=[];return baseToString(value).replace(rePropName,function(match,number,quote,string){result.push(quote?string.replace(reEscapeChar,"$1"):number||match)}),result}var baseToString=_dereq_(129),isArray=_dereq_(159),rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,reEscapeChar=/\\(\\)?/g;module.exports=toPath},{129:129,159:159}],158:[function(_dereq_,module,exports){function isArguments(value){return isObjectLike(value)&&isArrayLike(value)&&hasOwnProperty.call(value,"callee")&&!propertyIsEnumerable.call(value,"callee")}var isArrayLike=_dereq_(148),isObjectLike=_dereq_(153),objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,propertyIsEnumerable=objectProto.propertyIsEnumerable;module.exports=isArguments},{148:148,153:153}],159:[function(_dereq_,module,exports){var getNative=_dereq_(146),isLength=_dereq_(152),isObjectLike=_dereq_(153),objectProto=Object.prototype,objToString=objectProto.toString,nativeIsArray=getNative(Array,"isArray"),isArray=nativeIsArray||function(value){return isObjectLike(value)&&isLength(value.length)&&"[object Array]"==objToString.call(value)};module.exports=isArray},{146:146,152:152,153:153}],160:[function(_dereq_,module,exports){function isEmpty(value){return null==value||(isArrayLike(value)&&(isArray(value)||isString(value)||isArguments(value)||isObjectLike(value)&&isFunction(value.splice))?!value.length:!keys(value).length)}var isArguments=_dereq_(158),isArray=_dereq_(159),isArrayLike=_dereq_(148),isFunction=_dereq_(161),isObjectLike=_dereq_(153),isString=_dereq_(164),keys=_dereq_(168);module.exports=isEmpty},{148:148,153:153,158:158,159:159,161:161,164:164,168:168}],161:[function(_dereq_,module,exports){function isFunction(value){return isObject(value)&&objToString.call(value)==funcTag}var isObject=_dereq_(163),funcTag="[object Function]",objectProto=Object.prototype,objToString=objectProto.toString;module.exports=isFunction},{163:163}],162:[function(_dereq_,module,exports){function isNative(value){return null!=value&&(isFunction(value)?reIsNative.test(fnToString.call(value)):isObjectLike(value)&&reIsHostCtor.test(value))}var isFunction=_dereq_(161),isObjectLike=_dereq_(153),reIsHostCtor=/^\[object .+?Constructor\]$/,objectProto=Object.prototype,fnToString=Function.prototype.toString,hasOwnProperty=objectProto.hasOwnProperty,reIsNative=RegExp("^"+fnToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");module.exports=isNative},{153:153,161:161}],163:[function(_dereq_,module,exports){function isObject(value){var type=typeof value;return!!value&&("object"==type||"function"==type)}module.exports=isObject},{}],164:[function(_dereq_,module,exports){function isString(value){return"string"==typeof value||isObjectLike(value)&&objToString.call(value)==stringTag}var isObjectLike=_dereq_(153),stringTag="[object String]",objectProto=Object.prototype,objToString=objectProto.toString;module.exports=isString},{153:153}],165:[function(_dereq_,module,exports){function isTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[objToString.call(value)]}var isLength=_dereq_(152),isObjectLike=_dereq_(153),typedArrayTags={};typedArrayTags["[object Float32Array]"]=typedArrayTags["[object Float64Array]"]=typedArrayTags["[object Int8Array]"]=typedArrayTags["[object Int16Array]"]=typedArrayTags["[object Int32Array]"]=typedArrayTags["[object Uint8Array]"]=typedArrayTags["[object Uint8ClampedArray]"]=typedArrayTags["[object Uint16Array]"]=typedArrayTags["[object Uint32Array]"]=!0,typedArrayTags["[object Arguments]"]=typedArrayTags["[object Array]"]=typedArrayTags["[object ArrayBuffer]"]=typedArrayTags["[object Boolean]"]=typedArrayTags["[object Date]"]=typedArrayTags["[object Error]"]=typedArrayTags["[object Function]"]=typedArrayTags["[object Map]"]=typedArrayTags["[object Number]"]=typedArrayTags["[object Object]"]=typedArrayTags["[object RegExp]"]=typedArrayTags["[object Set]"]=typedArrayTags["[object String]"]=typedArrayTags["[object WeakMap]"]=!1;var objectProto=Object.prototype,objToString=objectProto.toString;module.exports=isTypedArray},{152:152,153:153}],166:[function(_dereq_,module,exports){var assignWith=_dereq_(104),baseAssign=_dereq_(105),createAssigner=_dereq_(135),assign=createAssigner(function(object,source,customizer){return customizer?assignWith(object,source,customizer):baseAssign(object,source)});module.exports=assign},{104:104,105:105,135:135}],167:[function(_dereq_,module,exports){function get(object,path,defaultValue){var result=null==object?void 0:baseGet(object,toPath(path),path+"");return void 0===result?defaultValue:result}var baseGet=_dereq_(117),toPath=_dereq_(157);module.exports=get},{117:117,157:157}],168:[function(_dereq_,module,exports){var getNative=_dereq_(146),isArrayLike=_dereq_(148),isObject=_dereq_(163),shimKeys=_dereq_(155),nativeKeys=getNative(Object,"keys"),keys=nativeKeys?function(object){var Ctor=null==object?void 0:object.constructor;return"function"==typeof Ctor&&Ctor.prototype===object||"function"!=typeof object&&isArrayLike(object)?shimKeys(object):isObject(object)?nativeKeys(object):[]}:shimKeys;module.exports=keys},{146:146,148:148,155:155,163:163}],169:[function(_dereq_,module,exports){function keysIn(object){if(null==object)return[];isObject(object)||(object=Object(object));var length=object.length;length=length&&isLength(length)&&(isArray(object)||isArguments(object))&&length||0;for(var Ctor=object.constructor,index=-1,isProto="function"==typeof Ctor&&Ctor.prototype===object,result=Array(length),skipIndexes=length>0;++index<length;)result[index]=index+"";for(var key in object)skipIndexes&&isIndex(key,length)||"constructor"==key&&(isProto||!hasOwnProperty.call(object,key))||result.push(key);return result}var isArguments=_dereq_(158),isArray=_dereq_(159),isIndex=_dereq_(149),isLength=_dereq_(152),isObject=_dereq_(163),objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty;module.exports=keysIn},{149:149,152:152,158:158,159:159,163:163}],170:[function(_dereq_,module,exports){function pairs(object){object=toObject(object);for(var index=-1,props=keys(object),length=props.length,result=Array(length);++index<length;){var key=props[index];result[index]=[key,object[key]]}return result}var keys=_dereq_(168),toObject=_dereq_(156);module.exports=pairs},{156:156,168:168}],171:[function(_dereq_,module,exports){function transform(object,iteratee,accumulator,thisArg){var isArr=isArray(object)||isTypedArray(object);if(iteratee=baseCallback(iteratee,thisArg,4),null==accumulator)if(isArr||isObject(object)){var Ctor=object.constructor;accumulator=isArr?isArray(object)?new Ctor:[]:baseCreate(isFunction(Ctor)?Ctor.prototype:void 0)}else accumulator={};return(isArr?arrayEach:baseForOwn)(object,function(value,index,object){return iteratee(accumulator,value,index,object)}),accumulator}var arrayEach=_dereq_(99),baseCallback=_dereq_(106),baseCreate=_dereq_(108),baseForOwn=_dereq_(116),isArray=_dereq_(159),isFunction=_dereq_(161),isObject=_dereq_(163),isTypedArray=_dereq_(165);module.exports=transform},{106:106,108:108,116:116,159:159,161:161,163:163,165:165,99:99}],172:[function(_dereq_,module,exports){function identity(value){return value}module.exports=identity},{}],173:[function(_dereq_,module,exports){function property(path){return isKey(path)?baseProperty(path):basePropertyDeep(path)}var baseProperty=_dereq_(125),basePropertyDeep=_dereq_(126),isKey=_dereq_(151);module.exports=property},{125:125,126:126,151:151}],174:[function(_dereq_,module,exports){module.exports=function(el,name,val){return 2==arguments.length?el.getAttribute(name):null===val?el.removeAttribute(name):(el.setAttribute(name,val),el)}},{}],175:[function(_dereq_,module,exports){module.exports=_dereq_(70)},{70:70}],176:[function(_dereq_,module,exports){module.exports=function(el){for(var c;el.childNodes.length;)c=el.childNodes[0],el.removeChild(c);return el}},{}],177:[function(_dereq_,module,exports){module.exports=_dereq_(71)},{71:71}],178:[function(_dereq_,module,exports){module.exports=_dereq_(72)},{72:72}],179:[function(_dereq_,module,exports){module.exports=_dereq_(81)},{81:81}],180:[function(_dereq_,module,exports){module.exports=_dereq_(75)},{75:75}],181:[function(_dereq_,module,exports){module.exports=_dereq_(77)},{77:77}],182:[function(_dereq_,module,exports){module.exports=_dereq_(78)},{78:78}],183:[function(_dereq_,module,exports){module.exports=function(el){el.parentNode&&el.parentNode.removeChild(el)}},{}],184:[function(_dereq_,module,exports){"use strict";function ScrollTabs($el,options){EventEmitter.call(this),this.options=options=assign({},DEFAULT_OPTIONS,options),this.container=$el,this._createScrollButtons($el,options),this._bindEvents($el)}function create($el,options){var scrollTabs=get($el);return scrollTabs||(scrollTabs=new ScrollTabs($el,options),$el.__scrollTabs=scrollTabs),scrollTabs}function get($el){return $el.__scrollTabs}var domify=_dereq_(179),domClasses=_dereq_(175),domMatches=_dereq_(181),domDelegate=_dereq_(178),domQuery=_dereq_(182),domEvent=_dereq_(180),domAttr=_dereq_(174),filter=_dereq_(89),assign=_dereq_(166),inherits=_dereq_(84),EventEmitter=_dereq_(639),DEFAULT_OPTIONS={scrollSymbolLeft:"‹",scrollSymbolRight:"›"};inherits(ScrollTabs,EventEmitter),ScrollTabs.prototype._createButton=function(parentNode,options){var className=options.className,direction=options.direction,button=domQuery("."+className,parentNode);return button||(button=domify('<span class="scroll-tabs-button '+className+'">'+options.label+"</span>"),parentNode.insertBefore(button,parentNode.childNodes[0])),domAttr(button,"data-direction",direction),button},ScrollTabs.prototype._createScrollButtons=function(parentNode,options){this._createButton(parentNode,{className:"scroll-tabs-left",label:options.scrollSymbolLeft,direction:-1}),this._createButton(parentNode,{className:"scroll-tabs-right",label:options.scrollSymbolRight,direction:1})},ScrollTabs.prototype.getActiveTabNode=function(){return domQuery(this.options.selectors.active,this.container)},ScrollTabs.prototype.getTabsContainerNode=function(){return domQuery(this.options.selectors.tabsContainer,this.container)},ScrollTabs.prototype.getAllTabNodes=function(){return domQuery.all(this.options.selectors.tab,this.container)},ScrollTabs.prototype.getVisibleTabs=function(){var allTabs=this.getAllTabNodes(),ignore=this.options.selectors.ignore;return filter(allTabs,function(tabNode){return!domMatches(tabNode,ignore)})},ScrollTabs.prototype.getAdjacentTab=function(referenceTabNode,n){var visibleTabs=this.getVisibleTabs();return visibleTabs[visibleTabs.indexOf(referenceTabNode)+n]},ScrollTabs.prototype._bindEvents=function(node){this._bindWheelEvent(node),this._bindTabClickEvents(node),this._bindScrollButtonEvents(node)},ScrollTabs.prototype._bindTabClickEvents=function(node){var selector=this.options.selectors.tab,self=this;domDelegate.bind(node,selector,"click",function(event){self.scrollToTabNode(event.delegateTarget)})},ScrollTabs.prototype._bindWheelEvent=function(node){var self=this;domEvent.bind(node,"wheel",function(e){var direction=Math.sign(e.deltaY),oldActiveTab=self.getActiveTabNode(),newActiveTab=self.getAdjacentTab(oldActiveTab,direction);newActiveTab&&(self.scrollToTabNode(newActiveTab),self.emit("scroll",newActiveTab,oldActiveTab,direction)),e.preventDefault()})},ScrollTabs.prototype._bindScrollButtonEvents=function(node){var self=this;domDelegate.bind(node,".scroll-tabs-button","click",function(event){var target=event.delegateTarget,direction=parseInt(domAttr(target,"data-direction"),10),oldActiveTabNode=self.getActiveTabNode(),newActiveTabNode=self.getAdjacentTab(oldActiveTabNode,direction);newActiveTabNode&&(self.scrollToTabNode(newActiveTabNode),self.emit("scroll",newActiveTabNode,oldActiveTabNode,direction)),event.preventDefault()})},ScrollTabs.prototype.scrollToTabNode=function(tabNode){if(tabNode){var tabsContainerNode=tabNode.parentNode,tabWidth=tabNode.offsetWidth,tabOffsetLeft=tabNode.offsetLeft,tabOffsetRight=tabOffsetLeft+tabWidth,containerWidth=tabsContainerNode.offsetWidth;tabsContainerNode.scrollLeft>tabOffsetLeft?tabsContainerNode.scrollLeft=0:tabOffsetRight>containerWidth&&(tabsContainerNode.scrollLeft=tabOffsetRight-containerWidth)}},ScrollTabs.prototype.update=function(){var tabsContainerNode=this.getTabsContainerNode(),overflow=tabsContainerNode.scrollWidth>tabsContainerNode.offsetWidth;domClasses(this.container).toggle("scroll-tabs-overflow",overflow),overflow&&this.scrollToTabNode(this.getActiveTabNode())},module.exports=create,module.exports.get=get},{166:166,174:174,175:175,178:178,179:179,180:180,181:181,182:182,639:639,84:84,89:89}],185:[function(_dereq_,module,exports){"use strict";function calculateUpdate(currentSelection,currentValue,newValue){var currentCursor=currentSelection.start,newCursor=currentCursor,diff=newValue.length-currentValue.length,currentTail=(newValue.length,currentValue.length,currentValue.substring(currentCursor));newValue.lastIndexOf(currentTail)===newValue.length-currentTail.length&&(currentValue=currentValue.substring(0,currentValue.length-currentTail.length),newValue=newValue.substring(0,newValue.length-currentTail.length));var diff=createDiff(currentValue,newValue);return diff&&(newCursor="remove"===diff.type?diff.newStart:diff.newEnd),range(newCursor)}function createDiff(currentValue,newValue){var insert,l_str,l_char,s_str,s_char,l_idx=0,s_idx=0;for(newValue.length>currentValue.length?(l_str=newValue,s_str=currentValue):(l_str=currentValue,s_str=newValue);l_idx<l_str.length;)l_char=l_str.charAt(l_idx),s_char=s_str.charAt(s_idx),l_char!==s_char?(insert||(insert={l_start:l_idx,s_start:s_idx}),l_idx++):(insert&&!insert.complete&&(insert.l_end=l_idx,insert.s_end=s_idx,insert.complete=!0),s_idx++,l_idx++);if(insert&&!insert.complete&&(insert.complete=!0,insert.s_end=s_str.length,insert.l_end=l_str.length),insert)return newValue.length>currentValue.length?{newStart:insert.l_start,newEnd:insert.l_end,type:"add"}:{newStart:insert.s_start,newEnd:insert.s_end,type:newValue.length<currentValue.length?"remove":"replace"}}function range(start,end){return{start:start,end:void 0===end?start:end}}module.exports=calculateUpdate,module.exports.range=range},{}],186:[function(_dereq_,module,exports){module.exports={name:"Soupe Workflow BPMN Extension Model for Drools",uri:"http://www.jboss.org/drools",prefix:"drools",xml:{tagAlias:"lowerCase"},associations:[],types:[{name:"Global",superClass:["Element"],properties:[{name:"identifier",type:"String",isAttr:!0},{name:"type",type:"String",isAttr:!0}]},{name:"Import",superClass:["Element"],properties:[{name:"name",type:"String",isAttr:!0}]}]}},{}],187:[function(_dereq_,module,exports){module.exports={name:"Soupe Workflow BPMN Extension Model for jBPM",uri:"http://www.jboss.org/jbpm",prefix:"jbpm",xml:{tagAlias:"lowerCase"},associations:[],types:[{name:"Initiator",isAbstract:!0,extends:["bpmn:StartEvent"],properties:[{name:"initiator",isAttr:!0,type:"String"}]},{name:"ScriptTask",isAbstract:!0,extends:["bpmn:ScriptTask"],properties:[{name:"resultVariable",isAttr:!0,type:"String"},{name:"resource",isAttr:!0,type:"String"}]},{name:"Process",isAbstract:!0,extends:["bpmn:Process"],properties:[{name:"toDoUrl",isAttr:!0,type:"String"}]},{name:"FormalExpression",isAbstract:!0,extends:["bpmn:FormalExpression"],properties:[{name:"resource",isAttr:!0,type:"String"}]},{name:"UserTask",extends:["bpmn:UserTask"],properties:[{name:"RoleCodes",isAttr:!0,type:"String"},{name:"OrganizationLevel",isAttr:!0,type:"String"},{name:"Multi-User",isAttr:!0,type:"String"},{name:"ActorId",isAttr:!0,type:"String"},{name:"Skippable",isAttr:!0,type:"String"},{name:"Priority",isAttr:!0,type:"String"},{name:"toDoUrl",isAttr:!0,type:"String"}]},{name:"CallActivity",extends:["bpmn:CallActivity"],properties:[{name:"calledElementBinding",isAttr:!0,type:"String",default:"latest"},{name:"calledElementVersion",isAttr:!0,type:"Integer"},{name:"caseRef",isAttr:!0,type:"String"},{
name:"caseBinding",isAttr:!0,type:"String",default:"latest"},{name:"caseVersion",isAttr:!0,type:"Integer"}]},{name:"Properties",superClass:["Element"],properties:[{name:"values",type:"Property",isMany:!0}]},{name:"Property",superClass:["Element"],properties:[{name:"id",type:"String",isAttr:!0},{name:"name",type:"String",isAttr:!0},{name:"value",type:"String",isAttr:!0}]},{name:"InputOutput",superClass:["Element"],properties:[{name:"inputOutput",type:"InputOutput"},{name:"connectorId",type:"String"},{name:"inputParameters",isMany:!0,type:"InputParameter"},{name:"outputParameters",isMany:!0,type:"OutputParameter"}]},{name:"InputOutputParameter",properties:[{name:"name",isAttr:!0,type:"String"},{name:"value",isBody:!0,type:"String"},{name:"definition",type:"InputOutputParameterDefinition"}]},{name:"InputOutputParameterDefinition",isAbstract:!0},{name:"List",superClass:["InputOutputParameterDefinition"],properties:[{name:"items",isMany:!0,type:"InputOutputParameterDefinition"}]},{name:"Map",superClass:["InputOutputParameterDefinition"],properties:[{name:"entries",isMany:!0,type:"Entry"}]},{name:"Entry",properties:[{name:"key",isAttr:!0,type:"String"},{name:"value",isBody:!0,type:"String"},{name:"definition",type:"InputOutputParameterDefinition"}]},{name:"Value",superClass:["InputOutputParameterDefinition"],properties:[{name:"id",isAttr:!0,type:"String"},{name:"name",isAttr:!0,type:"String"},{name:"value",isBody:!0,type:"String"}]},{name:"Script",superClass:["InputOutputParameterDefinition"],properties:[{name:"scriptFormat",isAttr:!0,type:"String"},{name:"resource",isAttr:!0,type:"String"},{name:"value",isBody:!0,type:"String"}]},{name:"InputParameter",superClass:["InputOutputParameter"]},{name:"OutputParameter",superClass:["InputOutputParameter"]}],emumerations:[]}},{}],188:[function(_dereq_,module,exports){"use strict";function Modeler(options){Viewer.call(this,options),this.on("import.parse.complete",function(event){event.error||this._collectIds(event.definitions,event.context)},this),this.on("diagram.destroy",function(){this.moddle.ids.clear()},this)}var inherits=_dereq_(451),Ids=_dereq_(450),Viewer=_dereq_(190),NavigatedViewer=_dereq_(189);inherits(Modeler,Viewer),module.exports=Modeler,module.exports.Viewer=Viewer,module.exports.NavigatedViewer=NavigatedViewer,Modeler.prototype.createDiagram=function(done){return this.importXML('<?xml version="1.0" encoding="UTF-8"?><bpmn:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" targetNamespace="http://bpmn.io/schema/bpmn" id="Definitions_1"><bpmn:process id="Process_1" isExecutable="false"><bpmn:startEvent id="StartEvent_1"/></bpmn:process><bpmndi:BPMNDiagram id="BPMNDiagram_1"><bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_1"><bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1"><dc:Bounds height="36.0" width="36.0" x="173.0" y="102.0"/></bpmndi:BPMNShape></bpmndi:BPMNPlane></bpmndi:BPMNDiagram></bpmn:definitions>',done)},Modeler.prototype._createModdle=function(options){var moddle=Viewer.prototype._createModdle.call(this,options);return moddle.ids=new Ids([32,36,1]),moddle},Modeler.prototype._collectIds=function(definitions,context){var id,moddle=definitions.$model,ids=moddle.ids;ids.clear();for(id in context.elementsById)ids.claim(id,context.elementsById[id])},Modeler.prototype._interactionModules=[_dereq_(208),_dereq_(196),_dereq_(258),_dereq_(422),_dereq_(418),_dereq_(419),_dereq_(308)],Modeler.prototype._modelingModules=[_dereq_(370),_dereq_(314),_dereq_(386),_dereq_(402),_dereq_(343),_dereq_(335),_dereq_(202),_dereq_(204),_dereq_(200),_dereq_(261),_dereq_(240),_dereq_(198),_dereq_(246),_dereq_(251)],Modeler.prototype._modules=[].concat(Modeler.prototype._modules,Modeler.prototype._interactionModules,Modeler.prototype._modelingModules)},{189:189,190:190,196:196,198:198,200:200,202:202,204:204,208:208,240:240,246:246,251:251,258:258,261:261,308:308,314:314,335:335,343:343,370:370,386:386,402:402,418:418,419:419,422:422,450:450,451:451}],189:[function(_dereq_,module,exports){"use strict";function NavigatedViewer(options){Viewer.call(this,options)}var inherits=_dereq_(451),Viewer=_dereq_(190);inherits(NavigatedViewer,Viewer),module.exports=NavigatedViewer,NavigatedViewer.prototype._navigationModules=[_dereq_(422),_dereq_(418)],NavigatedViewer.prototype._modules=[].concat(NavigatedViewer.prototype._modules,NavigatedViewer.prototype._navigationModules)},{190:190,418:418,422:422,451:451}],190:[function(_dereq_,module,exports){"use strict";function checkValidationError(err){var pattern=/unparsable content <([^>]+)> detected([\s\S]*)$/,match=pattern.exec(err.message);return match&&(err.message="unparsable content <"+match[1]+"> detected; this may indicate an invalid BPMN 2.0 diagram file"+match[2]),err}function ensureUnit(val){return val+(isNumber(val)?"px":"")}function Viewer(options){options=assign({},DEFAULT_OPTIONS,options),this.moddle=this._createModdle(options),this.container=this._createContainer(options),addProjectLogo(this.container),this._init(this.container,this.moddle,options)}function addProjectLogo(container){var logoData=PoweredBy.BPMNIO_LOGO,linkMarkup='<a href="http://bpmn.io" target="_blank" class="bjs-powered-by" title="Powered by bpmn.io" style="position: absolute; bottom: 15px; right: 15px; z-index: 100"><img src="data:image/png;base64,'+logoData+'"></a>',linkElement=domify(linkMarkup);container.appendChild(linkElement),domEvent.bind(linkElement,"click",function(event){PoweredBy.open(),event.preventDefault()})}var assign=_dereq_(592),omit=_dereq_(596),isString=_dereq_(589),isNumber=_dereq_(586),domify=_dereq_(609),domQuery=_dereq_(612),domRemove=_dereq_(613),Diagram=_dereq_(290),BpmnModdle=_dereq_(271),inherits=_dereq_(451),Importer=_dereq_(264),DEFAULT_OPTIONS={width:"100%",height:"100%",position:"relative",container:"body"};inherits(Viewer,Diagram),module.exports=Viewer,Viewer.prototype.importXML=function(xml,done){done=done||function(){};var self=this;xml=this._emit("import.parse.start",{xml:xml})||xml,this.moddle.fromXML(xml,"bpmn:Definitions",function(err,definitions,context){if(definitions=self._emit("import.parse.complete",{error:err,definitions:definitions,context:context})||definitions,err)return err=checkValidationError(err),self._emit("import.done",{error:err}),done(err);var parseWarnings=context.warnings;self.importDefinitions(definitions,function(err,importWarnings){var allWarnings=[].concat(parseWarnings,importWarnings||[]);self._emit("import.done",{error:err,warnings:allWarnings}),done(err,allWarnings)})})},Viewer.prototype.saveXML=function(options,done){done||(done=options,options={});var definitions=this.definitions;if(!definitions)return done(new Error("no definitions loaded"));this.moddle.toXML(definitions,options,done)},Viewer.prototype.saveSVG=function(options,done){done||(done=options,options={});var canvas=this.get("canvas"),contentNode=canvas.getDefaultLayer(),defsNode=canvas._svg.select("defs"),contents=contentNode.innerSVG(),defs=defsNode&&defsNode.outerSVG()||"",bbox=contentNode.getBBox();done(null,'<?xml version="1.0" encoding="utf-8"?>\n\x3c!-- created with bpmn-js / http://bpmn.io --\x3e\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+bbox.width+'" height="'+bbox.height+'" viewBox="'+bbox.x+" "+bbox.y+" "+bbox.width+" "+bbox.height+'" version="1.1">'+defs+contents+"</svg>")},Viewer.prototype.importDefinitions=function(definitions,done){try{this.definitions&&this.clear(),this.definitions=definitions,Importer.importBpmnDiagram(this,definitions,done)}catch(e){done(e)}},Viewer.prototype.getModules=function(){return this._modules},Viewer.prototype.destroy=function(){Diagram.prototype.destroy.call(this),domRemove(this.container)},Viewer.prototype.on=function(event,priority,callback,target){return this.get("eventBus").on(event,priority,callback,target)},Viewer.prototype.off=function(event,callback){this.get("eventBus").off(event,callback)},Viewer.prototype._init=function(container,moddle,options){var baseModules=options.modules||this.getModules(),additionalModules=options.additionalModules||[],staticModules=[{bpmnjs:["value",this],moddle:["value",moddle]}],diagramModules=[].concat(staticModules,baseModules,additionalModules),diagramOptions=assign(omit(options,"additionalModules"),{canvas:assign({},options.canvas,{container:container}),modules:diagramModules});Diagram.call(this,diagramOptions)},Viewer.prototype._emit=function(type,event){return this.get("eventBus").fire(type,event)},Viewer.prototype._createContainer=function(options){var container,parent=options.container;return parent.get&&(parent=parent.get(0)),isString(parent)&&(parent=domQuery(parent)),container=domify('<div class="bjs-container"></div>'),assign(container.style,{width:ensureUnit(options.width),height:ensureUnit(options.height),position:options.position}),parent.appendChild(container),container},Viewer.prototype._createModdle=function(options){var moddleOptions=assign({},this._moddleExtensions,options.moddleExtensions);return new BpmnModdle(moddleOptions)},Viewer.prototype._modules=[_dereq_(191),_dereq_(410),_dereq_(395),_dereq_(375)],Viewer.prototype._moddleExtensions={};var PoweredBy=_dereq_(270),domEvent=_dereq_(610)},{191:191,264:264,270:270,271:271,290:290,375:375,395:395,410:410,451:451,586:586,589:589,592:592,596:596,609:609,610:610,612:612,613:613}],191:[function(_dereq_,module,exports){module.exports={__depends__:[_dereq_(194),_dereq_(266)]}},{194:194,266:266}],192:[function(_dereq_,module,exports){"use strict";function BpmnRenderer(eventBus,styles,pathMap,priority){function addMarker(id,element){markers[id]=element}function marker(id){return markers[id]}function initMarkers(svg){function createMarker(id,options){var attrs=assign({fill:"black",strokeWidth:1,strokeLinecap:"round",strokeDasharray:"none"},options.attrs),ref=options.ref||{x:0,y:0},scale=options.scale||1;return"none"===attrs.strokeDasharray&&(attrs.strokeDasharray=[1e4,1]),addMarker(id,options.element.attr(attrs).marker(0,0,20,20,ref.x,ref.y).attr({markerWidth:20*scale,markerHeight:20*scale}))}createMarker("sequenceflow-end",{element:svg.path("M 1 5 L 11 10 L 1 15 Z"),ref:{x:11,y:10},scale:.5}),createMarker("messageflow-start",{element:svg.circle(6,6,3.5),attrs:{fill:"white",stroke:"black"},ref:{x:6,y:6}}),createMarker("messageflow-end",{element:svg.path("m 1 5 l 0 -3 l 7 3 l -7 3 z"),attrs:{fill:"white",stroke:"black",strokeLinecap:"butt"},ref:{x:8.5,y:5}}),createMarker("association-start",{element:svg.path("M 11 5 L 1 10 L 11 15"),attrs:{fill:"none",stroke:"black",strokeWidth:1.5},ref:{x:1,y:10},scale:.5}),createMarker("association-end",{element:svg.path("M 1 5 L 11 10 L 1 15"),attrs:{fill:"none",stroke:"black",strokeWidth:1.5},ref:{x:12,y:10},scale:.5}),createMarker("conditional-flow-marker",{element:svg.path("M 0 10 L 8 6 L 16 10 L 8 14 Z"),attrs:{fill:"white",stroke:"black"},ref:{x:-1,y:10},scale:.5}),createMarker("conditional-default-flow-marker",{element:svg.path("M 1 4 L 5 16"),attrs:{stroke:"black"},ref:{x:-5,y:10},scale:.5})}function drawCircle(p,width,height,offset,attrs){isObject(offset)&&(attrs=offset,offset=0),offset=offset||0,attrs=computeStyle(attrs,{stroke:"black",strokeWidth:2,fill:"white"});var cx=width/2,cy=height/2;return p.circle(cx,cy,Math.round((width+height)/4-offset)).attr(attrs)}function drawRect(p,width,height,r,offset,attrs){return isObject(offset)&&(attrs=offset,offset=0),offset=offset||0,attrs=computeStyle(attrs,{stroke:"black",strokeWidth:2,fill:"white"}),p.rect(offset,offset,width-2*offset,height-2*offset,r).attr(attrs)}function drawDiamond(p,width,height,attrs){var x_2=width/2,y_2=height/2,points=[x_2,0,width,y_2,x_2,height,0,y_2];return attrs=computeStyle(attrs,{stroke:"black",strokeWidth:2,fill:"white"}),p.polygon(points).attr(attrs)}function drawLine(p,waypoints,attrs){return attrs=computeStyle(attrs,["no-fill"],{stroke:"black",strokeWidth:2,fill:"none"}),createLine(waypoints,attrs).appendTo(p)}function drawPath(p,d,attrs){return attrs=computeStyle(attrs,["no-fill"],{strokeWidth:2,stroke:"black"}),p.path(d).attr(attrs)}function drawMarker(type,p,path,attrs){return drawPath(p,path,assign({"data-marker":type},attrs))}function as(type){return function(p,element){return handlers[type](p,element)}}function renderer(type){return handlers[type]}function renderEventContent(element,p){var event=getSemantic(element),isThrowing=isThrowEvent(event);return isTypedEvent(event,"bpmn:MessageEventDefinition")?renderer("bpmn:MessageEventDefinition")(p,element,isThrowing):isTypedEvent(event,"bpmn:TimerEventDefinition")?renderer("bpmn:TimerEventDefinition")(p,element,isThrowing):isTypedEvent(event,"bpmn:ConditionalEventDefinition")?renderer("bpmn:ConditionalEventDefinition")(p,element):isTypedEvent(event,"bpmn:SignalEventDefinition")?renderer("bpmn:SignalEventDefinition")(p,element,isThrowing):isTypedEvent(event,"bpmn:CancelEventDefinition")&&isTypedEvent(event,"bpmn:TerminateEventDefinition",{parallelMultiple:!1})?renderer("bpmn:MultipleEventDefinition")(p,element,isThrowing):isTypedEvent(event,"bpmn:CancelEventDefinition")&&isTypedEvent(event,"bpmn:TerminateEventDefinition",{parallelMultiple:!0})?renderer("bpmn:ParallelMultipleEventDefinition")(p,element,isThrowing):isTypedEvent(event,"bpmn:EscalationEventDefinition")?renderer("bpmn:EscalationEventDefinition")(p,element,isThrowing):isTypedEvent(event,"bpmn:LinkEventDefinition")?renderer("bpmn:LinkEventDefinition")(p,element,isThrowing):isTypedEvent(event,"bpmn:ErrorEventDefinition")?renderer("bpmn:ErrorEventDefinition")(p,element,isThrowing):isTypedEvent(event,"bpmn:CancelEventDefinition")?renderer("bpmn:CancelEventDefinition")(p,element,isThrowing):isTypedEvent(event,"bpmn:CompensateEventDefinition")?renderer("bpmn:CompensateEventDefinition")(p,element,isThrowing):isTypedEvent(event,"bpmn:TerminateEventDefinition")?renderer("bpmn:TerminateEventDefinition")(p,element,isThrowing):null}function renderLabel(p,label,options){return textUtil.createText(p,label||"",options).addClass("djs-label")}function renderEmbeddedLabel(p,element,align){return renderLabel(p,getSemantic(element).name,{box:element,align:align,padding:5})}function renderExternalLabel(p,element,align){return renderLabel(p,getSemantic(element).name,{box:element,align:align,style:{fontSize:"11px"}})}function renderLaneLabel(p,text,element){var textBox=renderLabel(p,text,{box:{height:30,width:element.height},align:"center-middle"}),top=-1*element.height;textBox.transform("rotate(270) translate("+top+",0)")}function createPathFromConnection(connection){for(var waypoints=connection.waypoints,pathData="m  "+waypoints[0].x+","+waypoints[0].y,i=1;i<waypoints.length;i++)pathData+="L"+waypoints[i].x+","+waypoints[i].y+" ";return pathData}function attachTaskMarkers(p,element,taskMarkers){var position,obj=getSemantic(element),subprocess=includes(taskMarkers,"SubProcessMarker");position=subprocess?{seq:-21,parallel:-22,compensation:-42,loop:-18,adhoc:10}:{seq:-3,parallel:-6,compensation:-27,loop:0,adhoc:10},forEach(taskMarkers,function(marker){renderer(marker)(p,element,position)}),obj.isForCompensation&&renderer("CompensationMarker")(p,element,position),"bpmn:AdHocSubProcess"===obj.$type&&renderer("AdhocMarker")(p,element,position);var loopCharacteristics=obj.loopCharacteristics,isSequential=loopCharacteristics&&loopCharacteristics.isSequential;loopCharacteristics&&(void 0===isSequential&&renderer("LoopMarker")(p,element,position),!1===isSequential&&renderer("ParallelMarker")(p,element,position),!0===isSequential&&renderer("SequentialMarker")(p,element,position))}function renderDataItemCollection(p,element){var yPosition=(element.height-16)/element.height;drawPath(p,pathMap.getScaledPath("DATA_OBJECT_COLLECTION_PATH",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:.451,my:yPosition}}),{strokeWidth:2})}BaseRenderer.call(this,eventBus,priority);var textUtil=new TextUtil({style:LABEL_STYLE,size:{width:100}}),markers={},computeStyle=styles.computeStyle,handlers=this.handlers={"bpmn:Event":function(p,element,attrs){return drawCircle(p,element.width,element.height,attrs)},"bpmn:StartEvent":function(p,element){var attrs={};getSemantic(element).isInterrupting||(attrs={strokeDasharray:"6",strokeLinecap:"round"});var circle=renderer("bpmn:Event")(p,element,attrs);return renderEventContent(element,p),circle},"bpmn:MessageEventDefinition":function(p,element,isThrowing){return drawPath(p,pathMap.getScaledPath("EVENT_MESSAGE",{xScaleFactor:.9,yScaleFactor:.9,containerWidth:element.width,containerHeight:element.height,position:{mx:.235,my:.315}}),{strokeWidth:1,fill:isThrowing?"black":"white",stroke:isThrowing?"white":"black"})},"bpmn:TimerEventDefinition":function(p,element){var circle=drawCircle(p,element.width,element.height,.2*element.height,{strokeWidth:2});drawPath(p,pathMap.getScaledPath("EVENT_TIMER_WH",{xScaleFactor:.75,yScaleFactor:.75,containerWidth:element.width,containerHeight:element.height,position:{mx:.5,my:.5}}),{strokeWidth:2,strokeLinecap:"square"});for(var i=0;i<12;i++){var linePathData=pathMap.getScaledPath("EVENT_TIMER_LINE",{xScaleFactor:.75,yScaleFactor:.75,containerWidth:element.width,containerHeight:element.height,position:{mx:.5,my:.5}}),width=element.width/2;drawPath(p,linePathData,{strokeWidth:1,strokeLinecap:"square",transform:"rotate("+30*i+","+element.height/2+","+width+")"})}return circle},"bpmn:EscalationEventDefinition":function(p,event,isThrowing){return drawPath(p,pathMap.getScaledPath("EVENT_ESCALATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:event.width,containerHeight:event.height,position:{mx:.5,my:.555}}),{strokeWidth:1,fill:isThrowing?"black":"none"})},"bpmn:ConditionalEventDefinition":function(p,event){return drawPath(p,pathMap.getScaledPath("EVENT_CONDITIONAL",{xScaleFactor:1,yScaleFactor:1,containerWidth:event.width,containerHeight:event.height,position:{mx:.5,my:.222}}),{strokeWidth:1})},"bpmn:LinkEventDefinition":function(p,event,isThrowing){return drawPath(p,pathMap.getScaledPath("EVENT_LINK",{xScaleFactor:1,yScaleFactor:1,containerWidth:event.width,containerHeight:event.height,position:{mx:.57,my:.263}}),{strokeWidth:1,fill:isThrowing?"black":"none"})},"bpmn:ErrorEventDefinition":function(p,event,isThrowing){return drawPath(p,pathMap.getScaledPath("EVENT_ERROR",{xScaleFactor:1.1,yScaleFactor:1.1,containerWidth:event.width,containerHeight:event.height,position:{mx:.2,my:.722}}),{strokeWidth:1,fill:isThrowing?"black":"none"})},"bpmn:CancelEventDefinition":function(p,event,isThrowing){return drawPath(p,pathMap.getScaledPath("EVENT_CANCEL_45",{xScaleFactor:1,yScaleFactor:1,containerWidth:event.width,containerHeight:event.height,position:{mx:.638,my:-.055}}),{strokeWidth:1,fill:isThrowing?"black":"none"}).transform("rotate(45)")},"bpmn:CompensateEventDefinition":function(p,event,isThrowing){return drawPath(p,pathMap.getScaledPath("EVENT_COMPENSATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:event.width,containerHeight:event.height,position:{mx:.22,my:.5}}),{strokeWidth:1,fill:isThrowing?"black":"none"})},"bpmn:SignalEventDefinition":function(p,event,isThrowing){return drawPath(p,pathMap.getScaledPath("EVENT_SIGNAL",{xScaleFactor:.9,yScaleFactor:.9,containerWidth:event.width,containerHeight:event.height,position:{mx:.5,my:.2}}),{strokeWidth:1,fill:isThrowing?"black":"none"})},"bpmn:MultipleEventDefinition":function(p,event,isThrowing){return drawPath(p,pathMap.getScaledPath("EVENT_MULTIPLE",{xScaleFactor:1.1,yScaleFactor:1.1,containerWidth:event.width,containerHeight:event.height,position:{mx:.222,my:.36}}),{strokeWidth:1,fill:isThrowing?"black":"none"})},"bpmn:ParallelMultipleEventDefinition":function(p,event){return drawPath(p,pathMap.getScaledPath("EVENT_PARALLEL_MULTIPLE",{xScaleFactor:1.2,yScaleFactor:1.2,containerWidth:event.width,containerHeight:event.height,position:{mx:.458,my:.194}}),{strokeWidth:1})},"bpmn:EndEvent":function(p,element){var circle=renderer("bpmn:Event")(p,element,{strokeWidth:4});return renderEventContent(element,p),circle},"bpmn:TerminateEventDefinition":function(p,element){return drawCircle(p,element.width,element.height,8,{strokeWidth:4,fill:"black"})},"bpmn:IntermediateEvent":function(p,element){var outer=renderer("bpmn:Event")(p,element,{strokeWidth:1});return drawCircle(p,element.width,element.height,INNER_OUTER_DIST,{strokeWidth:1,fill:"none"}),renderEventContent(element,p),outer},"bpmn:IntermediateCatchEvent":as("bpmn:IntermediateEvent"),"bpmn:IntermediateThrowEvent":as("bpmn:IntermediateEvent"),"bpmn:Activity":function(p,element,attrs){return drawRect(p,element.width,element.height,TASK_BORDER_RADIUS,attrs)},"bpmn:Task":function(p,element,attrs){var rect=renderer("bpmn:Activity")(p,element,attrs);return renderEmbeddedLabel(p,element,"center-middle"),attachTaskMarkers(p,element),rect},"bpmn:ServiceTask":function(p,element){var task=renderer("bpmn:Task")(p,element);return drawPath(p,pathMap.getScaledPath("TASK_TYPE_SERVICE",{abspos:{x:12,y:18}}),{strokeWidth:1,fill:"none"}),drawPath(p,pathMap.getScaledPath("TASK_TYPE_SERVICE_FILL",{abspos:{x:17.2,y:18}}),{strokeWidth:0,stroke:"none",fill:"white"}),drawPath(p,pathMap.getScaledPath("TASK_TYPE_SERVICE",{abspos:{x:17,y:22}}),{strokeWidth:1,fill:"white"}),task},"bpmn:UserTask":function(p,element){var task=renderer("bpmn:Task")(p,element);return drawPath(p,pathMap.getScaledPath("TASK_TYPE_USER_1",{abspos:{x:15,y:12}}),{strokeWidth:.5,fill:"none"}),drawPath(p,pathMap.getScaledPath("TASK_TYPE_USER_2",{abspos:{x:15,y:12}}),{strokeWidth:.5,fill:"none"}),drawPath(p,pathMap.getScaledPath("TASK_TYPE_USER_3",{abspos:{x:15,y:12}}),{strokeWidth:.5,fill:"black"}),task},"bpmn:ManualTask":function(p,element){var task=renderer("bpmn:Task")(p,element);return drawPath(p,pathMap.getScaledPath("TASK_TYPE_MANUAL",{abspos:{x:17,y:15}}),{strokeWidth:.25,fill:"white",stroke:"black"}),task},"bpmn:SendTask":function(p,element){var task=renderer("bpmn:Task")(p,element);return drawPath(p,pathMap.getScaledPath("TASK_TYPE_SEND",{xScaleFactor:1,yScaleFactor:1,containerWidth:21,containerHeight:14,position:{mx:.285,my:.357}}),{strokeWidth:1,fill:"black",stroke:"white"}),task},"bpmn:ReceiveTask":function(p,element){var pathData,semantic=getSemantic(element),task=renderer("bpmn:Task")(p,element);return semantic.instantiate?(drawCircle(p,28,28,4.4,{strokeWidth:1}),pathData=pathMap.getScaledPath("TASK_TYPE_INSTANTIATING_SEND",{abspos:{x:7.77,y:9.52}})):pathData=pathMap.getScaledPath("TASK_TYPE_SEND",{xScaleFactor:.9,yScaleFactor:.9,containerWidth:21,containerHeight:14,position:{mx:.3,my:.4}}),drawPath(p,pathData,{strokeWidth:1}),task},"bpmn:ScriptTask":function(p,element){var task=renderer("bpmn:Task")(p,element);return drawPath(p,pathMap.getScaledPath("TASK_TYPE_SCRIPT",{abspos:{x:15,y:20}}),{strokeWidth:1}),task},"bpmn:BusinessRuleTask":function(p,element){var task=renderer("bpmn:Task")(p,element);return drawPath(p,pathMap.getScaledPath("TASK_TYPE_BUSINESS_RULE_HEADER",{abspos:{x:8,y:8}})).attr({strokeWidth:1,fill:"AAA"}),drawPath(p,pathMap.getScaledPath("TASK_TYPE_BUSINESS_RULE_MAIN",{abspos:{x:8,y:8}})).attr({strokeWidth:1}),task},"bpmn:SubProcess":function(p,element,attrs){attrs=assign({fillOpacity:.95},attrs);var rect=renderer("bpmn:Activity")(p,element,attrs),expanded=DiUtil.isExpanded(element);return DiUtil.isEventSubProcess(element)&&rect.attr({strokeDasharray:"1,2"}),renderEmbeddedLabel(p,element,expanded?"center-top":"center-middle"),expanded?attachTaskMarkers(p,element):attachTaskMarkers(p,element,["SubProcessMarker"]),rect},"bpmn:AdHocSubProcess":function(p,element){return renderer("bpmn:SubProcess")(p,element)},"bpmn:Transaction":function(p,element){var outer=renderer("bpmn:SubProcess")(p,element),innerAttrs=styles.style(["no-fill","no-events"]);return drawRect(p,element.width,element.height,TASK_BORDER_RADIUS-2,INNER_OUTER_DIST,innerAttrs),outer},"bpmn:CallActivity":function(p,element){return renderer("bpmn:SubProcess")(p,element,{strokeWidth:5})},"bpmn:Participant":function(p,element){var lane=renderer("bpmn:Lane")(p,element,{fillOpacity:.95,fill:"White"});DiUtil.isExpanded(element)?(drawLine(p,[{x:30,y:0},{x:30,y:element.height}]),renderLaneLabel(p,getSemantic(element).name,element)):renderLabel(p,getSemantic(element).name,{box:element,align:"center-middle"});return!!getSemantic(element).participantMultiplicity&&renderer("ParticipantMultiplicityMarker")(p,element),lane},"bpmn:Lane":function(p,element,attrs){var rect=drawRect(p,element.width,element.height,0,attrs||{fill:"none"}),semantic=getSemantic(element);if("bpmn:Lane"===semantic.$type){renderLaneLabel(p,semantic.name,element)}return rect},"bpmn:InclusiveGateway":function(p,element){var diamond=drawDiamond(p,element.width,element.height);return drawCircle(p,element.width,element.height,.24*element.height,{strokeWidth:2.5,fill:"none"}),diamond},"bpmn:ExclusiveGateway":function(p,element){var diamond=drawDiamond(p,element.width,element.height),pathData=pathMap.getScaledPath("GATEWAY_EXCLUSIVE",{xScaleFactor:.4,yScaleFactor:.4,containerWidth:element.width,containerHeight:element.height,position:{mx:.32,my:.3}});return getDi(element).isMarkerVisible&&drawPath(p,pathData,{strokeWidth:1,fill:"black"}),diamond},"bpmn:ComplexGateway":function(p,element){var diamond=drawDiamond(p,element.width,element.height);return drawPath(p,pathMap.getScaledPath("GATEWAY_COMPLEX",{xScaleFactor:.5,yScaleFactor:.5,containerWidth:element.width,containerHeight:element.height,position:{mx:.46,my:.26}}),{strokeWidth:1,fill:"black"}),diamond},"bpmn:ParallelGateway":function(p,element){var diamond=drawDiamond(p,element.width,element.height);return drawPath(p,pathMap.getScaledPath("GATEWAY_PARALLEL",{xScaleFactor:.6,yScaleFactor:.6,containerWidth:element.width,containerHeight:element.height,position:{mx:.46,my:.2}}),{strokeWidth:1,fill:"black"}),diamond},"bpmn:EventBasedGateway":function(p,element){var semantic=getSemantic(element),diamond=drawDiamond(p,element.width,element.height);drawCircle(p,element.width,element.height,.2*element.height,{strokeWidth:1,fill:"none"});var type=semantic.eventGatewayType,instantiate=!!semantic.instantiate;if("Parallel"===type){var pathData=pathMap.getScaledPath("GATEWAY_PARALLEL",{xScaleFactor:.4,yScaleFactor:.4,containerWidth:element.width,containerHeight:element.height,position:{mx:.474,my:.296}});drawPath(p,pathData).attr({strokeWidth:1,fill:"none"})}else if("Exclusive"===type){if(!instantiate){var innerCircle=drawCircle(p,element.width,element.height,.26*element.height);innerCircle.attr({strokeWidth:1,fill:"none"})}!function(){var pathData=pathMap.getScaledPath("GATEWAY_EVENT_BASED",{xScaleFactor:.18,yScaleFactor:.18,containerWidth:element.width,containerHeight:element.height,position:{mx:.36,my:.44}});drawPath(p,pathData,{strokeWidth:2,fill:"none"})}()}return diamond},"bpmn:Gateway":function(p,element){return drawDiamond(p,element.width,element.height)},"bpmn:SequenceFlow":function(p,element){var pathData=createPathFromConnection(element),path=drawPath(p,pathData,{strokeLinejoin:"round",markerEnd:marker("sequenceflow-end")}),sequenceFlow=getSemantic(element),source=element.source.businessObject;return sequenceFlow.conditionExpression&&source.$instanceOf("bpmn:Activity")&&path.attr({markerStart:marker("conditional-flow-marker")}),source.default&&(source.$instanceOf("bpmn:Gateway")||source.$instanceOf("bpmn:Activity"))&&source.default===sequenceFlow&&path.attr({markerStart:marker("conditional-default-flow-marker")}),path},"bpmn:Association":function(p,element,attrs){var semantic=getSemantic(element);return attrs=assign({strokeDasharray:"0.5, 5",strokeLinecap:"round",strokeLinejoin:"round"},attrs||{}),"One"!==semantic.associationDirection&&"Both"!==semantic.associationDirection||(attrs.markerEnd=marker("association-end")),"Both"===semantic.associationDirection&&(attrs.markerStart=marker("association-start")),drawLine(p,element.waypoints,attrs)},"bpmn:DataInputAssociation":function(p,element){return renderer("bpmn:Association")(p,element,{markerEnd:marker("association-end")})},"bpmn:DataOutputAssociation":function(p,element){return renderer("bpmn:Association")(p,element,{markerEnd:marker("association-end")})},"bpmn:MessageFlow":function(p,element){var semantic=getSemantic(element),di=getDi(element),pathData=createPathFromConnection(element),path=drawPath(p,pathData,{markerEnd:marker("messageflow-end"),markerStart:marker("messageflow-start"),strokeDasharray:"10, 12",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5px"});if(semantic.messageRef){var midPoint=path.getPointAtLength(path.getTotalLength()/2),markerPathData=pathMap.getScaledPath("MESSAGE_FLOW_MARKER",{abspos:{x:midPoint.x,y:midPoint.y}}),messageAttrs={strokeWidth:1};"initiating"===di.messageVisibleKind?(messageAttrs.fill="white",messageAttrs.stroke="black"):(messageAttrs.fill="#888",messageAttrs.stroke="white"),drawPath(p,markerPathData,messageAttrs)}return path},"bpmn:DataObject":function(p,element){var pathData=pathMap.getScaledPath("DATA_OBJECT_PATH",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:.474,my:.296}}),elementObject=drawPath(p,pathData,{fill:"white"});return isCollection(getSemantic(element))&&renderDataItemCollection(p,element),elementObject},"bpmn:DataObjectReference":as("bpmn:DataObject"),"bpmn:DataInput":function(p,element){var arrowPathData=pathMap.getRawPath("DATA_ARROW"),elementObject=renderer("bpmn:DataObject")(p,element);return drawPath(p,arrowPathData,{strokeWidth:1}),elementObject},"bpmn:DataOutput":function(p,element){var arrowPathData=pathMap.getRawPath("DATA_ARROW"),elementObject=renderer("bpmn:DataObject")(p,element);return drawPath(p,arrowPathData,{strokeWidth:1,fill:"black"}),elementObject},"bpmn:DataStoreReference":function(p,element){return drawPath(p,pathMap.getScaledPath("DATA_STORE",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:0,my:.133}}),{strokeWidth:2,fill:"white"})},"bpmn:BoundaryEvent":function(p,element){var semantic=getSemantic(element),cancel=semantic.cancelActivity,attrs={strokeWidth:1};cancel||(attrs.strokeDasharray="6",attrs.strokeLinecap="round");var outer=renderer("bpmn:Event")(p,element,attrs);return drawCircle(p,element.width,element.height,INNER_OUTER_DIST,assign(attrs,{fill:"none"})),renderEventContent(element,p),outer},"bpmn:Group":function(p,element){return drawRect(p,element.width,element.height,TASK_BORDER_RADIUS,{strokeWidth:1,strokeDasharray:"8,3,1,3",fill:"none",pointerEvents:"none"})},label:function(p,element){return renderExternalLabel(p,element,"")},"bpmn:TextAnnotation":function(p,element){var style={fill:"none",stroke:"none"},textElement=drawRect(p,element.width,element.height,0,0,style);return drawPath(p,pathMap.getScaledPath("TEXT_ANNOTATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:0,my:0}})),renderLabel(p,getSemantic(element).text||"",{box:element,align:"left-middle",padding:5}),textElement},ParticipantMultiplicityMarker:function(p,element){drawMarker("participant-multiplicity",p,pathMap.getScaledPath("MARKER_PARALLEL",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:element.width/2/element.width,my:(element.height-15)/element.height}}))},SubProcessMarker:function(p,element){drawRect(p,14,14,0,{strokeWidth:1}).transform("translate("+(element.width/2-7.5)+","+(element.height-20)+")"),drawMarker("sub-process",p,pathMap.getScaledPath("MARKER_SUB_PROCESS",{xScaleFactor:1.5,yScaleFactor:1.5,containerWidth:element.width,containerHeight:element.height,position:{mx:(element.width/2-7.5)/element.width,
my:(element.height-20)/element.height}}))},ParallelMarker:function(p,element,position){drawMarker("parallel",p,pathMap.getScaledPath("MARKER_PARALLEL",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:(element.width/2+position.parallel)/element.width,my:(element.height-20)/element.height}}))},SequentialMarker:function(p,element,position){drawMarker("sequential",p,pathMap.getScaledPath("MARKER_SEQUENTIAL",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:(element.width/2+position.seq)/element.width,my:(element.height-19)/element.height}}))},CompensationMarker:function(p,element,position){drawMarker("compensation",p,pathMap.getScaledPath("MARKER_COMPENSATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:(element.width/2+position.compensation)/element.width,my:(element.height-13)/element.height}}),{strokeWidth:1})},LoopMarker:function(p,element,position){drawMarker("loop",p,pathMap.getScaledPath("MARKER_LOOP",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:(element.width/2+position.loop)/element.width,my:(element.height-7)/element.height}}),{strokeWidth:1,fill:"none",strokeLinecap:"round",strokeMiterlimit:.5})},AdhocMarker:function(p,element,position){drawMarker("adhoc",p,pathMap.getScaledPath("MARKER_ADHOC",{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:(element.width/2+position.adhoc)/element.width,my:(element.height-15)/element.height}}),{strokeWidth:1,fill:"black"})}};eventBus.on("canvas.init",function(event){initMarkers(event.svg)})}function isTypedEvent(event,eventDefinitionType,filter){function matches(definition,filter){return every(filter,function(val,key){return definition[key]==val})}return some(event.eventDefinitions,function(definition){return definition.$type===eventDefinitionType&&matches(event,filter)})}function isThrowEvent(event){return"bpmn:IntermediateThrowEvent"===event.$type||"bpmn:EndEvent"===event.$type}function isCollection(element){return element.isCollection||element.elementObjectRef&&element.elementObjectRef.isCollection}function getDi(element){return element.businessObject.di}function getSemantic(element){return element.businessObject}function getCirclePath(shape){var cx=shape.x+shape.width/2,cy=shape.y+shape.height/2,radius=shape.width/2;return componentsToPath([["M",cx,cy],["m",0,-radius],["a",radius,radius,0,1,1,0,2*radius],["a",radius,radius,0,1,1,0,-2*radius],["z"]])}function getRoundRectPath(shape,borderRadius){var x=shape.x,y=shape.y,width=shape.width,height=shape.height;return componentsToPath([["M",x+borderRadius,y],["l",width-2*borderRadius,0],["a",borderRadius,borderRadius,0,0,1,borderRadius,borderRadius],["l",0,height-2*borderRadius],["a",borderRadius,borderRadius,0,0,1,-borderRadius,borderRadius],["l",2*borderRadius-width,0],["a",borderRadius,borderRadius,0,0,1,-borderRadius,-borderRadius],["l",0,2*borderRadius-height],["a",borderRadius,borderRadius,0,0,1,borderRadius,-borderRadius],["z"]])}function getDiamondPath(shape){var width=shape.width,height=shape.height,x=shape.x,y=shape.y,halfWidth=width/2,halfHeight=height/2;return componentsToPath([["M",x+halfWidth,y],["l",halfWidth,halfHeight],["l",-halfWidth,halfHeight],["l",-halfWidth,-halfHeight],["z"]])}function getRectPath(shape){var x=shape.x,y=shape.y,width=shape.width,height=shape.height;return componentsToPath([["M",x,y],["l",width,0],["l",0,height],["l",-width,0],["z"]])}var inherits=_dereq_(451),isObject=_dereq_(587),assign=_dereq_(592),forEach=_dereq_(464),every=_dereq_(461),includes=_dereq_(466),some=_dereq_(470),BaseRenderer=_dereq_(301),TextUtil=_dereq_(440),DiUtil=_dereq_(267),is=_dereq_(269).is,RenderUtil=_dereq_(439),componentsToPath=RenderUtil.componentsToPath,createLine=RenderUtil.createLine,TASK_BORDER_RADIUS=10,INNER_OUTER_DIST=3,LABEL_STYLE={fontFamily:"Arial, sans-serif",fontSize:"12px"};inherits(BpmnRenderer,BaseRenderer),BpmnRenderer.$inject=["eventBus","styles","pathMap"],module.exports=BpmnRenderer,BpmnRenderer.prototype.canRender=function(element){return is(element,"bpmn:BaseElement")},BpmnRenderer.prototype.drawShape=function(visuals,element){var type=element.type;return(0,this.handlers[type])(visuals,element)},BpmnRenderer.prototype.drawConnection=function(visuals,element){var type=element.type;return(0,this.handlers[type])(visuals,element)},BpmnRenderer.prototype.getShapePath=function(element){return is(element,"bpmn:Event")?getCirclePath(element):is(element,"bpmn:Activity")?getRoundRectPath(element,TASK_BORDER_RADIUS):is(element,"bpmn:Gateway")?getDiamondPath(element):getRectPath(element)}},{267:267,269:269,301:301,439:439,440:440,451:451,461:461,464:464,466:466,470:470,587:587,592:592}],193:[function(_dereq_,module,exports){"use strict";function PathMap(){this.pathMap={EVENT_MESSAGE:{d:"m {mx},{my} l 0,{e.y1} l {e.x1},0 l 0,-{e.y1} z l {e.x0},{e.y0} l {e.x0},-{e.y0}",height:36,width:36,heightElements:[6,14],widthElements:[10.5,21]},EVENT_SIGNAL:{d:"M {mx},{my} l {e.x0},{e.y0} l -{e.x1},0 Z",height:36,width:36,heightElements:[18],widthElements:[10,20]},EVENT_ESCALATION:{d:"m {mx},{my} c -{e.x1},{e.y0} -{e.x3},{e.y1} -{e.x5},{e.y4} {e.x1},-{e.y3} {e.x3},-{e.y5} {e.x5},-{e.y6} {e.x0},{e.y3} {e.x2},{e.y5} {e.x4},{e.y6} -{e.x0},-{e.y0} -{e.x2},-{e.y1} -{e.x4},-{e.y4} z",height:36,width:36,heightElements:[2.382,4.764,4.926,6.589333,7.146,13.178667,19.768],widthElements:[2.463,2.808,4.926,5.616,7.389,8.424]},EVENT_CONDITIONAL:{d:"M {e.x0},{e.y0} l {e.x1},0 l 0,{e.y2} l -{e.x1},0 Z M {e.x2},{e.y3} l {e.x0},0 M {e.x2},{e.y4} l {e.x0},0 M {e.x2},{e.y5} l {e.x0},0 M {e.x2},{e.y6} l {e.x0},0 M {e.x2},{e.y7} l {e.x0},0 M {e.x2},{e.y8} l {e.x0},0 ",height:36,width:36,heightElements:[8.5,14.5,18,11.5,14.5,17.5,20.5,23.5,26.5],widthElements:[10.5,14.5,12.5]},EVENT_LINK:{d:"m {mx},{my} 0,{e.y0} -{e.x1},0 0,{e.y1} {e.x1},0 0,{e.y0} {e.x0},-{e.y2} -{e.x0},-{e.y2} z",height:36,width:36,heightElements:[4.4375,6.75,7.8125],widthElements:[9.84375,13.5]},EVENT_ERROR:{d:"m {mx},{my} {e.x0},-{e.y0} {e.x1},-{e.y1} {e.x2},{e.y2} {e.x3},-{e.y3} -{e.x4},{e.y4} -{e.x5},-{e.y5} z",height:36,width:36,heightElements:[.023,8.737,8.151,16.564,10.591,8.714],widthElements:[.085,6.672,6.97,4.273,5.337,6.636]},EVENT_CANCEL_45:{d:"m {mx},{my} -{e.x1},0 0,{e.x0} {e.x1},0 0,{e.y1} {e.x0},0 0,-{e.y1} {e.x1},0 0,-{e.y0} -{e.x1},0 0,-{e.y1} -{e.x0},0 z",height:36,width:36,heightElements:[4.75,8.5],widthElements:[4.75,8.5]},EVENT_COMPENSATION:{d:"m {mx},{my} {e.x0},-{e.y0} 0,{e.y1} z m {e.x1},-{e.y2} {e.x2},-{e.y3} 0,{e.y1} -{e.x2},-{e.y3} z",height:36,width:36,heightElements:[6.5,13,.4,6.1],widthElements:[9,9.3,8.7]},EVENT_TIMER_WH:{d:"M {mx},{my} l {e.x0},-{e.y0} m -{e.x0},{e.y0} l {e.x1},{e.y1} ",height:36,width:36,heightElements:[10,2],widthElements:[3,7]},EVENT_TIMER_LINE:{d:"M {mx},{my} m {e.x0},{e.y0} l -{e.x1},{e.y1} ",height:36,width:36,heightElements:[10,3],widthElements:[0,0]},EVENT_MULTIPLE:{d:"m {mx},{my} {e.x1},-{e.y0} {e.x1},{e.y0} -{e.x0},{e.y1} -{e.x2},0 z",height:36,width:36,heightElements:[6.28099,12.56199],widthElements:[3.1405,9.42149,12.56198]},EVENT_PARALLEL_MULTIPLE:{d:"m {mx},{my} {e.x0},0 0,{e.y1} {e.x1},0 0,{e.y0} -{e.x1},0 0,{e.y1} -{e.x0},0 0,-{e.y1} -{e.x1},0 0,-{e.y0} {e.x1},0 z",height:36,width:36,heightElements:[2.56228,7.68683],widthElements:[2.56228,7.68683]},GATEWAY_EXCLUSIVE:{d:"m {mx},{my} {e.x0},{e.y0} {e.x1},{e.y0} {e.x2},0 {e.x4},{e.y2} {e.x4},{e.y1} {e.x2},0 {e.x1},{e.y3} {e.x0},{e.y3} {e.x3},0 {e.x5},{e.y1} {e.x5},{e.y2} {e.x3},0 z",height:17.5,width:17.5,heightElements:[8.5,6.5312,-6.5312,-8.5],widthElements:[6.5,-6.5,3,-3,5,-5]},GATEWAY_PARALLEL:{d:"m {mx},{my} 0,{e.y1} -{e.x1},0 0,{e.y0} {e.x1},0 0,{e.y1} {e.x0},0 0,-{e.y1} {e.x1},0 0,-{e.y0} -{e.x1},0 0,-{e.y1} -{e.x0},0 z",height:30,width:30,heightElements:[5,12.5],widthElements:[5,12.5]},GATEWAY_EVENT_BASED:{d:"m {mx},{my} {e.x0},{e.y0} {e.x0},{e.y1} {e.x1},{e.y2} {e.x2},0 z",height:11,width:11,heightElements:[-6,6,12,-12],widthElements:[9,-3,-12]},GATEWAY_COMPLEX:{d:"m {mx},{my} 0,{e.y0} -{e.x0},-{e.y1} -{e.x1},{e.y2} {e.x0},{e.y1} -{e.x2},0 0,{e.y3} {e.x2},0  -{e.x0},{e.y1} l {e.x1},{e.y2} {e.x0},-{e.y1} 0,{e.y0} {e.x3},0 0,-{e.y0} {e.x0},{e.y1} {e.x1},-{e.y2} -{e.x0},-{e.y1} {e.x2},0 0,-{e.y3} -{e.x2},0 {e.x0},-{e.y1} -{e.x1},-{e.y2} -{e.x0},{e.y1} 0,-{e.y0} -{e.x3},0 z",height:17.125,width:17.125,heightElements:[4.875,3.4375,2.125,3],widthElements:[3.4375,2.125,4.875,3]},DATA_OBJECT_PATH:{d:"m 0,0 {e.x1},0 {e.x0},{e.y0} 0,{e.y1} -{e.x2},0 0,-{e.y2} {e.x1},0 0,{e.y0} {e.x0},0",height:61,width:51,heightElements:[10,50,60],widthElements:[10,40,50,60]},DATA_OBJECT_COLLECTION_PATH:{d:"m {mx}, {my} m  0 15  l 0 -15 m  4 15  l 0 -15 m  4 15  l 0 -15 ",height:61,width:51,heightElements:[12],widthElements:[1,6,12,15]},DATA_ARROW:{d:"m 5,9 9,0 0,-3 5,5 -5,5 0,-3 -9,0 z",height:61,width:51,heightElements:[],widthElements:[]},DATA_STORE:{d:"m  {mx},{my} l  0,{e.y2} c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0 l  0,-{e.y2} c -{e.x0},-{e.y1} -{e.x1},-{e.y1} -{e.x2},0c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0 m  -{e.x2},{e.y0}c  {e.x0},{e.y1} {e.x1},{e.y1} {e.x2},0m  -{e.x2},{e.y0}c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0",height:61,width:61,heightElements:[7,10,45],widthElements:[2,58,60]},TEXT_ANNOTATION:{d:"m {mx}, {my} m 10,0 l -10,0 l 0,{e.y0} l 10,0",height:30,width:10,heightElements:[30],widthElements:[10]},MARKER_SUB_PROCESS:{d:"m{mx},{my} m 7,2 l 0,10 m -5,-5 l 10,0",height:10,width:10,heightElements:[],widthElements:[]},MARKER_PARALLEL:{d:"m{mx},{my} m 3,2 l 0,10 m 3,-10 l 0,10 m 3,-10 l 0,10",height:10,width:10,heightElements:[],widthElements:[]},MARKER_SEQUENTIAL:{d:"m{mx},{my} m 0,3 l 10,0 m -10,3 l 10,0 m -10,3 l 10,0",height:10,width:10,heightElements:[],widthElements:[]},MARKER_COMPENSATION:{d:"m {mx},{my} 7,-5 0,10 z m 7.1,-0.3 6.9,-4.7 0,10 -6.9,-4.7 z",height:10,width:21,heightElements:[],widthElements:[]},MARKER_LOOP:{d:"m {mx},{my} c 3.526979,0 6.386161,-2.829858 6.386161,-6.320661 0,-3.490806 -2.859182,-6.320661 -6.386161,-6.320661 -3.526978,0 -6.38616,2.829855 -6.38616,6.320661 0,1.745402 0.714797,3.325567 1.870463,4.469381 0.577834,0.571908 1.265885,1.034728 2.029916,1.35457 l -0.718163,-3.909793 m 0.718163,3.909793 -3.885211,0.802902",height:13.9,width:13.7,heightElements:[],widthElements:[]},MARKER_ADHOC:{d:"m {mx},{my} m 0.84461,2.64411 c 1.05533,-1.23780996 2.64337,-2.07882 4.29653,-1.97997996 2.05163,0.0805 3.85579,1.15803 5.76082,1.79107 1.06385,0.34139996 2.24454,0.1438 3.18759,-0.43767 0.61743,-0.33642 1.2775,-0.64078 1.7542,-1.17511 0,0.56023 0,1.12046 0,1.6807 -0.98706,0.96237996 -2.29792,1.62393996 -3.6918,1.66181996 -1.24459,0.0927 -2.46671,-0.2491 -3.59505,-0.74812 -1.35789,-0.55965 -2.75133,-1.33436996 -4.27027,-1.18121996 -1.37741,0.14601 -2.41842,1.13685996 -3.44288,1.96782996 z",height:4,width:15,heightElements:[],widthElements:[]},TASK_TYPE_SEND:{d:"m {mx},{my} l 0,{e.y1} l {e.x1},0 l 0,-{e.y1} z l {e.x0},{e.y0} l {e.x0},-{e.y0}",height:14,width:21,heightElements:[6,14],widthElements:[10.5,21]},TASK_TYPE_SCRIPT:{d:"m {mx},{my} c 9.966553,-6.27276 -8.000926,-7.91932 2.968968,-14.938 l -8.802728,0 c -10.969894,7.01868 6.997585,8.66524 -2.968967,14.938 z m -7,-12 l 5,0 m -4.5,3 l 4.5,0 m -3,3 l 5,0m -4,3 l 5,0",height:15,width:12.6,heightElements:[6,14],widthElements:[10.5,21]},TASK_TYPE_USER_1:{d:"m {mx},{my} c 0.909,-0.845 1.594,-2.049 1.594,-3.385 0,-2.554 -1.805,-4.62199999 -4.357,-4.62199999 -2.55199998,0 -4.28799998,2.06799999 -4.28799998,4.62199999 0,1.348 0.974,2.562 1.89599998,3.405 -0.52899998,0.187 -5.669,2.097 -5.794,4.7560005 v 6.718 h 17 v -6.718 c 0,-2.2980005 -5.5279996,-4.5950005 -6.0509996,-4.7760005 zm -8,6 l 0,5.5 m 11,0 l 0,-5"},TASK_TYPE_USER_2:{d:"m {mx},{my} m 2.162,1.009 c 0,2.4470005 -2.158,4.4310005 -4.821,4.4310005 -2.66499998,0 -4.822,-1.981 -4.822,-4.4310005 "},TASK_TYPE_USER_3:{d:"m {mx},{my} m -6.9,-3.80 c 0,0 2.25099998,-2.358 4.27399998,-1.177 2.024,1.181 4.221,1.537 4.124,0.965 -0.098,-0.57 -0.117,-3.79099999 -4.191,-4.13599999 -3.57499998,0.001 -4.20799998,3.36699999 -4.20699998,4.34799999 z"},TASK_TYPE_MANUAL:{d:"m {mx},{my} c 0.234,-0.01 5.604,0.008 8.029,0.004 0.808,0 1.271,-0.172 1.417,-0.752 0.227,-0.898 -0.334,-1.314 -1.338,-1.316 -2.467,-0.01 -7.886,-0.004 -8.108,-0.004 -0.014,-0.079 0.016,-0.533 0,-0.61 0.195,-0.042 8.507,0.006 9.616,0.002 0.877,-0.007 1.35,-0.438 1.353,-1.208 0.003,-0.768 -0.479,-1.09 -1.35,-1.091 -2.968,-0.002 -9.619,-0.013 -9.619,-0.013 v -0.591 c 0,0 5.052,-0.016 7.225,-0.016 0.888,-0.002 1.354,-0.416 1.351,-1.193 -0.006,-0.761 -0.492,-1.196 -1.361,-1.196 -3.473,-0.005 -10.86,-0.003 -11.0829995,-0.003 -0.022,-0.047 -0.045,-0.094 -0.069,-0.139 0.3939995,-0.319 2.0409995,-1.626 2.4149995,-2.017 0.469,-0.4870005 0.519,-1.1650005 0.162,-1.6040005 -0.414,-0.511 -0.973,-0.5 -1.48,-0.236 -1.4609995,0.764 -6.5999995,3.6430005 -7.7329995,4.2710005 -0.9,0.499 -1.516,1.253 -1.882,2.19 -0.37000002,0.95 -0.17,2.01 -0.166,2.979 0.004,0.718 -0.27300002,1.345 -0.055,2.063 0.629,2.087 2.425,3.312 4.859,3.318 4.6179995,0.014 9.2379995,-0.139 13.8569995,-0.158 0.755,-0.004 1.171,-0.301 1.182,-1.033 0.012,-0.754 -0.423,-0.969 -1.183,-0.973 -1.778,-0.01 -5.824,-0.004 -6.04,-0.004 10e-4,-0.084 0.003,-0.586 10e-4,-0.67 z"},TASK_TYPE_INSTANTIATING_SEND:{d:"m {mx},{my} l 0,8.4 l 12.6,0 l 0,-8.4 z l 6.3,3.6 l 6.3,-3.6"},TASK_TYPE_SERVICE:{d:"m {mx},{my} v -1.71335 c 0.352326,-0.0705 0.703932,-0.17838 1.047628,-0.32133 0.344416,-0.14465 0.665822,-0.32133 0.966377,-0.52145 l 1.19431,1.18005 1.567487,-1.57688 -1.195028,-1.18014 c 0.403376,-0.61394 0.683079,-1.29908 0.825447,-2.01824 l 1.622133,-0.01 v -2.2196 l -1.636514,0.01 c -0.07333,-0.35153 -0.178319,-0.70024 -0.323564,-1.04372 -0.145244,-0.34406 -0.321407,-0.6644 -0.522735,-0.96217 l 1.131035,-1.13631 -1.583305,-1.56293 -1.129598,1.13589 c -0.614052,-0.40108 -1.302883,-0.68093 -2.022633,-0.82247 l 0.0093,-1.61852 h -2.241173 l 0.0042,1.63124 c -0.353763,0.0736 -0.705369,0.17977 -1.049785,0.32371 -0.344415,0.14437 -0.665102,0.32092 -0.9635006,0.52046 l -1.1698628,-1.15823 -1.5667691,1.5792 1.1684265,1.15669 c -0.4026573,0.61283 -0.68308,1.29797 -0.8247287,2.01713 l -1.6588041,0.003 v 2.22174 l 1.6724648,-0.006 c 0.073327,0.35077 0.1797598,0.70243 0.3242851,1.04472 0.1452428,0.34448 0.3214064,0.6644 0.5227339,0.96066 l -1.1993431,1.19723 1.5840256,1.56011 1.1964668,-1.19348 c 0.6140517,0.40346 1.3028827,0.68232 2.0233517,0.82331 l 7.19e-4,1.69892 h 2.226848 z m 0.221462,-3.9957 c -1.788948,0.7502 -3.8576,-0.0928 -4.6097055,-1.87438 -0.7521065,-1.78321 0.090598,-3.84627 1.8802645,-4.59604 1.78823,-0.74936 3.856881,0.0929 4.608987,1.87437 0.752106,1.78165 -0.0906,3.84612 -1.879546,4.59605 z"},TASK_TYPE_SERVICE_FILL:{d:"m {mx},{my} c -1.788948,0.7502 -3.8576,-0.0928 -4.6097055,-1.87438 -0.7521065,-1.78321 0.090598,-3.84627 1.8802645,-4.59604 1.78823,-0.74936 3.856881,0.0929 4.608987,1.87437 0.752106,1.78165 -0.0906,3.84612 -1.879546,4.59605 z"},TASK_TYPE_BUSINESS_RULE_HEADER:{d:"m {mx},{my} 0,4 20,0 0,-4 z"},TASK_TYPE_BUSINESS_RULE_MAIN:{d:"m {mx},{my} 0,12 20,0 0,-12 zm 0,8 l 20,0 m -13,-4 l 0,8"},MESSAGE_FLOW_MARKER:{d:"m {mx},{my} m -10.5 ,-7 l 0,14 l 21,0 l 0,-14 z l 10.5,6 l 10.5,-6"}},this.getRawPath=function(pathId){return this.pathMap[pathId].d},this.getScaledPath=function(pathId,param){var mx,my,rawPath=this.pathMap[pathId];param.abspos?(mx=param.abspos.x,my=param.abspos.y):(mx=param.containerWidth*param.position.mx,my=param.containerHeight*param.position.my);var coordinates={};if(param.position){for(var heightRatio=param.containerHeight/rawPath.height*param.yScaleFactor,widthRatio=param.containerWidth/rawPath.width*param.xScaleFactor,heightIndex=0;heightIndex<rawPath.heightElements.length;heightIndex++)coordinates["y"+heightIndex]=rawPath.heightElements[heightIndex]*heightRatio;for(var widthIndex=0;widthIndex<rawPath.widthElements.length;widthIndex++)coordinates["x"+widthIndex]=rawPath.widthElements[widthIndex]*widthRatio}return Snap.format(rawPath.d,{mx:mx,my:my,e:coordinates})}}var Snap=_dereq_(441);module.exports=PathMap},{441:441}],194:[function(_dereq_,module,exports){module.exports={__init__:["bpmnRenderer"],bpmnRenderer:["type",_dereq_(192)],pathMap:["type",_dereq_(193)]}},{192:192,193:193}],195:[function(_dereq_,module,exports){"use strict";function AutoResize(eventBus,canvas,modeling,elementRegistry){function isInbounds(bbox,target,padding){return{top:bbox.y<target.y+padding.top,bottom:bbox.y+bbox.height>target.y+target.height-padding.bottom,left:bbox.x<target.x+padding.left,right:bbox.x+bbox.width>target.x+target.width-padding.right}}function expand(elements,target){"string"==typeof target&&(target=elementRegistry.get(target));var bbox=getBoundingBox(elements),canExpand=!0;if((is(target,"bpmn:Participant")||is(target,"bpmn:Lane")||is(target,"bpmn:SubProcess"))&&(forEach(elements,function(element){if(is(element,"bpmn:Lane")||element.labelTarget)return void(canExpand=!1)}),canExpand)){var inbounds=isInbounds(bbox,target,PADDING),newBounds=pick(target,["x","y","width","height"]);if(inbounds.top){var topPosition=bbox.y-OFFSET.top;assign(newBounds,{y:topPosition,height:newBounds.height+newBounds.y-topPosition})}if(inbounds.bottom&&assign(newBounds,{height:bbox.y+bbox.height+OFFSET.bottom-newBounds.y}),inbounds.left){var leftPosition=bbox.x-OFFSET.left;assign(newBounds,{x:leftPosition,width:newBounds.width+newBounds.x-leftPosition})}inbounds.right&&assign(newBounds,{width:bbox.x+bbox.width+OFFSET.right-newBounds.x}),is(target,"bpmn:Participant")?modeling.resizeLane(target,newBounds):modeling.resizeShape(target,newBounds);var parent=target.parent;parent&&expand([target],parent)}}CommandInterceptor.call(this,eventBus),this.postExecuted(["shape.create"],function(event){var context=event.context,hints=context.hints,shape=context.shape,parent=context.parent||context.newParent;hints&&!1===hints.root||expand([shape],parent)}),this.postExecuted(["elements.move"],function(event){var context=event.context,elements=flatten(values(context.closure.topLevel)),expandings=groupBy(elements,function(element){return element.parent.id});forEach(expandings,function(elements,parentId){expand(elements,parentId)})})}var inherits=_dereq_(451),is=_dereq_(269).is,getBoundingBox=_dereq_(428).getBBox,pick=_dereq_(598),assign=_dereq_(592),forEach=_dereq_(464),values=_dereq_(600),flatten=_dereq_(453),groupBy=_dereq_(465),CommandInterceptor=_dereq_(292),OFFSET={top:60,bottom:60,left:100,right:100},PADDING={top:2,bottom:2,left:15,right:15};AutoResize.$inject=["eventBus","canvas","modeling","elementRegistry"],inherits(AutoResize,CommandInterceptor),module.exports=AutoResize},{269:269,292:292,428:428,451:451,453:453,464:464,465:465,592:592,598:598,600:600}],196:[function(_dereq_,module,exports){module.exports={__init__:["autoResize"],autoResize:["type",_dereq_(195)]}},{195:195}],197:[function(_dereq_,module,exports){"use strict";function ContextPadProvider(contextPad,modeling,elementFactory,connect,create,popupMenu,canvas,rules,translate){contextPad.registerProvider(this),this._contextPad=contextPad,this._modeling=modeling,this._elementFactory=elementFactory,this._connect=connect,this._create=create,this._popupMenu=popupMenu,this._canvas=canvas,this._rules=rules,this._translate=translate}function isEventType(eventBo,type,definition){var isType=eventBo.$instanceOf(type),isDefinition=!1,definitions=eventBo.eventDefinitions||[];return forEach(definitions,function(def){def.$type===definition&&(isDefinition=!0)}),isType&&isDefinition}var assign=_dereq_(592),forEach=_dereq_(464),isArray=_dereq_(583),is=_dereq_(269).is,isExpanded=_dereq_(267).isExpanded,isAny=_dereq_(242).isAny,getChildLanes=_dereq_(241).getChildLanes,isEventSubProcess=_dereq_(267).isEventSubProcess;ContextPadProvider.$inject=["contextPad","modeling","elementFactory","connect","create","popupMenu","canvas","rules","translate"],module.exports=ContextPadProvider,ContextPadProvider.prototype.getContextPadEntries=function(element){function startConnect(event,element,autoActivate){connect.start(event,element,autoActivate)}function removeElement(e){modeling.removeElements([element])}function getReplaceMenuPosition(element){var diagramContainer=canvas.getContainer(),pad=contextPad.getPad(element).html,diagramRect=diagramContainer.getBoundingClientRect(),padRect=pad.getBoundingClientRect(),top=padRect.top-diagramRect.top;return{x:padRect.left-diagramRect.left,y:top+padRect.height+5}}function appendAction(type,className,title,options){function appendListener(event,element){var shape=elementFactory.createShape(assign({type:type},options));create.start(event,shape,element)}return"string"!=typeof title&&(options=title,title=translate("Append {type}",{type:translate(type.replace(/^bpmn\:/,""))})),{group:"model",className:className,title:title,action:{dragstart:appendListener,click:appendListener}}}function splitLaneHandler(count){return function(event,element){modeling.splitLane(element,count),contextPad.open(element,!0)}}var contextPad=this._contextPad,modeling=this._modeling,elementFactory=this._elementFactory,connect=this._connect,create=this._create,popupMenu=this._popupMenu,canvas=this._canvas,rules=this._rules,translate=this._translate,actions={};if("label"===element.type)return actions;var businessObject=element.businessObject;if(isAny(businessObject,["bpmn:Lane","bpmn:Participant"])&&isExpanded(businessObject)){var childLanes=getChildLanes(element);assign(actions,{"lane-insert-above":{group:"lane-insert-above",className:"bpmn-icon-lane-insert-above",title:translate("Add Lane above"),action:{click:function(event,element){modeling.addLane(element,"top")}}}}),childLanes.length<2&&(element.height>=120&&assign(actions,{"lane-divide-two":{group:"lane-divide",className:"bpmn-icon-lane-divide-two",title:translate("Divide into two Lanes"),action:{click:splitLaneHandler(2)}}}),element.height>=180&&assign(actions,{"lane-divide-three":{group:"lane-divide",className:"bpmn-icon-lane-divide-three",title:translate("Divide into three Lanes"),action:{click:splitLaneHandler(3)}}})),assign(actions,{"lane-insert-below":{group:"lane-insert-below",className:"bpmn-icon-lane-insert-below",title:translate("Add Lane below"),action:{click:function(event,element){modeling.addLane(element,"bottom")}}}})}is(businessObject,"bpmn:FlowNode")&&(is(businessObject,"bpmn:EventBasedGateway")?assign(actions,{"append.receive-task":appendAction("bpmn:ReceiveTask","bpmn-icon-receive-task"),"append.message-intermediate-event":appendAction("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-message",{eventDefinitionType:"bpmn:MessageEventDefinition"}),"append.timer-intermediate-event":appendAction("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-timer",{eventDefinitionType:"bpmn:TimerEventDefinition"}),"append.condtion-intermediate-event":appendAction("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-condition",{eventDefinitionType:"bpmn:ConditionalEventDefinition"}),"append.signal-intermediate-event":appendAction("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-signal",{eventDefinitionType:"bpmn:SignalEventDefinition"})}):isEventType(businessObject,"bpmn:BoundaryEvent","bpmn:CompensateEventDefinition")?assign(actions,{"append.compensation-activity":appendAction("bpmn:Task","bpmn-icon-task",translate("Append compensation activity"),{isForCompensation:!0})}):is(businessObject,"bpmn:EndEvent")||businessObject.isForCompensation||isEventType(businessObject,"bpmn:IntermediateThrowEvent","bpmn:LinkEventDefinition")||isEventSubProcess(businessObject)||assign(actions,{"append.end-event":appendAction("bpmn:EndEvent","bpmn-icon-end-event-none"),"append.gateway":appendAction("bpmn:ExclusiveGateway","bpmn-icon-gateway-xor"),"append.append-task":appendAction("bpmn:Task","bpmn-icon-task"),"append.intermediate-event":appendAction("bpmn:IntermediateThrowEvent","bpmn-icon-intermediate-event-none")}));var replaceMenu;popupMenu._providers["bpmn-replace"]&&(replaceMenu=popupMenu.create("bpmn-replace",element)),replaceMenu&&!replaceMenu.isEmpty()&&assign(actions,{replace:{group:"edit",className:"bpmn-icon-screw-wrench",title:translate("Change type"),action:{click:function(event,element){replaceMenu.open(assign(getReplaceMenuPosition(element),{cursor:{x:event.x,y:event.y}}),element)}}}}),isAny(businessObject,["bpmn:FlowNode","bpmn:InteractionNode"])&&assign(actions,{"append.text-annotation":appendAction("bpmn:TextAnnotation","bpmn-icon-text-annotation"),connect:{group:"connect",className:"bpmn-icon-connection-multi",title:translate("Connect using "+(businessObject.isForCompensation?"":"Sequence/MessageFlow or ")+"Association"),action:{click:startConnect,dragstart:startConnect}}}),isAny(businessObject,["bpmn:DataObjectReference","bpmn:DataStoreReference"])&&assign(actions,{connect:{group:"connect",className:"bpmn-icon-connection-multi",title:translate("Connect using DataInputAssociation"),action:{click:startConnect,dragstart:startConnect}}});var deleteAllowed=rules.allowed("elements.delete",{elements:[element]});return isArray(deleteAllowed)&&(deleteAllowed=deleteAllowed[0]===element),deleteAllowed&&assign(actions,{delete:{group:"edit",className:"bpmn-icon-trash",title:translate("Remove"),action:{click:removeElement,dragstart:removeElement}}}),actions}},{241:241,242:242,267:267,269:269,464:464,583:583,592:592}],198:[function(_dereq_,module,exports){module.exports={__depends__:[_dereq_(287),_dereq_(322),_dereq_(395),_dereq_(320),_dereq_(326),_dereq_(248)],__init__:["contextPadProvider"],contextPadProvider:["type",_dereq_(197)]}},{197:197,248:248,287:287,320:320,322:322,326:326,395:395}],199:[function(_dereq_,module,exports){"use strict";function setProperties(descriptor,data,properties){forEach(properties,function(property){data[property]&&(descriptor[property]=data[property])})}function removeProperties(element,properties){forEach(properties,function(prop){element[prop]&&delete element[prop]})}function BpmnCopyPaste(bpmnFactory,eventBus,copyPaste,clipboard,moddle,canvas,bpmnRules){copyPaste.registerDescriptor(function(element,descriptor){var conditionExpression,eventDefinitions,businessObject=getBusinessObject(element);return descriptor.type=element.type,"label"===element.type?descriptor:(setProperties(descriptor,businessObject,["name","text","processRef","isInterrupting","isForCompensation","associationDirection"]),businessObject.default&&(descriptor.default=businessObject.default.id),businessObject.loopCharacteristics&&(descriptor.loopCharacteristics={type:businessObject.loopCharacteristics.$type,isSequential:businessObject.loopCharacteristics.isSequential}),setProperties(descriptor,businessObject.di,["isExpanded"]),is(businessObject,"bpmn:SequenceFlow")&&(conditionExpression=businessObject.get("conditionExpression"))&&(descriptor.conditionExpression={type:conditionExpression.$type,body:conditionExpression.body}),eventDefinitions=businessObject.get("eventDefinitions")||[],eventDefinitions.length&&(descriptor.eventDefinitions=map(eventDefinitions,function(defs){return defs.$type})),descriptor)}),eventBus.on("element.paste",function(context){var businessObject,newEventDefinition,rootElement,conditionExpression,loopCharacteristics,source,target,canConnect,descriptor=context.descriptor,createdElements=context.createdElements,parent=descriptor.parent;"label"!==descriptor.type&&(is(parent,"bpmn:Process")&&(rootElement=canvas.getRootElement(),descriptor.parent=is(rootElement,"bpmn:Collaboration")?rootElement:parent),is(parent,"bpmn:Lane")&&(descriptor.parent=parent.parent),"bpmn:MessageFlow"===descriptor.type&&(descriptor.parent=canvas.getRootElement()),descriptor.waypoints&&(source=createdElements[descriptor.source],target=createdElements[descriptor.target],source&&target&&(source=source.element,target=target.element),(canConnect=bpmnRules.canConnect(source,target))&&(descriptor.type=canConnect.type)),descriptor.businessObject=businessObject=bpmnFactory.create(descriptor.type),setProperties(businessObject,descriptor,["name","text"]),descriptor.loopCharacteristics&&(loopCharacteristics=descriptor.loopCharacteristics,businessObject.loopCharacteristics=moddle.create(loopCharacteristics.type),loopCharacteristics.isSequential&&(businessObject.loopCharacteristics.isSequential=!0),businessObject.loopCharacteristics.$parent=businessObject),descriptor.conditionExpression&&(conditionExpression=descriptor.conditionExpression,businessObject.conditionExpression=moddle.create(conditionExpression.type,{body:conditionExpression.body}),businessObject.conditionExpression.$parent=businessObject),descriptor.eventDefinitions&&(businessObject.eventDefinitions,businessObject.eventDefinitions=map(descriptor.eventDefinitions,function(type){return newEventDefinition=moddle.create(type),newEventDefinition.$parent=businessObject,newEventDefinition})),removeProperties(descriptor,["name","text","eventDefinitions","conditionExpression","loopCharacteristics"]))})}var ModelUtil=_dereq_(269),getBusinessObject=ModelUtil.getBusinessObject,is=ModelUtil.is,map=_dereq_(467),forEach=_dereq_(464);BpmnCopyPaste.$inject=["bpmnFactory","eventBus","copyPaste","clipboard","moddle","canvas","bpmnRules"],module.exports=BpmnCopyPaste},{269:269,464:464,467:467}],200:[function(_dereq_,module,exports){module.exports={__depends__:[_dereq_(324)],__init__:["bpmnCopyPaste"],bpmnCopyPaste:["type",_dereq_(199)]}},{199:199,324:324}],201:[function(_dereq_,module,exports){"use strict";function BpmnGlobalConnect(globalConnect){globalConnect.registerProvider(this)}function nonExistantOrLabel(element){return!element||isLabel(element)}function isLabel(element){return element.labelTarget}var isAny=_dereq_(242).isAny;BpmnGlobalConnect.$inject=["globalConnect"],module.exports=BpmnGlobalConnect,BpmnGlobalConnect.prototype.canStartConnect=function(source){if(nonExistantOrLabel(source))return null;var businessObject=source.businessObject;return isAny(businessObject,["bpmn:FlowNode","bpmn:InteractionNode","bpmn:DataObjectReference","bpmn:DataStoreReference"])}},{242:242}],202:[function(_dereq_,module,exports){module.exports={__depends__:[_dereq_(333)],__init__:["bpmnGlobalConnect"],bpmnGlobalConnect:["type",_dereq_(201)]}},{201:201,333:333}],203:[function(_dereq_,module,exports){"use strict";function BpmnKeyBindings(keyboard,spaceTool,lassoTool,handTool,globalConnect,directEditing,searchPad,selection,canvas,elementRegistry,editorActions){var actions={selectElements:function(){var rootElement=canvas.getRootElement(),elements=elementRegistry.filter(function(element){return element!=rootElement});selection.select(elements)},spaceTool:function(){spaceTool.toggle()},lassoTool:function(){lassoTool.toggle()},handTool:function(){handTool.toggle()},globalConnectTool:function(){globalConnect.toggle()},directEditing:function(){var currentSelection=selection.get();currentSelection.length&&directEditing.activate(currentSelection[0])},find:function(){searchPad.toggle()}};editorActions.register(actions),keyboard.addListener(function(key,modifiers){if(65===key&&keyboard.isCmd(modifiers))return editorActions.trigger("selectElements"),!0;if(70===key&&keyboard.isCmd(modifiers))return editorActions.trigger("find"),!0;if(!keyboard.hasModifier(modifiers))return 83===key?(editorActions.trigger("spaceTool"),!0):76===key?(editorActions.trigger("lassoTool"),!0):72===key?(editorActions.trigger("handTool"),!0):67===key?(editorActions.trigger("globalConnectTool"),!0):69===key?(editorActions.trigger("directEditing"),!0):void 0})}BpmnKeyBindings.$inject=["keyboard","spaceTool","lassoTool","handTool","globalConnect","directEditing","searchPad","selection","canvas","elementRegistry","editorActions"],module.exports=BpmnKeyBindings},{}],204:[function(_dereq_,module,exports){module.exports={__depends__:[_dereq_(339),_dereq_(202)],__init__:["bpmnKeyBindings"],bpmnKeyBindings:["type",_dereq_(203)]}},{
202:202,203:203,339:339}],205:[function(_dereq_,module,exports){"use strict";function LabelEditingProvider(eventBus,canvas,directEditing,commandStack,elementFactory){directEditing.registerProvider(this),commandStack.registerHandler("element.updateLabel",UpdateLabelHandler),eventBus.on("element.dblclick",function(event){directEditing.activate(event.element)}),eventBus.on(["element.mousedown","drag.init","canvas.viewbox.changed"],function(event){directEditing.complete()}),eventBus.on(["commandStack.changed"],function(){directEditing.cancel()}),"ontouchstart"in document.documentElement||eventBus.on("create.end",500,function(e){var element=e.shape;e.context.canExecute&&(is(element,"bpmn:Task")||is(element,"bpmn:TextAnnotation")||is(element,"bpmn:SubProcess")&&!isExpanded(element))&&directEditing.activate(element)}),this._canvas=canvas,this._commandStack=commandStack,this._elementFactory=elementFactory}var UpdateLabelHandler=_dereq_(207),LabelUtil=_dereq_(206),minBoundsLabel=_dereq_(268).DEFAULT_LABEL_SIZE,is=_dereq_(269).is,isExpanded=_dereq_(267).isExpanded,assign=_dereq_(592),MIN_BOUNDS={width:150,height:50};LabelEditingProvider.$inject=["eventBus","canvas","directEditing","commandStack","elementFactory"],module.exports=LabelEditingProvider,LabelEditingProvider.prototype.activate=function(element){var text=LabelUtil.getLabel(element);if(void 0!==text){var bbox=this.getEditingBBox(element),options={};return(is(element,"bpmn:Participant")&&isExpanded(element)||is(element,"bpmn:Lane"))&&(bbox.width=MIN_BOUNDS.width,bbox.height=MIN_BOUNDS.height,bbox.x=bbox.x+10-bbox.width/2,bbox.y=bbox.mid.y-bbox.height/2),(is(element,"bpmn:Task")||is(element,"bpmn:Activity"))&&(bbox.width<100&&(bbox.width=100,bbox.x=bbox.mid.x-bbox.width/2),bbox.height<80&&(bbox.height=80,bbox.y=bbox.mid.y-bbox.height/2)),(is(element,"bpmn:SubProcess")&&isExpanded(element)||is(element,"bpmn:Participant")&&!isExpanded(element))&&(bbox.width=element.width,bbox.height=MIN_BOUNDS.height,bbox.x=bbox.mid.x-element.width/2),is(element,"bpmn:TextAnnotation")&&(options.autosizing=!0,options.textAlignment="left",options.defaultHeight=this._elementFactory._getDefaultSize(element).height,options.maxHeight=100),(element.label||"label"===element.type)&&(options.autosizing=!0,options.defaultHeight=50,options.maxHeight=100),{bounds:bbox,text:text,options:options}}},LabelEditingProvider.prototype.getEditingBBox=function(element,maxBounds){var target=element.label||element,bbox=this._canvas.getAbsoluteBBox(target),mid={x:bbox.x+bbox.width/2,y:bbox.y+bbox.height/2};return target.labelTarget&&(bbox.width=Math.max(bbox.width,MIN_BOUNDS.width),bbox.height=Math.max(bbox.height,MIN_BOUNDS.height),bbox.x=mid.x-bbox.width/2),bbox.mid=mid,bbox},LabelEditingProvider.prototype.update=function(element,newLabel,newSize){var newBounds={},target=element.label||element;if(is(target,"bpmn:TextAnnotation")||"label"===target.type){var newX=null;if("label"===target.type){newSize.width=newSize.width<=MIN_BOUNDS.width?minBoundsLabel.width:newSize.width,newSize.height=Math.max(minBoundsLabel.height,newSize.height);var deltaX=target.width-newSize.width;newX=target.x+deltaX/2}assign(newBounds,{x:newX||target.x,y:target.y,width:newSize.width,height:newSize.height})}else newBounds=null;this._commandStack.execute("element.updateLabel",{element:element,newLabel:newLabel,newBounds:newBounds})}},{206:206,207:207,267:267,268:268,269:269,592:592}],206:[function(_dereq_,module,exports){"use strict";function getLabelAttr(semantic){return is(semantic,"bpmn:FlowElement")||is(semantic,"bpmn:Participant")||is(semantic,"bpmn:Lane")||is(semantic,"bpmn:SequenceFlow")||is(semantic,"bpmn:MessageFlow")?"name":is(semantic,"bpmn:TextAnnotation")?"text":void 0}var is=_dereq_(269).is;module.exports.getLabel=function(element){var semantic=element.businessObject,attr=getLabelAttr(semantic);if(attr)return semantic[attr]||""},module.exports.setLabel=function(element,text,isExternal){var semantic=element.businessObject,attr=getLabelAttr(semantic);return attr&&(semantic[attr]=text),isExternal&&(element.hidden=!text),element}},{269:269}],207:[function(_dereq_,module,exports){"use strict";function UpdateLabelHandler(modeling){function setText(element,text){var label=element.label||element,labelTarget=element.labelTarget||element;return LabelUtil.setLabel(label,text,labelTarget!==label),[label,labelTarget]}function execute(ctx){return ctx.oldLabel=LabelUtil.getLabel(ctx.element),setText(ctx.element,ctx.newLabel)}function revert(ctx){return setText(ctx.element,ctx.oldLabel)}function postExecute(ctx){if(ctx.newBounds){if(is(ctx.element,"bpmn:TextAnnotation"))return modeling.resizeShape(ctx.element,ctx.newBounds);if(ctx.element.label||"label"===ctx.element.type){var target="label"===ctx.element.type?ctx.element:ctx.element.label;return modeling.resizeShape(target,ctx.newBounds)}}}this._modeling=modeling,this.execute=execute,this.revert=revert,this.postExecute=postExecute}var LabelUtil=_dereq_(206),is=_dereq_(269).is;UpdateLabelHandler.$inject=["modeling"],module.exports=UpdateLabelHandler},{206:206,269:269}],208:[function(_dereq_,module,exports){module.exports={__depends__:[_dereq_(294),_dereq_(316),_dereq_(287)],__init__:["labelEditingProvider"],labelEditingProvider:["type",_dereq_(205)]}},{205:205,287:287,294:294,316:316}],209:[function(_dereq_,module,exports){"use strict";function BpmnFactory(moddle){this._model=moddle}var map=_dereq_(467),assign=_dereq_(592),pick=_dereq_(598);BpmnFactory.$inject=["moddle"],BpmnFactory.prototype._needsId=function(element){return element.$instanceOf("bpmn:RootElement")||element.$instanceOf("bpmn:FlowElement")||element.$instanceOf("bpmn:MessageFlow")||element.$instanceOf("bpmn:DataAssociation")||element.$instanceOf("bpmn:Artifact")||element.$instanceOf("bpmn:Participant")||element.$instanceOf("bpmn:Lane")||element.$instanceOf("bpmn:Process")||element.$instanceOf("bpmn:Collaboration")||element.$instanceOf("bpmndi:BPMNShape")||element.$instanceOf("bpmndi:BPMNEdge")||element.$instanceOf("bpmndi:BPMNDiagram")||element.$instanceOf("bpmndi:BPMNPlane")||element.$instanceOf("bpmn:Property")},BpmnFactory.prototype._ensureId=function(element){var prefix=(element.$type||"").replace(/^[^:]*:/g,"")+"_";!element.id&&this._needsId(element)&&(element.id=this._model.ids.nextPrefixed(prefix,element))},BpmnFactory.prototype.create=function(type,attrs){var element=this._model.create(type,attrs||{});return this._ensureId(element),element},BpmnFactory.prototype.createDiLabel=function(){return this.create("bpmndi:BPMNLabel",{bounds:this.createDiBounds()})},BpmnFactory.prototype.createDiShape=function(semantic,bounds,attrs){return this.create("bpmndi:BPMNShape",assign({bpmnElement:semantic,bounds:this.createDiBounds(bounds)},attrs))},BpmnFactory.prototype.createDiBounds=function(bounds){return this.create("dc:Bounds",bounds)},BpmnFactory.prototype.createDiWaypoints=function(waypoints){return map(waypoints,function(pos){return this.createDiWaypoint(pos)},this)},BpmnFactory.prototype.createDiWaypoint=function(point){return this.create("dc:Point",pick(point,["x","y"]))},BpmnFactory.prototype.createDiEdge=function(semantic,waypoints,attrs){return this.create("bpmndi:BPMNEdge",assign({bpmnElement:semantic},attrs))},BpmnFactory.prototype.createDiPlane=function(semantic){return this.create("bpmndi:BPMNPlane",{bpmnElement:semantic})},module.exports=BpmnFactory},{467:467,592:592,598:598}],210:[function(_dereq_,module,exports){"use strict";function BpmnLayouter(){}function getAttachOrientation(attachedElement){var hostElement=attachedElement.host;return getOrientation(getMid(attachedElement),hostElement,-10)}function getConnectionDocking(waypoints,idx,shape){var point=waypoints&&waypoints[idx];return point?point.original||point:getMid(shape)}function isCompensationAssociation(connection){var source=connection.source,target=connection.target;return is(target,"bpmn:Activity")&&is(source,"bpmn:BoundaryEvent")&&target.businessObject.isForCompensation}var inherits=_dereq_(451),assign=_dereq_(592),BaseLayouter=_dereq_(412),ManhattanLayout=_dereq_(415),LayoutUtil=_dereq_(414),getMid=LayoutUtil.getMid,getOrientation=LayoutUtil.getOrientation,is=_dereq_(269).is;inherits(BpmnLayouter,BaseLayouter),module.exports=BpmnLayouter,BpmnLayouter.prototype.layoutConnection=function(connection,layoutHints){var start,end,manhattanOptions,updatedWaypoints,source=connection.source,target=connection.target,waypoints=connection.waypoints;if(start=getConnectionDocking(waypoints,0,source),end=getConnectionDocking(waypoints,waypoints&&waypoints.length-1,target),(is(connection,"bpmn:Association")||is(connection,"bpmn:DataAssociation"))&&waypoints&&!isCompensationAssociation(connection))return waypoints;if(is(connection,"bpmn:MessageFlow"))manhattanOptions={preferredLayouts:["straight","v:v"]},is(target,"bpmn:Event")&&(manhattanOptions={preferredLayouts:["v:v"]});else if(is(connection,"bpmn:SequenceFlow")||isCompensationAssociation(connection))if(is(source,"bpmn:BoundaryEvent")){var orientation=getAttachOrientation(source);/left|right/.test(orientation)?manhattanOptions={preferredLayouts:["h:v"]}:/top|bottom/.test(orientation)&&(manhattanOptions={preferredLayouts:["v:h"]})}else manhattanOptions=is(source,"bpmn:Gateway")?{preferredLayouts:["v:h"]}:is(target,"bpmn:Gateway")?{preferredLayouts:["h:v"]}:{preferredLayouts:["h:h"]};return manhattanOptions&&(manhattanOptions=assign(manhattanOptions,layoutHints),updatedWaypoints=ManhattanLayout.repairConnection(source,target,start,end,waypoints,manhattanOptions)),updatedWaypoints||[start,end]}},{269:269,412:412,414:414,415:415,451:451,592:592}],211:[function(_dereq_,module,exports){"use strict";function BpmnUpdater(eventBus,bpmnFactory,connectionDocking,translate){function cropConnection(e){var connection,context=e.context;context.cropped||(connection=context.connection,connection.waypoints=connectionDocking.getCroppedWaypoints(connection),context.cropped=!0)}function updateParent(e){var context=e.context;self.updateParent(context.shape||context.connection,context.oldParent)}function reverseUpdateParent(e){var context=e.context,element=context.shape||context.connection,oldParent=context.parent||context.newParent;self.updateParent(element,oldParent)}function updateRoot(event){var context=event.context,oldRoot=context.oldRoot,children=oldRoot.children;forEach(children,function(child){self.updateParent(child)})}function updateBounds(e){var shape=e.context.shape;is(shape,"bpmn:BaseElement")&&self.updateBounds(shape)}function updateConnection(e){self.updateConnection(e.context)}function updateConnectionWaypoints(e){self.updateConnectionWaypoints(e.context.connection)}function updateAttachment(e){self.updateAttachment(e.context)}CommandInterceptor.call(this,eventBus),this._bpmnFactory=bpmnFactory,this._translate=translate;var self=this;this.executed(["connection.layout","connection.create","connection.reconnectEnd","connection.reconnectStart"],cropConnection),this.reverted(["connection.layout"],function(e){delete e.context.cropped}),this.executed(["shape.move","shape.create","shape.delete","connection.create","connection.move","connection.delete"],ifBpmn(updateParent)),this.reverted(["shape.move","shape.create","shape.delete","connection.create","connection.move","connection.delete"],ifBpmn(reverseUpdateParent)),this.executed(["canvas.updateRoot"],updateRoot),this.reverted(["canvas.updateRoot"],updateRoot),this.executed(["shape.move","shape.create","shape.resize"],ifBpmn(updateBounds)),this.reverted(["shape.move","shape.create","shape.resize"],ifBpmn(updateBounds)),this.executed(["connection.create","connection.move","connection.delete","connection.reconnectEnd","connection.reconnectStart"],ifBpmn(updateConnection)),this.reverted(["connection.create","connection.move","connection.delete","connection.reconnectEnd","connection.reconnectStart"],ifBpmn(updateConnection)),this.executed(["connection.layout","connection.move","connection.updateWaypoints","connection.reconnectEnd","connection.reconnectStart"],ifBpmn(updateConnectionWaypoints)),this.reverted(["connection.layout","connection.move","connection.updateWaypoints","connection.reconnectEnd","connection.reconnectStart"],ifBpmn(updateConnectionWaypoints)),this.executed(["connection.reconnectEnd","connection.reconnectStart"],ifBpmn(function(e){var context=e.context,connection=context.connection,businessObject=getBusinessObject(connection),oldSource=getBusinessObject(context.oldSource),oldTarget=getBusinessObject(context.oldTarget),newSource=getBusinessObject(connection.source),newTarget=getBusinessObject(connection.target);oldSource!==newSource&&oldTarget!==newTarget&&(oldSource&&oldSource.default&&(context.default=oldSource.default,oldSource.default=void 0),businessObject.sourceRef&&businessObject.sourceRef.default&&!(is(newTarget,"bpmn:Activity")||is(newTarget,"bpmn:EndEvent")||is(newTarget,"bpmn:IntermediateThrowEvent"))&&(context.default=businessObject.sourceRef.default,businessObject.sourceRef.default=void 0),businessObject.conditionExpression&&!is(newSource,"bpmn:Activity")&&(context.conditionExpression=businessObject.conditionExpression,businessObject.conditionExpression=void 0),businessObject.conditionExpression&&!(is(newTarget,"bpmn:Activity")||is(newTarget,"bpmn:EndEvent")||is(newTarget,"bpmn:IntermediateThrowEvent"))&&(context.conditionExpression=businessObject.conditionExpression,businessObject.conditionExpression=void 0))})),this.reverted(["connection.reconnectEnd","connection.reconnectStart"],ifBpmn(function(e){var context=e.context,connection=context.connection,businessObject=getBusinessObject(connection),newSource=getBusinessObject(connection.source);context.default&&(is(newSource,"bpmn:ExclusiveGateway")||is(newSource,"bpmn:InclusiveGateway")||is(newSource,"bpmn:Activity"))&&(newSource.default=context.default),context.conditionExpression&&is(newSource,"bpmn:Activity")&&(businessObject.conditionExpression=context.conditionExpression)})),this.executed(["element.updateAttachment"],ifBpmn(updateAttachment)),this.reverted(["element.updateAttachment"],ifBpmn(updateAttachment))}function getDefinitions(element){for(;element&&!is(element,"bpmn:Definitions");)element=element.$parent;return element}function ifBpmn(fn){return function(event){var context=event.context,element=context.shape||context.connection;is(element,"bpmn:BaseElement")&&fn(event)}}var assign=_dereq_(592),forEach=_dereq_(464),inherits=_dereq_(451),Collections=_dereq_(425),Model=_dereq_(416),getBusinessObject=_dereq_(269).getBusinessObject,is=_dereq_(269).is,CommandInterceptor=_dereq_(292);inherits(BpmnUpdater,CommandInterceptor),module.exports=BpmnUpdater,BpmnUpdater.$inject=["eventBus","bpmnFactory","connectionDocking","translate"],BpmnUpdater.prototype.updateAttachment=function(context){var shape=context.shape,businessObject=shape.businessObject,host=shape.host;businessObject.attachedToRef=host&&host.businessObject},BpmnUpdater.prototype.updateParent=function(element,oldParent){if(!(element instanceof Model.Label)){var parentShape=element.parent,businessObject=element.businessObject,parentBusinessObject=parentShape&&parentShape.businessObject,parentDi=parentBusinessObject&&parentBusinessObject.di;is(element,"bpmn:FlowNode")&&this.updateFlowNodeRefs(businessObject,parentBusinessObject,oldParent&&oldParent.businessObject),is(element,"bpmn:DataOutputAssociation")&&(parentBusinessObject=element.source?element.source.businessObject:null),is(element,"bpmn:DataInputAssociation")&&(parentBusinessObject=element.target?element.target.businessObject:null),this.updateSemanticParent(businessObject,parentBusinessObject),is(element,"bpmn:DataObjectReference")&&businessObject.dataObjectRef&&this.updateSemanticParent(businessObject.dataObjectRef,parentBusinessObject),this.updateDiParent(businessObject.di,parentDi)}},BpmnUpdater.prototype.updateBounds=function(shape){var di=shape.businessObject.di,bounds=shape instanceof Model.Label?this._getLabel(di).bounds:di.bounds;assign(bounds,{x:shape.x,y:shape.y,width:shape.width,height:shape.height})},BpmnUpdater.prototype.updateFlowNodeRefs=function(businessObject,newContainment,oldContainment){if(oldContainment!==newContainment){var oldRefs,newRefs;is(oldContainment,"bpmn:Lane")&&(oldRefs=oldContainment.get("flowNodeRef"),Collections.remove(oldRefs,businessObject)),is(newContainment,"bpmn:Lane")&&(newRefs=newContainment.get("flowNodeRef"),Collections.add(newRefs,businessObject))}},BpmnUpdater.prototype.updateDiParent=function(di,parentDi){if(parentDi&&!is(parentDi,"bpmndi:BPMNPlane")&&(parentDi=parentDi.$parent),di.$parent!==parentDi){var planeElements=(parentDi||di.$parent).get("planeElement");parentDi?(planeElements.push(di),di.$parent=parentDi):(Collections.remove(planeElements,di),di.$parent=null)}},BpmnUpdater.prototype.getLaneSet=function(container){var laneSet,laneSets;return is(container,"bpmn:Lane")?(laneSet=container.childLaneSet,laneSet||(laneSet=this._bpmnFactory.create("bpmn:LaneSet"),container.childLaneSet=laneSet,laneSet.$parent=container),laneSet):(is(container,"bpmn:Participant")&&(container=container.processRef),laneSets=container.get("laneSets"),laneSet=laneSets[0],laneSet||(laneSet=this._bpmnFactory.create("bpmn:LaneSet"),laneSet.$parent=container,laneSets.push(laneSet)),laneSet)},BpmnUpdater.prototype.updateSemanticParent=function(businessObject,newParent,visualParent){var containment,translate=this._translate;if(businessObject.$parent!==newParent){if(is(businessObject,"bpmn:Lane"))newParent&&(newParent=this.getLaneSet(newParent)),containment="lanes";else if(is(businessObject,"bpmn:FlowElement")){if(newParent)if(is(newParent,"bpmn:Participant"))newParent=newParent.processRef;else if(is(newParent,"bpmn:Lane"))do{newParent=newParent.$parent.$parent}while(is(newParent,"bpmn:Lane"));containment="flowElements"}else if(is(businessObject,"bpmn:Artifact")){for(;newParent&&!is(newParent,"bpmn:Process")&&!is(newParent,"bpmn:SubProcess")&&!is(newParent,"bpmn:Collaboration");){if(is(newParent,"bpmn:Participant")){newParent=newParent.processRef;break}newParent=newParent.$parent}containment="artifacts"}else if(is(businessObject,"bpmn:MessageFlow"))containment="messageFlows";else if(is(businessObject,"bpmn:Participant")){containment="participants";var definitions,process=businessObject.processRef;process&&(definitions=getDefinitions(businessObject.$parent||newParent),businessObject.$parent&&(Collections.remove(definitions.get("rootElements"),process),process.$parent=null),newParent&&(Collections.add(definitions.get("rootElements"),process),process.$parent=definitions))}else is(businessObject,"bpmn:DataOutputAssociation")?containment="dataOutputAssociations":is(businessObject,"bpmn:DataInputAssociation")&&(containment="dataInputAssociations");if(!containment)throw new Error(translate("no parent for {element} in {parent}",{element:businessObject.id,parent:newParent.id}));var children;if(businessObject.$parent&&(children=businessObject.$parent.get(containment),Collections.remove(children,businessObject)),newParent?(children=newParent.get(containment),children.push(businessObject),businessObject.$parent=newParent):businessObject.$parent=null,visualParent){var diChildren=visualParent.get(containment);Collections.remove(children,businessObject),newParent&&(diChildren||(diChildren=[],newParent.set(containment,diChildren)),diChildren.push(businessObject))}}},BpmnUpdater.prototype.updateConnectionWaypoints=function(connection){connection.businessObject.di.set("waypoint",this._bpmnFactory.createDiWaypoints(connection.waypoints))},BpmnUpdater.prototype.updateConnection=function(context){var visualParent,connection=context.connection,businessObject=getBusinessObject(connection),newSource=getBusinessObject(connection.source),newTarget=getBusinessObject(connection.target);if(is(businessObject,"bpmn:DataAssociation"))is(businessObject,"bpmn:DataInputAssociation")?(businessObject.get("sourceRef")[0]=newSource,visualParent=context.parent||context.newParent||newTarget,this.updateSemanticParent(businessObject,newTarget,parent.businessObject)):is(businessObject,"bpmn:DataOutputAssociation")&&(visualParent=context.parent||context.newParent||newSource,this.updateSemanticParent(businessObject,newSource,visualParent),businessObject.targetRef=newTarget);else{var inverseSet=is(businessObject,"bpmn:SequenceFlow");businessObject.sourceRef!==newSource&&(inverseSet&&(Collections.remove(businessObject.sourceRef&&businessObject.sourceRef.get("outgoing"),businessObject),newSource&&newSource.get("outgoing")&&newSource.get("outgoing").push(businessObject)),businessObject.sourceRef=newSource),businessObject.targetRef!==newTarget&&(inverseSet&&(Collections.remove(businessObject.targetRef&&businessObject.targetRef.get("incoming"),businessObject),newTarget&&newTarget.get("incoming")&&newTarget.get("incoming").push(businessObject)),businessObject.targetRef=newTarget)}this.updateConnectionWaypoints(connection)},BpmnUpdater.prototype._getLabel=function(di){return di.label||(di.label=this._bpmnFactory.createDiLabel()),di.label}},{269:269,292:292,416:416,425:425,451:451,464:464,592:592}],212:[function(_dereq_,module,exports){"use strict";function ElementFactory(bpmnFactory,moddle,translate){BaseElementFactory.call(this),this._bpmnFactory=bpmnFactory,this._moddle=moddle,this._translate=translate}var assign=_dereq_(592),inherits=_dereq_(451),is=_dereq_(269).is,isExpanded=_dereq_(267).isExpanded,BaseElementFactory=_dereq_(296),LabelUtil=_dereq_(268);inherits(ElementFactory,BaseElementFactory),ElementFactory.$inject=["bpmnFactory","moddle","translate"],module.exports=ElementFactory,ElementFactory.prototype.baseCreate=BaseElementFactory.prototype.create,ElementFactory.prototype.create=function(elementType,attrs){return"label"===elementType?this.baseCreate(elementType,assign({type:"label"},LabelUtil.DEFAULT_LABEL_SIZE,attrs)):this.createBpmnElement(elementType,attrs)},ElementFactory.prototype.createBpmnElement=function(elementType,attrs){var size,translate=this._translate;attrs=attrs||{};var businessObject=attrs.businessObject;if(!businessObject){if(!attrs.type)throw new Error(translate("no shape type specified"));businessObject=this._bpmnFactory.create(attrs.type)}businessObject.di||(businessObject.di="root"===elementType?this._bpmnFactory.createDiPlane(businessObject,[],{id:businessObject.id+"_di"}):"connection"===elementType?this._bpmnFactory.createDiEdge(businessObject,[],{id:businessObject.id+"_di"}):this._bpmnFactory.createDiShape(businessObject,{},{id:businessObject.id+"_di"})),attrs.processRef&&(businessObject.processRef=attrs.processRef),attrs.isExpanded&&(businessObject.di.isExpanded=attrs.isExpanded),is(businessObject,"bpmn:ExclusiveGateway")&&(businessObject.di.isMarkerVisible=!0),!1===attrs.isInterrupting&&(businessObject.isInterrupting=!1),attrs.associationDirection&&(businessObject.associationDirection=attrs.associationDirection);var eventDefinitions,newEventDefinition;return attrs.eventDefinitionType&&(eventDefinitions=businessObject.get("eventDefinitions")||[],newEventDefinition=this._moddle.create(attrs.eventDefinitionType),eventDefinitions.push(newEventDefinition),newEventDefinition.$parent=businessObject,businessObject.eventDefinitions=eventDefinitions),attrs.isForCompensation&&(businessObject.isForCompensation=!0),size=this._getDefaultSize(businessObject),attrs=assign({businessObject:businessObject,id:businessObject.id},size,attrs),this.baseCreate(elementType,attrs)},ElementFactory.prototype._getDefaultSize=function(semantic){return is(semantic,"bpmn:SubProcess")?isExpanded(semantic)?{width:350,height:200}:{width:100,height:80}:is(semantic,"bpmn:Task")?{width:100,height:80}:is(semantic,"bpmn:Gateway")?{width:50,height:50}:is(semantic,"bpmn:Event")?{width:36,height:36}:is(semantic,"bpmn:Participant")?isExpanded(semantic)?{width:600,height:250}:{width:400,height:100}:is(semantic,"bpmn:Lane")?{width:400,height:100}:is(semantic,"bpmn:DataObjectReference")?{width:36,height:50}:is(semantic,"bpmn:DataStoreReference")?{width:50,height:50}:is(semantic,"bpmn:TextAnnotation")?{width:100,height:30}:{width:100,height:80}},ElementFactory.prototype.createParticipantShape=function(collapsed){var attrs={type:"bpmn:Participant"};return collapsed||(attrs.processRef=this._bpmnFactory.create("bpmn:Process")),this.createShape(attrs)}},{267:267,268:268,269:269,296:296,451:451,592:592}],213:[function(_dereq_,module,exports){"use strict";function Modeling(eventBus,elementFactory,commandStack,bpmnRules){BaseModeling.call(this,eventBus,elementFactory,commandStack),this._bpmnRules=bpmnRules}var inherits=_dereq_(451),BaseModeling=_dereq_(344),UpdatePropertiesHandler=_dereq_(239),UpdateCanvasRootHandler=_dereq_(237),AddLaneHandler=_dereq_(233),SplitLaneHandler=_dereq_(236),ResizeLaneHandler=_dereq_(235),UpdateFlowNodeRefsHandler=_dereq_(238),IdClaimHandler=_dereq_(234);inherits(Modeling,BaseModeling),Modeling.$inject=["eventBus","elementFactory","commandStack","bpmnRules"],module.exports=Modeling,Modeling.prototype.getHandlers=function(){var handlers=BaseModeling.prototype.getHandlers.call(this);return handlers["element.updateProperties"]=UpdatePropertiesHandler,handlers["canvas.updateRoot"]=UpdateCanvasRootHandler,handlers["lane.add"]=AddLaneHandler,handlers["lane.resize"]=ResizeLaneHandler,handlers["lane.split"]=SplitLaneHandler,handlers["lane.updateRefs"]=UpdateFlowNodeRefsHandler,handlers["id.updateClaim"]=IdClaimHandler,handlers},Modeling.prototype.updateLabel=function(element,newLabel,newBounds){this._commandStack.execute("element.updateLabel",{element:element,newLabel:newLabel,newBounds:newBounds})},Modeling.prototype.connect=function(source,target,attrs){var bpmnRules=this._bpmnRules;return attrs||(attrs=bpmnRules.canConnect(source,target)||{type:"bpmn:Association"}),this.createConnection(source,target,attrs,source.parent)},Modeling.prototype.updateProperties=function(element,properties){this._commandStack.execute("element.updateProperties",{element:element,properties:properties})},Modeling.prototype.resizeLane=function(laneShape,newBounds,balanced){this._commandStack.execute("lane.resize",{shape:laneShape,newBounds:newBounds,balanced:balanced})},Modeling.prototype.addLane=function(targetLaneShape,location){var context={shape:targetLaneShape,location:location};return this._commandStack.execute("lane.add",context),context.newLane},Modeling.prototype.splitLane=function(targetLane,count){this._commandStack.execute("lane.split",{shape:targetLane,count:count})},Modeling.prototype.makeCollaboration=function(){var collaborationElement=this._create("root",{type:"bpmn:Collaboration"}),context={newRoot:collaborationElement};return this._commandStack.execute("canvas.updateRoot",context),collaborationElement},Modeling.prototype.updateLaneRefs=function(flowNodeShapes,laneShapes){this._commandStack.execute("lane.updateRefs",{flowNodeShapes:flowNodeShapes,laneShapes:laneShapes})},Modeling.prototype.makeProcess=function(){var processElement=this._create("root",{type:"bpmn:Process"}),context={newRoot:processElement};this._commandStack.execute("canvas.updateRoot",context)},Modeling.prototype.claimId=function(id,moddleElement){this._commandStack.execute("id.updateClaim",{id:id,element:moddleElement,claiming:!0})},Modeling.prototype.unclaimId=function(id,moddleElement){this._commandStack.execute("id.updateClaim",{id:id,element:moddleElement})}},{233:233,234:234,235:235,236:236,237:237,238:238,239:239,344:344,451:451}],214:[function(_dereq_,module,exports){"use strict";function AppendBehavior(eventBus,elementFactory,bpmnRules){CommandInterceptor.call(this,eventBus),this.preExecute("shape.append",function(context){var source=context.source,shape=context.shape;context.position||(is(shape,"bpmn:TextAnnotation")?context.position={x:source.x+source.width/2+75,y:source.y-50-shape.height/2}:context.position={x:source.x+source.width+80+shape.width/2,y:source.y+source.height/2})},!0)}var inherits=_dereq_(451),is=_dereq_(269).is,CommandInterceptor=_dereq_(292);AppendBehavior.$inject=["eventBus","elementFactory","bpmnRules"],inherits(AppendBehavior,CommandInterceptor),module.exports=AppendBehavior},{269:269,292:292,451:451}],215:[function(_dereq_,module,exports){"use strict";function CopyPasteBehavior(eventBus,modeling,canvas){CommandInterceptor.call(this,eventBus),this.preExecute("elements.paste",1500,function(context){var topParent=context.topParent;if(topParent.parent||(context.topParent=canvas.getRootElement()),is(topParent,"bpmn:Lane"))do{topParent=context.topParent=topParent.parent}while(is(topParent,"bpmn:Lane")||!is(topParent,"bpmn:Participant"))},!0),this.postExecute("elements.paste",function(context){var tree=context.tree,createdElements=tree.createdElements;forEach(createdElements,function(data){var defaultFlow,element=data.element,businessObject=element.businessObject,descriptor=data.descriptor;(is(businessObject,"bpmn:ExclusiveGateway")||is(businessObject,"bpmn:InclusiveGateway")||is(businessObject,"bpmn:Activity"))&&descriptor.default&&(defaultFlow=createdElements[descriptor.default],defaultFlow=defaultFlow?defaultFlow.element:void 0,delete element.default,modeling.updateProperties(element,{default:defaultFlow}))})},!0)}var inherits=_dereq_(451),forEach=_dereq_(464),is=_dereq_(269).is,CommandInterceptor=_dereq_(292);CopyPasteBehavior.$inject=["eventBus","modeling","canvas"],inherits(CopyPasteBehavior,CommandInterceptor),module.exports=CopyPasteBehavior},{269:269,292:292,451:451,464:464}],216:[function(_dereq_,module,exports){"use strict";function CreateBoundaryEventBehavior(eventBus,modeling,elementFactory,bpmnFactory){CommandInterceptor.call(this,eventBus),this.preExecute("shape.create",function(context){var businessObject,boundaryEvent,shape=context.shape,host=context.host,attrs={cancelActivity:!0};host&&is(shape,"bpmn:IntermediateThrowEvent")&&(attrs.attachedToRef=host.businessObject,businessObject=bpmnFactory.create("bpmn:BoundaryEvent",attrs),boundaryEvent={type:"bpmn:BoundaryEvent",businessObject:businessObject},context.shape=elementFactory.createShape(boundaryEvent))},!0)}var inherits=_dereq_(451),CommandInterceptor=_dereq_(292),is=_dereq_(269).is;CreateBoundaryEventBehavior.$inject=["eventBus","modeling","elementFactory","bpmnFactory"],inherits(CreateBoundaryEventBehavior,CommandInterceptor),module.exports=CreateBoundaryEventBehavior},{269:269,292:292,451:451}],217:[function(_dereq_,module,exports){"use strict";function CreateDataObjectBehavior(eventBus,bpmnFactory,moddle){CommandInterceptor.call(this,eventBus),this.preExecute("shape.create",function(event){var context=event.context,shape=context.shape;if(is(shape,"bpmn:DataObjectReference")&&"label"!==shape.type){var dataObject=bpmnFactory.create("bpmn:DataObject");shape.businessObject.dataObjectRef=dataObject}})}var inherits=_dereq_(451),CommandInterceptor=_dereq_(292),is=_dereq_(269).is;CreateDataObjectBehavior.$inject=["eventBus","bpmnFactory","moddle"],inherits(CreateDataObjectBehavior,CommandInterceptor),module.exports=CreateDataObjectBehavior},{269:269,292:292,451:451}],218:[function(_dereq_,module,exports){"use strict";function copy(obj){return assign({},obj)}function CreateOnFlowBehavior(eventBus,bpmnRules,modeling){CommandInterceptor.call(this,eventBus),this.preExecute("shape.create",function(context){var parent=context.parent,shape=context.shape;bpmnRules.canInsert(shape,parent)&&(context.targetFlow=parent,context.parent=parent.parent)},!0),this.postExecute("shape.create",function(context){var source,target,reconnected,intersection,waypoints,waypointsBefore,waypointsAfter,dockingPoint,shape=context.shape,targetFlow=context.targetFlow,position=context.position;targetFlow&&(waypoints=targetFlow.waypoints,intersection=getApproxIntersection(waypoints,position),intersection&&(waypointsBefore=waypoints.slice(0,intersection.index),waypointsAfter=waypoints.slice(intersection.index+(intersection.bendpoint?1:0)),dockingPoint=intersection.bendpoint?waypoints[intersection.index]:position,waypointsBefore.push(copy(dockingPoint)),
waypointsAfter.unshift(copy(dockingPoint))),source=targetFlow.source,target=targetFlow.target,bpmnRules.canConnect(source,shape,targetFlow)&&(modeling.reconnectEnd(targetFlow,shape,waypointsBefore||copy(position)),reconnected=!0),bpmnRules.canConnect(shape,target,targetFlow)&&(reconnected?modeling.connect(shape,target,{type:targetFlow.type,waypoints:waypointsAfter}):modeling.reconnectStart(targetFlow,shape,waypointsAfter||copy(position))))},!0)}var inherits=_dereq_(451),assign=_dereq_(592),CommandInterceptor=_dereq_(292),getApproxIntersection=_dereq_(433).getApproxIntersection;inherits(CreateOnFlowBehavior,CommandInterceptor),CreateOnFlowBehavior.$inject=["eventBus","bpmnRules","modeling"],module.exports=CreateOnFlowBehavior},{292:292,433:433,451:451,592:592}],219:[function(_dereq_,module,exports){"use strict";function CreateParticipantBehavior(eventBus,modeling,elementFactory,bpmnFactory,canvas){CommandInterceptor.call(this,eventBus),this.preExecute("shape.create",function(context){var parent=context.parent,shape=context.shape,position=context.position,rootElement=canvas.getRootElement();if(is(parent,"bpmn:Process")&&is(shape,"bpmn:Participant")&&!is(rootElement,"bpmn:Collaboration")){var collaborationElement=modeling.makeCollaboration();context.position=position,context.parent=collaborationElement,context.processRoot=parent}},!0),this.execute("shape.create",function(context){var processRoot=context.processRoot,shape=context.shape;processRoot&&(context.oldProcessRef=shape.businessObject.processRef,shape.businessObject.processRef=processRoot.businessObject)},!0),this.revert("shape.create",function(context){var processRoot=context.processRoot,shape=context.shape;processRoot&&(shape.businessObject.processRef=context.oldProcessRef)},!0),this.postExecute("shape.create",function(context){var processRoot=context.processRoot,shape=context.shape;if(processRoot){var processChildren=processRoot.children.slice();modeling.moveElements(processChildren,{x:0,y:0},shape)}},!0)}var inherits=_dereq_(451),CommandInterceptor=_dereq_(292),is=_dereq_(269).is;CreateParticipantBehavior.$inject=["eventBus","modeling","elementFactory","bpmnFactory","canvas"],inherits(CreateParticipantBehavior,CommandInterceptor),module.exports=CreateParticipantBehavior},{269:269,292:292,451:451}],220:[function(_dereq_,module,exports){"use strict";function DataInputAssociationBehavior(eventBus,bpmnFactory){function usesTargetRef(element,targetRef,removedConnection){var inputAssociations=element.get("dataInputAssociations");return find(inputAssociations,function(association){return association!==removedConnection&&association.targetRef===targetRef})}function getTargetRef(element,create){var properties=element.get("properties"),targetRefProp=find(properties,function(p){return p.name===TARGET_REF_PLACEHOLDER_NAME});return!targetRefProp&&create&&(targetRefProp=bpmnFactory.create("bpmn:Property",{name:TARGET_REF_PLACEHOLDER_NAME}),Collections.add(properties,targetRefProp)),targetRefProp}function cleanupTargetRef(element,connection){var targetRefProp=getTargetRef(element);targetRefProp&&(usesTargetRef(element,targetRefProp,connection)||Collections.remove(element.get("properties"),targetRefProp))}function fixTargetRef(event){var targetRefProp,context=event.context,connection=context.connection,connectionBo=connection.businessObject,target=connection.target,targetBo=target&&target.businessObject,newTarget=context.newTarget,newTargetBo=newTarget&&newTarget.businessObject,oldTarget=context.oldTarget||context.target,oldTargetBo=oldTarget&&oldTarget.businessObject,dataAssociation=connection.businessObject;oldTargetBo&&oldTargetBo!==targetBo&&cleanupTargetRef(oldTargetBo,connectionBo),newTargetBo&&newTargetBo!==targetBo&&cleanupTargetRef(newTargetBo,connectionBo),targetBo?(targetRefProp=getTargetRef(targetBo,!0),dataAssociation.targetRef=targetRefProp):dataAssociation.targetRef=null}CommandInterceptor.call(this,eventBus),this.executed(["connection.create","connection.delete","connection.move","connection.reconnectEnd"],ifDataInputAssociation(fixTargetRef)),this.reverted(["connection.create","connection.delete","connection.move","connection.reconnectEnd"],ifDataInputAssociation(fixTargetRef))}function ifDataInputAssociation(fn){return function(event){var context=event.context,connection=context.connection;if(is(connection,"bpmn:DataInputAssociation"))return fn(event)}}var inherits=_dereq_(451),CommandInterceptor=_dereq_(292),Collections=_dereq_(425),find=_dereq_(463),is=_dereq_(269).is,TARGET_REF_PLACEHOLDER_NAME="__targetRef_placeholder";DataInputAssociationBehavior.$inject=["eventBus","bpmnFactory"],inherits(DataInputAssociationBehavior,CommandInterceptor),module.exports=DataInputAssociationBehavior},{269:269,292:292,425:425,451:451,463:463}],221:[function(_dereq_,module,exports){"use strict";function DeleteLaneBehavior(eventBus,modeling,spaceTool){function compensateLaneDelete(shape,oldParent){var siblings=getChildLanes(oldParent),topAffected=[],bottomAffected=[];if(eachElement(siblings,function(element){return element.y>shape.y?bottomAffected.push(element):topAffected.push(element),element.children}),siblings.length){var offset;offset=bottomAffected.length&&topAffected.length?shape.height/2:shape.height;var topAdjustments,bottomAdjustments;topAffected.length&&(topAdjustments=spaceTool.calculateAdjustments(topAffected,"y",offset,shape.y-10),spaceTool.makeSpace(topAdjustments.movingShapes,topAdjustments.resizingShapes,{x:0,y:offset},"s")),bottomAffected.length&&(bottomAdjustments=spaceTool.calculateAdjustments(bottomAffected,"y",-offset,shape.y+shape.height+10),spaceTool.makeSpace(bottomAdjustments.movingShapes,bottomAdjustments.resizingShapes,{x:0,y:-offset},"n"))}}CommandInterceptor.call(this,eventBus),this.postExecuted("shape.delete",LOW_PRIORITY,function(event){var context=event.context,hints=context.hints,shape=context.shape,oldParent=context.oldParent;is(shape,"bpmn:Lane")&&(hints&&hints.nested||compensateLaneDelete(shape,oldParent))})}var inherits=_dereq_(451),CommandInterceptor=_dereq_(292),is=_dereq_(269).is,getChildLanes=_dereq_(241).getChildLanes,eachElement=_dereq_(428).eachElement,LOW_PRIORITY=500;DeleteLaneBehavior.$inject=["eventBus","modeling","spaceTool"],inherits(DeleteLaneBehavior,CommandInterceptor),module.exports=DeleteLaneBehavior},{241:241,269:269,292:292,428:428,451:451}],222:[function(_dereq_,module,exports){"use strict";function LabelSupport(eventBus,modeling,bpmnFactory){CommandInterceptor.call(this,eventBus),this.postExecute(["shape.create","connection.create"],function(e){var position,context=e.context,element=context.shape||context.connection,businessObject=element.businessObject;hasExternalLabel(businessObject)&&(position=getExternalLabelMid(element),modeling.createLabel(element,position,{id:businessObject.id+"_label",hidden:!businessObject.name,businessObject:businessObject}))}),this.postExecute(["connection.updateWaypoints"],function(e){var context=e.context,connection=context.connection,label=connection.label;if(label&&label.hidden){var position=getExternalLabelMid(connection),delta={x:position.x-label.x-label.width/2,y:position.y-label.y-label.height/2};modeling.moveShape(label,delta)}}),this.postExecute(["shape.replace"],function(e){var context=e.context,newShape=context.newShape,oldShape=context.oldShape,businessObject=getBusinessObject(newShape);businessObject&&hasExternalLabel(businessObject)&&(newShape.label.x=oldShape.label.x,newShape.label.y=oldShape.label.y)}),this.executed(["label.create"],function(e){var businessObject,di,element=e.context.shape;element.labelTarget&&is(element.labelTarget||element,"bpmn:BaseElement")&&(businessObject=element.businessObject,di=businessObject.di,di.label||(di.label=bpmnFactory.create("bpmndi:BPMNLabel",{bounds:bpmnFactory.create("dc:Bounds")})),assign(di.label.bounds,{x:element.x,y:element.y,width:element.width,height:element.height}))})}var assign=_dereq_(592),inherits=_dereq_(451),LabelUtil=_dereq_(268),ModelUtil=_dereq_(269),is=ModelUtil.is,getBusinessObject=ModelUtil.getBusinessObject,hasExternalLabel=LabelUtil.hasExternalLabel,getExternalLabelMid=LabelUtil.getExternalLabelMid,CommandInterceptor=_dereq_(292);inherits(LabelSupport,CommandInterceptor),LabelSupport.$inject=["eventBus","modeling","bpmnFactory"],module.exports=LabelSupport},{268:268,269:269,292:292,451:451,592:592}],223:[function(_dereq_,module,exports){"use strict";function ModelingFeedback(eventBus,tooltips,translate){function showError(position,message,timeout){tooltips.add({position:{x:position.x+5,y:position.y+5},type:"error",timeout:timeout||2e3,html:"<div>"+message+"</div>"})}eventBus.on(["shape.move.rejected","create.rejected"],function(event){var context=event.context,shape=context.shape,target=context.target;is(target,"bpmn:Collaboration")&&is(shape,"bpmn:FlowNode")&&showError(event,translate(COLLAB_ERR_MSG))}),eventBus.on(["elements.paste.rejected"],function(event){var context=event.context,position=context.position,target=context.target;is(target,"bpmn:Collaboration")&&showError(position,translate(COLLAB_ERR_MSG)),is(target,"bpmn:Process")&&showError(position,translate(PROCESS_ERR_MSG),3e3)})}var is=_dereq_(269).is,COLLAB_ERR_MSG="flow elements must be children of pools/participants",PROCESS_ERR_MSG="participants cannot be pasted onto a non-empty process diagram";ModelingFeedback.$inject=["eventBus","tooltips","translate"],module.exports=ModelingFeedback},{269:269}],224:[function(_dereq_,module,exports){"use strict";function RemoveElementBehavior(eventBus,bpmnRules,modeling){CommandInterceptor.call(this,eventBus),this.preExecute("shape.delete",function(e){var shape=e.context.shape;if(1==shape.incoming.length&&1==shape.outgoing.length){var inConnection=shape.incoming[0],outConnection=shape.outgoing[0],docking=outConnection.waypoints[outConnection.waypoints.length-1];bpmnRules.canConnect(inConnection.source,outConnection.target,inConnection)&&modeling.reconnectEnd(inConnection,outConnection.target,docking)}})}var inherits=_dereq_(451),CommandInterceptor=_dereq_(292);inherits(RemoveElementBehavior,CommandInterceptor),RemoveElementBehavior.$inject=["eventBus","bpmnRules","modeling"],module.exports=RemoveElementBehavior},{292:292,451:451}],225:[function(_dereq_,module,exports){"use strict";function RemoveParticipantBehavior(eventBus,modeling){CommandInterceptor.call(this,eventBus),this.preExecute("shape.delete",function(context){var shape=context.shape,parent=shape.parent;is(shape,"bpmn:Participant")&&(context.collaborationRoot=parent)},!0),this.postExecute("shape.delete",function(context){var collaborationRoot=context.collaborationRoot;collaborationRoot&&!collaborationRoot.businessObject.participants.length&&modeling.makeProcess()},!0)}var inherits=_dereq_(451),CommandInterceptor=_dereq_(292),is=_dereq_(269).is;RemoveParticipantBehavior.$inject=["eventBus","modeling"],inherits(RemoveParticipantBehavior,CommandInterceptor),module.exports=RemoveParticipantBehavior},{269:269,292:292,451:451}],226:[function(_dereq_,module,exports){"use strict";function ReplaceConnectionBehavior(eventBus,modeling,bpmnRules){function fixConnection(connection){var source=connection.source,target=connection.target;if(connection.parent){var replacementType,remove;is(connection,"bpmn:SequenceFlow")&&(bpmnRules.canConnectSequenceFlow(source,target)||(remove=!0),bpmnRules.canConnectMessageFlow(source,target)&&(replacementType="bpmn:MessageFlow")),is(connection,"bpmn:MessageFlow")&&(bpmnRules.canConnectMessageFlow(source,target)||(remove=!0),bpmnRules.canConnectSequenceFlow(source,target)&&(replacementType="bpmn:SequenceFlow")),is(connection,"bpmn:Association")&&!bpmnRules.canConnectAssociation(source,target)&&(remove=!0),remove&&modeling.removeConnection(connection),replacementType&&modeling.connect(source,target,{type:replacementType,waypoints:connection.waypoints.slice()})}}CommandInterceptor.call(this,eventBus),this.postExecuted("elements.move",function(context){var closure=context.closure,allConnections=closure.allConnections;forEach(allConnections,fixConnection)},!0),this.postExecuted(["connection.reconnectStart","connection.reconnectEnd"],function(event){fixConnection(event.context.connection)}),this.postExecuted("element.updateProperties",function(event){var connection,context=event.context,properties=context.properties,element=context.element,businessObject=element.businessObject;properties.default&&(connection=find(element.outgoing,{id:element.businessObject.default.id}))&&modeling.updateProperties(connection,{conditionExpression:void 0}),properties.conditionExpression&&businessObject.sourceRef.default===businessObject&&modeling.updateProperties(element.source,{default:void 0})})}var forEach=_dereq_(464),find=_dereq_(463),inherits=_dereq_(451),CommandInterceptor=_dereq_(292),is=_dereq_(269).is;inherits(ReplaceConnectionBehavior,CommandInterceptor),ReplaceConnectionBehavior.$inject=["eventBus","modeling","bpmnRules"],module.exports=ReplaceConnectionBehavior},{269:269,292:292,451:451,463:463,464:464}],227:[function(_dereq_,module,exports){"use strict";function ReplaceElementBehaviour(eventBus,bpmnReplace,bpmnRules,elementRegistry,selection,modeling){CommandInterceptor.call(this,eventBus),this._bpmnReplace=bpmnReplace,this._elementRegistry=elementRegistry,this._selection=selection,this._modeling=modeling,this.postExecuted(["elements.move"],500,function(event){var context=event.context,target=context.newParent,newHost=context.newHost,elements=[];forEach(context.closure.topLevel,function(topLevelElements){elements=isEventSubProcess(topLevelElements)?elements.concat(topLevelElements.children):elements.concat(topLevelElements)}),1===elements.length&&newHost&&(target=newHost);var canReplace=bpmnRules.canReplace(elements,target);canReplace&&this.replaceElements(elements,canReplace.replacements,newHost)},this),this.postExecute(["shape.replace"],1500,function(e){var canReplace,context=e.context,oldShape=context.oldShape,newShape=context.newShape,attachers=oldShape.attachers;modeling.unclaimId(oldShape.businessObject.id,oldShape.businessObject),modeling.claimId(newShape.businessObject.id,newShape.businessObject),attachers&&attachers.length&&(canReplace=bpmnRules.canReplace(attachers,newShape),this.replaceElements(attachers,canReplace.replacements))},this)}var inherits=_dereq_(451),CommandInterceptor=_dereq_(292),forEach=_dereq_(464),isEventSubProcess=_dereq_(267).isEventSubProcess,is=_dereq_(269).is;inherits(ReplaceElementBehaviour,CommandInterceptor),ReplaceElementBehaviour.prototype.replaceElements=function(elements,newElements,newHost){var elementRegistry=this._elementRegistry,bpmnReplace=this._bpmnReplace,selection=this._selection,modeling=this._modeling;forEach(newElements,function(replacement){var newElement={type:replacement.newElementType},oldElement=elementRegistry.get(replacement.oldElementId);newHost&&is(oldElement,"bpmn:BoundaryEvent")&&modeling.updateAttachment(oldElement,null);var idx=elements.indexOf(oldElement);elements[idx]=bpmnReplace.replaceElement(oldElement,newElement,{select:!1}),newHost&&is(elements[idx],"bpmn:BoundaryEvent")&&modeling.updateAttachment(elements[idx],newHost)}),newElements&&selection.select(elements)},ReplaceElementBehaviour.$inject=["eventBus","bpmnReplace","bpmnRules","elementRegistry","selection","modeling"],module.exports=ReplaceElementBehaviour},{267:267,269:269,292:292,451:451,464:464}],228:[function(_dereq_,module,exports){"use strict";function ResizeLaneBehavior(eventBus,modeling){eventBus.on("resize.start",SLIGHTLY_HIGHER_PRIORITY+500,function(event){var context=event.context,shape=context.shape;(is(shape,"bpmn:Lane")||is(shape,"bpmn:Participant"))&&(context.balanced=!hasPrimaryModifier(event))}),eventBus.on("resize.end",SLIGHTLY_HIGHER_PRIORITY,function(event){var context=event.context,shape=context.shape,canExecute=context.canExecute,newBounds=context.newBounds;if(is(shape,"bpmn:Lane")||is(shape,"bpmn:Participant"))return canExecute&&(newBounds=roundBounds(newBounds),modeling.resizeLane(shape,newBounds,context.balanced)),!1})}var is=_dereq_(269).is,roundBounds=_dereq_(414).roundBounds,hasPrimaryModifier=_dereq_(435).hasPrimaryModifier,SLIGHTLY_HIGHER_PRIORITY=1001;ResizeLaneBehavior.$inject=["eventBus","modeling"],module.exports=ResizeLaneBehavior},{269:269,414:414,435:435}],229:[function(_dereq_,module,exports){"use strict";function UnclaimIdBehavior(eventBus,modeling){CommandInterceptor.call(this,eventBus),this.preExecute("elements.delete",function(event){var context=event.context,elements=context.elements;forEach(elements,function(element){modeling.unclaimId(element.businessObject.id,element.businessObject)})})}var forEach=_dereq_(464),inherits=_dereq_(451),CommandInterceptor=_dereq_(292);inherits(UnclaimIdBehavior,CommandInterceptor),UnclaimIdBehavior.$inject=["eventBus","modeling"],module.exports=UnclaimIdBehavior},{292:292,451:451,464:464}],230:[function(_dereq_,module,exports){"use strict";function DeleteSequenceFlowBehavior(eventBus,modeling){CommandInterceptor.call(this,eventBus),this.preExecute("connection.delete",function(event){var context=event.context,connection=context.connection,source=connection.source;isDefaultFlow(connection,source)&&modeling.updateProperties(source,{default:null})})}function isDefaultFlow(connection,source){if(!is(connection,"bpmn:SequenceFlow"))return!1;var sourceBo=getBusinessObject(source),sequenceFlow=getBusinessObject(connection);return sourceBo.get("default")===sequenceFlow}var inherits=_dereq_(451),CommandInterceptor=_dereq_(292),is=_dereq_(269).is,getBusinessObject=_dereq_(269).getBusinessObject;inherits(DeleteSequenceFlowBehavior,CommandInterceptor),DeleteSequenceFlowBehavior.$inject=["eventBus","modeling"],module.exports=DeleteSequenceFlowBehavior},{269:269,292:292,451:451}],231:[function(_dereq_,module,exports){"use strict";function UpdateFlowNodeRefsBehavior(eventBus,modeling,translate){function initContext(){return context=context||new UpdateContext,context.enter(),context}function getContext(){if(!context)throw new Error(translate("out of bounds release"));return context}function releaseContext(){if(!context)throw new Error(translate("out of bounds release"));var triggerUpdate=context.leave();return triggerUpdate&&(modeling.updateLaneRefs(context.flowNodes,context.lanes),context=null),triggerUpdate}CommandInterceptor.call(this,eventBus);var context,laneRefUpdateEvents=["spaceTool","lane.add","lane.resize","lane.split","elements.move","elements.delete","shape.create","shape.delete","shape.move","shape.resize"];this.preExecute(laneRefUpdateEvents,HIGH_PRIORITY,function(event){initContext()}),this.postExecuted(laneRefUpdateEvents,LOW_PRIORITY,function(event){releaseContext()}),this.preExecute(["shape.create","shape.move","shape.delete","shape.resize"],function(event){var context=event.context,shape=context.shape,updateContext=getContext();shape.labelTarget||(is(shape,"bpmn:Lane")&&updateContext.addLane(shape),is(shape,"bpmn:FlowNode")&&updateContext.addFlowNode(shape))})}function UpdateContext(){this.flowNodes=[],this.lanes=[],this.counter=0,this.addLane=function(lane){this.lanes.push(lane)},this.addFlowNode=function(flowNode){this.flowNodes.push(flowNode)},this.enter=function(){this.counter++},this.leave=function(){return!--this.counter}}var inherits=_dereq_(451),CommandInterceptor=_dereq_(292),is=_dereq_(269).is,LOW_PRIORITY=500,HIGH_PRIORITY=5e3;UpdateFlowNodeRefsBehavior.$inject=["eventBus","modeling","translate"],inherits(UpdateFlowNodeRefsBehavior,CommandInterceptor),module.exports=UpdateFlowNodeRefsBehavior},{269:269,292:292,451:451}],232:[function(_dereq_,module,exports){module.exports={__init__:["appendBehavior","copyPasteBehavior","createBoundaryEventBehavior","createDataObjectBehavior","createOnFlowBehavior","createParticipantBehavior","dataInputAssociationBehavior","deleteLaneBehavior","labelBehavior","modelingFeedback","removeParticipantBehavior","replaceConnectionBehavior","replaceElementBehaviour","resizeLaneBehavior","unsetDefaultFlowBehavior","updateFlowNodeRefsBehavior","removeElementBehavior","unclaimIdBehavior"],appendBehavior:["type",_dereq_(214)],copyPasteBehavior:["type",_dereq_(215)],createBoundaryEventBehavior:["type",_dereq_(216)],createDataObjectBehavior:["type",_dereq_(217)],createOnFlowBehavior:["type",_dereq_(218)],createParticipantBehavior:["type",_dereq_(219)],dataInputAssociationBehavior:["type",_dereq_(220)],deleteLaneBehavior:["type",_dereq_(221)],labelBehavior:["type",_dereq_(222)],modelingFeedback:["type",_dereq_(223)],removeParticipantBehavior:["type",_dereq_(225)],replaceConnectionBehavior:["type",_dereq_(226)],replaceElementBehaviour:["type",_dereq_(227)],resizeLaneBehavior:["type",_dereq_(228)],unsetDefaultFlowBehavior:["type",_dereq_(230)],updateFlowNodeRefsBehavior:["type",_dereq_(231)],removeElementBehavior:["type",_dereq_(224)],unclaimIdBehavior:["type",_dereq_(229)]}},{214:214,215:215,216:216,217:217,218:218,219:219,220:220,221:221,222:222,223:223,224:224,225:225,226:226,227:227,228:228,229:229,230:230,231:231}],233:[function(_dereq_,module,exports){"use strict";function AddLaneHandler(modeling,spaceTool){this._modeling=modeling,this._spaceTool=spaceTool}var filter=_dereq_(462),Elements=_dereq_(428),getLanesRoot=_dereq_(241).getLanesRoot,getChildLanes=_dereq_(241).getChildLanes,LANE_INDENTATION=_dereq_(241).LANE_INDENTATION;AddLaneHandler.$inject=["modeling","spaceTool"],module.exports=AddLaneHandler,AddLaneHandler.prototype.preExecute=function(context){var spaceTool=this._spaceTool,modeling=this._modeling,shape=context.shape,location=context.location,lanesRoot=getLanesRoot(shape),isRoot=lanesRoot===shape,laneParent=isRoot?shape:shape.parent;getChildLanes(laneParent).length||modeling.createShape({type:"bpmn:Lane"},{x:shape.x+LANE_INDENTATION,y:shape.y,width:shape.width-LANE_INDENTATION,height:shape.height},laneParent);var allAffected=[];Elements.eachElement(lanesRoot,function(element){return allAffected.push(element),element===shape?[]:filter(element.children,function(c){return c!==shape})});var offset="top"===location?-120:120,lanePosition="top"===location?shape.y:shape.y+shape.height,spacePos=lanePosition+("top"===location?10:-10),direction="top"===location?"n":"s",adjustments=spaceTool.calculateAdjustments(allAffected,"y",offset,spacePos);spaceTool.makeSpace(adjustments.movingShapes,adjustments.resizingShapes,{x:0,y:offset},direction),context.newLane=modeling.createShape({type:"bpmn:Lane"},{x:shape.x+(isRoot?LANE_INDENTATION:0),y:lanePosition-("top"===location?120:0),width:shape.width-(isRoot?LANE_INDENTATION:0),height:120},laneParent)}},{241:241,428:428,462:462}],234:[function(_dereq_,module,exports){"use strict";function IdClaimHandler(moddle){this._moddle=moddle}IdClaimHandler.$inject=["moddle"],module.exports=IdClaimHandler,IdClaimHandler.prototype.execute=function(context){var ids=this._moddle.ids,id=context.id,element=context.element;context.claiming?ids.claim(id,element):ids.unclaim(id)},IdClaimHandler.prototype.revert=function(context){var ids=this._moddle.ids,id=context.id,element=context.element;context.claiming?ids.unclaim(id):ids.claim(id,element)}},{}],235:[function(_dereq_,module,exports){"use strict";function ResizeLaneHandler(modeling,spaceTool){this._modeling=modeling,this._spaceTool=spaceTool}var is=_dereq_(269).is,getLanesRoot=_dereq_(241).getLanesRoot,computeLanesResize=_dereq_(241).computeLanesResize,eachElement=_dereq_(428).eachElement,asTRBL=_dereq_(414).asTRBL,substractTRBL=_dereq_(384).substractTRBL;ResizeLaneHandler.$inject=["modeling","spaceTool"],module.exports=ResizeLaneHandler,ResizeLaneHandler.prototype.preExecute=function(context){var shape=context.shape,newBounds=context.newBounds;!1!==context.balanced?this.resizeBalanced(shape,newBounds):this.resizeSpace(shape,newBounds)},ResizeLaneHandler.prototype.resizeBalanced=function(shape,newBounds){var modeling=this._modeling,resizeNeeded=computeLanesResize(shape,newBounds);modeling.resizeShape(shape,newBounds),resizeNeeded.forEach(function(r){modeling.resizeShape(r.shape,r.newBounds)})},ResizeLaneHandler.prototype.resizeSpace=function(shape,newBounds){var spaceTool=this._spaceTool,shapeTrbl=asTRBL(shape),newTrbl=asTRBL(newBounds),trblDiff=substractTRBL(newTrbl,shapeTrbl),lanesRoot=getLanesRoot(shape),allAffected=[],allLanes=[];eachElement(lanesRoot,function(element){return allAffected.push(element),(is(element,"bpmn:Lane")||is(element,"bpmn:Participant"))&&allLanes.push(element),element.children});var change,spacePos,direction,offset,adjustments;(trblDiff.bottom||trblDiff.top)&&(change=trblDiff.bottom||trblDiff.top,spacePos=shape.y+(trblDiff.bottom?shape.height:0)+(trblDiff.bottom?-10:10),direction=trblDiff.bottom?"s":"n",offset=trblDiff.top>0||trblDiff.bottom<0?-change:change,adjustments=spaceTool.calculateAdjustments(allAffected,"y",offset,spacePos),spaceTool.makeSpace(adjustments.movingShapes,adjustments.resizingShapes,{x:0,y:change},direction)),(trblDiff.left||trblDiff.right)&&(change=trblDiff.right||trblDiff.left,spacePos=shape.x+(trblDiff.right?shape.width:0)+(trblDiff.right?-10:100),direction=trblDiff.right?"e":"w",offset=trblDiff.left>0||trblDiff.right<0?-change:change,adjustments=spaceTool.calculateAdjustments(allLanes,"x",offset,spacePos),spaceTool.makeSpace(adjustments.movingShapes,adjustments.resizingShapes,{x:change,y:0},direction))}},{241:241,269:269,384:384,414:414,428:428}],236:[function(_dereq_,module,exports){"use strict";function SplitLaneHandler(modeling,translate){this._modeling=modeling,this._translate=translate}var getChildLanes=_dereq_(241).getChildLanes,LANE_INDENTATION=_dereq_(241).LANE_INDENTATION;SplitLaneHandler.$inject=["modeling","translate"],module.exports=SplitLaneHandler,SplitLaneHandler.prototype.preExecute=function(context){var modeling=this._modeling,translate=this._translate,shape=context.shape,newLanesCount=context.count,childLanes=getChildLanes(shape),existingLanesCount=childLanes.length;if(existingLanesCount>newLanesCount)throw new Error(translate("more than {count} child lanes",{count:newLanesCount}));var laneY,laneHeight,laneBounds,newLaneAttrs,idx,newLanesHeight=Math.round(shape.height/newLanesCount);for(idx=0;idx<newLanesCount;idx++)laneY=shape.y+idx*newLanesHeight,laneHeight=idx===newLanesCount-1?shape.height-newLanesHeight*idx:newLanesHeight,laneBounds={x:shape.x+LANE_INDENTATION,y:laneY,width:shape.width-LANE_INDENTATION,height:laneHeight},idx<existingLanesCount?modeling.resizeShape(childLanes[idx],laneBounds):(newLaneAttrs={type:"bpmn:Lane"},modeling.createShape(newLaneAttrs,laneBounds,shape))}},{241:241}],237:[function(_dereq_,module,exports){"use strict";function UpdateCanvasRootHandler(canvas,modeling){this._canvas=canvas,this._modeling=modeling}var Collections=_dereq_(425);UpdateCanvasRootHandler.$inject=["canvas","modeling"],module.exports=UpdateCanvasRootHandler,UpdateCanvasRootHandler.prototype.execute=function(context){var canvas=this._canvas,newRoot=context.newRoot,newRootBusinessObject=newRoot.businessObject,oldRoot=canvas.getRootElement(),oldRootBusinessObject=oldRoot.businessObject,bpmnDefinitions=oldRootBusinessObject.$parent,diPlane=oldRootBusinessObject.di;canvas.setRootElement(newRoot,!0),Collections.add(bpmnDefinitions.rootElements,newRootBusinessObject),newRootBusinessObject.$parent=bpmnDefinitions,Collections.remove(bpmnDefinitions.rootElements,oldRootBusinessObject),oldRootBusinessObject.$parent=null,oldRootBusinessObject.di=null,diPlane.bpmnElement=newRootBusinessObject,newRootBusinessObject.di=diPlane,context.oldRoot=oldRoot},UpdateCanvasRootHandler.prototype.revert=function(context){var canvas=this._canvas,newRoot=context.newRoot,newRootBusinessObject=newRoot.businessObject,oldRoot=context.oldRoot,oldRootBusinessObject=oldRoot.businessObject,bpmnDefinitions=newRootBusinessObject.$parent,diPlane=newRootBusinessObject.di;canvas.setRootElement(oldRoot,!0),Collections.remove(bpmnDefinitions.rootElements,newRootBusinessObject),newRootBusinessObject.$parent=null,Collections.add(bpmnDefinitions.rootElements,oldRootBusinessObject),oldRootBusinessObject.$parent=bpmnDefinitions,newRootBusinessObject.di=null,diPlane.bpmnElement=oldRootBusinessObject,oldRootBusinessObject.di=diPlane}},{425:425}],238:[function(_dereq_,module,exports){"use strict";function UpdateFlowNodeRefsHandler(elementRegistry){this._elementRegistry=elementRegistry}var collectLanes=_dereq_(241).collectLanes,getLanesRoot=_dereq_(241).getLanesRoot,is=_dereq_(269).is,Collections=_dereq_(425),asTRBL=_dereq_(414).asTRBL;UpdateFlowNodeRefsHandler.$inject=["elementRegistry"],module.exports=UpdateFlowNodeRefsHandler,UpdateFlowNodeRefsHandler.prototype.computeUpdates=function(flowNodeShapes,laneShapes){function isInLaneShape(element,laneShape){var laneTrbl=asTRBL(laneShape),elementMid={x:element.x+element.width/2,y:element.y+element.height/2};return elementMid.x>laneTrbl.left&&elementMid.x<laneTrbl.right&&elementMid.y>laneTrbl.top&&elementMid.y<laneTrbl.bottom}function addFlowNodeShape(flowNodeShape){handledNodes[flowNodeShape.id]||(allFlowNodeShapes.push(flowNodeShape),handledNodes[flowNodeShape.id]=flowNodeShape)}function getAllLaneShapes(flowNodeShape){var root=getLanesRoot(flowNodeShape);return participantCache[root.id]||(participantCache[root.id]=collectLanes(root)),participantCache[root.id]}function getNewLanes(flowNodeShape){return flowNodeShape.parent?getAllLaneShapes(flowNodeShape).filter(function(l){return isInLaneShape(flowNodeShape,l)}).map(function(shape){return shape.businessObject}):[]}var handledNodes={},updates=[],participantCache={},allFlowNodeShapes=[];return laneShapes.forEach(function(laneShape){var root=getLanesRoot(laneShape);if(root&&!handledNodes[root.id]){root.children.filter(function(c){return is(c,"bpmn:FlowNode")}).forEach(addFlowNodeShape),handledNodes[root.id]=root}}),flowNodeShapes.forEach(addFlowNodeShape),allFlowNodeShapes.forEach(function(flowNodeShape){var flowNode=flowNodeShape.businessObject,lanes=flowNode.get("lanes"),remove=lanes.slice(),add=getNewLanes(flowNodeShape);updates.push({flowNode:flowNode,remove:remove,add:add})}),laneShapes.forEach(function(laneShape){var lane=laneShape.businessObject;laneShape.parent||lane.get("flowNodeRef").forEach(function(flowNode){updates.push({flowNode:flowNode,remove:[lane],add:[]})})}),updates},UpdateFlowNodeRefsHandler.prototype.execute=function(context){var updates=context.updates;updates||(updates=context.updates=this.computeUpdates(context.flowNodeShapes,context.laneShapes)),updates.forEach(function(update){var flowNode=update.flowNode,lanes=flowNode.get("lanes");update.remove.forEach(function(oldLane){Collections.remove(lanes,oldLane),Collections.remove(oldLane.get("flowNodeRef"),flowNode)}),update.add.forEach(function(newLane){Collections.add(lanes,newLane),Collections.add(newLane.get("flowNodeRef"),flowNode)})})},UpdateFlowNodeRefsHandler.prototype.revert=function(context){context.updates.forEach(function(update){var flowNode=update.flowNode,lanes=flowNode.get("lanes");update.add.forEach(function(newLane){Collections.remove(lanes,newLane),Collections.remove(newLane.get("flowNodeRef"),flowNode)}),update.remove.forEach(function(oldLane){Collections.add(lanes,oldLane),Collections.add(oldLane.get("flowNodeRef"),flowNode)})})}},{241:241,269:269,414:414,425:425}],239:[function(_dereq_,module,exports){"use strict";function UpdatePropertiesHandler(elementRegistry,moddle,translate){this._elementRegistry=elementRegistry,this._moddle=moddle,this._translate=translate}function isIdChange(properties,businessObject){return ID in properties&&properties[ID]!==businessObject[ID]}function getProperties(businessObject,propertyNames){return reduce(propertyNames,function(result,key){return result[key]=businessObject.get(key),result},{})}function setProperties(businessObject,properties){forEach(properties,function(value,key){businessObject.set(key,value)})}function unwrapBusinessObjects(properties){var unwrappedProps=assign({},properties);return referencePropertyNames.forEach(function(name){
name in properties&&(unwrappedProps[name]=getBusinessObject(unwrappedProps[name]))}),unwrappedProps}var reduce=_dereq_(599),keys=_dereq_(593),forEach=_dereq_(464),assign=_dereq_(592),getBusinessObject=_dereq_(269).getBusinessObject,ID="id";UpdatePropertiesHandler.$inject=["elementRegistry","moddle","translate"],module.exports=UpdatePropertiesHandler,UpdatePropertiesHandler.prototype.execute=function(context){var element=context.element,changed=[element],translate=this._translate;if(!element)throw new Error(translate("element required"));var elementRegistry=this._elementRegistry,ids=this._moddle.ids,businessObject=element.businessObject,properties=unwrapBusinessObjects(context.properties),oldProperties=context.oldProperties||getProperties(businessObject,keys(properties));return isIdChange(properties,businessObject)&&(ids.unclaim(businessObject[ID]),elementRegistry.updateId(element,properties[ID]),ids.claim(properties[ID],businessObject)),"default"in properties&&(properties.default&&changed.push(elementRegistry.get(properties.default.id)),businessObject.default&&changed.push(elementRegistry.get(businessObject.default.id))),"name"in properties&&element.label&&(changed.push(element.label),element.label.hidden=!properties.name),setProperties(businessObject,properties),context.oldProperties=oldProperties,context.changed=changed,changed},UpdatePropertiesHandler.prototype.revert=function(context){var element=context.element,properties=context.properties,oldProperties=context.oldProperties,businessObject=element.businessObject,elementRegistry=this._elementRegistry,ids=this._moddle.ids;return setProperties(businessObject,oldProperties),isIdChange(properties,businessObject)&&(ids.unclaim(properties[ID]),elementRegistry.updateId(element,oldProperties[ID]),ids.claim(oldProperties[ID],businessObject)),context.changed};var referencePropertyNames=["default"]},{269:269,464:464,592:592,593:593,599:599}],240:[function(_dereq_,module,exports){module.exports={__init__:["modeling","bpmnUpdater"],__depends__:[_dereq_(232),_dereq_(208),_dereq_(256),_dereq_(244),_dereq_(254),_dereq_(294),_dereq_(406),_dereq_(341),_dereq_(306),_dereq_(395),_dereq_(316),_dereq_(402)],bpmnFactory:["type",_dereq_(209)],bpmnUpdater:["type",_dereq_(211)],elementFactory:["type",_dereq_(212)],modeling:["type",_dereq_(213)],layouter:["type",_dereq_(210)],connectionDocking:["type",_dereq_(413)]}},{208:208,209:209,210:210,211:211,212:212,213:213,232:232,244:244,254:254,256:256,294:294,306:306,316:316,341:341,395:395,402:402,406:406,413:413}],241:[function(_dereq_,module,exports){"use strict";function getTRBLResize(oldBounds,newBounds){return substractTRBL(asTRBL(newBounds),asTRBL(oldBounds))}function collectLanes(shape,collectedShapes){return collectedShapes=collectedShapes||[],shape.children.filter(function(s){is(s,"bpmn:Lane")&&(collectLanes(s,collectedShapes),collectedShapes.push(s))}),collectedShapes}function getChildLanes(shape){return shape.children.filter(function(c){return is(c,"bpmn:Lane")})}function getLanesRoot(shape){return getParent(shape,LANE_PARENTS)||shape}function computeLanesResize(shape,newBounds){var rootElement=getLanesRoot(shape),initialShapes=is(rootElement,"bpmn:Process")?[]:[rootElement],allLanes=collectLanes(rootElement,initialShapes),shapeTrbl=asTRBL(shape),shapeNewTrbl=asTRBL(newBounds),trblResize=getTRBLResize(shape,newBounds),resizeNeeded=[];return allLanes.forEach(function(other){if(other!==shape){var topResize=0,rightResize=trblResize.right,bottomResize=0,leftResize=trblResize.left,otherTrbl=asTRBL(other);trblResize.top&&(abs(otherTrbl.bottom-shapeTrbl.top)<10&&(bottomResize=shapeNewTrbl.top-otherTrbl.bottom),abs(otherTrbl.top-shapeTrbl.top)<5&&(topResize=shapeNewTrbl.top-otherTrbl.top)),trblResize.bottom&&(abs(otherTrbl.top-shapeTrbl.bottom)<10&&(topResize=shapeNewTrbl.bottom-otherTrbl.top),abs(otherTrbl.bottom-shapeTrbl.bottom)<5&&(bottomResize=shapeNewTrbl.bottom-otherTrbl.bottom)),(topResize||rightResize||bottomResize||leftResize)&&resizeNeeded.push({shape:other,newBounds:resizeTRBL(other,{top:topResize,right:rightResize,bottom:bottomResize,left:leftResize})})}}),resizeNeeded}var is=_dereq_(269).is,getParent=_dereq_(242).getParent,asTRBL=_dereq_(414).asTRBL,substractTRBL=_dereq_(384).substractTRBL,resizeTRBL=_dereq_(384).resizeTRBL,abs=Math.abs,LANE_PARENTS=["bpmn:Participant","bpmn:Process","bpmn:SubProcess"];module.exports.LANE_INDENTATION=30,module.exports.collectLanes=collectLanes,module.exports.getChildLanes=getChildLanes,module.exports.getLanesRoot=getLanesRoot,module.exports.computeLanesResize=computeLanesResize},{242:242,269:269,384:384,414:414}],242:[function(_dereq_,module,exports){"use strict";function getParents(element){for(var parents=[];element;)(element=element.parent)&&parents.push(element);return parents}function isAny(element,types){return any(types,function(t){return is(element,t)})}function getParent(element,anyType){for("string"==typeof anyType&&(anyType=[anyType]);element=element.parent;)if(isAny(element,anyType))return element;return null}var any=_dereq_(460),is=_dereq_(269).is;module.exports.getParents=getParents,module.exports.isAny=isAny,module.exports.getParent=getParent},{269:269,460:460}],243:[function(_dereq_,module,exports){"use strict";function BpmnOrderingProvider(eventBus,translate){function computeOrder(element){var entry=find(orders,function(o){return isAny(element,[o.type])});return entry&&entry.order||{level:1}}function getOrder(element){var order=element.order;return order||(element.order=order=computeOrder(element)),order}function findActualParent(element,newParent,containers){for(var actualParent=newParent;actualParent&&!isAny(actualParent,containers);)actualParent=actualParent.parent;if(!actualParent)throw new Error(translate("no parent for {element} in {parent}",{element:element.id,parent:newParent.id}));return actualParent}OrderingProvider.call(this,eventBus);var orders=[{type:"label",order:{level:10}},{type:"bpmn:SubProcess",order:{level:6}},{type:"bpmn:SequenceFlow",order:{level:5,containers:["bpmn:Participant","bpmn:FlowElementsContainer"]}},{type:"bpmn:DataInputAssociation",order:{level:9,containers:["bpmn:Collaboration","bpmn:Process"]}},{type:"bpmn:DataOutputAssociation",order:{level:9,containers:["bpmn:Collaboration","bpmn:Process"]}},{type:"bpmn:MessageFlow",order:{level:9,containers:["bpmn:Collaboration"]}},{type:"bpmn:Association",order:{level:6,containers:["bpmn:Participant","bpmn:FlowElementsContainer","bpmn:Collaboration"]}},{type:"bpmn:BoundaryEvent",order:{level:8}},{type:"bpmn:Participant",order:{level:-2}},{type:"bpmn:Lane",order:{level:-1}}];this.getOrdering=function(element,newParent){var elementOrder=getOrder(element);elementOrder.containers&&(newParent=findActualParent(element,newParent,elementOrder.containers));var currentIndex=newParent.children.indexOf(element),insertIndex=findIndex(newParent.children,function(child){return!(!element.labelTarget&&child.labelTarget)&&elementOrder.level<getOrder(child).level});return-1!==insertIndex&&-1!==currentIndex&&currentIndex<insertIndex&&(insertIndex-=1),{index:insertIndex,parent:newParent}}}var inherits=_dereq_(451),OrderingProvider=_dereq_(371),isAny=_dereq_(242).isAny,findIndex=_dereq_(452),find=_dereq_(463);BpmnOrderingProvider.$inject=["eventBus","translate"],inherits(BpmnOrderingProvider,OrderingProvider),module.exports=BpmnOrderingProvider},{242:242,371:371,451:451,452:452,463:463}],244:[function(_dereq_,module,exports){module.exports={__init__:["bpmnOrderingProvider"],__depends__:[_dereq_(410)],bpmnOrderingProvider:["type",_dereq_(243)]}},{243:243,410:410}],245:[function(_dereq_,module,exports){"use strict";function PaletteProvider(palette,create,elementFactory,spaceTool,lassoTool,handTool,globalConnect,translate){this._palette=palette,this._create=create,this._elementFactory=elementFactory,this._spaceTool=spaceTool,this._lassoTool=lassoTool,this._handTool=handTool,this._globalConnect=globalConnect,this._translate=translate,palette.registerProvider(this)}var assign=_dereq_(592);module.exports=PaletteProvider,PaletteProvider.$inject=["palette","create","elementFactory","spaceTool","lassoTool","handTool","globalConnect","translate"],PaletteProvider.prototype.getPaletteEntries=function(element){function createAction(type,group,className,title,options){function createListener(event){var shape=elementFactory.createShape(assign({type:type},options));options&&(shape.businessObject.di.isExpanded=options.isExpanded),create.start(event,shape)}var shortType=type.replace(/^bpmn\:/,"");return{group:group,className:className,title:title||translate("Create {type}",{type:translate(shortType)}),action:{dragstart:createListener,click:createListener}}}function createParticipant(event,collapsed){create.start(event,elementFactory.createParticipantShape(collapsed))}var actions={},create=this._create,elementFactory=this._elementFactory,spaceTool=this._spaceTool,lassoTool=this._lassoTool,handTool=this._handTool,globalConnect=this._globalConnect,translate=this._translate;return assign(actions,{"hand-tool":{group:"tools",className:"bpmn-icon-hand-tool",title:translate("Activate the hand tool"),action:{click:function(event){handTool.activateHand(event)}}},"lasso-tool":{group:"tools",className:"bpmn-icon-lasso-tool",title:translate("Activate the lasso tool"),action:{click:function(event){lassoTool.activateSelection(event)}}},"space-tool":{group:"tools",className:"bpmn-icon-space-tool",title:translate("Activate the create/remove space tool"),action:{click:function(event){spaceTool.activateSelection(event)}}},"global-connect-tool":{group:"tools",className:"bpmn-icon-connection-multi",title:translate("Activate the global connect tool"),action:{click:function(event){globalConnect.toggle(event)}}},"tool-separator":{group:"tools",separator:!0},"create.start-event":createAction("bpmn:StartEvent","event","bpmn-icon-start-event-none"),"create.intermediate-event":createAction("bpmn:IntermediateThrowEvent","event","bpmn-icon-intermediate-event-none",translate("Create IntermediateThrowEvent/BoundaryEvent")),"create.end-event":createAction("bpmn:EndEvent","event","bpmn-icon-end-event-none"),"create.exclusive-gateway":createAction("bpmn:ExclusiveGateway","gateway","bpmn-icon-gateway-xor"),"create.task":createAction("bpmn:Task","activity","bpmn-icon-task"),"create.data-object":createAction("bpmn:DataObjectReference","data-object","bpmn-icon-data-object"),"create.data-store":createAction("bpmn:DataStoreReference","data-store","bpmn-icon-data-store"),"create.subprocess-expanded":createAction("bpmn:SubProcess","activity","bpmn-icon-subprocess-expanded",translate("Create expanded SubProcess"),{isExpanded:!0}),"create.participant-expanded":{group:"collaboration",className:"bpmn-icon-participant",title:translate("Create Pool/Participant"),action:{dragstart:createParticipant,click:createParticipant}}}),actions}},{592:592}],246:[function(_dereq_,module,exports){module.exports={__depends__:[_dereq_(377),_dereq_(326),_dereq_(402),_dereq_(343),_dereq_(335),_dereq_(410),_dereq_(202)],__init__:["paletteProvider"],paletteProvider:["type",_dereq_(245)]}},{202:202,245:245,326:326,335:335,343:343,377:377,402:402,410:410}],247:[function(_dereq_,module,exports){"use strict";function ReplaceMenuProvider(popupMenu,modeling,moddle,bpmnReplace,rules,translate){this._popupMenu=popupMenu,this._modeling=modeling,this._moddle=moddle,this._bpmnReplace=bpmnReplace,this._rules=rules,this._translate=translate,this.register()}var is=_dereq_(269).is,isEventSubProcess=_dereq_(267).isEventSubProcess,getBusinessObject=_dereq_(269).getBusinessObject,isExpanded=_dereq_(267).isExpanded,isDifferentType=_dereq_(249).isDifferentType,forEach=_dereq_(464),filter=_dereq_(462),replaceOptions=_dereq_(253);ReplaceMenuProvider.$inject=["popupMenu","modeling","moddle","bpmnReplace","rules","translate"],ReplaceMenuProvider.prototype.register=function(){this._popupMenu.registerProvider("bpmn-replace",this)},ReplaceMenuProvider.prototype.getEntries=function(element){var entries,businessObject=element.businessObject,rules=this._rules;if(!rules.allowed("shape.replace",{element:element}))return[];var differentType=isDifferentType(element);return is(businessObject,"bpmn:StartEvent")&&!isEventSubProcess(businessObject.$parent)?(entries=filter(replaceOptions.START_EVENT,differentType),this._createEntries(element,entries)):is(businessObject,"bpmn:Participant")?(entries=filter(replaceOptions.PARTICIPANT,function(entry){return isExpanded(businessObject)!==entry.target.isExpanded}),this._createEntries(element,entries)):is(businessObject,"bpmn:StartEvent")&&isEventSubProcess(businessObject.$parent)?(entries=filter(replaceOptions.EVENT_SUB_PROCESS_START_EVENT,function(entry){var target=entry.target,isInterrupting=!1!==target.isInterrupting,isInterruptingEqual=getBusinessObject(element).isInterrupting===isInterrupting;return differentType(entry)||!differentType(entry)&&!isInterruptingEqual}),this._createEntries(element,entries)):is(businessObject,"bpmn:EndEvent")?(entries=filter(replaceOptions.END_EVENT,function(entry){return!("bpmn:CancelEventDefinition"==entry.target.eventDefinition&&!is(businessObject.$parent,"bpmn:Transaction"))&&differentType(entry)}),this._createEntries(element,entries)):is(businessObject,"bpmn:BoundaryEvent")?(entries=filter(replaceOptions.BOUNDARY_EVENT,function(entry){var target=entry.target;if("bpmn:CancelEventDefinition"==target.eventDefinition&&!is(businessObject.attachedToRef,"bpmn:Transaction"))return!1;var cancelActivity=!1!==target.cancelActivity,isCancelActivityEqual=businessObject.cancelActivity==cancelActivity;return differentType(entry)||!differentType(entry)&&!isCancelActivityEqual}),this._createEntries(element,entries)):is(businessObject,"bpmn:IntermediateCatchEvent")||is(businessObject,"bpmn:IntermediateThrowEvent")?(entries=filter(replaceOptions.INTERMEDIATE_EVENT,differentType),this._createEntries(element,entries)):is(businessObject,"bpmn:Gateway")?(entries=filter(replaceOptions.GATEWAY,differentType),this._createEntries(element,entries)):is(businessObject,"bpmn:Transaction")?(entries=filter(replaceOptions.TRANSACTION,differentType),this._createEntries(element,entries)):isEventSubProcess(businessObject)&&isExpanded(businessObject)?(entries=filter(replaceOptions.EVENT_SUB_PROCESS,differentType),this._createEntries(element,entries)):is(businessObject,"bpmn:SubProcess")&&isExpanded(businessObject)?(entries=filter(replaceOptions.SUBPROCESS_EXPANDED,differentType),this._createEntries(element,entries)):is(businessObject,"bpmn:AdHocSubProcess")&&!isExpanded(businessObject)?(entries=filter(replaceOptions.TASK,function(entry){var target=entry.target,isTargetSubProcess="bpmn:SubProcess"===target.type,isTargetExpanded=!0===target.isExpanded;return isDifferentType(element,target)&&(!isTargetSubProcess||isTargetExpanded)}),this._createEntries(element,entries)):is(businessObject,"bpmn:SequenceFlow")?this._createSequenceFlowEntries(element,replaceOptions.SEQUENCE_FLOW):is(businessObject,"bpmn:FlowNode")?(entries=filter(replaceOptions.TASK,differentType),businessObject.isForCompensation&&(entries=filter(entries,function(entry){return!/CallActivity/.test(entry.target.type)})),this._createEntries(element,entries)):[]},ReplaceMenuProvider.prototype.getHeaderEntries=function(element){var headerEntries=[];return is(element,"bpmn:Activity")&&!isEventSubProcess(element)&&(headerEntries=headerEntries.concat(this._getLoopEntries(element))),!is(element,"bpmn:SubProcess")||is(element,"bpmn:Transaction")||isEventSubProcess(element)||headerEntries.push(this._getAdHocEntry(element)),headerEntries},ReplaceMenuProvider.prototype._createEntries=function(element,replaceOptions){var menuEntries=[],self=this;return forEach(replaceOptions,function(definition){var entry=self._createMenuEntry(definition,element);menuEntries.push(entry)}),menuEntries},ReplaceMenuProvider.prototype._createSequenceFlowEntries=function(element,replaceOptions){var businessObject=getBusinessObject(element),menuEntries=[],modeling=this._modeling,moddle=this._moddle,self=this;return forEach(replaceOptions,function(entry){switch(entry.actionName){case"replace-with-default-flow":businessObject.sourceRef.default!==businessObject&&(is(businessObject.sourceRef,"bpmn:ExclusiveGateway")||is(businessObject.sourceRef,"bpmn:InclusiveGateway")||is(businessObject.sourceRef,"bpmn:Activity"))&&menuEntries.push(self._createMenuEntry(entry,element,function(){modeling.updateProperties(element.source,{default:businessObject})}));break;case"replace-with-conditional-flow":!businessObject.conditionExpression&&is(businessObject.sourceRef,"bpmn:Activity")&&menuEntries.push(self._createMenuEntry(entry,element,function(){var conditionExpression=moddle.create("bpmn:FormalExpression",{body:""});modeling.updateProperties(element,{conditionExpression:conditionExpression})}));break;default:if(is(businessObject.sourceRef,"bpmn:Activity")&&businessObject.conditionExpression)return menuEntries.push(self._createMenuEntry(entry,element,function(){modeling.updateProperties(element,{conditionExpression:void 0})}));if((is(businessObject.sourceRef,"bpmn:ExclusiveGateway")||is(businessObject.sourceRef,"bpmn:InclusiveGateway")||is(businessObject.sourceRef,"bpmn:Activity"))&&businessObject.sourceRef.default===businessObject)return menuEntries.push(self._createMenuEntry(entry,element,function(){modeling.updateProperties(element.source,{default:void 0})}))}}),menuEntries},ReplaceMenuProvider.prototype._createMenuEntry=function(definition,element,action){var translate=this._translate,replaceElement=this._bpmnReplace.replaceElement,replaceAction=function(){return replaceElement(element,definition.target)};return action=action||replaceAction,{label:translate(definition.label),className:definition.className,id:definition.actionName,action:action}},ReplaceMenuProvider.prototype._getLoopEntries=function(element){function toggleLoopEntry(event,entry){var loopCharacteristics;entry.active?loopCharacteristics=void 0:(loopCharacteristics=self._moddle.create(entry.options.loopCharacteristics),entry.options.isSequential&&(loopCharacteristics.isSequential=entry.options.isSequential)),self._modeling.updateProperties(element,{loopCharacteristics:loopCharacteristics})}var isSequential,isLoop,isParallel,self=this,translate=this._translate,businessObject=getBusinessObject(element),loopCharacteristics=businessObject.loopCharacteristics;return loopCharacteristics&&(isSequential=loopCharacteristics.isSequential,isLoop=void 0===loopCharacteristics.isSequential,isParallel=void 0!==loopCharacteristics.isSequential&&!loopCharacteristics.isSequential),[{id:"toggle-parallel-mi",className:"bpmn-icon-parallel-mi-marker",title:translate("Parallel Multi Instance"),active:isParallel,action:toggleLoopEntry,options:{loopCharacteristics:"bpmn:MultiInstanceLoopCharacteristics",isSequential:!1}},{id:"toggle-sequential-mi",className:"bpmn-icon-sequential-mi-marker",title:translate("Sequential Multi Instance"),active:isSequential,action:toggleLoopEntry,options:{loopCharacteristics:"bpmn:MultiInstanceLoopCharacteristics",isSequential:!0}},{id:"toggle-loop",className:"bpmn-icon-loop-marker",title:translate("Loop"),active:isLoop,action:toggleLoopEntry,options:{loopCharacteristics:"bpmn:StandardLoopCharacteristics"}}]},ReplaceMenuProvider.prototype._getAdHocEntry=function(element){var translate=this._translate,businessObject=getBusinessObject(element),isAdHoc=is(businessObject,"bpmn:AdHocSubProcess"),replaceElement=this._bpmnReplace.replaceElement;return{id:"toggle-adhoc",className:"bpmn-icon-ad-hoc-marker",title:translate("Ad-hoc"),active:isAdHoc,action:function(event,entry){return isAdHoc?replaceElement(element,{type:"bpmn:SubProcess"}):replaceElement(element,{type:"bpmn:AdHocSubProcess"})}}},module.exports=ReplaceMenuProvider},{249:249,253:253,267:267,269:269,462:462,464:464}],248:[function(_dereq_,module,exports){module.exports={__depends__:[_dereq_(379),_dereq_(254)],__init__:["replaceMenuProvider"],replaceMenuProvider:["type",_dereq_(247)]}},{247:247,254:254,379:379}],249:[function(_dereq_,module,exports){"use strict";function isDifferentType(element){return function(entry){var target=entry.target,businessObject=getBusinessObject(element),eventDefinition=businessObject.eventDefinitions&&businessObject.eventDefinitions[0],isTypeEqual=businessObject.$type===target.type,isEventDefinitionEqual=(eventDefinition&&eventDefinition.$type)===target.eventDefinitionType,isTriggeredByEventEqual=void 0===target.triggeredByEvent||businessObject.triggeredByEvent===target.triggeredByEvent,isExpandedEqual=void 0===target.isExpanded||target.isExpanded===isExpanded(businessObject);return!(isTypeEqual&&isEventDefinitionEqual&&isTriggeredByEventEqual&&isExpandedEqual)}}var getBusinessObject=_dereq_(269).getBusinessObject,isExpanded=_dereq_(267).isExpanded;module.exports.isDifferentType=isDifferentType},{267:267,269:269}],250:[function(_dereq_,module,exports){"use strict";function BpmnReplacePreview(eventBus,elementRegistry,elementFactory,canvas,moveVisuals){function replaceVisual(context){var replacements=context.canExecute.replacements;forEach(replacements,function(replacement){var id=replacement.oldElementId,newElement={type:replacement.newElementType};if(!context.visualReplacements[id]){var element=elementRegistry.get(id);assign(newElement,{x:element.x,y:element.y});var tempShape=elementFactory.createShape(newElement);canvas.addShape(tempShape,element.parent);var gfx=context.dragGroup.select("[data-element-id="+element.id+"]");gfx&&gfx.attr({display:"none"});var dragger=moveVisuals.addDragger(context,tempShape);context.visualReplacements[id]=dragger,canvas.removeShape(tempShape)}})}function restoreVisual(context){var visualReplacements=context.visualReplacements;forEach(visualReplacements,function(dragger,id){var originalGfx=context.dragGroup.select("[data-element-id="+id+"]");originalGfx&&originalGfx.attr({display:"inline"}),dragger.remove(),visualReplacements[id]&&delete visualReplacements[id]})}CommandInterceptor.call(this,eventBus),eventBus.on("shape.move.move",LOW_PRIORITY,function(event){var context=event.context,canExecute=context.canExecute;context.visualReplacements||(context.visualReplacements={}),canExecute.replacements?replaceVisual(context):restoreVisual(context)})}var CommandInterceptor=_dereq_(292),inherits=_dereq_(451),assign=_dereq_(592),forEach=_dereq_(464),LOW_PRIORITY=250;BpmnReplacePreview.$inject=["eventBus","elementRegistry","elementFactory","canvas","moveVisuals"],inherits(BpmnReplacePreview,CommandInterceptor),module.exports=BpmnReplacePreview},{292:292,451:451,464:464,592:592}],251:[function(_dereq_,module,exports){module.exports={__depends__:[_dereq_(370)],__init__:["bpmnReplacePreview"],bpmnReplacePreview:["type",_dereq_(250)]}},{250:250,370:370}],252:[function(_dereq_,module,exports){"use strict";function BpmnReplace(bpmnFactory,replace,selection,modeling){function replaceElement(element,target,hints){hints=hints||{};var type=target.type,oldBusinessObject=element.businessObject,newBusinessObject=bpmnFactory.create(type),newElement={type:type,businessObject:newBusinessObject};return target.eventDefinitionType&&(newElement.eventDefinitionType=target.eventDefinitionType),assign(newBusinessObject,pick(target,CUSTOM_PROPERTIES)),is(oldBusinessObject,"bpmn:SubProcess")&&(newElement.isExpanded=isExpanded(oldBusinessObject)),is(oldBusinessObject,"bpmn:AdHocSubProcess")&&target.isExpanded&&(newElement.businessObject=bpmnFactory.create("bpmn:AdHocSubProcess")),is(oldBusinessObject,"bpmn:Activity")&&(!0===target.isExpanded&&(newElement.isExpanded=!0),isExpanded(oldBusinessObject)&&!is(oldBusinessObject,"bpmn:Task")&&target.isExpanded&&(newElement.width=element.width,newElement.height=element.height)),is(oldBusinessObject,"bpmn:Participant")&&(!0===target.isExpanded?newBusinessObject.processRef=bpmnFactory.create("bpmn:Process"):hints.moveChildren=!1,newElement.width=element.width,newElement.height=element.height),newBusinessObject.name=oldBusinessObject.name,isEventSubProcess(newBusinessObject)||(newBusinessObject.loopCharacteristics=oldBusinessObject.loopCharacteristics),(is(oldBusinessObject,"bpmn:ExclusiveGateway")||is(oldBusinessObject,"bpmn:InclusiveGateway")||is(oldBusinessObject,"bpmn:Activity"))&&(is(newBusinessObject,"bpmn:ExclusiveGateway")||is(newBusinessObject,"bpmn:InclusiveGateway")||is(newBusinessObject,"bpmn:Activity"))&&(newBusinessObject.default=oldBusinessObject.default),oldBusinessObject.isForCompensation&&(newBusinessObject.isForCompensation=!0),newElement=replace.replaceElement(element,newElement,hints),!1!==hints.select&&selection.select(newElement),newElement}this.replaceElement=replaceElement}var pick=_dereq_(598),assign=_dereq_(592),is=_dereq_(269).is,isExpanded=_dereq_(267).isExpanded,isEventSubProcess=_dereq_(267).isEventSubProcess,CUSTOM_PROPERTIES=["cancelActivity","instantiate","eventGatewayType","triggeredByEvent","isInterrupting"];BpmnReplace.$inject=["bpmnFactory","replace","selection","modeling"],module.exports=BpmnReplace},{267:267,269:269,592:592,598:598}],253:[function(_dereq_,module,exports){"use strict";module.exports.START_EVENT=[{label:"Start Event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate Throw Event",actionName:"replace-with-none-intermediate-throwing",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End Event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}},{label:"Message Start Event",actionName:"replace-with-message-start",className:"bpmn-icon-start-event-message",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Timer Start Event",actionName:"replace-with-timer-start",className:"bpmn-icon-start-event-timer",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}},{label:"Conditional Start Event",actionName:"replace-with-conditional-start",className:"bpmn-icon-start-event-condition",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}},{label:"Signal Start Event",actionName:"replace-with-signal-start",className:"bpmn-icon-start-event-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}}],module.exports.INTERMEDIATE_EVENT=[{label:"Start Event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate Throw Event",actionName:"replace-with-none-intermediate-throw",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End Event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}},{label:"Message Intermediate Catch Event",actionName:"replace-with-message-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-message",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Message Intermediate Throw Event",actionName:"replace-with-message-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-message",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Timer Intermediate Catch Event",actionName:"replace-with-timer-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-timer",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}},{label:"Escalation Intermediate Throw Event",actionName:"replace-with-escalation-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-escalation",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Conditional Intermediate Catch Event",actionName:"replace-with-conditional-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-condition",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}},{label:"Link Intermediate Catch Event",actionName:"replace-with-link-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-link",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:LinkEventDefinition"}},{label:"Link Intermediate Throw Event",actionName:"replace-with-link-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-link",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:LinkEventDefinition"}},{label:"Compensation Intermediate Throw Event",actionName:"replace-with-compensation-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-compensation",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Signal Intermediate Catch Event",actionName:"replace-with-signal-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-signal",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Signal Intermediate Throw Event",actionName:"replace-with-signal-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-signal",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}}],module.exports.END_EVENT=[{label:"Start Event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate Throw Event",actionName:"replace-with-none-intermediate-throw",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End Event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}},{label:"Message End Event",actionName:"replace-with-message-end",className:"bpmn-icon-end-event-message",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Escalation End Event",actionName:"replace-with-escalation-end",className:"bpmn-icon-end-event-escalation",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Error End Event",actionName:"replace-with-error-end",className:"bpmn-icon-end-event-error",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:ErrorEventDefinition"}},{label:"Cancel End Event",actionName:"replace-with-cancel-end",className:"bpmn-icon-end-event-cancel",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:CancelEventDefinition"}},{label:"Compensation End Event",actionName:"replace-with-compensation-end",className:"bpmn-icon-end-event-compensation",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Signal End Event",actionName:"replace-with-signal-end",className:"bpmn-icon-end-event-signal",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Terminate End Event",actionName:"replace-with-terminate-end",className:"bpmn-icon-end-event-terminate",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:TerminateEventDefinition"}}],module.exports.GATEWAY=[{label:"Exclusive Gateway",actionName:"replace-with-exclusive-gateway",className:"bpmn-icon-gateway-xor",target:{type:"bpmn:ExclusiveGateway"}},{label:"Parallel Gateway",actionName:"replace-with-parallel-gateway",className:"bpmn-icon-gateway-parallel",target:{type:"bpmn:ParallelGateway"}},{label:"Inclusive Gateway",actionName:"replace-with-inclusive-gateway",className:"bpmn-icon-gateway-or",target:{type:"bpmn:InclusiveGateway"}},{label:"Complex Gateway",actionName:"replace-with-complex-gateway",className:"bpmn-icon-gateway-complex",target:{type:"bpmn:ComplexGateway"}},{label:"Event based Gateway",actionName:"replace-with-event-based-gateway",className:"bpmn-icon-gateway-eventbased",target:{type:"bpmn:EventBasedGateway",instantiate:!1,eventGatewayType:"Exclusive"}}],module.exports.SUBPROCESS_EXPANDED=[{label:"Transaction",actionName:"replace-with-transaction",className:"bpmn-icon-transaction",target:{
type:"bpmn:Transaction",isExpanded:!0}},{label:"Event Sub Process",actionName:"replace-with-event-subprocess",className:"bpmn-icon-event-subprocess-expanded",target:{type:"bpmn:SubProcess",triggeredByEvent:!0,isExpanded:!0}}],module.exports.TRANSACTION=[{label:"Sub Process",actionName:"replace-with-subprocess",className:"bpmn-icon-subprocess-expanded",target:{type:"bpmn:SubProcess",isExpanded:!0}},{label:"Event Sub Process",actionName:"replace-with-event-subprocess",className:"bpmn-icon-event-subprocess-expanded",target:{type:"bpmn:SubProcess",triggeredByEvent:!0,isExpanded:!0}}],module.exports.EVENT_SUB_PROCESS=[{label:"Sub Process",actionName:"replace-with-subprocess",className:"bpmn-icon-subprocess-expanded",target:{type:"bpmn:SubProcess",isExpanded:!0}},{label:"Transaction",actionName:"replace-with-transaction",className:"bpmn-icon-transaction",target:{type:"bpmn:Transaction",isExpanded:!0}}],module.exports.TASK=[{label:"Task",actionName:"replace-with-task",className:"bpmn-icon-task",target:{type:"bpmn:Task"}},{label:"Send Task",actionName:"replace-with-send-task",className:"bpmn-icon-send",target:{type:"bpmn:SendTask"}},{label:"Receive Task",actionName:"replace-with-receive-task",className:"bpmn-icon-receive",target:{type:"bpmn:ReceiveTask"}},{label:"User Task",actionName:"replace-with-user-task",className:"bpmn-icon-user",target:{type:"bpmn:UserTask"}},{label:"Manual Task",actionName:"replace-with-manual-task",className:"bpmn-icon-manual",target:{type:"bpmn:ManualTask"}},{label:"Business Rule Task",actionName:"replace-with-rule-task",className:"bpmn-icon-business-rule",target:{type:"bpmn:BusinessRuleTask"}},{label:"Service Task",actionName:"replace-with-service-task",className:"bpmn-icon-service",target:{type:"bpmn:ServiceTask"}},{label:"Script Task",actionName:"replace-with-script-task",className:"bpmn-icon-script",target:{type:"bpmn:ScriptTask"}},{label:"Call Activity",actionName:"replace-with-call-activity",className:"bpmn-icon-call-activity",target:{type:"bpmn:CallActivity"}},{label:"Sub Process (collapsed)",actionName:"replace-with-collapsed-subprocess",className:"bpmn-icon-subprocess-collapsed",target:{type:"bpmn:SubProcess",isExpanded:!1}},{label:"Sub Process (expanded)",actionName:"replace-with-expanded-subprocess",className:"bpmn-icon-subprocess-expanded",target:{type:"bpmn:SubProcess",isExpanded:!0}}],module.exports.BOUNDARY_EVENT=[{label:"Message Boundary Event",actionName:"replace-with-message-boundary",className:"bpmn-icon-intermediate-event-catch-message",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Timer Boundary Event",actionName:"replace-with-timer-boundary",className:"bpmn-icon-intermediate-event-catch-timer",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}},{label:"Escalation Boundary Event",actionName:"replace-with-escalation-boundary",className:"bpmn-icon-intermediate-event-catch-escalation",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Conditional Boundary Event",actionName:"replace-with-conditional-boundary",className:"bpmn-icon-intermediate-event-catch-condition",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}},{label:"Error Boundary Event",actionName:"replace-with-error-boundary",className:"bpmn-icon-intermediate-event-catch-error",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:ErrorEventDefinition"}},{label:"Cancel Boundary Event",actionName:"replace-with-cancel-boundary",className:"bpmn-icon-intermediate-event-catch-cancel",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:CancelEventDefinition"}},{label:"Signal Boundary Event",actionName:"replace-with-signal-boundary",className:"bpmn-icon-intermediate-event-catch-signal",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Compensation Boundary Event",actionName:"replace-with-compensation-boundary",className:"bpmn-icon-intermediate-event-catch-compensation",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Message Boundary Event (non-interrupting)",actionName:"replace-with-non-interrupting-message-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-message",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:MessageEventDefinition",cancelActivity:!1}},{label:"Timer Boundary Event (non-interrupting)",actionName:"replace-with-non-interrupting-timer-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-timer",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:TimerEventDefinition",cancelActivity:!1}},{label:"Escalation Boundary Event (non-interrupting)",actionName:"replace-with-non-interrupting-escalation-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-escalation",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:EscalationEventDefinition",cancelActivity:!1}},{label:"Conditional Boundary Event (non-interrupting)",actionName:"replace-with-non-interrupting-conditional-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-condition",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition",cancelActivity:!1}},{label:"Signal Boundary Event (non-interrupting)",actionName:"replace-with-non-interrupting-signal-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-signal",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:SignalEventDefinition",cancelActivity:!1}}],module.exports.EVENT_SUB_PROCESS_START_EVENT=[{label:"Message Start Event",actionName:"replace-with-message-start",className:"bpmn-icon-start-event-message",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Timer Start Event",actionName:"replace-with-timer-start",className:"bpmn-icon-start-event-timer",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}},{label:"Conditional Start Event",actionName:"replace-with-conditional-start",className:"bpmn-icon-start-event-condition",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}},{label:"Signal Start Event",actionName:"replace-with-signal-start",className:"bpmn-icon-start-event-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Error Start Event",actionName:"replace-with-error-start",className:"bpmn-icon-start-event-error",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ErrorEventDefinition"}},{label:"Escalation Start Event",actionName:"replace-with-escalation-start",className:"bpmn-icon-start-event-escalation",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Compensation Start Event",actionName:"replace-with-compensation-start",className:"bpmn-icon-start-event-compensation",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Message Start Event (non-interrupting)",actionName:"replace-with-non-interrupting-message-start",className:"bpmn-icon-start-event-non-interrupting-message",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:MessageEventDefinition",isInterrupting:!1}},{label:"Timer Start Event (non-interrupting)",actionName:"replace-with-non-interrupting-timer-start",className:"bpmn-icon-start-event-non-interrupting-timer",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:TimerEventDefinition",isInterrupting:!1}},{label:"Conditional Start Event (non-interrupting)",actionName:"replace-with-non-interrupting-conditional-start",className:"bpmn-icon-start-event-non-interrupting-condition",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition",isInterrupting:!1}},{label:"Signal Start Event (non-interrupting)",actionName:"replace-with-non-interrupting-signal-start",className:"bpmn-icon-start-event-non-interrupting-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition",isInterrupting:!1}},{label:"Escalation Start Event (non-interrupting)",actionName:"replace-with-non-interrupting-escalation-start",className:"bpmn-icon-start-event-non-interrupting-escalation",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:EscalationEventDefinition",isInterrupting:!1}}],module.exports.SEQUENCE_FLOW=[{label:"Sequence Flow",actionName:"replace-with-sequence-flow",className:"bpmn-icon-connection"},{label:"Default Flow",actionName:"replace-with-default-flow",className:"bpmn-icon-default-flow"},{label:"Conditional Flow",actionName:"replace-with-conditional-flow",className:"bpmn-icon-conditional-flow"}],module.exports.PARTICIPANT=[{label:"Expanded Pool",actionName:"replace-with-expanded-pool",className:"bpmn-icon-participant",target:{type:"bpmn:Participant",isExpanded:!0}},{label:"Collapsed Pool",actionName:"replace-with-collapsed-pool",className:"bpmn-icon-lane",target:{type:"bpmn:Participant",isExpanded:!1}}]},{}],254:[function(_dereq_,module,exports){module.exports={__depends__:[_dereq_(381),_dereq_(395)],bpmnReplace:["type",_dereq_(252)]}},{252:252,381:381,395:395}],255:[function(_dereq_,module,exports){"use strict";function BpmnRules(eventBus){RuleProvider.call(this,eventBus)}function nonExistantOrLabel(element){return!element||isLabel(element)}function isSame(a,b){return a===b}function getOrganizationalParent(element){for(var bo=getBusinessObject(element);bo&&!is(bo,"bpmn:Process");){if(is(bo,"bpmn:Participant"))return bo.processRef||bo;bo=bo.$parent}return bo}function isTextAnnotation(element){return is(element,"bpmn:TextAnnotation")}function isCompensationBoundary(element){return is(element,"bpmn:BoundaryEvent")&&hasEventDefinition(element,"bpmn:CompensateEventDefinition")}function isForCompensation(e){return getBusinessObject(e).isForCompensation}function isSameOrganization(a,b){return getOrganizationalParent(a)===getOrganizationalParent(b)}function isMessageFlowSource(element){return is(element,"bpmn:InteractionNode")&&!isForCompensation(element)&&(!is(element,"bpmn:Event")||is(element,"bpmn:ThrowEvent")&&hasEventDefinitionOrNone(element,"bpmn:MessageEventDefinition"))}function isMessageFlowTarget(element){return is(element,"bpmn:InteractionNode")&&!isForCompensation(element)&&(!is(element,"bpmn:Event")||is(element,"bpmn:CatchEvent")&&hasEventDefinitionOrNone(element,"bpmn:MessageEventDefinition"))}function getScopeParent(element){var bo=getBusinessObject(element);if(is(bo,"bpmn:Participant"))return null;for(;bo;)if(bo=bo.$parent,is(bo,"bpmn:FlowElementsContainer"))return bo;return bo}function isSameScope(a,b){var scopeParentA=getScopeParent(a),scopeParentB=getScopeParent(b);return scopeParentA&&scopeParentA===scopeParentB}function hasEventDefinition(element,eventDefinition){var bo=getBusinessObject(element);return!!find(bo.eventDefinitions||[],function(definition){return is(definition,eventDefinition)})}function hasEventDefinitionOrNone(element,eventDefinition){return(getBusinessObject(element).eventDefinitions||[]).every(function(definition){return is(definition,eventDefinition)})}function isSequenceFlowSource(element){return is(element,"bpmn:FlowNode")&&!is(element,"bpmn:EndEvent")&&!isEventSubProcess(element)&&!(is(element,"bpmn:IntermediateThrowEvent")&&hasEventDefinition(element,"bpmn:LinkEventDefinition"))&&!isCompensationBoundary(element)&&!isForCompensation(element)}function isSequenceFlowTarget(element){return is(element,"bpmn:FlowNode")&&!is(element,"bpmn:StartEvent")&&!is(element,"bpmn:BoundaryEvent")&&!isEventSubProcess(element)&&!(is(element,"bpmn:IntermediateCatchEvent")&&hasEventDefinition(element,"bpmn:LinkEventDefinition"))&&!isForCompensation(element)}function isEventBasedTarget(element){return is(element,"bpmn:ReceiveTask")||is(element,"bpmn:IntermediateCatchEvent")&&(hasEventDefinition(element,"bpmn:MessageEventDefinition")||hasEventDefinition(element,"bpmn:TimerEventDefinition")||hasEventDefinition(element,"bpmn:ConditionalEventDefinition")||hasEventDefinition(element,"bpmn:SignalEventDefinition"))}function isLabel(element){return element.labelTarget}function isConnection(element){return element.waypoints}function isParent(possibleParent,element){return-1!==getParents(element).indexOf(possibleParent)}function canConnect(source,target,connection){if(nonExistantOrLabel(source)||nonExistantOrLabel(target))return null;if(isSame(source,target))return!1;if(!is(connection,"bpmn:DataAssociation")){if(canConnectMessageFlow(source,target))return{type:"bpmn:MessageFlow"};if(canConnectSequenceFlow(source,target))return{type:"bpmn:SequenceFlow"}}var connectDataAssociation=canConnectDataAssociation(source,target);return connectDataAssociation||(isCompensationBoundary(source)&&isForCompensation(target)?{type:"bpmn:Association",associationDirection:"One"}:is(connection,"bpmn:Association")&&canConnectAssociation(source,target)?{type:"bpmn:Association"}:!(!isTextAnnotation(source)&&!isTextAnnotation(target))&&{type:"bpmn:Association"})}function canDrop(element,target,position){return!(!isLabel(element)||isConnection(target))||!(is(target,"bpmn:Participant")&&!isExpanded(target))&&(is(element,"bpmn:Participant")?is(target,"bpmn:Process")||is(target,"bpmn:Collaboration"):is(element,"bpmn:Lane")?is(target,"bpmn:Participant")||is(target,"bpmn:Lane"):!is(element,"bpmn:BoundaryEvent")&&(is(element,"bpmn:FlowElement")||is(element,"bpmn:DataAssociation")?is(target,"bpmn:FlowElementsContainer")?isExpanded(target):isAny(target,["bpmn:Participant","bpmn:Lane"]):is(element,"bpmn:Artifact")?isAny(target,["bpmn:Collaboration","bpmn:Lane","bpmn:Participant","bpmn:Process","bpmn:SubProcess"]):!!is(element,"bpmn:MessageFlow")&&is(target,"bpmn:Collaboration")))}function canPaste(tree,target){var topLevel=tree[0];return is(target,"bpmn:Collaboration")?every(topLevel,function(e){return"bpmn:Participant"===e.type}):is(target,"bpmn:Process")?!(any(topLevel,function(e){return"bpmn:Participant"===e.type})&&target.children.length>0):!(is(target,"bpmn:Participant")&&!isExpanded(target))&&(is(target,"bpmn:FlowElementsContainer")?isExpanded(target):isAny(target,["bpmn:Collaboration","bpmn:Lane","bpmn:Participant","bpmn:Process","bpmn:SubProcess"]))}function isBoundaryEvent(element){return!isLabel(element)&&is(element,"bpmn:BoundaryEvent")}function isLane(element){return is(element,"bpmn:Lane")}function isBoundaryCandidate(element){return isBoundaryEvent(element)||is(element,"bpmn:IntermediateThrowEvent")&&!element.parent}function canAttach(elements,target,source,position){if(Array.isArray(elements)||(elements=[elements]),source)return!1;if(1!==elements.length)return!1;var element=elements[0];return!isLabel(element)&&(!!isBoundaryCandidate(element)&&(!target||!isEventSubProcess(target)&&(!(!is(target,"bpmn:Activity")||isForCompensation(target))&&(!(position&&!isBoundaryAttachment(position,target))&&"attach"))))}function canReplace(elements,target,position){if(!target)return!1;var canExecute={replacements:[]};return forEach(elements,function(element){isEventSubProcess(target)||is(element,"bpmn:StartEvent")&&!isInterrupting(element)&&"label"!==element.type&&canDrop(element,target)&&canExecute.replacements.push({oldElementId:element.id,newElementType:"bpmn:StartEvent"}),is(target,"bpmn:Transaction")||hasEventDefinition(element,"bpmn:CancelEventDefinition")&&"label"!==element.type&&(is(element,"bpmn:EndEvent")&&canDrop(element,target)&&canExecute.replacements.push({oldElementId:element.id,newElementType:"bpmn:EndEvent"}),is(element,"bpmn:BoundaryEvent")&&canAttach(element,target,null,position)&&canExecute.replacements.push({oldElementId:element.id,newElementType:"bpmn:BoundaryEvent"}))}),!!canExecute.replacements.length&&canExecute}function canMove(elements,target){return!any(elements,isBoundaryEvent)&&(!any(elements,isLane)&&(!target||elements.every(function(element){return canDrop(element,target)})))}function canCreate(shape,target,source,position){return!!target&&(isLabel(target)?null:!isSame(source,target)&&((!source||!isParent(source,target))&&(canDrop(shape,target,position)||canInsert(shape,target,position))))}function canResize(shape,newBounds){return is(shape,"bpmn:SubProcess")?!!isExpanded(shape)&&(!newBounds||newBounds.width>=100&&newBounds.height>=80):is(shape,"bpmn:Lane")?!newBounds||newBounds.width>=130&&newBounds.height>=60:is(shape,"bpmn:Participant")?!newBounds||newBounds.width>=250&&newBounds.height>=50:!!isTextAnnotation(shape)}function canConnectAssociation(source,target){return!isConnection(source)&&!isConnection(target)&&(!isParent(target,source)&&!isParent(source,target))}function canConnectMessageFlow(source,target){return isMessageFlowSource(source)&&isMessageFlowTarget(target)&&!isSameOrganization(source,target)}function canConnectSequenceFlow(source,target){return isSequenceFlowSource(source)&&isSequenceFlowTarget(target)&&isSameScope(source,target)&&!(is(source,"bpmn:EventBasedGateway")&&!isEventBasedTarget(target))}function canConnectDataAssociation(source,target){return isAny(source,["bpmn:DataObjectReference","bpmn:DataStoreReference"])&&isAny(target,["bpmn:Activity","bpmn:ThrowEvent"])?{type:"bpmn:DataInputAssociation"}:!(!isAny(target,["bpmn:DataObjectReference","bpmn:DataStoreReference"])||!isAny(source,["bpmn:Activity","bpmn:CatchEvent"]))&&{type:"bpmn:DataOutputAssociation"}}function canInsert(shape,flow,position){return isAny(flow,["bpmn:SequenceFlow","bpmn:MessageFlow"])&&is(shape,"bpmn:FlowNode")&&!is(shape,"bpmn:BoundaryEvent")&&canDrop(shape,flow.parent,position)}function contains(collection,element){return collection&&element&&-1!==collection.indexOf(element)}function canCopy(collection,element){return!(is(element,"bpmn:Lane")&&!contains(collection,element.parent))&&!(is(element,"bpmn:BoundaryEvent")&&!contains(collection,element.host))}var find=_dereq_(463),any=_dereq_(460),every=_dereq_(461),filter=_dereq_(462),forEach=_dereq_(464),inherits=_dereq_(451),getParents=_dereq_(242).getParents,is=_dereq_(269).is,isAny=_dereq_(242).isAny,getBusinessObject=_dereq_(269).getBusinessObject,isExpanded=_dereq_(267).isExpanded,isEventSubProcess=_dereq_(267).isEventSubProcess,isInterrupting=_dereq_(267).isInterrupting,RuleProvider=_dereq_(387),isBoundaryAttachment=_dereq_(260).getBoundaryAttachment;inherits(BpmnRules,RuleProvider),BpmnRules.$inject=["eventBus"],module.exports=BpmnRules,BpmnRules.prototype.init=function(){this.addRule("connection.create",function(context){return canConnect(context.source,context.target)}),this.addRule("connection.reconnectStart",function(context){var connection=context.connection;return canConnect(context.hover||context.source,connection.target,connection)}),this.addRule("connection.reconnectEnd",function(context){var connection=context.connection;return canConnect(connection.source,context.hover||context.target,connection)}),this.addRule("connection.updateWaypoints",function(context){return null}),this.addRule("shape.resize",function(context){return canResize(context.shape,context.newBounds)}),this.addRule("elements.move",function(context){var target=context.target,shapes=context.shapes,position=context.position;return canAttach(shapes,target,null,position)||canReplace(shapes,target,position)||canMove(shapes,target)}),this.addRule(["shape.create","shape.append"],function(context){var target=context.target,shape=context.shape,source=context.source,position=context.position;return canAttach([shape],target,source,position)||canCreate(shape,target,source,position)}),this.addRule("element.copy",function(context){return canCopy(context.collection,context.element)}),this.addRule("element.paste",function(context){var parent=context.parent,element=context.element,position=context.position,source=context.source,target=context.target;return source||target?canConnect(source,target):canAttach([element],parent,null,position)||canCreate(element,parent,null,position)}),this.addRule("elements.paste",function(context){return canPaste(context.tree,context.target)}),this.addRule(["elements.delete"],function(context){return filter(context.elements,function(e){return!isLabel(e)})})},BpmnRules.prototype.canConnectMessageFlow=canConnectMessageFlow,BpmnRules.prototype.canConnectSequenceFlow=canConnectSequenceFlow,BpmnRules.prototype.canConnectDataAssociation=canConnectDataAssociation,BpmnRules.prototype.canConnectAssociation=canConnectAssociation,BpmnRules.prototype.canMove=canMove,BpmnRules.prototype.canAttach=canAttach,BpmnRules.prototype.canReplace=canReplace,BpmnRules.prototype.canDrop=canDrop,BpmnRules.prototype.canInsert=canInsert,BpmnRules.prototype.canCreate=canCreate,BpmnRules.prototype.canConnect=canConnect,BpmnRules.prototype.canResize=canResize,BpmnRules.prototype.canCopy=canCopy},{242:242,260:260,267:267,269:269,387:387,451:451,460:460,461:461,462:462,463:463,464:464}],256:[function(_dereq_,module,exports){module.exports={__depends__:[_dereq_(389)],__init__:["bpmnRules"],bpmnRules:["type",_dereq_(255)]}},{255:255,389:389}],257:[function(_dereq_,module,exports){"use strict";function BpmnSearchProvider(elementRegistry,searchPad){this._elementRegistry=elementRegistry,searchPad.registerProvider(this)}function hasMatched(tokens){return filter(tokens,function(t){return!!t.matched}).length>0}function matchAndSplit(text,pattern){var tokens=[],originalText=text;if(!text)return tokens;text=text.toLowerCase(),pattern=pattern.toLowerCase();var i=text.indexOf(pattern);return i>-1?(0!==i&&tokens.push({normal:originalText.substr(0,i)}),tokens.push({matched:originalText.substr(i,pattern.length)}),pattern.length+i<text.length&&tokens.push({normal:originalText.substr(pattern.length+i,text.length)})):tokens.push({normal:originalText}),tokens}var map=_dereq_(467),filter=_dereq_(462),sortBy=_dereq_(471),labelUtil=_dereq_(206);module.exports=BpmnSearchProvider,BpmnSearchProvider.$inject=["elementRegistry","searchPad"],BpmnSearchProvider.prototype.find=function(pattern){var elements=this._elementRegistry.filter(function(element){return!element.labelTarget});return elements=map(elements,function(element){return{primaryTokens:matchAndSplit(labelUtil.getLabel(element),pattern),secondaryTokens:matchAndSplit(element.id,pattern),element:element}}),elements=filter(elements,function(element){return hasMatched(element.primaryTokens)||hasMatched(element.secondaryTokens)}),elements=sortBy(elements,function(element){return labelUtil.getLabel(element.element)+element.element.id})}},{206:206,462:462,467:467,471:471}],258:[function(_dereq_,module,exports){module.exports={__depends__:[_dereq_(391)],__init__:["bpmnSearch"],bpmnSearch:["type",_dereq_(257)]}},{257:257,391:391}],259:[function(_dereq_,module,exports){"use strict";function BpmnSnapping(eventBus,canvas,bpmnRules,elementRegistry){function canAttach(shape,target,position){return"attach"===bpmnRules.canAttach([shape],target,null,position)}Snapping.call(this,eventBus,canvas),eventBus.on("create.start",function(event){var context=event.context,shape=context.shape,rootElement=canvas.getRootElement();is(shape,"bpmn:Participant")&&is(rootElement,"bpmn:Process")&&initParticipantSnapping(context,shape,rootElement.children)}),eventBus.on(["create.move","create.end"],1500,function(event){var context=event.context,shape=context.shape,participantSnapBox=context.participantSnapBox;!isSnapped(event)&&participantSnapBox&&snapParticipant(participantSnapBox,shape,event)}),eventBus.on("shape.move.start",function(event){var context=event.context,shape=context.shape,rootElement=canvas.getRootElement();is(shape,"bpmn:Participant")&&is(rootElement,"bpmn:Process")&&initParticipantSnapping(context,shape,rootElement.children)}),eventBus.on(["create.move","create.end","shape.move.move","shape.move.end"],1500,function(event){var context=event.context,target=context.target,shape=context.shape;target&&!isSnapped(event)&&canAttach(shape,target,event)&&snapBoundaryEvent(event,shape,target)}),eventBus.on(["shape.move.hover","shape.move.move","shape.move.end","create.hover","create.move","create.end"],1500,function(event){var context=event.context,shape=context.shape,hover=event.hover;is(hover,"bpmn:Lane")&&!isAny(shape,["bpmn:Lane","bpmn:Participant"])&&(event.hover=getLanesRoot(hover),event.hoverGfx=elementRegistry.getGraphics(event.hover))});var abs=Math.abs,filter=_dereq_(462),assign=_dereq_(592);eventBus.on(["create.move","shape.move.move"],function(event){var context=event.context,shape=context.shape,target=context.target;if(is(shape,"bpmn:Lane")&&isAny(target,["bpmn:Lane","bpmn:Participant"])){var targetTrbl,childLanes=filter(target.children,function(c){return is(c,"bpmn:Lane")}),y=event.y,insert=childLanes.reduce(function(insert,l){var laneTrbl=asTRBL(l);return abs(laneTrbl.top-y)<30?insert=assign(insert||{},{before:{element:l,y:laneTrbl.top}}):abs(laneTrbl.bottom-y)<30?insert=assign(insert||{},{after:{element:l,y:laneTrbl.bottom}}):laneTrbl.top<y&&laneTrbl.bottom>y&&(insert=abs(laneTrbl.top-y)>abs(laneTrbl.bottom-y)?assign(insert||{},{after:{element:l,y:laneTrbl.bottom}}):assign(insert||{},{before:{element:l,y:laneTrbl.top}})),insert},!1);insert||(targetTrbl=asTRBL(target),insert=abs(targetTrbl.top-y)<30?{before:{element:target,y:targetTrbl.top}}:abs(targetTrbl.bottom-y)<30?{after:{element:target,y:targetTrbl.bottom}}:{into:{element:target,y:(targetTrbl.top+targetTrbl.bottom)/2}}),insert.before&&insert.after?(console.log("insert between",insert.before.element.id,"and",insert.after.element.id),setSnapped(event,"x",insert.before.element.x+insert.before.element.width/2),setSnapped(event,"y",insert.before.y)):insert.after?(console.log("insert after",insert.after.element.id),setSnapped(event,"x",insert.after.element.x+insert.after.element.width/2),setSnapped(event,"y",insert.after.y)):insert.before?(console.log("insert before",insert.before.element.id),setSnapped(event,"x",insert.before.element.x+insert.before.element.width/2),setSnapped(event,"y",insert.before.y)):insert.into&&(console.log("insert into",insert.into.element.id),setSnapped(event,"x",insert.into.element.x+insert.into.element.width/2),setSnapped(event,"y",insert.into.y))}}),eventBus.on("resize.start",1500,function(event){var context=event.context,shape=context.shape;is(shape,"bpmn:SubProcess")&&isExpanded(shape)&&(context.minDimensions={width:140,height:120}),is(shape,"bpmn:Participant")&&(context.minDimensions={width:300,height:150}),(is(shape,"bpmn:Lane")||is(shape,"bpmn:Participant"))&&(context.resizeConstraints=getParticipantSizeConstraints(shape,context.direction,context.balanced)),is(shape,"bpmn:TextAnnotation")&&(context.minDimensions={width:50,height:30})})}function initParticipantSnapping(context,shape,elements){if(elements.length){var snapBox=getBoundingBox(elements.filter(function(e){return!e.labelTarget&&!e.waypoints}));snapBox.x-=50,snapBox.y-=20,snapBox.width+=70,snapBox.height+=40,shape.width=Math.max(shape.width,snapBox.width),shape.height=Math.max(shape.height,snapBox.height),context.participantSnapBox=snapBox}}function snapParticipant(snapBox,shape,event,offset){offset=offset||0;var shapeHalfWidth=shape.width/2-offset,shapeHalfHeight=shape.height/2,currentTopLeft={x:event.x-shapeHalfWidth-offset,y:event.y-shapeHalfHeight},currentBottomRight={x:event.x+shapeHalfWidth+offset,y:event.y+shapeHalfHeight},snapTopLeft=snapBox,snapBottomRight=bottomRight(snapBox);currentTopLeft.x>=snapTopLeft.x?setSnapped(event,"x",snapTopLeft.x+offset+shapeHalfWidth):currentBottomRight.x<=snapBottomRight.x&&setSnapped(event,"x",snapBottomRight.x-offset-shapeHalfWidth),currentTopLeft.y>=snapTopLeft.y?setSnapped(event,"y",snapTopLeft.y+shapeHalfHeight):currentBottomRight.y<=snapBottomRight.y&&setSnapped(event,"y",snapBottomRight.y-shapeHalfHeight)}function snapBoundaryEvent(event,shape,target){var targetTRBL=asTRBL(target),direction=getBoundaryAttachment(event,target);/top/.test(direction)?setSnapped(event,"y",targetTRBL.top):/bottom/.test(direction)&&setSnapped(event,"y",targetTRBL.bottom),/left/.test(direction)?setSnapped(event,"x",targetTRBL.left):/right/.test(direction)&&setSnapped(event,"x",targetTRBL.right)}var inherits=_dereq_(451),forEach=_dereq_(464),getBoundingBox=_dereq_(428).getBBox,is=_dereq_(269).is,isAny=_dereq_(242).isAny,isExpanded=_dereq_(267).isExpanded,Snapping=_dereq_(398),SnapUtil=_dereq_(397),asTRBL=_dereq_(414).asTRBL,round=Math.round,mid=SnapUtil.mid,topLeft=SnapUtil.topLeft,bottomRight=SnapUtil.bottomRight,isSnapped=SnapUtil.isSnapped,setSnapped=SnapUtil.setSnapped,getBoundaryAttachment=_dereq_(260).getBoundaryAttachment,getParticipantSizeConstraints=_dereq_(260).getParticipantSizeConstraints,getLanesRoot=_dereq_(241).getLanesRoot;inherits(BpmnSnapping,Snapping),BpmnSnapping.$inject=["eventBus","canvas","bpmnRules","elementRegistry"],module.exports=BpmnSnapping,BpmnSnapping.prototype.initSnap=function(event){var shapeMid,shapeBounds,shapeTopLeft,shapeBottomRight,snapContext,context=event.context,shape=event.shape;snapContext=Snapping.prototype.initSnap.call(this,event),is(shape,"bpmn:Participant")&&snapContext.setSnapLocations(["top-left","bottom-right","mid"]),shape&&(shapeMid=mid(shape,event),shapeBounds={width:shape.width,height:shape.height,x:isNaN(shape.x)?round(shapeMid.x-shape.width/2):shape.x,y:isNaN(shape.y)?round(shapeMid.y-shape.height/2):shape.y},shapeTopLeft=topLeft(shapeBounds),shapeBottomRight=bottomRight(shapeBounds),snapContext.setSnapOrigin("top-left",{x:shapeTopLeft.x-event.x,y:shapeTopLeft.y-event.y}),snapContext.setSnapOrigin("bottom-right",{x:shapeBottomRight.x-event.x,y:shapeBottomRight.y-event.y}),forEach(shape.outgoing,function(c){var docking=c.waypoints[0];docking=docking.original||docking,snapContext.setSnapOrigin(c.id+"-docking",{x:docking.x-event.x,y:docking.y-event.y})}),forEach(shape.incoming,function(c){var docking=c.waypoints[c.waypoints.length-1];docking=docking.original||docking,snapContext.setSnapOrigin(c.id+"-docking",{x:docking.x-event.x,y:docking.y-event.y})}));var source=context.source;source&&snapContext.addDefaultSnap("mid",mid(source))},BpmnSnapping.prototype.addTargetSnaps=function(snapPoints,shape,target){is(shape,"bpmn:BoundaryEvent")&&"label"!==shape.type&&(target=target.parent),is(target,"bpmn:SequenceFlow")&&this.addTargetSnaps(snapPoints,shape,target.parent);var siblings=this.getSiblings(shape,target)||[];forEach(siblings,function(s){is(s,"bpmn:Lane")||(snapPoints.add("mid",mid(s)),is(s,"bpmn:Participant")&&(snapPoints.add("top-left",topLeft(s)),snapPoints.add("bottom-right",bottomRight(s))))}),forEach(shape.incoming,function(c){-1===siblings.indexOf(c.source)&&snapPoints.add("mid",mid(c.source));var docking=c.waypoints[0];snapPoints.add(c.id+"-docking",docking.original||docking)}),forEach(shape.outgoing,function(c){-1===siblings.indexOf(c.target)&&snapPoints.add("mid",mid(c.target));var docking=c.waypoints[c.waypoints.length-1];snapPoints.add(c.id+"-docking",docking.original||docking)})}},{241:241,242:242,260:260,267:267,269:269,397:397,398:398,414:414,428:428,451:451,462:462,464:464,592:592}],260:[function(_dereq_,module,exports){"use strict";function getBoundaryAttachment(position,targetBounds){var orientation=getOrientation(position,targetBounds,-15);return"intersect"!==orientation?orientation:null}function addToTrbl(trbl,attr,value,choice){var current=trbl[attr];trbl[attr]=void 0===current?value:choice(value,current)}function addMin(trbl,attr,value){return addToTrbl(trbl,attr,value,min)}function addMax(trbl,attr,value){return addToTrbl(trbl,attr,value,max)}function getParticipantSizeConstraints(laneShape,resizeDirection,balanced){var lanesRoot=getLanesRoot(laneShape),isFirst=!0,isLast=!0,allLanes=collectLanes(lanesRoot,[lanesRoot]),laneTrbl=asTRBL(laneShape),maxTrbl={},minTrbl={};return/e/.test(resizeDirection)?minTrbl.right=laneTrbl.left+LANE_MIN_WIDTH:/w/.test(resizeDirection)&&(minTrbl.left=laneTrbl.right-LANE_MIN_WIDTH),allLanes.forEach(function(other){var otherTrbl=asTRBL(other);/n/.test(resizeDirection)&&(otherTrbl.top<laneTrbl.top-10&&(isFirst=!1),
balanced&&abs(laneTrbl.top-otherTrbl.bottom)<10&&addMax(maxTrbl,"top",otherTrbl.top+LANE_MIN_HEIGHT),abs(laneTrbl.top-otherTrbl.top)<5&&addMin(minTrbl,"top",otherTrbl.bottom-LANE_MIN_HEIGHT)),/s/.test(resizeDirection)&&(otherTrbl.bottom>laneTrbl.bottom+10&&(isLast=!1),balanced&&abs(laneTrbl.bottom-otherTrbl.top)<10&&addMin(maxTrbl,"bottom",otherTrbl.bottom-LANE_MIN_HEIGHT),abs(laneTrbl.bottom-otherTrbl.bottom)<5&&addMax(minTrbl,"bottom",otherTrbl.top+LANE_MIN_HEIGHT))}),lanesRoot.children.filter(function(s){return!s.hidden&&!s.waypoints&&(is(s,"bpmn:FlowElement")||is(s,"bpmn:Artifact"))}).forEach(function(flowElement){var flowElementTrbl=asTRBL(flowElement);isFirst&&/n/.test(resizeDirection)&&addMin(minTrbl,"top",flowElementTrbl.top-LANE_TOP_PADDING),/e/.test(resizeDirection)&&addMax(minTrbl,"right",flowElementTrbl.right+LANE_RIGHT_PADDING),isLast&&/s/.test(resizeDirection)&&addMax(minTrbl,"bottom",flowElementTrbl.bottom+LANE_BOTTOM_PADDING),/w/.test(resizeDirection)&&addMin(minTrbl,"left",flowElementTrbl.left-LANE_LEFT_PADDING)}),{min:minTrbl,max:maxTrbl}}var getOrientation=_dereq_(414).getOrientation;module.exports.getBoundaryAttachment=getBoundaryAttachment;var is=_dereq_(269).is,asTRBL=_dereq_(414).asTRBL,collectLanes=_dereq_(241).collectLanes,getLanesRoot=_dereq_(241).getLanesRoot,abs=Math.abs,min=Math.min,max=Math.max,LANE_MIN_HEIGHT=60,LANE_MIN_WIDTH=300,LANE_RIGHT_PADDING=20,LANE_LEFT_PADDING=50,LANE_TOP_PADDING=20,LANE_BOTTOM_PADDING=20;module.exports.getParticipantSizeConstraints=getParticipantSizeConstraints},{241:241,269:269,414:414}],261:[function(_dereq_,module,exports){module.exports={__init__:["snapping"],snapping:["type",_dereq_(259)]}},{259:259}],262:[function(_dereq_,module,exports){"use strict";function elementData(semantic,attrs){return assign({id:semantic.id,type:semantic.$type,businessObject:semantic},attrs)}function collectWaypoints(waypoints){return map(waypoints,function(p){return{x:p.x,y:p.y}})}function notYetDrawn(translate,semantic,refSemantic,property){return new Error(translate("element {element} referenced by {referenced}#{property} not yet drawn",{element:elementToString(refSemantic),referenced:elementToString(semantic),property:property}))}function BpmnImporter(eventBus,canvas,elementFactory,elementRegistry,translate){this._eventBus=eventBus,this._canvas=canvas,this._elementFactory=elementFactory,this._elementRegistry=elementRegistry,this._translate=translate}var assign=_dereq_(592),map=_dereq_(467),LabelUtil=_dereq_(268),is=_dereq_(269).is,hasExternalLabel=LabelUtil.hasExternalLabel,getExternalLabelBounds=LabelUtil.getExternalLabelBounds,isExpanded=_dereq_(267).isExpanded,elementToString=_dereq_(265).elementToString;BpmnImporter.$inject=["eventBus","canvas","elementFactory","elementRegistry","translate"],module.exports=BpmnImporter,BpmnImporter.prototype.add=function(semantic,parentElement){var element,di=semantic.di,translate=this._translate;if(is(di,"bpmndi:BPMNPlane"))element=this._elementFactory.createRoot(elementData(semantic)),this._canvas.setRootElement(element);else if(is(di,"bpmndi:BPMNShape")){var collapsed=!isExpanded(semantic),hidden=parentElement&&(parentElement.hidden||parentElement.collapsed),bounds=semantic.di.bounds;element=this._elementFactory.createShape(elementData(semantic,{collapsed:collapsed,hidden:hidden,x:Math.round(bounds.x),y:Math.round(bounds.y),width:Math.round(bounds.width),height:Math.round(bounds.height)})),is(semantic,"bpmn:BoundaryEvent")&&this._attachBoundary(semantic,element),this._canvas.addShape(element,parentElement)}else{if(!is(di,"bpmndi:BPMNEdge"))throw new Error(translate("unknown di {di} for element {semantic}",{di:elementToString(di),semantic:elementToString(semantic)}));var source=this._getSource(semantic),target=this._getTarget(semantic);element=this._elementFactory.createConnection(elementData(semantic,{source:source,target:target,waypoints:collectWaypoints(semantic.di.waypoint)})),(is(semantic,"bpmn:DataInputAssociation")||is(semantic,"bpmn:DataOutputAssociation"))&&(parentElement=null),this._canvas.addConnection(element,parentElement)}return hasExternalLabel(semantic)&&this.addLabel(semantic,element),this._eventBus.fire("bpmnElement.added",{element:element}),element},BpmnImporter.prototype._attachBoundary=function(boundarySemantic,boundaryElement){var translate=this._translate,hostSemantic=boundarySemantic.attachedToRef;if(!hostSemantic)throw new Error(translate("missing {semantic}#attachedToRef",{semantic:elementToString(boundarySemantic)}));var host=this._elementRegistry.get(hostSemantic.id),attachers=host&&host.attachers;if(!host)throw notYetDrawn(translate,boundarySemantic,hostSemantic,"attachedToRef");boundaryElement.host=host,attachers||(host.attachers=attachers=[]),-1===attachers.indexOf(boundaryElement)&&attachers.push(boundaryElement)},BpmnImporter.prototype.addLabel=function(semantic,element){var bounds=getExternalLabelBounds(semantic,element),label=this._elementFactory.createLabel(elementData(semantic,{id:semantic.id+"_label",labelTarget:element,type:"label",hidden:element.hidden||!semantic.name,x:Math.round(bounds.x),y:Math.round(bounds.y),width:Math.round(bounds.width),height:Math.round(bounds.height)}));return this._canvas.addShape(label,element.parent)},BpmnImporter.prototype._getEnd=function(semantic,side){var element,refSemantic,type=semantic.$type,translate=this._translate;if(refSemantic=semantic[side+"Ref"],"source"===side&&"bpmn:DataInputAssociation"===type&&(refSemantic=refSemantic&&refSemantic[0]),("source"===side&&"bpmn:DataOutputAssociation"===type||"target"===side&&"bpmn:DataInputAssociation"===type)&&(refSemantic=semantic.$parent),element=refSemantic&&this._getElement(refSemantic))return element;throw refSemantic?notYetDrawn(translate,semantic,refSemantic,side+"Ref"):new Error(translate("{semantic}#{side} Ref not specified",{semantic:elementToString(semantic),side:side}))},BpmnImporter.prototype._getSource=function(semantic){return this._getEnd(semantic,"source")},BpmnImporter.prototype._getTarget=function(semantic){return this._getEnd(semantic,"target")},BpmnImporter.prototype._getElement=function(semantic){return this._elementRegistry.get(semantic.id)}},{265:265,267:267,268:268,269:269,467:467,592:592}],263:[function(_dereq_,module,exports){"use strict";function is(element,type){return element.$instanceOf(type)}function findDisplayCandidate(definitions){return find(definitions.rootElements,function(e){return is(e,"bpmn:Process")||is(e,"bpmn:Collaboration")})}function BpmnTreeWalker(handler,translate){function contextual(fn,ctx){return function(e){fn(e,ctx)}}function handled(element){handledElements[element.id]=element}function isHandled(element){return handledElements[element.id]}function visit(element,ctx){if(element.gfx)throw new Error(translate("already rendered {element}",{element:elementToString(element)}));return handler.element(element,ctx)}function visitRoot(element,diagram){return handler.root(element,diagram)}function visitIfDi(element,ctx){try{var gfx=element.di&&visit(element,ctx);return handled(element),gfx}catch(e){logError(e.message,{element:element,error:e}),console.error(translate("failed to import {element}",{element:elementToString(element)})),console.error(e)}}function logError(message,context){handler.error(message,context)}function registerDi(di){var bpmnElement=di.bpmnElement;bpmnElement?bpmnElement.di?logError(translate("multiple DI elements defined for {element}",{element:elementToString(bpmnElement)}),{element:bpmnElement}):(diRefs.bind(bpmnElement,"di"),bpmnElement.di=di):logError(translate("no bpmnElement referenced in {element}",{element:elementToString(di)}),{element:di})}function handleDiagram(diagram){handlePlane(diagram.plane)}function handlePlane(plane){registerDi(plane),forEach(plane.planeElement,handlePlaneElement)}function handlePlaneElement(planeElement){registerDi(planeElement)}function handleDefinitions(definitions,diagram){var diagrams=definitions.diagrams;if(diagram&&-1===diagrams.indexOf(diagram))throw new Error(translate("diagram not part of bpmn:Definitions"));if(!diagram&&diagrams&&diagrams.length&&(diagram=diagrams[0]),!diagram)throw new Error(translate("no diagram to display"));handleDiagram(diagram);var plane=diagram.plane;if(!plane)throw new Error(translate("no plane for {element}",{element:elementToString(diagram)}));var rootElement=plane.bpmnElement;if(!rootElement){if(!(rootElement=findDisplayCandidate(definitions)))throw new Error(translate("no process or collaboration to display"));logError(translate("correcting missing bpmnElement on {plane} to {rootElement}",{plane:elementToString(plane),rootElement:elementToString(rootElement)})),plane.bpmnElement=rootElement,registerDi(plane)}var ctx=visitRoot(rootElement,plane);if(is(rootElement,"bpmn:Process"))handleProcess(rootElement,ctx);else{if(!is(rootElement,"bpmn:Collaboration"))throw new Error(translate("unsupported bpmnElement for {plane}: {rootElement}",{plane:elementToString(plane),rootElement:elementToString(rootElement)}));handleCollaboration(rootElement),handleUnhandledProcesses(definitions.rootElements)}handleDeferred(deferred)}function handleDeferred(deferred){forEach(deferred,function(d){d()})}function handleProcess(process,context){handleFlowElementsContainer(process,context),handleIoSpecification(process.ioSpecification,context),handleArtifacts(process.artifacts,context),handled(process)}function handleUnhandledProcesses(rootElements){filter(rootElements,function(e){return!isHandled(e)&&is(e,"bpmn:Process")&&e.laneSets}).forEach(contextual(handleProcess))}function handleMessageFlow(messageFlow,context){visitIfDi(messageFlow,context)}function handleMessageFlows(messageFlows,context){forEach(messageFlows,contextual(handleMessageFlow,context))}function handleDataAssociation(association,context){visitIfDi(association,context)}function handleDataInput(dataInput,context){visitIfDi(dataInput,context)}function handleDataOutput(dataOutput,context){visitIfDi(dataOutput,context)}function handleArtifact(artifact,context){visitIfDi(artifact,context)}function handleArtifacts(artifacts,context){forEach(artifacts,function(e){is(e,"bpmn:Association")?deferred.push(function(){handleArtifact(e,context)}):handleArtifact(e,context)})}function handleIoSpecification(ioSpecification,context){ioSpecification&&(forEach(ioSpecification.dataInputs,contextual(handleDataInput,context)),forEach(ioSpecification.dataOutputs,contextual(handleDataOutput,context)))}function handleSubProcess(subProcess,context){handleFlowElementsContainer(subProcess,context),handleArtifacts(subProcess.artifacts,context)}function handleFlowNode(flowNode,context){var childCtx=visitIfDi(flowNode,context);is(flowNode,"bpmn:SubProcess")&&handleSubProcess(flowNode,childCtx||context),is(flowNode,"bpmn:Activity")&&handleIoSpecification(flowNode.ioSpecification,context),deferred.push(function(){forEach(flowNode.dataInputAssociations,contextual(handleDataAssociation,context)),forEach(flowNode.dataOutputAssociations,contextual(handleDataAssociation,context))})}function handleSequenceFlow(sequenceFlow,context){visitIfDi(sequenceFlow,context)}function handleDataElement(dataObject,context){visitIfDi(dataObject,context)}function handleBoundaryEvent(dataObject,context){visitIfDi(dataObject,context)}function handleLane(lane,context){var newContext=visitIfDi(lane,context);lane.childLaneSet&&handleLaneSet(lane.childLaneSet,newContext||context),wireFlowNodeRefs(lane)}function handleLaneSet(laneSet,context){forEach(laneSet.lanes,contextual(handleLane,context))}function handleLaneSets(laneSets,context){forEach(laneSets,contextual(handleLaneSet,context))}function handleFlowElementsContainer(container,context){container.laneSets&&handleLaneSets(container.laneSets,context),handleFlowElements(container.flowElements,context)}function handleFlowElements(flowElements,context){forEach(flowElements,function(e){is(e,"bpmn:SequenceFlow")?deferred.push(function(){handleSequenceFlow(e,context)}):is(e,"bpmn:BoundaryEvent")?deferred.unshift(function(){handleBoundaryEvent(e,context)}):is(e,"bpmn:FlowNode")?handleFlowNode(e,context):is(e,"bpmn:DataObject")||(is(e,"bpmn:DataStoreReference")?handleDataElement(e,context):is(e,"bpmn:DataObjectReference")?handleDataElement(e,context):logError(translate("unrecognized flowElement {element} in context {context}",{element:elementToString(e),context:context?elementToString(context.businessObject):"null"}),{element:e,context:context}))})}function handleParticipant(participant,context){var newCtx=visitIfDi(participant,context),process=participant.processRef;process&&handleProcess(process,newCtx||context)}function handleCollaboration(collaboration){forEach(collaboration.participants,contextual(handleParticipant)),handleArtifacts(collaboration.artifacts),deferred.push(function(){handleMessageFlows(collaboration.messageFlows)})}function wireFlowNodeRefs(lane){forEach(lane.flowNodeRef,function(flowNode){var lanes=flowNode.get("lanes");lanes&&lanes.push(lane)})}var handledElements={},deferred=[];return{handleDefinitions:handleDefinitions}}var filter=_dereq_(462),find=_dereq_(463),forEach=_dereq_(464),Refs=_dereq_(626),elementToString=_dereq_(265).elementToString,diRefs=new Refs({name:"bpmnElement",enumerable:!0},{name:"di"});module.exports=BpmnTreeWalker},{265:265,462:462,463:463,464:464,626:626}],264:[function(_dereq_,module,exports){"use strict";function importBpmnDiagram(diagram,definitions,done){var error,importer=diagram.get("bpmnImporter"),eventBus=diagram.get("eventBus"),translate=diagram.get("translate"),warnings=[];eventBus.fire("import.render.start",{definitions:definitions});try{!function(definitions){new BpmnTreeWalker({root:function(element){return importer.add(element)},element:function(element,parentShape){return importer.add(element,parentShape)},error:function(message,context){warnings.push({message:message,context:context})}},translate).handleDefinitions(definitions)}(definitions)}catch(e){error=e}eventBus.fire("import.render.complete",{error:error,warnings:warnings}),done(error,warnings)}var BpmnTreeWalker=_dereq_(263);module.exports.importBpmnDiagram=importBpmnDiagram},{263:263}],265:[function(_dereq_,module,exports){"use strict";module.exports.elementToString=function(e){return e?"<"+e.$type+(e.id?' id="'+e.id:"")+'" />':"<null>"}},{}],266:[function(_dereq_,module,exports){module.exports={__depends__:[_dereq_(410)],bpmnImporter:["type",_dereq_(262)]}},{262:262,410:410}],267:[function(_dereq_,module,exports){"use strict";var is=_dereq_(269).is,getBusinessObject=_dereq_(269).getBusinessObject;module.exports.isExpanded=function(element){return!is(element,"bpmn:CallActivity")&&(is(element,"bpmn:SubProcess")?!!getBusinessObject(element).di.isExpanded:!is(element,"bpmn:Participant")||!!getBusinessObject(element).processRef)},module.exports.isInterrupting=function(element){return element&&!1!==getBusinessObject(element).isInterrupting},module.exports.isEventSubProcess=function(element){return element&&!!getBusinessObject(element).triggeredByEvent}},{269:269}],268:[function(_dereq_,module,exports){"use strict";function getFlowLabelPosition(waypoints){var mid=waypoints.length/2-1,first=waypoints[Math.floor(mid)],second=waypoints[Math.ceil(mid+.01)],position=getWaypointsMid(waypoints),angle=Math.atan((second.y-first.y)/(second.x-first.x)),x=position.x,y=position.y;return Math.abs(angle)<Math.PI/2?y-=FLOW_LABEL_INDENT:x+=FLOW_LABEL_INDENT,{x:x,y:y}}function getWaypointsMid(waypoints){var mid=waypoints.length/2-1,first=waypoints[Math.floor(mid)],second=waypoints[Math.ceil(mid+.01)];return{x:first.x+(second.x-first.x)/2,y:first.y+(second.y-first.y)/2}}function getExternalLabelMid(element){return element.waypoints?getFlowLabelPosition(element.waypoints):{x:element.x+element.width/2,y:element.y+element.height+DEFAULT_LABEL_SIZE.height/2}}var assign=_dereq_(592),is=_dereq_(269).is,DEFAULT_LABEL_SIZE=module.exports.DEFAULT_LABEL_SIZE={width:90,height:20},FLOW_LABEL_INDENT=module.exports.FLOW_LABEL_INDENT=15;module.exports.hasExternalLabel=function(semantic){return is(semantic,"bpmn:Event")||is(semantic,"bpmn:Gateway")||is(semantic,"bpmn:DataStoreReference")||is(semantic,"bpmn:DataObjectReference")||is(semantic,"bpmn:SequenceFlow")||is(semantic,"bpmn:MessageFlow")},module.exports.getFlowLabelPosition=getFlowLabelPosition,module.exports.getWaypointsMid=getWaypointsMid,module.exports.getExternalLabelMid=getExternalLabelMid,module.exports.getExternalLabelBounds=function(semantic,element){var mid,size,bounds,di=semantic.di,label=di.label;return label&&label.bounds?(bounds=label.bounds,size={width:Math.max(DEFAULT_LABEL_SIZE.width,bounds.width),height:bounds.height},mid={x:bounds.x+bounds.width/2,y:bounds.y+bounds.height/2}):(mid=getExternalLabelMid(element),size=DEFAULT_LABEL_SIZE),assign({x:mid.x-size.width/2,y:mid.y-size.height/2},size)}},{269:269,592:592}],269:[function(_dereq_,module,exports){"use strict";function is(element,type){var bo=getBusinessObject(element);return bo&&"function"==typeof bo.$instanceOf&&bo.$instanceOf(type)}function getBusinessObject(element){return element&&element.businessObject||element}module.exports.is=is,module.exports.getBusinessObject=getBusinessObject},{}],270:[function(_dereq_,module,exports){"use strict";function css(attrs){return attrs.join(";")}function open(){lightbox||(lightbox=domify(LIGHTBOX_MARKUP),domDelegate.bind(lightbox,".backdrop","click",function(event){document.body.removeChild(lightbox)})),document.body.appendChild(lightbox)}var lightbox,domify=_dereq_(609),domDelegate=_dereq_(608),logoData=module.exports.BPMNIO_LOGO="iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAMAAADypuvZAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAADBQTFRFiMte9PrwldFwfcZPqtqN0+zEyOe1XLgjvuKncsJAZ70y6fXh3vDT////UrQV////G2zN+AAAABB0Uk5T////////////////////AOAjXRkAAAHDSURBVHjavJZJkoUgDEBJmAX8979tM8u3E6x20VlYJfFFMoL4vBDxATxZcakIOJTWSmxvKWVIkJ8jHvlRv1F2LFrVISCZI+tCtQx+XfewgVTfyY3plPiQEAzI3zWy+kR6NBhFBYeBuscJLOUuA2WVLpCjVIaFzrNQZArxAZKUQm6gsj37L9Cb7dnIBUKxENaaMJQqMpDXvSL+ktxdGRm2IsKgJGGPg7atwUG5CcFUEuSv+CwQqizTrvDTNXdMU2bMiDWZd8d7QIySWVRsb2vBBioxOFt4OinPBapL+neAb5KL5IJ8szOza2/DYoipUCx+CjO0Bpsv0V6mktNZ+k8rlABlWG0FrOpKYVo8DT3dBeLEjUBAj7moDogVii7nSS9QzZnFcOVBp1g2PyBQ3Vr5aIapN91VJy33HTJLC1iX2FY6F8gRdaAeIEfVONgtFCzZTmoLEdOjBDfsIOA6128gw3eu1shAajdZNAORxuQDJN5A5PbEG6gNIu24QJD5iNyRMZIr6bsHbCtCU/OaOaSvgkUyDMdDa1BXGf5HJ1To+/Ym6mCKT02Y+/Sa126ZKyd3jxhzpc1r8zVL6YM1Qy/kR4ABAFJ6iQUnivhAAAAAAElFTkSuQmCC",LIGHTBOX_STYLES=css(["z-index: 1001","position: fixed","top: 0","left: 0","right: 0","bottom: 0"]),BACKDROP_STYLES=css(["width: 100%","height: 100%","background: rgba(0,0,0,0.2)"]),NOTICE_STYLES=css(["position: absolute","left: 50%","top: 40%","margin: 0 -130px","width: 260px","padding: 10px","background: white","border: solid 1px #AAA","border-radius: 3px","font-family: Helvetica, Arial, sans-serif","font-size: 14px","line-height: 1.2em"]),LIGHTBOX_MARKUP='<div class="bjs-powered-by-lightbox" style="'+LIGHTBOX_STYLES+'"><div class="backdrop" style="'+BACKDROP_STYLES+'"></div><div class="notice" style="'+NOTICE_STYLES+'"><a href="http://bpmn.io" target="_blank" style="float: left; margin-right: 10px"><img src="data:image/png;base64,'+logoData+'"></a>Web-based tooling for BPMN, DMN and CMMN diagrams powered by <a href="http://bpmn.io" target="_blank">bpmn.io</a>.</div></div>';module.exports.open=open},{608:608,609:609}],271:[function(_dereq_,module,exports){module.exports=_dereq_(273)},{273:273}],272:[function(_dereq_,module,exports){"use strict";function BpmnModdle(packages,options){Moddle.call(this,packages,options)}var isString=_dereq_(589),isFunction=_dereq_(584),assign=_dereq_(592),Moddle=_dereq_(617),XmlReader=_dereq_(615),XmlWriter=_dereq_(616);BpmnModdle.prototype=Object.create(Moddle.prototype),module.exports=BpmnModdle,BpmnModdle.prototype.fromXML=function(xmlStr,typeName,options,done){isString(typeName)||(done=options,options=typeName,typeName="bpmn:Definitions"),isFunction(options)&&(done=options,options={});var reader=new XmlReader(assign({model:this,lax:!0},options)),rootHandler=reader.handler(typeName);reader.fromXML(xmlStr,rootHandler,done)},BpmnModdle.prototype.toXML=function(element,options,done){isFunction(options)&&(done=options,options={});var writer=new XmlWriter(options);try{var result=writer.toXML(element);done(null,result)}catch(e){done(e)}}},{584:584,589:589,592:592,615:615,616:616,617:617}],273:[function(_dereq_,module,exports){"use strict";var assign=_dereq_(592),BpmnModdle=_dereq_(272),packages={bpmn:_dereq_(274),bpmndi:_dereq_(275),dc:_dereq_(276),di:_dereq_(277)};module.exports=function(additionalPackages,options){return new BpmnModdle(assign({},packages,additionalPackages),options)}},{272:272,274:274,275:275,276:276,277:277,592:592}],274:[function(_dereq_,module,exports){module.exports={name:"BPMN20",uri:"http://www.omg.org/spec/BPMN/20100524/MODEL",associations:[],types:[{name:"Interface",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"operations",type:"Operation",isMany:!0},{name:"implementationRef",type:"String",isAttr:!0}]},{name:"Operation",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"inMessageRef",type:"Message",isReference:!0},{name:"outMessageRef",type:"Message",isReference:!0},{name:"errorRef",type:"Error",isMany:!0,isReference:!0},{name:"implementationRef",type:"String",isAttr:!0}]},{name:"EndPoint",superClass:["RootElement"]},{name:"Auditing",superClass:["BaseElement"]},{name:"GlobalTask",superClass:["CallableElement"],properties:[{name:"resources",type:"ResourceRole",isMany:!0}]},{name:"Monitoring",superClass:["BaseElement"]},{name:"Performer",superClass:["ResourceRole"]},{name:"Process",superClass:["FlowElementsContainer","CallableElement"],properties:[{name:"processType",type:"ProcessType",isAttr:!0},{name:"isClosed",isAttr:!0,type:"Boolean"},{name:"auditing",type:"Auditing"},{name:"monitoring",type:"Monitoring"},{name:"properties",type:"Property",isMany:!0},{name:"laneSets",type:"LaneSet",isMany:!0,replaces:"FlowElementsContainer#laneSets"},{name:"flowElements",type:"FlowElement",isMany:!0,replaces:"FlowElementsContainer#flowElements"},{name:"artifacts",type:"Artifact",isMany:!0},{name:"resources",type:"ResourceRole",isMany:!0},{name:"correlationSubscriptions",type:"CorrelationSubscription",isMany:!0},{name:"supports",type:"Process",isMany:!0,isReference:!0},{name:"definitionalCollaborationRef",type:"Collaboration",isAttr:!0,isReference:!0},{name:"isExecutable",isAttr:!0,type:"Boolean"}]},{name:"LaneSet",superClass:["BaseElement"],properties:[{name:"lanes",type:"Lane",isMany:!0},{name:"name",isAttr:!0,type:"String"}]},{name:"Lane",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"partitionElementRef",type:"BaseElement",isAttr:!0,isReference:!0},{name:"partitionElement",type:"BaseElement"},{name:"flowNodeRef",type:"FlowNode",isMany:!0,isReference:!0},{name:"childLaneSet",type:"LaneSet",xml:{serialize:"xsi:type"}}]},{name:"GlobalManualTask",superClass:["GlobalTask"]},{name:"ManualTask",superClass:["Task"]},{name:"UserTask",superClass:["Task"],properties:[{name:"renderings",type:"Rendering",isMany:!0},{name:"implementation",isAttr:!0,type:"String"}]},{name:"Rendering",superClass:["BaseElement"]},{name:"HumanPerformer",superClass:["Performer"]},{name:"PotentialOwner",superClass:["HumanPerformer"]},{name:"GlobalUserTask",superClass:["GlobalTask"],properties:[{name:"implementation",isAttr:!0,type:"String"},{name:"renderings",type:"Rendering",isMany:!0}]},{name:"Gateway",isAbstract:!0,superClass:["FlowNode"],properties:[{name:"gatewayDirection",type:"GatewayDirection",default:"Unspecified",isAttr:!0}]},{name:"EventBasedGateway",superClass:["Gateway"],properties:[{name:"instantiate",default:!1,isAttr:!0,type:"Boolean"},{name:"eventGatewayType",type:"EventBasedGatewayType",isAttr:!0,default:"Exclusive"}]},{name:"ComplexGateway",superClass:["Gateway"],properties:[{name:"activationCondition",type:"Expression",xml:{serialize:"xsi:type"}},{name:"default",type:"SequenceFlow",isAttr:!0,isReference:!0}]},{name:"ExclusiveGateway",superClass:["Gateway"],properties:[{name:"default",type:"SequenceFlow",isAttr:!0,isReference:!0}]},{name:"InclusiveGateway",superClass:["Gateway"],properties:[{name:"default",type:"SequenceFlow",isAttr:!0,isReference:!0}]},{name:"ParallelGateway",superClass:["Gateway"]},{name:"RootElement",isAbstract:!0,superClass:["BaseElement"]},{name:"Relationship",superClass:["BaseElement"],properties:[{name:"type",isAttr:!0,type:"String"},{name:"direction",type:"RelationshipDirection",isAttr:!0},{name:"source",isMany:!0,isReference:!0,type:"Element"},{name:"target",isMany:!0,isReference:!0,type:"Element"}]},{name:"BaseElement",isAbstract:!0,properties:[{name:"id",isAttr:!0,type:"String",isId:!0},{name:"documentation",type:"Documentation",isMany:!0},{name:"extensionDefinitions",type:"ExtensionDefinition",isMany:!0,isReference:!0},{name:"extensionElements",type:"ExtensionElements"}]},{name:"Extension",properties:[{name:"mustUnderstand",default:!1,isAttr:!0,type:"Boolean"},{name:"definition",type:"ExtensionDefinition",isAttr:!0,isReference:!0}]},{name:"ExtensionDefinition",properties:[{name:"name",isAttr:!0,type:"String"},{name:"extensionAttributeDefinitions",type:"ExtensionAttributeDefinition",isMany:!0}]},{name:"ExtensionAttributeDefinition",properties:[{name:"name",isAttr:!0,type:"String"},{name:"type",isAttr:!0,type:"String"},{name:"isReference",default:!1,isAttr:!0,type:"Boolean"},{name:"extensionDefinition",type:"ExtensionDefinition",isAttr:!0,isReference:!0}]},{name:"ExtensionElements",properties:[{name:"valueRef",isAttr:!0,isReference:!0,type:"Element"},{name:"values",type:"Element",isMany:!0},{name:"extensionAttributeDefinition",type:"ExtensionAttributeDefinition",isAttr:!0,isReference:!0}]},{name:"Documentation",superClass:["BaseElement"],properties:[{name:"text",type:"String",isBody:!0},{name:"textFormat",default:"text/plain",isAttr:!0,type:"String"}]},{name:"Event",isAbstract:!0,superClass:["FlowNode","InteractionNode"],properties:[{name:"properties",type:"Property",isMany:!0}]},{name:"IntermediateCatchEvent",superClass:["CatchEvent"]},{name:"IntermediateThrowEvent",superClass:["ThrowEvent"]},{name:"EndEvent",superClass:["ThrowEvent"]},{name:"StartEvent",superClass:["CatchEvent"],properties:[{name:"isInterrupting",default:!0,isAttr:!0,type:"Boolean"}]},{name:"ThrowEvent",isAbstract:!0,superClass:["Event"],properties:[{name:"dataInputs",type:"DataInput",isMany:!0},{name:"dataInputAssociations",type:"DataInputAssociation",isMany:!0},{name:"inputSet",type:"InputSet"},{name:"eventDefinitions",type:"EventDefinition",isMany:!0},{name:"eventDefinitionRef",type:"EventDefinition",isMany:!0,isReference:!0}]},{name:"CatchEvent",isAbstract:!0,superClass:["Event"],properties:[{name:"parallelMultiple",isAttr:!0,type:"Boolean",default:!1},{name:"dataOutputs",type:"DataOutput",isMany:!0},{name:"dataOutputAssociations",type:"DataOutputAssociation",isMany:!0},{name:"outputSet",type:"OutputSet"},{name:"eventDefinitions",type:"EventDefinition",isMany:!0},{name:"eventDefinitionRef",type:"EventDefinition",isMany:!0,isReference:!0}]},{name:"BoundaryEvent",superClass:["CatchEvent"],properties:[{name:"cancelActivity",default:!0,isAttr:!0,type:"Boolean"},{name:"attachedToRef",type:"Activity",isAttr:!0,isReference:!0}]},{name:"EventDefinition",isAbstract:!0,superClass:["RootElement"]},{name:"CancelEventDefinition",superClass:["EventDefinition"]},{name:"ErrorEventDefinition",superClass:["EventDefinition"],properties:[{name:"errorRef",type:"Error",isAttr:!0,isReference:!0}]},{name:"TerminateEventDefinition",superClass:["EventDefinition"]},{name:"EscalationEventDefinition",superClass:["EventDefinition"],properties:[{name:"escalationRef",type:"Escalation",isAttr:!0,isReference:!0}]},{name:"Escalation",properties:[{name:"structureRef",type:"ItemDefinition",isAttr:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"},{name:"escalationCode",isAttr:!0,type:"String"}],superClass:["RootElement"]},{name:"CompensateEventDefinition",superClass:["EventDefinition"],properties:[{name:"waitForCompletion",isAttr:!0,type:"Boolean"},{name:"activityRef",type:"Activity",isAttr:!0,isReference:!0}]},{name:"TimerEventDefinition",superClass:["EventDefinition"],properties:[{name:"timeDate",type:"Expression",xml:{serialize:"xsi:type"}},{name:"timeCycle",type:"Expression",xml:{serialize:"xsi:type"}},{name:"timeDuration",type:"Expression",xml:{serialize:"xsi:type"}}]},{name:"LinkEventDefinition",superClass:["EventDefinition"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"target",type:"LinkEventDefinition",isAttr:!0,isReference:!0},{name:"source",type:"LinkEventDefinition",isMany:!0,isReference:!0}]},{name:"MessageEventDefinition",superClass:["EventDefinition"],properties:[{name:"messageRef",type:"Message",isAttr:!0,isReference:!0},{name:"operationRef",type:"Operation",isAttr:!0,isReference:!0}]},{name:"ConditionalEventDefinition",superClass:["EventDefinition"],properties:[{name:"condition",type:"Expression",xml:{serialize:"xsi:type"}}]},{name:"SignalEventDefinition",superClass:["EventDefinition"],properties:[{name:"signalRef",type:"Signal",isAttr:!0,isReference:!0}]},{name:"Signal",superClass:["RootElement"],properties:[{name:"structureRef",type:"ItemDefinition",isAttr:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"}]},{name:"ImplicitThrowEvent",superClass:["ThrowEvent"]},{name:"DataState",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"}]},{name:"ItemAwareElement",superClass:["BaseElement"],properties:[{name:"itemSubjectRef",type:"ItemDefinition",isAttr:!0,isReference:!0},{name:"dataState",type:"DataState"}]},{name:"DataAssociation",superClass:["BaseElement"],properties:[{name:"assignment",type:"Assignment",isMany:!0},{name:"sourceRef",type:"ItemAwareElement",isMany:!0,isReference:!0},{name:"targetRef",type:"ItemAwareElement",isReference:!0},{name:"transformation",type:"FormalExpression",xml:{serialize:"property"}}]},{name:"DataInput",superClass:["ItemAwareElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"isCollection",default:!1,isAttr:!0,type:"Boolean"},{name:"inputSetRef",type:"InputSet",isVirtual:!0,isMany:!0,isReference:!0},{name:"inputSetWithOptional",type:"InputSet",isVirtual:!0,isMany:!0,isReference:!0},{name:"inputSetWithWhileExecuting",type:"InputSet",isVirtual:!0,isMany:!0,isReference:!0}]},{name:"DataOutput",superClass:["ItemAwareElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"isCollection",default:!1,isAttr:!0,type:"Boolean"},{name:"outputSetRef",type:"OutputSet",isVirtual:!0,isMany:!0,isReference:!0},{name:"outputSetWithOptional",type:"OutputSet",isVirtual:!0,isMany:!0,isReference:!0},{name:"outputSetWithWhileExecuting",type:"OutputSet",isVirtual:!0,isMany:!0,isReference:!0}]},{name:"InputSet",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"dataInputRefs",type:"DataInput",isMany:!0,isReference:!0},{name:"optionalInputRefs",type:"DataInput",isMany:!0,isReference:!0},{name:"whileExecutingInputRefs",type:"DataInput",isMany:!0,isReference:!0},{name:"outputSetRefs",type:"OutputSet",isMany:!0,isReference:!0}]},{name:"OutputSet",superClass:["BaseElement"],properties:[{name:"dataOutputRefs",type:"DataOutput",isMany:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"},{name:"inputSetRefs",type:"InputSet",isMany:!0,isReference:!0},{name:"optionalOutputRefs",type:"DataOutput",isMany:!0,isReference:!0},{name:"whileExecutingOutputRefs",type:"DataOutput",isMany:!0,isReference:!0}]},{name:"Property",superClass:["ItemAwareElement"],properties:[{name:"name",isAttr:!0,type:"String"}]},{name:"DataInputAssociation",superClass:["DataAssociation"]},{name:"DataOutputAssociation",superClass:["DataAssociation"]},{name:"InputOutputSpecification",superClass:["BaseElement"],properties:[{name:"dataInputs",type:"DataInput",isMany:!0},{name:"dataOutputs",type:"DataOutput",isMany:!0},{name:"inputSets",
type:"InputSet",isMany:!0},{name:"outputSets",type:"OutputSet",isMany:!0}]},{name:"DataObject",superClass:["FlowElement","ItemAwareElement"],properties:[{name:"isCollection",default:!1,isAttr:!0,type:"Boolean"}]},{name:"InputOutputBinding",properties:[{name:"inputDataRef",type:"InputSet",isAttr:!0,isReference:!0},{name:"outputDataRef",type:"OutputSet",isAttr:!0,isReference:!0},{name:"operationRef",type:"Operation",isAttr:!0,isReference:!0}]},{name:"Assignment",superClass:["BaseElement"],properties:[{name:"from",type:"Expression",xml:{serialize:"xsi:type"}},{name:"to",type:"Expression",xml:{serialize:"xsi:type"}}]},{name:"DataStore",superClass:["RootElement","ItemAwareElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"capacity",isAttr:!0,type:"Integer"},{name:"isUnlimited",default:!0,isAttr:!0,type:"Boolean"}]},{name:"DataStoreReference",superClass:["ItemAwareElement","FlowElement"],properties:[{name:"dataStoreRef",type:"DataStore",isAttr:!0,isReference:!0}]},{name:"DataObjectReference",superClass:["ItemAwareElement","FlowElement"],properties:[{name:"dataObjectRef",type:"DataObject",isAttr:!0,isReference:!0}]},{name:"ConversationLink",superClass:["BaseElement"],properties:[{name:"sourceRef",type:"InteractionNode",isAttr:!0,isReference:!0},{name:"targetRef",type:"InteractionNode",isAttr:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"}]},{name:"ConversationAssociation",superClass:["BaseElement"],properties:[{name:"innerConversationNodeRef",type:"ConversationNode",isAttr:!0,isReference:!0},{name:"outerConversationNodeRef",type:"ConversationNode",isAttr:!0,isReference:!0}]},{name:"CallConversation",superClass:["ConversationNode"],properties:[{name:"calledCollaborationRef",type:"Collaboration",isAttr:!0,isReference:!0},{name:"participantAssociations",type:"ParticipantAssociation",isMany:!0}]},{name:"Conversation",superClass:["ConversationNode"]},{name:"SubConversation",superClass:["ConversationNode"],properties:[{name:"conversationNodes",type:"ConversationNode",isMany:!0}]},{name:"ConversationNode",isAbstract:!0,superClass:["InteractionNode","BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"participantRefs",type:"Participant",isMany:!0,isReference:!0},{name:"messageFlowRefs",type:"MessageFlow",isMany:!0,isReference:!0},{name:"correlationKeys",type:"CorrelationKey",isMany:!0}]},{name:"GlobalConversation",superClass:["Collaboration"]},{name:"PartnerEntity",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"participantRef",type:"Participant",isMany:!0,isReference:!0}]},{name:"PartnerRole",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"participantRef",type:"Participant",isMany:!0,isReference:!0}]},{name:"CorrelationProperty",superClass:["RootElement"],properties:[{name:"correlationPropertyRetrievalExpression",type:"CorrelationPropertyRetrievalExpression",isMany:!0},{name:"name",isAttr:!0,type:"String"},{name:"type",type:"ItemDefinition",isAttr:!0,isReference:!0}]},{name:"Error",superClass:["RootElement"],properties:[{name:"structureRef",type:"ItemDefinition",isAttr:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"},{name:"errorCode",isAttr:!0,type:"String"}]},{name:"CorrelationKey",superClass:["BaseElement"],properties:[{name:"correlationPropertyRef",type:"CorrelationProperty",isMany:!0,isReference:!0},{name:"name",isAttr:!0,type:"String"}]},{name:"Expression",superClass:["BaseElement"],isAbstract:!1,properties:[{name:"body",type:"String",isBody:!0}]},{name:"FormalExpression",superClass:["Expression"],properties:[{name:"language",isAttr:!0,type:"String"},{name:"evaluatesToTypeRef",type:"ItemDefinition",isAttr:!0,isReference:!0}]},{name:"Message",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"itemRef",type:"ItemDefinition",isAttr:!0,isReference:!0}]},{name:"ItemDefinition",superClass:["RootElement"],properties:[{name:"itemKind",type:"ItemKind",isAttr:!0},{name:"structureRef",type:"String",isAttr:!0},{name:"isCollection",default:!1,isAttr:!0,type:"Boolean"},{name:"import",type:"Import",isAttr:!0,isReference:!0}]},{name:"FlowElement",isAbstract:!0,superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"auditing",type:"Auditing"},{name:"monitoring",type:"Monitoring"},{name:"categoryValueRef",type:"CategoryValue",isMany:!0,isReference:!0}]},{name:"SequenceFlow",superClass:["FlowElement"],properties:[{name:"isImmediate",isAttr:!0,type:"Boolean"},{name:"conditionExpression",type:"Expression",xml:{serialize:"xsi:type"}},{name:"sourceRef",type:"FlowNode",isAttr:!0,isReference:!0},{name:"targetRef",type:"FlowNode",isAttr:!0,isReference:!0}]},{name:"FlowElementsContainer",isAbstract:!0,superClass:["BaseElement"],properties:[{name:"laneSets",type:"LaneSet",isMany:!0},{name:"flowElements",type:"FlowElement",isMany:!0}]},{name:"CallableElement",isAbstract:!0,superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"ioSpecification",type:"InputOutputSpecification",xml:{serialize:"property"}},{name:"supportedInterfaceRef",type:"Interface",isMany:!0,isReference:!0},{name:"ioBinding",type:"InputOutputBinding",isMany:!0,xml:{serialize:"property"}}]},{name:"FlowNode",isAbstract:!0,superClass:["FlowElement"],properties:[{name:"incoming",type:"SequenceFlow",isMany:!0,isReference:!0},{name:"outgoing",type:"SequenceFlow",isMany:!0,isReference:!0},{name:"lanes",type:"Lane",isVirtual:!0,isMany:!0,isReference:!0}]},{name:"CorrelationPropertyRetrievalExpression",superClass:["BaseElement"],properties:[{name:"messagePath",type:"FormalExpression"},{name:"messageRef",type:"Message",isAttr:!0,isReference:!0}]},{name:"CorrelationPropertyBinding",superClass:["BaseElement"],properties:[{name:"dataPath",type:"FormalExpression"},{name:"correlationPropertyRef",type:"CorrelationProperty",isAttr:!0,isReference:!0}]},{name:"Resource",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"resourceParameters",type:"ResourceParameter",isMany:!0}]},{name:"ResourceParameter",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"isRequired",isAttr:!0,type:"Boolean"},{name:"type",type:"ItemDefinition",isAttr:!0,isReference:!0}]},{name:"CorrelationSubscription",superClass:["BaseElement"],properties:[{name:"correlationKeyRef",type:"CorrelationKey",isAttr:!0,isReference:!0},{name:"correlationPropertyBinding",type:"CorrelationPropertyBinding",isMany:!0}]},{name:"MessageFlow",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"sourceRef",type:"InteractionNode",isAttr:!0,isReference:!0},{name:"targetRef",type:"InteractionNode",isAttr:!0,isReference:!0},{name:"messageRef",type:"Message",isAttr:!0,isReference:!0}]},{name:"MessageFlowAssociation",superClass:["BaseElement"],properties:[{name:"innerMessageFlowRef",type:"MessageFlow",isAttr:!0,isReference:!0},{name:"outerMessageFlowRef",type:"MessageFlow",isAttr:!0,isReference:!0}]},{name:"InteractionNode",isAbstract:!0,properties:[{name:"incomingConversationLinks",type:"ConversationLink",isVirtual:!0,isMany:!0,isReference:!0},{name:"outgoingConversationLinks",type:"ConversationLink",isVirtual:!0,isMany:!0,isReference:!0}]},{name:"Participant",superClass:["InteractionNode","BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"interfaceRef",type:"Interface",isMany:!0,isReference:!0},{name:"participantMultiplicity",type:"ParticipantMultiplicity"},{name:"endPointRefs",type:"EndPoint",isMany:!0,isReference:!0},{name:"processRef",type:"Process",isAttr:!0,isReference:!0}]},{name:"ParticipantAssociation",superClass:["BaseElement"],properties:[{name:"innerParticipantRef",type:"Participant",isAttr:!0,isReference:!0},{name:"outerParticipantRef",type:"Participant",isAttr:!0,isReference:!0}]},{name:"ParticipantMultiplicity",properties:[{name:"minimum",default:0,isAttr:!0,type:"Integer"},{name:"maximum",default:1,isAttr:!0,type:"Integer"}]},{name:"Collaboration",superClass:["RootElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"isClosed",isAttr:!0,type:"Boolean"},{name:"participants",type:"Participant",isMany:!0},{name:"messageFlows",type:"MessageFlow",isMany:!0},{name:"artifacts",type:"Artifact",isMany:!0},{name:"conversations",type:"ConversationNode",isMany:!0},{name:"conversationAssociations",type:"ConversationAssociation"},{name:"participantAssociations",type:"ParticipantAssociation",isMany:!0},{name:"messageFlowAssociations",type:"MessageFlowAssociation",isMany:!0},{name:"correlationKeys",type:"CorrelationKey",isMany:!0},{name:"choreographyRef",type:"Choreography",isMany:!0,isReference:!0},{name:"conversationLinks",type:"ConversationLink",isMany:!0}]},{name:"ChoreographyActivity",isAbstract:!0,superClass:["FlowNode"],properties:[{name:"participantRefs",type:"Participant",isMany:!0,isReference:!0},{name:"initiatingParticipantRef",type:"Participant",isAttr:!0,isReference:!0},{name:"correlationKeys",type:"CorrelationKey",isMany:!0},{name:"loopType",type:"ChoreographyLoopType",default:"None",isAttr:!0}]},{name:"CallChoreography",superClass:["ChoreographyActivity"],properties:[{name:"calledChoreographyRef",type:"Choreography",isAttr:!0,isReference:!0},{name:"participantAssociations",type:"ParticipantAssociation",isMany:!0}]},{name:"SubChoreography",superClass:["ChoreographyActivity","FlowElementsContainer"],properties:[{name:"artifacts",type:"Artifact",isMany:!0}]},{name:"ChoreographyTask",superClass:["ChoreographyActivity"],properties:[{name:"messageFlowRef",type:"MessageFlow",isMany:!0,isReference:!0}]},{name:"Choreography",superClass:["FlowElementsContainer","Collaboration"]},{name:"GlobalChoreographyTask",superClass:["Choreography"],properties:[{name:"initiatingParticipantRef",type:"Participant",isAttr:!0,isReference:!0}]},{name:"TextAnnotation",superClass:["Artifact"],properties:[{name:"text",type:"String"},{name:"textFormat",default:"text/plain",isAttr:!0,type:"String"}]},{name:"Group",superClass:["Artifact"],properties:[{name:"categoryValueRef",type:"CategoryValue",isAttr:!0,isReference:!0}]},{name:"Association",superClass:["Artifact"],properties:[{name:"associationDirection",type:"AssociationDirection",isAttr:!0},{name:"sourceRef",type:"BaseElement",isAttr:!0,isReference:!0},{name:"targetRef",type:"BaseElement",isAttr:!0,isReference:!0}]},{name:"Category",superClass:["RootElement"],properties:[{name:"categoryValue",type:"CategoryValue",isMany:!0},{name:"name",isAttr:!0,type:"String"}]},{name:"Artifact",isAbstract:!0,superClass:["BaseElement"]},{name:"CategoryValue",superClass:["BaseElement"],properties:[{name:"categorizedFlowElements",type:"FlowElement",isVirtual:!0,isMany:!0,isReference:!0},{name:"value",isAttr:!0,type:"String"}]},{name:"Activity",isAbstract:!0,superClass:["FlowNode"],properties:[{name:"isForCompensation",default:!1,isAttr:!0,type:"Boolean"},{name:"default",type:"SequenceFlow",isAttr:!0,isReference:!0},{name:"ioSpecification",type:"InputOutputSpecification",xml:{serialize:"property"}},{name:"boundaryEventRefs",type:"BoundaryEvent",isMany:!0,isReference:!0},{name:"properties",type:"Property",isMany:!0},{name:"dataInputAssociations",type:"DataInputAssociation",isMany:!0},{name:"dataOutputAssociations",type:"DataOutputAssociation",isMany:!0},{name:"startQuantity",default:1,isAttr:!0,type:"Integer"},{name:"resources",type:"ResourceRole",isMany:!0},{name:"completionQuantity",default:1,isAttr:!0,type:"Integer"},{name:"loopCharacteristics",type:"LoopCharacteristics"}]},{name:"ServiceTask",superClass:["Task"],properties:[{name:"implementation",isAttr:!0,type:"String"},{name:"operationRef",type:"Operation",isAttr:!0,isReference:!0}]},{name:"SubProcess",superClass:["Activity","FlowElementsContainer","InteractionNode"],properties:[{name:"triggeredByEvent",default:!1,isAttr:!0,type:"Boolean"},{name:"artifacts",type:"Artifact",isMany:!0}]},{name:"LoopCharacteristics",isAbstract:!0,superClass:["BaseElement"]},{name:"MultiInstanceLoopCharacteristics",superClass:["LoopCharacteristics"],properties:[{name:"isSequential",default:!1,isAttr:!0,type:"Boolean"},{name:"behavior",type:"MultiInstanceBehavior",default:"All",isAttr:!0},{name:"loopCardinality",type:"Expression",xml:{serialize:"xsi:type"}},{name:"loopDataInputRef",type:"ItemAwareElement",isReference:!0},{name:"loopDataOutputRef",type:"ItemAwareElement",isReference:!0},{name:"inputDataItem",type:"DataInput",xml:{serialize:"property"}},{name:"outputDataItem",type:"DataOutput",xml:{serialize:"property"}},{name:"complexBehaviorDefinition",type:"ComplexBehaviorDefinition",isMany:!0},{name:"completionCondition",type:"Expression",xml:{serialize:"xsi:type"}},{name:"oneBehaviorEventRef",type:"EventDefinition",isAttr:!0,isReference:!0},{name:"noneBehaviorEventRef",type:"EventDefinition",isAttr:!0,isReference:!0}]},{name:"StandardLoopCharacteristics",superClass:["LoopCharacteristics"],properties:[{name:"testBefore",default:!1,isAttr:!0,type:"Boolean"},{name:"loopCondition",type:"Expression",xml:{serialize:"xsi:type"}},{name:"loopMaximum",type:"Expression",xml:{serialize:"xsi:type"}}]},{name:"CallActivity",superClass:["Activity"],properties:[{name:"calledElement",type:"String",isAttr:!0}]},{name:"Task",superClass:["Activity","InteractionNode"]},{name:"SendTask",superClass:["Task"],properties:[{name:"implementation",isAttr:!0,type:"String"},{name:"operationRef",type:"Operation",isAttr:!0,isReference:!0},{name:"messageRef",type:"Message",isAttr:!0,isReference:!0}]},{name:"ReceiveTask",superClass:["Task"],properties:[{name:"implementation",isAttr:!0,type:"String"},{name:"instantiate",default:!1,isAttr:!0,type:"Boolean"},{name:"operationRef",type:"Operation",isAttr:!0,isReference:!0},{name:"messageRef",type:"Message",isAttr:!0,isReference:!0}]},{name:"ScriptTask",superClass:["Task"],properties:[{name:"scriptFormat",isAttr:!0,type:"String"},{name:"script",type:"String"}]},{name:"BusinessRuleTask",superClass:["Task"],properties:[{name:"implementation",isAttr:!0,type:"String"}]},{name:"AdHocSubProcess",superClass:["SubProcess"],properties:[{name:"completionCondition",type:"Expression",xml:{serialize:"xsi:type"}},{name:"ordering",type:"AdHocOrdering",isAttr:!0},{name:"cancelRemainingInstances",default:!0,isAttr:!0,type:"Boolean"}]},{name:"Transaction",superClass:["SubProcess"],properties:[{name:"protocol",isAttr:!0,type:"String"},{name:"method",isAttr:!0,type:"String"}]},{name:"GlobalScriptTask",superClass:["GlobalTask"],properties:[{name:"scriptLanguage",isAttr:!0,type:"String"},{name:"script",isAttr:!0,type:"String"}]},{name:"GlobalBusinessRuleTask",superClass:["GlobalTask"],properties:[{name:"implementation",isAttr:!0,type:"String"}]},{name:"ComplexBehaviorDefinition",superClass:["BaseElement"],properties:[{name:"condition",type:"FormalExpression"},{name:"event",type:"ImplicitThrowEvent"}]},{name:"ResourceRole",superClass:["BaseElement"],properties:[{name:"resourceRef",type:"Resource",isReference:!0},{name:"resourceParameterBindings",type:"ResourceParameterBinding",isMany:!0},{name:"resourceAssignmentExpression",type:"ResourceAssignmentExpression"},{name:"name",isAttr:!0,type:"String"}]},{name:"ResourceParameterBinding",properties:[{name:"expression",type:"Expression",xml:{serialize:"xsi:type"}},{name:"parameterRef",type:"ResourceParameter",isAttr:!0,isReference:!0}]},{name:"ResourceAssignmentExpression",properties:[{name:"expression",type:"Expression",xml:{serialize:"xsi:type"}}],superClass:["BaseElement"]},{name:"Import",properties:[{name:"importType",isAttr:!0,type:"String"},{name:"location",isAttr:!0,type:"String"},{name:"namespace",isAttr:!0,type:"String"}]},{name:"Definitions",superClass:["BaseElement"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"targetNamespace",isAttr:!0,type:"String"},{name:"expressionLanguage",default:"http://www.w3.org/1999/XPath",isAttr:!0,type:"String"},{name:"typeLanguage",default:"http://www.w3.org/2001/XMLSchema",isAttr:!0,type:"String"},{name:"imports",type:"Import",isMany:!0},{name:"extensions",type:"Extension",isMany:!0},{name:"rootElements",type:"RootElement",isMany:!0},{name:"diagrams",isMany:!0,type:"bpmndi:BPMNDiagram"},{name:"exporter",isAttr:!0,type:"String"},{name:"relationships",type:"Relationship",isMany:!0},{name:"exporterVersion",isAttr:!0,type:"String"}]}],emumerations:[{name:"ProcessType",literalValues:[{name:"None"},{name:"Public"},{name:"Private"}]},{name:"GatewayDirection",literalValues:[{name:"Unspecified"},{name:"Converging"},{name:"Diverging"},{name:"Mixed"}]},{name:"EventBasedGatewayType",literalValues:[{name:"Parallel"},{name:"Exclusive"}]},{name:"RelationshipDirection",literalValues:[{name:"None"},{name:"Forward"},{name:"Backward"},{name:"Both"}]},{name:"ItemKind",literalValues:[{name:"Physical"},{name:"Information"}]},{name:"ChoreographyLoopType",literalValues:[{name:"None"},{name:"Standard"},{name:"MultiInstanceSequential"},{name:"MultiInstanceParallel"}]},{name:"AssociationDirection",literalValues:[{name:"None"},{name:"One"},{name:"Both"}]},{name:"MultiInstanceBehavior",literalValues:[{name:"None"},{name:"One"},{name:"All"},{name:"Complex"}]},{name:"AdHocOrdering",literalValues:[{name:"Parallel"},{name:"Sequential"}]}],prefix:"bpmn",xml:{tagAlias:"lowerCase",typePrefix:"t"}}},{}],275:[function(_dereq_,module,exports){module.exports={name:"BPMNDI",uri:"http://www.omg.org/spec/BPMN/20100524/DI",types:[{name:"BPMNDiagram",properties:[{name:"plane",type:"BPMNPlane",redefines:"di:Diagram#rootElement"},{name:"labelStyle",type:"BPMNLabelStyle",isMany:!0}],superClass:["di:Diagram"]},{name:"BPMNPlane",properties:[{name:"bpmnElement",isAttr:!0,isReference:!0,type:"bpmn:BaseElement",redefines:"di:DiagramElement#modelElement"}],superClass:["di:Plane"]},{name:"BPMNShape",properties:[{name:"bpmnElement",isAttr:!0,isReference:!0,type:"bpmn:BaseElement",redefines:"di:DiagramElement#modelElement"},{name:"isHorizontal",isAttr:!0,type:"Boolean"},{name:"isExpanded",isAttr:!0,type:"Boolean"},{name:"isMarkerVisible",isAttr:!0,type:"Boolean"},{name:"label",type:"BPMNLabel"},{name:"isMessageVisible",isAttr:!0,type:"Boolean"},{name:"participantBandKind",type:"ParticipantBandKind",isAttr:!0},{name:"choreographyActivityShape",type:"BPMNShape",isAttr:!0,isReference:!0}],superClass:["di:LabeledShape"]},{name:"BPMNEdge",properties:[{name:"label",type:"BPMNLabel"},{name:"bpmnElement",isAttr:!0,isReference:!0,type:"bpmn:BaseElement",redefines:"di:DiagramElement#modelElement"},{name:"sourceElement",isAttr:!0,isReference:!0,type:"di:DiagramElement",redefines:"di:Edge#source"},{name:"targetElement",isAttr:!0,isReference:!0,type:"di:DiagramElement",redefines:"di:Edge#target"},{name:"messageVisibleKind",type:"MessageVisibleKind",isAttr:!0,default:"initiating"}],superClass:["di:LabeledEdge"]},{name:"BPMNLabel",properties:[{name:"labelStyle",type:"BPMNLabelStyle",isAttr:!0,isReference:!0,redefines:"di:DiagramElement#style"}],superClass:["di:Label"]},{name:"BPMNLabelStyle",properties:[{name:"font",type:"dc:Font"}],superClass:["di:Style"]}],emumerations:[{name:"ParticipantBandKind",literalValues:[{name:"top_initiating"},{name:"middle_initiating"},{name:"bottom_initiating"},{name:"top_non_initiating"},{name:"middle_non_initiating"},{name:"bottom_non_initiating"}]},{name:"MessageVisibleKind",literalValues:[{name:"initiating"},{name:"non_initiating"}]}],associations:[],prefix:"bpmndi"}},{}],276:[function(_dereq_,module,exports){module.exports={name:"DC",uri:"http://www.omg.org/spec/DD/20100524/DC",types:[{name:"Boolean"},{name:"Integer"},{name:"Real"},{name:"String"},{name:"Font",properties:[{name:"name",type:"String",isAttr:!0},{name:"size",type:"Real",isAttr:!0},{name:"isBold",type:"Boolean",isAttr:!0},{name:"isItalic",type:"Boolean",isAttr:!0},{name:"isUnderline",type:"Boolean",isAttr:!0},{name:"isStrikeThrough",type:"Boolean",isAttr:!0}]},{name:"Point",properties:[{name:"x",type:"Real",default:"0",isAttr:!0},{name:"y",type:"Real",default:"0",isAttr:!0}]},{name:"Bounds",properties:[{name:"x",type:"Real",default:"0",isAttr:!0},{name:"y",type:"Real",default:"0",isAttr:!0},{name:"width",type:"Real",isAttr:!0},{name:"height",type:"Real",isAttr:!0}]}],prefix:"dc",associations:[]}},{}],277:[function(_dereq_,module,exports){module.exports={name:"DI",uri:"http://www.omg.org/spec/DD/20100524/DI",types:[{name:"DiagramElement",isAbstract:!0,properties:[{name:"id",type:"String",isAttr:!0,isId:!0},{name:"extension",type:"Extension"},{name:"owningDiagram",type:"Diagram",isReadOnly:!0,isVirtual:!0,isReference:!0},{name:"owningElement",type:"DiagramElement",isReadOnly:!0,isVirtual:!0,isReference:!0},{name:"modelElement",isReadOnly:!0,isVirtual:!0,isReference:!0,type:"Element"},{name:"style",type:"Style",isReadOnly:!0,isVirtual:!0,isReference:!0},{name:"ownedElement",type:"DiagramElement",isReadOnly:!0,isVirtual:!0,isMany:!0}]},{name:"Node",isAbstract:!0,superClass:["DiagramElement"]},{name:"Edge",isAbstract:!0,superClass:["DiagramElement"],properties:[{name:"source",type:"DiagramElement",isReadOnly:!0,isVirtual:!0,isReference:!0},{name:"target",type:"DiagramElement",isReadOnly:!0,isVirtual:!0,isReference:!0},{name:"waypoint",isUnique:!1,isMany:!0,type:"dc:Point",xml:{serialize:"xsi:type"}}]},{name:"Diagram",isAbstract:!0,properties:[{name:"id",type:"String",isAttr:!0,isId:!0},{name:"rootElement",type:"DiagramElement",isReadOnly:!0,isVirtual:!0},{name:"name",isAttr:!0,type:"String"},{name:"documentation",isAttr:!0,type:"String"},{name:"resolution",isAttr:!0,type:"Real"},{name:"ownedStyle",type:"Style",isReadOnly:!0,isVirtual:!0,isMany:!0}]},{name:"Shape",isAbstract:!0,superClass:["Node"],properties:[{name:"bounds",type:"dc:Bounds"}]},{name:"Plane",isAbstract:!0,superClass:["Node"],properties:[{name:"planeElement",type:"DiagramElement",subsettedProperty:"DiagramElement-ownedElement",isMany:!0}]},{name:"LabeledEdge",isAbstract:!0,superClass:["Edge"],properties:[{name:"ownedLabel",type:"Label",isReadOnly:!0,subsettedProperty:"DiagramElement-ownedElement",isVirtual:!0,isMany:!0}]},{name:"LabeledShape",isAbstract:!0,superClass:["Shape"],properties:[{name:"ownedLabel",type:"Label",isReadOnly:!0,subsettedProperty:"DiagramElement-ownedElement",isVirtual:!0,isMany:!0}]},{name:"Label",isAbstract:!0,superClass:["Node"],properties:[{name:"bounds",type:"dc:Bounds"}]},{name:"Style",isAbstract:!0,properties:[{name:"id",type:"String",isAttr:!0,isId:!0}]},{name:"Extension",properties:[{name:"values",type:"Element",isMany:!0}]}],associations:[],prefix:"di",xml:{tagAlias:"lowerCase"}}},{}],278:[function(_dereq_,module,exports){arguments[4][70][0].apply(exports,arguments)},{284:284,70:70}],279:[function(_dereq_,module,exports){arguments[4][71][0].apply(exports,arguments)},{285:285,71:71}],280:[function(_dereq_,module,exports){arguments[4][72][0].apply(exports,arguments)},{281:281,282:282,72:72}],281:[function(_dereq_,module,exports){arguments[4][73][0].apply(exports,arguments)},{285:285,73:73}],282:[function(_dereq_,module,exports){arguments[4][74][0].apply(exports,arguments)},{74:74}],283:[function(_dereq_,module,exports){arguments[4][75][0].apply(exports,arguments)},{75:75}],284:[function(_dereq_,module,exports){arguments[4][76][0].apply(exports,arguments)},{76:76}],285:[function(_dereq_,module,exports){arguments[4][77][0].apply(exports,arguments)},{286:286,77:77}],286:[function(_dereq_,module,exports){arguments[4][78][0].apply(exports,arguments)},{78:78}],287:[function(_dereq_,module,exports){module.exports={__depends__:[_dereq_(337)],__init__:["directEditing"],directEditing:["type",_dereq_(288)]}},{288:288,337:337}],288:[function(_dereq_,module,exports){"use strict";function DirectEditing(eventBus,canvas){this._eventBus=eventBus,this._providers=[],this._textbox=new TextBox({container:canvas.getContainer(),keyHandler:bind(this._handleKey,this)})}var bind=_dereq_(473),find=_dereq_(463),TextBox=_dereq_(289);DirectEditing.$inject=["eventBus","canvas"],DirectEditing.prototype.registerProvider=function(provider){this._providers.push(provider)},DirectEditing.prototype.isActive=function(){return!!this._active},DirectEditing.prototype.cancel=function(){this._active&&(this._fire("cancel"),this.close())},DirectEditing.prototype._fire=function(event){this._eventBus.fire("directEditing."+event,{active:this._active})},DirectEditing.prototype.close=function(){this._textbox.destroy(),this._fire("deactivate"),this._active=null},DirectEditing.prototype.complete=function(){var active=this._active;if(active){var text=this.getValue();text!==active.context.text&&active.provider.update(active.element,text,active.context.text),this._fire("complete"),this.close()}},DirectEditing.prototype.getValue=function(){return this._textbox.getValue()},DirectEditing.prototype._handleKey=function(e){e.stopPropagation();var key=e.keyCode||e.charCode;return 27===key?(e.preventDefault(),this.cancel()):13!==key||e.shiftKey?void 0:(e.preventDefault(),this.complete())},DirectEditing.prototype.activate=function(element){this.isActive()&&this.cancel();var context,provider=find(this._providers,function(p){return(context=p.activate(element))?p:null});return context&&(this._textbox.create(context.bounds,context.style,context.text),this._active={element:element,context:context,provider:provider},this._fire("activate")),!!context},module.exports=DirectEditing},{289:289,463:463,473:473}],289:[function(_dereq_,module,exports){"use strict";function stopPropagation(event){event.stopPropagation()}function TextBox(options){this.container=options.container,this.textarea=document.createElement("textarea"),this.keyHandler=options.keyHandler||function(){}}var assign=_dereq_(592),domEvent=_dereq_(610),domRemove=_dereq_(613);module.exports=TextBox,TextBox.prototype.create=function(bounds,style,value){var textarea=this.textarea,container=this.container;assign(textarea.style,{width:bounds.width+"px",height:bounds.height+"px",left:bounds.x+"px",top:bounds.y+"px",position:"absolute",textAlign:"center",boxSizing:"border-box"},style||{}),textarea.value=value,textarea.title="Press SHIFT+Enter for line feed",domEvent.bind(textarea,"keydown",this.keyHandler),domEvent.bind(textarea,"mousedown",stopPropagation),container.appendChild(textarea),setTimeout(function(){textarea.parent&&textarea.select(),textarea.focus()},100)},TextBox.prototype.destroy=function(){var textarea=this.textarea;textarea.value="",domEvent.unbind(textarea,"keydown",this.keyHandler),domEvent.unbind(textarea,"mousedown",stopPropagation),domRemove(textarea)},TextBox.prototype.getValue=function(){return this.textarea.value}},{592:592,610:610,613:613}],290:[function(_dereq_,module,exports){module.exports=_dereq_(291)},{291:291}],291:[function(_dereq_,module,exports){"use strict";function bootstrap(bootstrapModules){function hasModule(m){return modules.indexOf(m)>=0}function addModule(m){modules.push(m)}function visit(m){hasModule(m)||((m.__depends__||[]).forEach(visit),hasModule(m)||(addModule(m),(m.__init__||[]).forEach(function(c){components.push(c)})))}var modules=[],components=[];bootstrapModules.forEach(visit);var injector=new di.Injector(modules);return components.forEach(function(c){try{injector["string"==typeof c?"get":"invoke"](c)}catch(e){throw console.error("Failed to instantiate component"),console.error(e.stack),e}}),injector}function createInjector(options){return options=options||{},bootstrap([{config:["value",options]},_dereq_(300)].concat(options.modules||[]))}function Diagram(options,injector){this.injector=injector=injector||createInjector(options),this.get=injector.get,this.invoke=injector.invoke,this.get("eventBus").fire("diagram.init")}var di=_dereq_(443);module.exports=Diagram,Diagram.prototype.destroy=function(){this.get("eventBus").fire("diagram.destroy")},Diagram.prototype.clear=function(){this.get("eventBus").fire("diagram.clear")}},{300:300,443:443}],292:[function(_dereq_,module,exports){"use strict";function isObject(element){return"object"==typeof element}function CommandInterceptor(eventBus){this._eventBus=eventBus}function unwrapEvent(fn,that){return function(event){return fn.call(that||null,event.context,event.command,event)}}var forEach=_dereq_(464),isFunction=_dereq_(584),isArray=_dereq_(583),isNumber=_dereq_(586);CommandInterceptor.$inject=["eventBus"],module.exports=CommandInterceptor,CommandInterceptor.prototype.on=function(events,hook,priority,handlerFn,unwrap,that){if((isFunction(hook)||isNumber(hook))&&(that=unwrap,unwrap=handlerFn,handlerFn=priority,priority=hook,hook=null),isFunction(priority)&&(that=unwrap,unwrap=handlerFn,handlerFn=priority,priority=1e3),isObject(unwrap)&&(that=unwrap,unwrap=!1),!isFunction(handlerFn))throw new Error("handlerFn must be a function");isArray(events)||(events=[events]);var eventBus=this._eventBus;forEach(events,function(event){var fullEvent=["commandStack",event,hook].filter(function(e){return e}).join(".");eventBus.on(fullEvent,priority,unwrap?unwrapEvent(handlerFn,that):handlerFn,that)})},forEach(["canExecute","preExecute","preExecuted","execute","executed","postExecute","postExecuted","revert","reverted"],function(hook){CommandInterceptor.prototype[hook]=function(events,priority,handlerFn,unwrap,that){(isFunction(events)||isNumber(events))&&(that=unwrap,unwrap=handlerFn,handlerFn=priority,priority=events,events=null),this.on(events,hook,priority,handlerFn,unwrap,that)}})},{464:464,583:583,584:584,586:586}],293:[function(_dereq_,module,exports){"use strict";function CommandStack(eventBus,injector){this._handlerMap={},this._stack=[],this._stackIdx=-1,this._currentExecution={actions:[],dirty:[]},this._injector=injector,this._eventBus=eventBus,this._uid=1,eventBus.on(["diagram.destroy","diagram.clear"],this.clear,this)}var unique=_dereq_(457),isArray=_dereq_(583),assign=_dereq_(592),InternalEvent=_dereq_(298).Event;CommandStack.$inject=["eventBus","injector"],module.exports=CommandStack,CommandStack.prototype.execute=function(command,context){if(!command)throw new Error("command required");var action={command:command,context:context};this._pushAction(action),this._internalExecute(action),this._popAction(action)},CommandStack.prototype.canExecute=function(command,context){var action={command:command,context:context},handler=this._getHandler(command),result=this._fire(command,"canExecute",action);if(void 0===result){if(!handler)return!1;handler.canExecute&&(result=handler.canExecute(context))}return result},CommandStack.prototype.clear=function(){this._stack.length=0,this._stackIdx=-1,this._fire("changed")},CommandStack.prototype.undo=function(){var next,action=this._getUndoAction();if(action){for(this._pushAction(action);action&&(this._internalUndo(action),(next=this._getUndoAction())&&next.id===action.id);)action=next;this._popAction()}},CommandStack.prototype.redo=function(){var next,action=this._getRedoAction();if(action){for(this._pushAction(action);action&&(this._internalExecute(action,!0),(next=this._getRedoAction())&&next.id===action.id);)action=next;this._popAction()}},CommandStack.prototype.register=function(command,handler){this._setHandler(command,handler)},CommandStack.prototype.registerHandler=function(command,handlerCls){if(!command||!handlerCls)throw new Error("command and handlerCls must be defined");var handler=this._injector.instantiate(handlerCls);this.register(command,handler)},CommandStack.prototype.canUndo=function(){return!!this._getUndoAction()},CommandStack.prototype.canRedo=function(){return!!this._getRedoAction()},CommandStack.prototype._getRedoAction=function(){return this._stack[this._stackIdx+1]},CommandStack.prototype._getUndoAction=function(){return this._stack[this._stackIdx]},CommandStack.prototype._internalUndo=function(action){var self=this,command=action.command,context=action.context,handler=this._getHandler(command);this._atomicDo(function(){self._fire(command,"revert",action),handler.revert&&self._markDirty(handler.revert(context)),self._revertedAction(action),self._fire(command,"reverted",action)})},CommandStack.prototype._fire=function(command,qualifier,event){arguments.length<3&&(event=qualifier,qualifier=null)
;var i,name,result,names=qualifier?[command+"."+qualifier,qualifier]:[command];for(event=assign(new InternalEvent,event),i=0;(name=names[i])&&(result=this._eventBus.fire("commandStack."+name,event),!event.cancelBubble);i++);return result},CommandStack.prototype._createId=function(){return this._uid++},CommandStack.prototype._atomicDo=function(fn){var execution=this._currentExecution;execution.atomic=!0;try{fn()}finally{execution.atomic=!1}},CommandStack.prototype._internalExecute=function(action,redo){var self=this,command=action.command,context=action.context,handler=this._getHandler(command);if(!handler)throw new Error("no command handler registered for <"+command+">");this._pushAction(action),redo||(this._fire(command,"preExecute",action),handler.preExecute&&handler.preExecute(context),this._fire(command,"preExecuted",action)),this._atomicDo(function(){self._fire(command,"execute",action),handler.execute&&self._markDirty(handler.execute(context)),self._executedAction(action,redo),self._fire(command,"executed",action)}),redo||(this._fire(command,"postExecute",action),handler.postExecute&&handler.postExecute(context),this._fire(command,"postExecuted",action)),this._popAction(action)},CommandStack.prototype._pushAction=function(action){var execution=this._currentExecution,actions=execution.actions,baseAction=actions[0];if(execution.atomic)throw new Error("illegal invocation in <execute> or <revert> phase (action: "+action.command+")");action.id||(action.id=baseAction&&baseAction.id||this._createId()),actions.push(action)},CommandStack.prototype._popAction=function(){var execution=this._currentExecution,actions=execution.actions,dirty=execution.dirty;actions.pop(),actions.length||(this._eventBus.fire("elements.changed",{elements:unique(dirty)}),dirty.length=0,this._fire("changed"))},CommandStack.prototype._markDirty=function(elements){var execution=this._currentExecution;elements&&(elements=isArray(elements)?elements:[elements],execution.dirty=execution.dirty.concat(elements))},CommandStack.prototype._executedAction=function(action,redo){var stackIdx=++this._stackIdx;redo||this._stack.splice(stackIdx,this._stack.length,action)},CommandStack.prototype._revertedAction=function(action){this._stackIdx--},CommandStack.prototype._getHandler=function(command){return this._handlerMap[command]},CommandStack.prototype._setHandler=function(command,handler){if(!command||!handler)throw new Error("command and handler required");if(this._handlerMap[command])throw new Error("overriding handler for command <"+command+">");this._handlerMap[command]=handler}},{298:298,457:457,583:583,592:592}],294:[function(_dereq_,module,exports){module.exports={commandStack:["type",_dereq_(293)]}},{293:293}],295:[function(_dereq_,module,exports){"use strict";function round(number,resolution){return Math.round(number*resolution)/resolution}function ensurePx(number){return isNumber(number)?number+"px":number}function createContainer(options){options=assign({},{width:"100%",height:"100%"},options);var container=options.container||document.body,parent=document.createElement("div");return parent.setAttribute("class","djs-container"),assign(parent.style,{position:"relative",overflow:"hidden",width:ensurePx(options.width),height:ensurePx(options.height)}),container.appendChild(parent),parent}function createGroup(parent,cls){return parent.group().attr({class:cls})}function Canvas(config,eventBus,graphicsFactory,elementRegistry){this._eventBus=eventBus,this._elementRegistry=elementRegistry,this._graphicsFactory=graphicsFactory,this._init(config||{})}function setCTM(node,m){var mstr="matrix("+m.a+","+m.b+","+m.c+","+m.d+","+m.e+","+m.f+")";node.setAttribute("transform",mstr)}var isNumber=_dereq_(586),assign=_dereq_(592),forEach=_dereq_(464),every=_dereq_(461),debounce=_dereq_(474),Collections=_dereq_(425),Elements=_dereq_(428),Snap=_dereq_(441),REQUIRED_MODEL_ATTRS={shape:["x","y","width","height"],connection:["waypoints"]};Canvas.$inject=["config.canvas","eventBus","graphicsFactory","elementRegistry"],module.exports=Canvas,Canvas.prototype._init=function(config){var eventBus=this._eventBus,container=this._container=createContainer(config),svg=this._svg=Snap.createSnapAt("100%","100%",container),viewport=this._viewport=createGroup(svg,"viewport");this._layers={},!1!==config.deferUpdate&&(this._viewboxChanged=debounce(this._viewboxChanged,300)),eventBus.on("diagram.init",function(){eventBus.fire("canvas.init",{svg:svg,viewport:viewport}),this.resized()},this),eventBus.on("diagram.destroy",500,this._destroy,this),eventBus.on("diagram.clear",500,this._clear,this)},Canvas.prototype._destroy=function(emit){this._eventBus.fire("canvas.destroy",{svg:this._svg,viewport:this._viewport});var parent=this._container.parentNode;parent&&parent.removeChild(this._container),delete this._svg,delete this._container,delete this._layers,delete this._rootElement,delete this._viewport},Canvas.prototype._clear=function(){var self=this;this._elementRegistry.getAll().forEach(function(element){var type=Elements.getType(element);"root"===type?self.setRootElement(null,!0):self._removeElement(element,type)}),delete this._cachedViewbox},Canvas.prototype.getDefaultLayer=function(){return this.getLayer("base")},Canvas.prototype.getLayer=function(name){if(!name)throw new Error("must specify a name");var layer=this._layers[name];return layer||(layer=this._layers[name]=createGroup(this._viewport,"layer-"+name)),layer},Canvas.prototype.getContainer=function(){return this._container},Canvas.prototype._updateMarker=function(element,marker,add){var container;element.id||(element=this._elementRegistry.get(element)),(container=this._elementRegistry._elements[element.id])&&(forEach([container.gfx,container.secondaryGfx],function(gfx){gfx&&gfx[add?"addClass":"removeClass"](marker)}),this._eventBus.fire("element.marker.update",{element:element,gfx:container.gfx,marker:marker,add:!!add}))},Canvas.prototype.addMarker=function(element,marker){this._updateMarker(element,marker,!0)},Canvas.prototype.removeMarker=function(element,marker){this._updateMarker(element,marker,!1)},Canvas.prototype.hasMarker=function(element,marker){element.id||(element=this._elementRegistry.get(element));var gfx=this.getGraphics(element);return gfx&&gfx.hasClass(marker)},Canvas.prototype.toggleMarker=function(element,marker){this.hasMarker(element,marker)?this.removeMarker(element,marker):this.addMarker(element,marker)},Canvas.prototype.getRootElement=function(){return this._rootElement||this.setRootElement({id:"__implicitroot",children:[]}),this._rootElement},Canvas.prototype.setRootElement=function(element,override){element&&this._ensureValid("root",element);var currentRoot=this._rootElement,elementRegistry=this._elementRegistry,eventBus=this._eventBus;if(currentRoot){if(!override)throw new Error("rootElement already set, need to specify override");eventBus.fire("root.remove",{element:currentRoot}),eventBus.fire("root.removed",{element:currentRoot}),elementRegistry.remove(currentRoot)}if(element){var gfx=this.getDefaultLayer();eventBus.fire("root.add",{element:element}),elementRegistry.add(element,gfx,this._svg),eventBus.fire("root.added",{element:element,gfx:gfx})}return this._rootElement=element,element},Canvas.prototype._ensureValid=function(type,element){if(!element.id)throw new Error("element must have an id");if(this._elementRegistry.get(element.id))throw new Error("element with id "+element.id+" already exists");var requiredAttrs=REQUIRED_MODEL_ATTRS[type];if(!every(requiredAttrs,function(attr){return void 0!==element[attr]}))throw new Error("must supply { "+requiredAttrs.join(", ")+" } with "+type)},Canvas.prototype._setParent=function(element,parent,parentIndex){Collections.add(parent.children,element,parentIndex),element.parent=parent},Canvas.prototype._addElement=function(type,element,parent,parentIndex){parent=parent||this.getRootElement();var eventBus=this._eventBus,graphicsFactory=this._graphicsFactory;this._ensureValid(type,element),eventBus.fire(type+".add",{element:element,parent:parent}),this._setParent(element,parent,parentIndex);var gfx=graphicsFactory.create(type,element);return this._elementRegistry.add(element,gfx),graphicsFactory.update(type,element,gfx),eventBus.fire(type+".added",{element:element,gfx:gfx}),element},Canvas.prototype.addShape=function(shape,parent,parentIndex){return this._addElement("shape",shape,parent,parentIndex)},Canvas.prototype.addConnection=function(connection,parent,parentIndex){return this._addElement("connection",connection,parent,parentIndex)},Canvas.prototype._removeElement=function(element,type){var elementRegistry=this._elementRegistry,graphicsFactory=this._graphicsFactory,eventBus=this._eventBus;if(element=elementRegistry.get(element.id||element))return eventBus.fire(type+".remove",{element:element}),graphicsFactory.remove(element),Collections.remove(element.parent&&element.parent.children,element),element.parent=null,eventBus.fire(type+".removed",{element:element}),elementRegistry.remove(element),element},Canvas.prototype.removeShape=function(shape){return this._removeElement(shape,"shape")},Canvas.prototype.removeConnection=function(connection){return this._removeElement(connection,"connection")},Canvas.prototype.getGraphics=function(element,secondary){return this._elementRegistry.getGraphics(element,secondary)},Canvas.prototype._changeViewbox=function(changeFn){this._eventBus.fire("canvas.viewbox.changing"),changeFn.apply(this),this._cachedViewbox=null,this._viewboxChanged()},Canvas.prototype._viewboxChanged=function(){this._eventBus.fire("canvas.viewbox.changed",{viewbox:this.viewbox()})},Canvas.prototype.viewbox=function(box){if(void 0===box&&this._cachedViewbox)return this._cachedViewbox;var innerBox,matrix,scale,x,y,viewport=this._viewport,outerBox=this.getSize();return box?(this._changeViewbox(function(){scale=Math.min(outerBox.width/box.width,outerBox.height/box.height),matrix=(new Snap.Matrix).scale(scale).translate(-box.x,-box.y),viewport.transform(matrix)}),box):(innerBox=this.getDefaultLayer().getBBox(!0),matrix=viewport.transform().localMatrix,scale=round(matrix.a,1e3),x=round(-matrix.e||0,1e3),y=round(-matrix.f||0,1e3),box=this._cachedViewbox={x:x?x/scale:0,y:y?y/scale:0,width:outerBox.width/scale,height:outerBox.height/scale,scale:scale,inner:{width:innerBox.width,height:innerBox.height,x:innerBox.x,y:innerBox.y},outer:outerBox})},Canvas.prototype.scroll=function(delta){var node=this._viewport.node,matrix=node.getCTM();return delta&&this._changeViewbox(function(){delta=assign({dx:0,dy:0},delta||{}),matrix=this._svg.node.createSVGMatrix().translate(delta.dx,delta.dy).multiply(matrix),setCTM(node,matrix)}),{x:matrix.e,y:matrix.f}},Canvas.prototype.zoom=function(newScale,center){if(!newScale)return this.viewbox(newScale).scale;if("fit-viewport"===newScale)return this._fitViewport(center);var outer,matrix;return this._changeViewbox(function(){"object"!=typeof center&&(outer=this.viewbox().outer,center={x:outer.width/2,y:outer.height/2}),matrix=this._setZoom(newScale,center)}),round(matrix.a,1e3)},Canvas.prototype._fitViewport=function(center){var newScale,newViewbox,vbox=this.viewbox(),outer=vbox.outer,inner=vbox.inner;return inner.x>=0&&inner.y>=0&&inner.x+inner.width<=outer.width&&inner.y+inner.height<=outer.height&&!center?newViewbox={x:0,y:0,width:Math.max(inner.width+inner.x,outer.width),height:Math.max(inner.height+inner.y,outer.height)}:(newScale=Math.min(1,outer.width/inner.width,outer.height/inner.height),newViewbox={x:inner.x+(center?inner.width/2-outer.width/newScale/2:0),y:inner.y+(center?inner.height/2-outer.height/newScale/2:0),width:outer.width/newScale,height:outer.height/newScale}),this.viewbox(newViewbox),this.viewbox(!1).scale},Canvas.prototype._setZoom=function(scale,center){var centerPoint,originalPoint,currentMatrix,scaleMatrix,newMatrix,svg=this._svg.node,viewport=this._viewport.node,matrix=svg.createSVGMatrix(),point=svg.createSVGPoint();currentMatrix=viewport.getCTM();var currentScale=currentMatrix.a;return center?(centerPoint=assign(point,center),originalPoint=centerPoint.matrixTransform(currentMatrix.inverse()),scaleMatrix=matrix.translate(originalPoint.x,originalPoint.y).scale(1/currentScale*scale).translate(-originalPoint.x,-originalPoint.y),newMatrix=currentMatrix.multiply(scaleMatrix)):newMatrix=matrix.scale(scale),setCTM(this._viewport.node,newMatrix),newMatrix},Canvas.prototype.getSize=function(){return{width:this._container.clientWidth,height:this._container.clientHeight}},Canvas.prototype.getAbsoluteBBox=function(element){var bbox,vbox=this.viewbox();if(element.waypoints){var gfx=this.getGraphics(element),transformBBox=gfx.getBBox(!0);bbox=gfx.getBBox(),bbox.x-=transformBBox.x,bbox.y-=transformBBox.y,bbox.width+=2*transformBBox.x,bbox.height+=2*transformBBox.y}else bbox=element;return{x:bbox.x*vbox.scale-vbox.x*vbox.scale,y:bbox.y*vbox.scale-vbox.y*vbox.scale,width:bbox.width*vbox.scale,height:bbox.height*vbox.scale}},Canvas.prototype.resized=function(){delete this._cachedViewbox,this._eventBus.fire("canvas.resized")}},{425:425,428:428,441:441,461:461,464:464,474:474,586:586,592:592}],296:[function(_dereq_,module,exports){"use strict";function ElementFactory(){this._uid=12}var Model=_dereq_(416);module.exports=ElementFactory,ElementFactory.prototype.createRoot=function(attrs){return this.create("root",attrs)},ElementFactory.prototype.createLabel=function(attrs){return this.create("label",attrs)},ElementFactory.prototype.createShape=function(attrs){return this.create("shape",attrs)},ElementFactory.prototype.createConnection=function(attrs){return this.create("connection",attrs)},ElementFactory.prototype.create=function(type,attrs){return attrs=attrs||{},attrs.id||(attrs.id=type+"_"+this._uid++),Model.create(type,attrs)}},{416:416}],297:[function(_dereq_,module,exports){"use strict";function ElementRegistry(){this._elements={}}var ELEMENT_ID="data-element-id";module.exports=ElementRegistry,ElementRegistry.prototype.add=function(element,gfx,secondaryGfx){var id=element.id;this._validateId(id),gfx.attr(ELEMENT_ID,id),secondaryGfx&&secondaryGfx.attr(ELEMENT_ID,id),this._elements[id]={element:element,gfx:gfx,secondaryGfx:secondaryGfx}},ElementRegistry.prototype.remove=function(element){var elements=this._elements,id=element.id||element,container=id&&elements[id];container&&(container.gfx.attr(ELEMENT_ID,""),container.secondaryGfx&&container.secondaryGfx.attr(ELEMENT_ID,""),delete elements[id])},ElementRegistry.prototype.updateId=function(element,newId){this._validateId(newId),"string"==typeof element&&(element=this.get(element));var gfx=this.getGraphics(element),secondaryGfx=this.getGraphics(element,!0);this.remove(element),element.id=newId,this.add(element,gfx,secondaryGfx)},ElementRegistry.prototype.get=function(filter){var id;id="string"==typeof filter?filter:filter&&filter.attr(ELEMENT_ID);var container=this._elements[id];return container&&container.element},ElementRegistry.prototype.filter=function(fn){var filtered=[];return this.forEach(function(element,gfx){fn(element,gfx)&&filtered.push(element)}),filtered},ElementRegistry.prototype.getAll=function(){return this.filter(function(e){return e})},ElementRegistry.prototype.forEach=function(fn){var map=this._elements;Object.keys(map).forEach(function(id){var container=map[id],element=container.element,gfx=container.gfx;return fn(element,gfx)})},ElementRegistry.prototype.getGraphics=function(filter,secondary){var id=filter.id||filter,container=this._elements[id];return container&&(secondary?container.secondaryGfx:container.gfx)},ElementRegistry.prototype._validateId=function(id){if(!id)throw new Error("element must have an id");if(this._elements[id])throw new Error("element with id "+id+" already added")}},{}],298:[function(_dereq_,module,exports){"use strict";function EventBus(){this._listeners={},this.on("diagram.destroy",1,this._destroy,this)}function Event(){}function invokeFunction(fn,args){return fn.apply(null,args)}var isFunction=_dereq_(584),isArray=_dereq_(583),isNumber=_dereq_(586),bind=_dereq_(473),assign=_dereq_(592),slice=Array.prototype.slice;module.exports=EventBus,EventBus.prototype.on=function(events,priority,callback,that){if(events=isArray(events)?events:[events],isFunction(priority)&&(that=callback,callback=priority,priority=1e3),!isNumber(priority))throw new Error("priority must be a number");var actualCallback=callback;that&&(actualCallback=bind(callback,that),actualCallback.__fn=callback.__fn||callback);var self=this,listener={priority:priority,callback:actualCallback};events.forEach(function(e){self._addListener(e,listener)})},EventBus.prototype.once=function(event,priority,callback,that){function wrappedCallback(){return self.off(event,wrappedCallback),callback.apply(that,arguments)}var self=this;if(isFunction(priority)&&(that=callback,callback=priority,priority=1e3),!isNumber(priority))throw new Error("priority must be a number");wrappedCallback.__fn=callback,this.on(event,priority,wrappedCallback)},EventBus.prototype.off=function(event,callback){var listener,listenerCallback,idx,listeners=this._getListeners(event);if(callback)for(idx=listeners.length-1;listener=listeners[idx];idx--)(listenerCallback=listener.callback)!==callback&&listenerCallback.__fn!==callback||listeners.splice(idx,1);else listeners.length=0},EventBus.prototype.fire=function(type,data){var event,listeners,returnValue,args;if(args=slice.call(arguments),"object"==typeof type&&(event=type,type=event.type),!type)throw new Error("no event type specified");if(listeners=this._listeners[type]){data instanceof Event?event=data:(event=new Event,event.init(data)),args[0]=event;var originalType=event.type;type!==originalType&&(event.type=type);try{returnValue=this._invokeListeners(event,args,listeners)}finally{type!==originalType&&(event.type=originalType)}return void 0===returnValue&&event.defaultPrevented&&(returnValue=!1),returnValue}},EventBus.prototype.handleError=function(error){return!1===this.fire("error",{error:error})},EventBus.prototype._destroy=function(){this._listeners={}},EventBus.prototype._invokeListeners=function(event,args,listeners){var idx,listener,returnValue;for(idx=0;(listener=listeners[idx])&&!event.cancelBubble;idx++)returnValue=this._invokeListener(event,args,listener);return returnValue},EventBus.prototype._invokeListener=function(event,args,listener){var returnValue;try{returnValue=invokeFunction(listener.callback,args),void 0!==returnValue&&(event.returnValue=returnValue,event.stopPropagation()),!1===returnValue&&event.preventDefault()}catch(e){if(!this.handleError(e))throw console.error("unhandled error in event listener"),console.error(e.stack),e}return returnValue},EventBus.prototype._addListener=function(event,newListener){var existingListener,idx,listeners=this._getListeners(event);for(idx=0;existingListener=listeners[idx];idx++)if(existingListener.priority<newListener.priority)return void listeners.splice(idx,0,newListener);listeners.push(newListener)},EventBus.prototype._getListeners=function(name){var listeners=this._listeners[name];return listeners||(this._listeners[name]=listeners=[]),listeners},module.exports.Event=Event,Event.prototype.stopPropagation=function(){this.cancelBubble=!0},Event.prototype.preventDefault=function(){this.defaultPrevented=!0},Event.prototype.init=function(data){assign(this,data||{})}},{473:473,583:583,584:584,586:586,592:592}],299:[function(_dereq_,module,exports){"use strict";function GraphicsFactory(eventBus,elementRegistry){this._eventBus=eventBus,this._elementRegistry=elementRegistry}var forEach=_dereq_(464),reduce=_dereq_(468),GraphicsUtil=_dereq_(431),domClear=_dereq_(606);GraphicsFactory.$inject=["eventBus","elementRegistry"],module.exports=GraphicsFactory,GraphicsFactory.prototype._getChildren=function(element){var childrenGfx,gfx=this._elementRegistry.getGraphics(element);return element.parent?(childrenGfx=GraphicsUtil.getChildren(gfx))||(childrenGfx=gfx.parent().group().attr("class","djs-children")):childrenGfx=gfx,childrenGfx},GraphicsFactory.prototype._clear=function(gfx){var visual=GraphicsUtil.getVisual(gfx);return domClear(visual.node),visual},GraphicsFactory.prototype._createContainer=function(type,parentGfx){var outerGfx=parentGfx.group().attr("class","djs-group"),gfx=outerGfx.group().attr("class","djs-element djs-"+type);return gfx.group().attr("class","djs-visual"),gfx},GraphicsFactory.prototype.create=function(type,element){var childrenGfx=this._getChildren(element.parent);return this._createContainer(type,childrenGfx)},GraphicsFactory.prototype.updateContainments=function(elements){var parents,self=this,elementRegistry=this._elementRegistry;parents=reduce(elements,function(map,e){return e.parent&&(map[e.parent.id]=e.parent),map},{}),forEach(parents,function(parent){var childGfx=self._getChildren(parent),children=parent.children;children&&forEach(children.slice().reverse(),function(c){elementRegistry.getGraphics(c).parent().prependTo(childGfx)})})},GraphicsFactory.prototype.drawShape=function(visual,element){return this._eventBus.fire("render.shape",{gfx:visual,element:element})},GraphicsFactory.prototype.getShapePath=function(element){return this._eventBus.fire("render.getShapePath",element)},GraphicsFactory.prototype.drawConnection=function(visual,element){return this._eventBus.fire("render.connection",{gfx:visual,element:element})},GraphicsFactory.prototype.getConnectionPath=function(waypoints){return this._eventBus.fire("render.getConnectionPath",waypoints)},GraphicsFactory.prototype.update=function(type,element,gfx){if(element.parent){var visual=this._clear(gfx);if("shape"===type)this.drawShape(visual,element),gfx.translate(element.x,element.y);else{if("connection"!==type)throw new Error("unknown type: "+type);this.drawConnection(visual,element)}gfx.attr("display",element.hidden?"none":"block")}},GraphicsFactory.prototype.remove=function(element){this._elementRegistry.getGraphics(element).parent().remove()}},{431:431,464:464,468:468,606:606}],300:[function(_dereq_,module,exports){module.exports={__depends__:[_dereq_(304)],__init__:["canvas"],canvas:["type",_dereq_(295)],elementRegistry:["type",_dereq_(297)],elementFactory:["type",_dereq_(296)],eventBus:["type",_dereq_(298)],graphicsFactory:["type",_dereq_(299)]}},{295:295,296:296,297:297,298:298,299:299,304:304}],301:[function(_dereq_,module,exports){"use strict";function BaseRenderer(eventBus,renderPriority){var self=this;renderPriority=renderPriority||DEFAULT_RENDER_PRIORITY,eventBus.on(["render.shape","render.connection"],renderPriority,function(evt,context){var type=evt.type,element=context.element,visuals=context.gfx;if(self.canRender(element))return"render.shape"===type?self.drawShape(visuals,element):self.drawConnection(visuals,element)}),eventBus.on(["render.getShapePath","render.getConnectionPath"],renderPriority,function(evt,element){if(self.canRender(element))return"render.getShapePath"===evt.type?self.getShapePath(element):self.getConnectionPath(element)})}var DEFAULT_RENDER_PRIORITY=1e3;BaseRenderer.prototype.canRender=function(){},BaseRenderer.prototype.drawShape=function(){},BaseRenderer.prototype.drawConnection=function(){},BaseRenderer.prototype.getShapePath=function(){},BaseRenderer.prototype.getConnectionPath=function(){},module.exports=BaseRenderer},{}],302:[function(_dereq_,module,exports){"use strict";function DefaultRenderer(eventBus,styles){BaseRenderer.call(this,eventBus,DEFAULT_RENDER_PRIORITY),this.CONNECTION_STYLE=styles.style(["no-fill"],{strokeWidth:5,stroke:"fuchsia"}),this.SHAPE_STYLE=styles.style({fill:"white",stroke:"fuchsia",strokeWidth:2})}var inherits=_dereq_(451),BaseRenderer=_dereq_(301),renderUtil=_dereq_(439),componentsToPath=renderUtil.componentsToPath,createLine=renderUtil.createLine,DEFAULT_RENDER_PRIORITY=1;inherits(DefaultRenderer,BaseRenderer),DefaultRenderer.prototype.canRender=function(){return!0},DefaultRenderer.prototype.drawShape=function(visuals,element){return visuals.rect(0,0,element.width||0,element.height||0).attr(this.SHAPE_STYLE)},DefaultRenderer.prototype.drawConnection=function(visuals,connection){return createLine(connection.waypoints,this.CONNECTION_STYLE).appendTo(visuals)},DefaultRenderer.prototype.getShapePath=function(shape){var x=shape.x,y=shape.y,width=shape.width,height=shape.height;return componentsToPath([["M",x,y],["l",width,0],["l",0,height],["l",-width,0],["z"]])},DefaultRenderer.prototype.getConnectionPath=function(connection){var idx,point,waypoints=connection.waypoints,connectionPath=[];for(idx=0;point=waypoints[idx];idx++)point=point.original||point,connectionPath.push([0===idx?"M":"L",point.x,point.y]);return componentsToPath(connectionPath)},DefaultRenderer.$inject=["eventBus","styles"],module.exports=DefaultRenderer},{301:301,439:439,451:451}],303:[function(_dereq_,module,exports){"use strict";function Styles(){var defaultTraits={"no-fill":{fill:"none"},"no-border":{strokeOpacity:0},"no-events":{pointerEvents:"none"}},self=this;this.cls=function(className,traits,additionalAttrs){var attrs=this.style(traits,additionalAttrs);return assign(attrs,{class:className})},this.style=function(traits,additionalAttrs){isArray(traits)||additionalAttrs||(additionalAttrs=traits,traits=[]);var attrs=reduce(traits,function(attrs,t){return assign(attrs,defaultTraits[t]||{})},{});return additionalAttrs?assign(attrs,additionalAttrs):attrs},this.computeStyle=function(custom,traits,defaultStyles){return isArray(traits)||(defaultStyles=traits,traits=[]),self.style(traits||[],assign({},defaultStyles,custom||{}))}}var isArray=_dereq_(583),assign=_dereq_(592),reduce=_dereq_(468);module.exports=Styles},{468:468,583:583,592:592}],304:[function(_dereq_,module,exports){module.exports={__init__:["defaultRenderer"],defaultRenderer:["type",_dereq_(302)],styles:["type",_dereq_(303)]}},{302:302,303:303}],305:[function(_dereq_,module,exports){"use strict";function AttachSupport(eventBus,modeling,moveVisuals,rules){CommandInterceptor.call(this,eventBus),eventBus.on("shape.move.start",HIGH_PRIORITY,function(e){var context=e.context,shapes=context.shapes,validatedShapes=context.validatedShapes;context.shapes=addAttached(shapes),context.validatedShapes=removeAttached(validatedShapes)}),this.postExecuted(["elements.move"],function(event){var context=event.context,delta=context.delta,newParent=context.newParent,closure=context.closure,enclosedElements=closure.enclosedElements,attachers=getAttachers(enclosedElements);forEach(attachers,function(attacher){enclosedElements[attacher.id]||modeling.moveShape(attacher,delta,newParent)})}),this.postExecuted(["elements.move"],function(e){var attachers,context=e.context,shapes=context.shapes,newHost=context.newHost;shapes.length>1||(attachers=newHost?shapes:filter(shapes,function(s){return!!s.host}),forEach(attachers,function(attacher){modeling.updateAttachment(attacher,newHost)}))}),this.postExecuted(["elements.move"],function(e){var shapes=e.context.shapes;forEach(shapes,function(shape){forEach(shape.attachers,function(attacher){forEach(attacher.outgoing.slice(),function(connection){rules.allowed("connection.reconnectStart",{connection:connection,source:connection.source,target:connection.target})||modeling.removeConnection(connection)}),forEach(attacher.incoming.slice(),function(connection){rules.allowed("connection.reconnectEnd",{connection:connection,source:connection.source,target:connection.target})||modeling.removeConnection(connection)})})})}),this.postExecute(["shape.create"],function(e){var context=e.context,shape=context.shape,host=context.host;host&&modeling.updateAttachment(shape,host)}),this.postExecute(["shape.replace"],function(e){var context=e.context,oldShape=context.oldShape,newShape=context.newShape;saveClear(oldShape.attachers,function(attacher){"attach"===rules.allowed("elements.move",{target:newShape,shapes:[attacher]})?modeling.updateAttachment(attacher,newShape):modeling.removeShape(attacher)}),newShape.attachers.length&&forEach(newShape.attachers,function(attacher){var delta=getNewAttachShapeDelta(attacher,oldShape,newShape);modeling.moveShape(attacher,delta,attacher.parent)})}),this.postExecute(["shape.resize"],function(event){var context=event.context,shape=context.shape,oldBounds=context.oldBounds,newBounds=context.newBounds,attachers=shape.attachers;attachers.length&&forEach(attachers,function(attacher){var delta=getNewAttachShapeDelta(attacher,oldBounds,newBounds);modeling.moveShape(attacher,delta,attacher.parent),attacher.label&&modeling.moveShape(attacher.label,delta,attacher.label.parent)})}),this.preExecute(["shape.delete"],function(event){var shape=event.context.shape;saveClear(shape.attachers,function(attacher){modeling.removeShape(attacher)}),shape.host&&modeling.updateAttachment(shape,null)}),eventBus.on("spaceTool.move",function(event){var movingShapes=event.context.movingShapes,movingAttachers=filter(movingShapes,function(shape){return shape.host&&shape.host.id});forEach(movingAttachers,function(shape){Collections.remove(movingShapes,shape),shape.label&&Collections.remove(movingShapes,shape.label)})})}function getAttachers(shapes){return flatten(map(shapes,function(s){return s.attachers||[]}))}function addAttached(elements){var attachers=getAttachers(elements);return union(elements,attachers)}function removeAttached(elements){var ids=groupBy(elements,"id");return filter(elements,function(element){for(;element;){if(element.host&&ids[element.host.id])return!1;element=element.parent}return!0})}var forEach=_dereq_(464),flatten=_dereq_(453),union=_dereq_(455),filter=_dereq_(462),groupBy=_dereq_(465),map=_dereq_(467),saveClear=_dereq_(438).saveClear,Collections=_dereq_(425),getNewAttachShapeDelta=_dereq_(423).getNewAttachShapeDelta,inherits=_dereq_(451),HIGH_PRIORITY=1500,CommandInterceptor=_dereq_(292);inherits(AttachSupport,CommandInterceptor),AttachSupport.$inject=["eventBus","modeling","moveVisuals","rules"],module.exports=AttachSupport},{292:292,423:423,425:425,438:438,451:451,453:453,455:455,462:462,464:464,465:465,467:467}],306:[function(_dereq_,module,exports){module.exports={__depends__:[_dereq_(370),_dereq_(341)],__init__:["attachSupport"],attachSupport:["type",_dereq_(305)]}},{305:305,341:341,370:370}],307:[function(_dereq_,module,exports){"use strict";function AutoScroll(config,eventBus,canvas,mouseTracking){this._canvas=canvas,this._mouseTracking=mouseTracking,this._opts=assign({scrollThresholdIn:[20,20,20,20],scrollThresholdOut:[0,0,0,0],scrollRepeatTimeout:15,scrollStep:10},config);var self=this;eventBus.on("drag.move",function(e){var point=self._toBorderPoint(e);self.startScroll(point)}),eventBus.on(["drag.cleanup"],function(){self.stopScroll()})}function between(val,start,end){return start<val&&val<end}var assign=_dereq_(592),EventUtil=_dereq_(429);AutoScroll.$inject=["config.autoScroll","eventBus","canvas","mouseTracking"],module.exports=AutoScroll,AutoScroll.prototype.startScroll=function(point){var canvas=this._canvas,opts=this._opts,self=this,clientRect=canvas.getContainer().getBoundingClientRect(),diff=[point.x,point.y,clientRect.width-point.x,clientRect.height-point.y];this.stopScroll();for(var dx=0,dy=0,i=0;i<4;i++)between(diff[i],opts.scrollThresholdOut[i],opts.scrollThresholdIn[i])&&(0===i?dx=opts.scrollStep:1==i?dy=opts.scrollStep:2==i?dx=-opts.scrollStep:3==i&&(dy=-opts.scrollStep));0===dx&&0===dy||(canvas.scroll({dx:dx,dy:dy}),this._scrolling=setTimeout(function(){self.startScroll(point)},opts.scrollRepeatTimeout))},AutoScroll.prototype.stopScroll=function(){clearTimeout(this._scrolling)},AutoScroll.prototype.setOptions=function(options){this._opts=assign({},this._opts,options)},AutoScroll.prototype._toBorderPoint=function(event){var clientRect=this._canvas._container.getBoundingClientRect(),globalPosition=EventUtil.toPoint(event.originalEvent);return{x:globalPosition.x-clientRect.left,y:globalPosition.y-clientRect.top}}},{429:429,592:592}],308:[function(_dereq_,module,exports){module.exports={__depends__:[_dereq_(329),_dereq_(367)],__init__:["autoScroll"],
autoScroll:["type",_dereq_(307)]}},{307:307,329:329,367:367}],309:[function(_dereq_,module,exports){"use strict";function BendpointMove(injector,eventBus,canvas,dragging,graphicsFactory,rules,modeling){function redrawConnection(data){graphicsFactory.update("connection",data.connection,data.connectionGfx)}function filterRedundantWaypoints(waypoints){waypoints=waypoints.slice();for(var point,previousPoint,nextPoint,idx=0;waypoints[idx];)point=waypoints[idx],previousPoint=waypoints[idx-1],nextPoint=waypoints[idx+1],0===Geometry.pointDistance(point,nextPoint)||Geometry.pointsOnLine(previousPoint,nextPoint,point)?waypoints.splice(idx,1):idx++;return waypoints}var connectionDocking=injector.get("connectionDocking",!1);this.start=function(event,connection,bendpointIndex,insert){var type,context,waypoints=connection.waypoints,gfx=canvas.getGraphics(connection);type=insert||0!==bendpointIndex?insert||bendpointIndex!==waypoints.length-1?COMMAND_BENDPOINT_UPDATE:COMMAND_RECONNECT_END:COMMAND_RECONNECT_START,context={connection:connection,bendpointIndex:bendpointIndex,insert:insert,type:type},dragging.init(event,"bendpoint.move",{data:{connection:connection,connectionGfx:gfx,context:context}})},eventBus.on("bendpoint.move.start",function(e){var context=e.context,connection=context.connection,originalWaypoints=connection.waypoints,waypoints=originalWaypoints.slice(),insert=context.insert,idx=context.bendpointIndex;context.originalWaypoints=originalWaypoints,insert&&waypoints.splice(idx,0,null),connection.waypoints=waypoints,context.draggerGfx=BendpointUtil.addBendpoint(canvas.getLayer("overlays")),context.draggerGfx.addClass("djs-dragging"),canvas.addMarker(connection,MARKER_CONNECT_UPDATING)}),eventBus.on("bendpoint.move.hover",function(e){e.context.hover=e.hover,canvas.addMarker(e.hover,MARKER_CONNECT_HOVER)}),eventBus.on(["bendpoint.move.out","bendpoint.move.cleanup"],function(e){var hover=e.context.hover;hover&&(canvas.removeMarker(hover,MARKER_CONNECT_HOVER),canvas.removeMarker(hover,e.context.target?MARKER_OK:MARKER_NOT_OK))}),eventBus.on("bendpoint.move.move",function(e){var source,target,context=e.context,moveType=context.type,connection=e.connection;connection.waypoints[context.bendpointIndex]={x:e.x,y:e.y},connectionDocking&&(context.hover&&(moveType===COMMAND_RECONNECT_START&&(source=context.hover),moveType===COMMAND_RECONNECT_END&&(target=context.hover)),connection.waypoints=connectionDocking.getCroppedWaypoints(connection,source,target));var allowed=context.allowed=rules.allowed(context.type,context);allowed?context.hover&&(canvas.removeMarker(context.hover,MARKER_NOT_OK),canvas.addMarker(context.hover,MARKER_OK),context.target=context.hover):!1===allowed&&context.hover&&(canvas.removeMarker(context.hover,MARKER_OK),canvas.addMarker(context.hover,MARKER_NOT_OK),context.target=null),context.draggerGfx.translate(e.x,e.y),redrawConnection(e)}),eventBus.on(["bendpoint.move.end","bendpoint.move.cancel"],function(e){var context=e.context,hover=context.hover,connection=context.connection;context.draggerGfx.remove(),context.newWaypoints=connection.waypoints.slice(),connection.waypoints=context.originalWaypoints,canvas.removeMarker(connection,MARKER_CONNECT_UPDATING),hover&&(canvas.removeMarker(hover,MARKER_OK),canvas.removeMarker(hover,MARKER_NOT_OK))}),eventBus.on("bendpoint.move.end",function(e){var context=e.context,waypoints=context.newWaypoints,bendpointIndex=context.bendpointIndex,bendpoint=waypoints[bendpointIndex],allowed=context.allowed;if(bendpoint.x=round(bendpoint.x),bendpoint.y=round(bendpoint.y),allowed&&context.type===COMMAND_RECONNECT_START)modeling.reconnectStart(context.connection,context.target,bendpoint);else if(allowed&&context.type===COMMAND_RECONNECT_END)modeling.reconnectEnd(context.connection,context.target,bendpoint);else{if(!1===allowed||context.type!==COMMAND_BENDPOINT_UPDATE)return redrawConnection(e),!1;modeling.updateWaypoints(context.connection,filterRedundantWaypoints(waypoints))}}),eventBus.on("bendpoint.move.cancel",function(e){redrawConnection(e)})}var Geometry=_dereq_(430),BendpointUtil=_dereq_(311),MARKER_OK="connect-ok",MARKER_NOT_OK="connect-not-ok",MARKER_CONNECT_HOVER="connect-hover",MARKER_CONNECT_UPDATING="djs-updating",COMMAND_BENDPOINT_UPDATE="connection.updateWaypoints",COMMAND_RECONNECT_START="connection.reconnectStart",COMMAND_RECONNECT_END="connection.reconnectEnd",round=Math.round;BendpointMove.$inject=["injector","eventBus","canvas","dragging","graphicsFactory","rules","modeling"],module.exports=BendpointMove},{311:311,430:430}],310:[function(_dereq_,module,exports){"use strict";function BendpointSnapping(eventBus){function snapTo(candidates,point){return Snap.snapTo(candidates,point)}function mid(element){if(element.width)return{x:round(element.width/2+element.x),y:round(element.height/2+element.y)}}function getConnectionSegmentSnaps(context){var snapPoints=context.snapPoints,connection=context.connection,waypoints=connection.waypoints,segmentStart=context.segmentStart,segmentStartIndex=context.segmentStartIndex,segmentEnd=context.segmentEnd,segmentEndIndex=context.segmentEndIndex,axis=context.axis;if(snapPoints)return snapPoints;var referenceWaypoints=[waypoints[segmentStartIndex-1],segmentStart,segmentEnd,waypoints[segmentEndIndex+1]];return segmentStartIndex<2&&referenceWaypoints.unshift(mid(connection.source)),segmentEndIndex>waypoints.length-3&&referenceWaypoints.unshift(mid(connection.target)),context.snapPoints=snapPoints={horizontal:[],vertical:[]},forEach(referenceWaypoints,function(p){p&&(p=p.original||p,"y"===axis&&snapPoints.horizontal.push(p.y),"x"===axis&&snapPoints.vertical.push(p.x))}),snapPoints}function getBendpointSnaps(context){var snapPoints=context.snapPoints,waypoints=context.connection.waypoints,bendpointIndex=context.bendpointIndex;if(snapPoints)return snapPoints;var referenceWaypoints=[waypoints[bendpointIndex-1],waypoints[bendpointIndex+1]];return context.snapPoints=snapPoints={horizontal:[],vertical:[]},forEach(referenceWaypoints,function(p){p&&(p=p.original||p,snapPoints.horizontal.push(p.y),snapPoints.vertical.push(p.x))}),snapPoints}eventBus.on("connectionSegment.move.move",1500,function(event){var sx,sy,context=event.context,snapPoints=getConnectionSegmentSnaps(context),x=event.x,y=event.y;if(snapPoints){sx=snapTo(snapPoints.vertical,x),sy=snapTo(snapPoints.horizontal,y);var cx=x-sx,cy=y-sy;assign(event,{dx:event.dx-cx,dy:event.dy-cy,x:sx,y:sy})}}),eventBus.on("bendpoint.move.move",1500,function(event){var sx,sy,context=event.context,snapPoints=getBendpointSnaps(context),target=context.target,targetMid=target&&mid(target),x=event.x,y=event.y;if(snapPoints){sx=snapTo(targetMid?snapPoints.vertical.concat([targetMid.x]):snapPoints.vertical,x),sy=snapTo(targetMid?snapPoints.horizontal.concat([targetMid.y]):snapPoints.horizontal,y);var cx=x-sx,cy=y-sy;assign(event,{dx:event.dx-cx,dy:event.dy-cy,x:event.x-cx,y:event.y-cy})}})}var assign=_dereq_(592),forEach=_dereq_(464),Snap=_dereq_(441),round=Math.round;BendpointSnapping.$inject=["eventBus"],module.exports=BendpointSnapping},{441:441,464:464,592:592}],311:[function(_dereq_,module,exports){"use strict";function createParallelDragger(parentGfx,position,alignment){var draggerGfx=parentGfx.group();draggerGfx.rect(-7,-1.5,14,3).addClass("djs-visual"),draggerGfx.rect(-10,-4.5,20,9).addClass("djs-hit");var matrix=(new Snap.Matrix).rotate("h"===alignment?90:0,0,0);return draggerGfx.transform(matrix),draggerGfx}var Events=_dereq_(429),Geometry=_dereq_(430),Snap=_dereq_(441),BENDPOINT_CLS=module.exports.BENDPOINT_CLS="djs-bendpoint",SEGMENT_DRAGGER_CLS=module.exports.SEGMENT_DRAGGER_CLS="djs-segment-dragger";module.exports.toCanvasCoordinates=function(canvas,event){var offset,position=Events.toPoint(event),clientRect=canvas._container.getBoundingClientRect();offset={x:clientRect.left,y:clientRect.top};var viewbox=canvas.viewbox();return{x:viewbox.x+(position.x-offset.x)/viewbox.scale,y:viewbox.y+(position.y-offset.y)/viewbox.scale}},module.exports.addBendpoint=function(parentGfx,cls){var groupGfx=parentGfx.group().addClass(BENDPOINT_CLS);return groupGfx.circle(0,0,4).addClass("djs-visual"),groupGfx.circle(0,0,10).addClass("djs-hit"),cls&&groupGfx.addClass(cls),groupGfx},module.exports.addSegmentDragger=function(parentGfx,segmentStart,segmentEnd){var groupGfx=parentGfx.group(),mid=Geometry.getMidPoint(segmentStart,segmentEnd),alignment=Geometry.pointsAligned(segmentStart,segmentEnd);return createParallelDragger(groupGfx,mid,alignment),groupGfx.addClass(SEGMENT_DRAGGER_CLS),groupGfx.addClass("h"===alignment?"vertical":"horizontal"),groupGfx.translate(mid.x,mid.y),groupGfx}},{429:429,430:430,441:441}],312:[function(_dereq_,module,exports){"use strict";function Bendpoints(eventBus,canvas,interactionEvents,bendpointMove,connectionSegmentMove){function getConnectionIntersection(waypoints,event){var localPosition=BendpointUtil.toCanvasCoordinates(canvas,event);return getApproxIntersection(waypoints,localPosition)}function isIntersectionMiddle(intersection,waypoints,treshold){var p0,p1,mid,aligned,xDelta,yDelta,idx=intersection.index,p=intersection.point;return!(idx<=0||intersection.bendpoint)&&(p0=waypoints[idx-1],p1=waypoints[idx],mid=getMidPoint(p0,p1),aligned=pointsAligned(p0,p1),xDelta=Math.abs(p.x-mid.x),yDelta=Math.abs(p.y-mid.y),aligned&&xDelta<=treshold&&yDelta<=treshold)}function activateBendpointMove(event,connection){var waypoints=connection.waypoints,intersection=getConnectionIntersection(waypoints,event);intersection&&(isIntersectionMiddle(intersection,waypoints,10)?connectionSegmentMove.start(event,connection,intersection.index):bendpointMove.start(event,connection,intersection.index,!intersection.bendpoint))}function bindInteractionEvents(node,eventName,element){domEvent.bind(node,eventName,function(event){interactionEvents.triggerMouseEvent(eventName,event,element),event.stopPropagation()})}function getBendpointsContainer(element,create){var layer=canvas.getLayer("overlays"),gfx=layer.select(".djs-bendpoints[data-element-id="+element.id+"]");return!gfx&&create&&(gfx=layer.group().addClass("djs-bendpoints").attr("data-element-id",element.id),bindInteractionEvents(gfx.node,"mousedown",element),bindInteractionEvents(gfx.node,"click",element),bindInteractionEvents(gfx.node,"dblclick",element)),gfx}function createBendpoints(gfx,connection){connection.waypoints.forEach(function(p,idx){BendpointUtil.addBendpoint(gfx).translate(p.x,p.y)}),BendpointUtil.addBendpoint(gfx,"floating")}function createSegmentDraggers(gfx,connection){for(var segmentStart,segmentEnd,waypoints=connection.waypoints,i=1;i<waypoints.length;i++)segmentStart=waypoints[i-1],segmentEnd=waypoints[i],pointsAligned(segmentStart,segmentEnd)&&BendpointUtil.addSegmentDragger(gfx,segmentStart,segmentEnd)}function clearBendpoints(gfx){gfx.selectAll("."+BENDPOINT_CLS).forEach(function(s){s.remove()})}function clearSegmentDraggers(gfx){gfx.selectAll("."+SEGMENT_DRAGGER_CLS).forEach(function(s){s.remove()})}function addHandles(connection){var gfx=getBendpointsContainer(connection);return gfx||(gfx=getBendpointsContainer(connection,!0),createBendpoints(gfx,connection),createSegmentDraggers(gfx,connection)),gfx}function updateHandles(connection){var gfx=getBendpointsContainer(connection);gfx&&(clearSegmentDraggers(gfx),clearBendpoints(gfx),createSegmentDraggers(gfx,connection),createBendpoints(gfx,connection))}eventBus.on("connection.changed",function(event){updateHandles(event.element)}),eventBus.on("connection.remove",function(event){var gfx=getBendpointsContainer(event.element);gfx&&gfx.remove()}),eventBus.on("element.marker.update",function(event){var bendpointsGfx,element=event.element;element.waypoints&&(bendpointsGfx=addHandles(element),bendpointsGfx[event.add?"addClass":"removeClass"](event.marker))}),eventBus.on("element.mousemove",function(event){var bendpointsGfx,floating,intersection,element=event.element,waypoints=element.waypoints;if(waypoints){if(bendpointsGfx=getBendpointsContainer(element,!0),!(floating=bendpointsGfx.select(".floating")))return;intersection=getConnectionIntersection(waypoints,event.originalEvent),intersection&&floating.translate(intersection.point.x,intersection.point.y)}}),eventBus.on("element.mousedown",function(event){var originalEvent=event.originalEvent,element=event.element,waypoints=element.waypoints;waypoints&&activateBendpointMove(originalEvent,element)}),eventBus.on("selection.changed",function(event){var newSelection=event.newSelection,primary=newSelection[0];primary&&primary.waypoints&&addHandles(primary)}),eventBus.on("element.hover",function(event){var element=event.element;element.waypoints&&(addHandles(element),interactionEvents.registerEvent(event.gfx.node,"mousemove","element.mousemove"))}),eventBus.on("element.out",function(event){interactionEvents.unregisterEvent(event.gfx.node,"mousemove","element.mousemove")}),this.addHandles=addHandles,this.updateHandles=updateHandles,this.getBendpointsContainer=getBendpointsContainer}var domEvent=_dereq_(610),BendpointUtil=_dereq_(311),pointsAligned=_dereq_(430).pointsAligned,getMidPoint=_dereq_(430).getMidPoint,BENDPOINT_CLS=BendpointUtil.BENDPOINT_CLS,SEGMENT_DRAGGER_CLS=BendpointUtil.SEGMENT_DRAGGER_CLS,getApproxIntersection=_dereq_(433).getApproxIntersection;Bendpoints.$inject=["eventBus","canvas","interactionEvents","bendpointMove","connectionSegmentMove"],module.exports=Bendpoints},{311:311,430:430,433:433,610:610}],313:[function(_dereq_,module,exports){"use strict";function axisAdd(point,axis,delta){return axisSet(point,axis,point[axis]+delta)}function axisSet(point,axis,value){return{x:"x"===axis?value:point.x,y:"y"===axis?value:point.y}}function axisFenced(position,segmentStart,segmentEnd,axis){var maxValue=Math.max(segmentStart[axis],segmentEnd[axis]),minValue=Math.min(segmentStart[axis],segmentEnd[axis]);return axisSet(segmentStart,axis,Math.min(Math.max(minValue+20,position[axis]),maxValue-20))}function flipAxis(axis){return"x"===axis?"y":"x"}function getDocking(point,referenceElement,moveAxis){var referenceMid,inverseAxis;return point.original?point.original:(referenceMid=LayoutUtil.getMid(referenceElement),inverseAxis=flipAxis(moveAxis),axisSet(point,inverseAxis,referenceMid[inverseAxis]))}function ConnectionSegmentMove(injector,eventBus,canvas,dragging,graphicsFactory,rules,modeling){function redrawConnection(data){graphicsFactory.update("connection",data.connection,data.connectionGfx)}function updateDragger(context,segmentOffset,event){var newWaypoints=context.newWaypoints,segmentStartIndex=context.segmentStartIndex+segmentOffset,segmentStart=newWaypoints[segmentStartIndex],segmentEndIndex=context.segmentEndIndex+segmentOffset,segmentEnd=newWaypoints[segmentEndIndex],axis=flipAxis(context.axis),draggerPosition=axisFenced(event,segmentStart,segmentEnd,axis);context.draggerGfx.translate(draggerPosition.x,draggerPosition.y)}function filterRedundantWaypoints(waypoints){return waypoints.filter(function(r,idx){return!Geometry.pointsOnLine(waypoints[idx-1],waypoints[idx+1],r)})}var connectionDocking=injector.get("connectionDocking",!1);this.start=function(event,connection,idx){var context,direction,axis,gfx=canvas.getGraphics(connection),segmentStartIndex=idx-1,segmentEndIndex=idx,waypoints=connection.waypoints,segmentStart=waypoints[segmentStartIndex],segmentEnd=waypoints[segmentEndIndex];(direction=Geometry.pointsAligned(segmentStart,segmentEnd))&&(axis="v"===direction?"y":"x",0===segmentStartIndex&&(segmentStart=getDocking(segmentStart,connection.source,axis)),segmentEndIndex===waypoints.length-1&&(segmentEnd=getDocking(segmentEnd,connection.target,axis)),context={connection:connection,segmentStartIndex:segmentStartIndex,segmentEndIndex:segmentEndIndex,segmentStart:segmentStart,segmentEnd:segmentEnd,axis:axis},dragging.init(event,{x:(segmentStart.x+segmentEnd.x)/2,y:(segmentStart.y+segmentEnd.y)/2},"connectionSegment.move",{cursor:"x"===axis?"resize-ew":"resize-ns",data:{connection:connection,connectionGfx:gfx,context:context}}))},eventBus.on("connectionSegment.move.start",function(e){var context=e.context,connection=e.connection,layer=canvas.getLayer("overlays");context.originalWaypoints=connection.waypoints.slice(),context.draggerGfx=BendpointUtil.addSegmentDragger(layer,context.segmentStart,context.segmentEnd),context.draggerGfx.addClass("djs-dragging"),canvas.addMarker(connection,MARKER_CONNECT_UPDATING)}),eventBus.on("connectionSegment.move.move",function(e){var context=e.context,connection=context.connection,segmentStartIndex=context.segmentStartIndex,segmentEndIndex=context.segmentEndIndex,segmentStart=context.segmentStart,segmentEnd=context.segmentEnd,axis=context.axis,newWaypoints=context.originalWaypoints.slice(),newSegmentStart=axisAdd(segmentStart,axis,e["d"+axis]),newSegmentEnd=axisAdd(segmentEnd,axis,e["d"+axis]),waypointCount=newWaypoints.length,segmentOffset=0;newWaypoints[segmentStartIndex]=newSegmentStart,newWaypoints[segmentEndIndex]=newSegmentEnd;var sourceToSegmentOrientation,targetToSegmentOrientation;segmentStartIndex<2&&(sourceToSegmentOrientation=LayoutUtil.getOrientation(connection.source,newSegmentStart),1===segmentStartIndex?"intersect"===sourceToSegmentOrientation&&(newWaypoints.shift(),newWaypoints[0]=newSegmentStart,segmentOffset--):"intersect"!==sourceToSegmentOrientation&&(newWaypoints.unshift(segmentStart),segmentOffset++)),segmentEndIndex>waypointCount-3&&(targetToSegmentOrientation=LayoutUtil.getOrientation(connection.target,newSegmentEnd),segmentEndIndex===waypointCount-2?"intersect"===targetToSegmentOrientation&&(newWaypoints.pop(),newWaypoints[newWaypoints.length-1]=newSegmentEnd):"intersect"!==targetToSegmentOrientation&&newWaypoints.push(segmentEnd)),connection.waypoints=newWaypoints,connectionDocking&&(connection.waypoints=newWaypoints=connectionDocking.getCroppedWaypoints(connection)),context.newWaypoints=newWaypoints,updateDragger(context,segmentOffset,e),redrawConnection(e)}),eventBus.on("connectionSegment.move.hover",function(e){e.context.hover=e.hover,canvas.addMarker(e.hover,MARKER_CONNECT_HOVER)}),eventBus.on(["connectionSegment.move.out","connectionSegment.move.cleanup"],function(e){var hover=e.context.hover;hover&&canvas.removeMarker(hover,MARKER_CONNECT_HOVER)}),eventBus.on("connectionSegment.move.cleanup",function(e){var context=e.context,connection=context.connection;context.draggerGfx&&context.draggerGfx.remove(),canvas.removeMarker(connection,MARKER_CONNECT_UPDATING)}),eventBus.on(["connectionSegment.move.cancel","connectionSegment.move.end"],function(e){var context=e.context;context.connection.waypoints=context.originalWaypoints,redrawConnection(e)}),eventBus.on("connectionSegment.move.end",function(e){var context=e.context,waypoints=context.newWaypoints;waypoints.forEach(function(wp){wp.x=Math.round(wp.x),wp.y=Math.round(wp.y)}),modeling.updateWaypoints(context.connection,filterRedundantWaypoints(waypoints))})}var Geometry=_dereq_(430),BendpointUtil=_dereq_(311),LayoutUtil=_dereq_(414),MARKER_CONNECT_HOVER="connect-hover",MARKER_CONNECT_UPDATING="djs-updating";ConnectionSegmentMove.$inject=["injector","eventBus","canvas","dragging","graphicsFactory","rules","modeling"],module.exports=ConnectionSegmentMove},{311:311,414:414,430:430}],314:[function(_dereq_,module,exports){module.exports={__depends__:[_dereq_(329),_dereq_(389)],__init__:["bendpoints","bendpointSnapping"],bendpoints:["type",_dereq_(312)],bendpointMove:["type",_dereq_(309)],connectionSegmentMove:["type",_dereq_(313)],bendpointSnapping:["type",_dereq_(310)]}},{309:309,310:310,312:312,313:313,329:329,389:389}],315:[function(_dereq_,module,exports){"use strict";function ChangeSupport(eventBus,canvas,elementRegistry,graphicsFactory){eventBus.on("element.changed",function(event){var element=event.element;event.gfx||(event.gfx=elementRegistry.getGraphics(element)),event.gfx&&eventBus.fire(getElementType(element)+".changed",event)}),eventBus.on("elements.changed",function(event){var elements=event.elements;elements.forEach(function(e){eventBus.fire("element.changed",{element:e})}),graphicsFactory.updateContainments(elements)}),eventBus.on("shape.changed",function(event){graphicsFactory.update("shape",event.element,event.gfx)}),eventBus.on("connection.changed",function(event){graphicsFactory.update("connection",event.element,event.gfx)})}var getElementType=_dereq_(428).getType;ChangeSupport.$inject=["eventBus","canvas","elementRegistry","graphicsFactory"],module.exports=ChangeSupport},{428:428}],316:[function(_dereq_,module,exports){module.exports={__init__:["changeSupport"],changeSupport:["type",_dereq_(315)]}},{315:315}],317:[function(_dereq_,module,exports){"use strict";function Clipboard(){}module.exports=Clipboard,Clipboard.prototype.get=function(){return this._data},Clipboard.prototype.set=function(data){this._data=data},Clipboard.prototype.clear=function(){var data=this._data;return delete this._data,data},Clipboard.prototype.isEmpty=function(){return!this._data}},{}],318:[function(_dereq_,module,exports){module.exports={clipboard:["type",_dereq_(317)]}},{317:317}],319:[function(_dereq_,module,exports){"use strict";function Connect(eventBus,dragging,modeling,rules,canvas,graphicsFactory){function canConnect(source,target){return rules.allowed("connection.create",{source:source,target:target})}function crop(start,end,source,target){var sourcePath=graphicsFactory.getShapePath(source),targetPath=target&&graphicsFactory.getShapePath(target),connectionPath=graphicsFactory.getConnectionPath({waypoints:[start,end]});return start=LayoutUtil.getElementLineIntersection(sourcePath,connectionPath,!0)||start,end=target&&LayoutUtil.getElementLineIntersection(targetPath,connectionPath,!1)||end,[start,end]}eventBus.on("connect.move",function(event){var start,end,waypoints,context=event.context,source=context.source,target=context.target,visual=context.visual;start=LayoutUtil.getMid(source),end={x:event.x,y:event.y},waypoints=crop(start,end,source,target),visual.attr("points",[waypoints[0].x,waypoints[0].y,waypoints[1].x,waypoints[1].y])}),eventBus.on("connect.hover",function(event){var canExecute,context=event.context,source=context.source,hover=event.hover;null!==(canExecute=context.canExecute=canConnect(source,hover))&&(context.target=hover,canvas.addMarker(hover,canExecute?MARKER_OK:MARKER_NOT_OK))}),eventBus.on(["connect.out","connect.cleanup"],function(event){var context=event.context;context.target&&canvas.removeMarker(context.target,context.canExecute?MARKER_OK:MARKER_NOT_OK),context.target=null}),eventBus.on("connect.cleanup",function(event){var context=event.context;context.visual&&context.visual.remove()}),eventBus.on("connect.start",function(event){var visual,context=event.context;visual=canvas.getDefaultLayer().polyline().attr({stroke:"#333",strokeDasharray:[1],strokeWidth:2,"pointer-events":"none"}),context.visual=visual}),eventBus.on("connect.end",function(event){var context=event.context,source=context.source,target=context.target,canExecute=context.canExecute||canConnect(source,target);if(!canExecute)return!1;modeling.connect(source,target,"object"==typeof canExecute&&canExecute)}),this.start=function(event,source,autoActivate){dragging.init(event,"connect",{autoActivate:autoActivate,data:{shape:source,context:{source:source}}})}}var LayoutUtil=_dereq_(414),MARKER_OK="connect-ok",MARKER_NOT_OK="connect-not-ok";Connect.$inject=["eventBus","dragging","modeling","rules","canvas","graphicsFactory"],module.exports=Connect},{414:414}],320:[function(_dereq_,module,exports){module.exports={__depends__:[_dereq_(395),_dereq_(389),_dereq_(329)],connect:["type",_dereq_(319)]}},{319:319,329:329,389:389,395:395}],321:[function(_dereq_,module,exports){"use strict";function ContextPad(eventBus,overlays){this._providers=[],this._eventBus=eventBus,this._overlays=overlays,this._current=null,this._init()}var isFunction=_dereq_(584),forEach=_dereq_(464),domDelegate=_dereq_(608),domEvent=_dereq_(610),domAttr=_dereq_(604),domQuery=_dereq_(612),domClasses=_dereq_(605),domify=_dereq_(609);ContextPad.$inject=["eventBus","overlays"],ContextPad.prototype._init=function(){var eventBus=this._eventBus,self=this;eventBus.on("selection.changed",function(e){var selection=e.newSelection;1===selection.length?self.open(selection[0]):self.close()}),eventBus.on("elements.delete",function(event){var elements=event.elements;forEach(elements,function(e){self.isOpen(e)&&self.close()})}),eventBus.on("element.changed",function(event){var element=event.element,current=self._current;current&&current.element===element&&self.open(element,!0)})},ContextPad.prototype.registerProvider=function(provider){this._providers.push(provider)},ContextPad.prototype.getEntries=function(element){var entries={};return forEach(this._providers,function(provider){var e=provider.getContextPadEntries(element);forEach(e,function(entry,id){entries[id]=entry})}),entries},ContextPad.prototype.trigger=function(action,event,autoActivate){var entry,handler,originalEvent,element=this._current.element,entries=this._current.entries,button=event.delegateTarget||event.target;if(!button)return event.preventDefault();if(entry=entries[domAttr(button,"data-action")],handler=entry.action,originalEvent=event.originalEvent||event,isFunction(handler)){if("click"===action)return handler(originalEvent,element,autoActivate)}else if(handler[action])return handler[action](originalEvent,element,autoActivate);event.preventDefault()},ContextPad.prototype.open=function(element,force){!force&&this.isOpen(element)||(this.close(),this._updateAndOpen(element))},ContextPad.prototype._updateAndOpen=function(element){var entries=this.getEntries(element),pad=this.getPad(element),html=pad.html;forEach(entries,function(entry,id){var container,grouping=entry.group||"default",control=domify(entry.html||'<div class="entry" draggable="true"></div>');domAttr(control,"data-action",id),container=domQuery("[data-group="+grouping+"]",html),container||(container=domify('<div class="group" data-group="'+grouping+'"></div>'),html.appendChild(container)),container.appendChild(control),entry.className&&domClasses(control).add(entry.className),entry.title&&domAttr(control,"title",entry.title),entry.imageUrl&&control.appendChild(domify('<img src="'+entry.imageUrl+'">'))}),domClasses(html).add("open"),this._current={element:element,pad:pad,entries:entries},this._eventBus.fire("contextPad.open",{current:this._current})},ContextPad.prototype.getPad=function(element){if(this.isOpen())return this._current.pad;var self=this,overlays=this._overlays,html=domify('<div class="djs-context-pad"></div>');domDelegate.bind(html,".entry","click",function(event){self.trigger("click",event)}),domDelegate.bind(html,".entry","dragstart",function(event){self.trigger("dragstart",event)}),domEvent.bind(html,"mousedown",function(event){event.stopPropagation()}),this._overlayId=overlays.add(element,"context-pad",{position:{right:-9,top:-6},html:html});var pad=overlays.get(this._overlayId);return this._eventBus.fire("contextPad.create",{element:element,pad:pad}),pad},ContextPad.prototype.close=function(){this.isOpen()&&(this._overlays.remove(this._overlayId),this._overlayId=null,this._eventBus.fire("contextPad.close",{current:this._current}),this._current=null)},ContextPad.prototype.isOpen=function(element){return!(!this._current||element&&this._current.element!==element)},module.exports=ContextPad},{464:464,584:584,604:604,605:605,608:608,609:609,610:610,612:612}],322:[function(_dereq_,module,exports){module.exports={__depends__:[_dereq_(337),_dereq_(375)],contextPad:["type",_dereq_(321)]}},{321:321,337:337,375:375}],323:[function(_dereq_,module,exports){"use strict";function CopyPaste(eventBus,modeling,elementFactory,rules,clipboard,canvas){this._eventBus=eventBus,this._modeling=modeling,this._elementFactory=elementFactory,this._rules=rules,this._canvas=canvas,this._clipboard=clipboard,this._descriptors=[],this.registerDescriptor(function(element,descriptor){return descriptor.priority=1,descriptor.id=element.id,element.parent&&(descriptor.parent=element.parent.id),element.labelTarget&&(descriptor.priority=4,descriptor.labelTarget=element.labelTarget.id),element.host&&(descriptor.priority=2,descriptor.host=element.host.id),element.x&&(descriptor.x=element.x,descriptor.y=element.y),element.width&&(descriptor.width=element.width,descriptor.height=element.height),element.waypoints&&(descriptor.priority=3,descriptor.waypoints=[],forEach(element.waypoints,function(waypoint){var wp={x:waypoint.x,y:waypoint.y};waypoint.original&&(wp.original={x:waypoint.original.x,y:waypoint.original.y}),descriptor.waypoints.push(wp)})),element.source&&element.target&&(descriptor.source=element.source.id,descriptor.target=element.target.id),descriptor})}var isArray=_dereq_(583),forEach=_dereq_(464),map=_dereq_(467),find=_dereq_(463),findIndex=_dereq_(452),sortBy=_dereq_(471),reduce=_dereq_(468),getBBox=_dereq_(428).getBBox,PositionUtil=_dereq_(437),CopyPasteUtil=_dereq_(426),ElementsUtil=_dereq_(428);CopyPaste.$inject=["eventBus","modeling","elementFactory","rules","clipboard","canvas"],module.exports=CopyPaste,CopyPaste.prototype.copy=function(selectedElements){var tree,bbox,clipboard=this._clipboard;if(isArray(selectedElements)||(selectedElements=selectedElements?[selectedElements]:[]),selectedElements.length)return tree=this.createTree(selectedElements),bbox=this._bbox=PositionUtil.center(getBBox(tree.allShapes)),delete tree.allShapes,forEach(tree,function(elements){forEach(elements,function(element){var delta,labelTarget;element.labelTarget?(labelTarget=find(elements,{id:element.labelTarget}),delta=labelTarget.waypoints?PositionUtil.delta(element,labelTarget.waypoints[0]):PositionUtil.delta(element,labelTarget)):3===element.priority?(delta=[],forEach(element.waypoints,function(waypoint){var waypointDelta=PositionUtil.delta(waypoint,bbox);delta.push(waypointDelta)},this)):delta=PositionUtil.delta(element,bbox),element.delta=delta})}),this._eventBus.fire("elements.copy",{context:{tree:tree}}),0===Object.keys(tree).length?clipboard.clear():clipboard.set(tree),this._eventBus.fire("elements.copied",{context:{tree:tree}}),tree},CopyPaste.prototype.paste=function(context){var newTree,clipboard=this._clipboard,modeling=this._modeling,eventBus=this._eventBus,rules=this._rules,tree=clipboard.get(),topParent=context.element,position=context.point;if(!clipboard.isEmpty()){if(newTree=reduce(tree,function(pasteTree,elements,depthStr){var depth=parseInt(depthStr,10);return isNaN(depth)?pasteTree:(pasteTree[depth]=elements,pasteTree)},{},this),!rules.allowed("elements.paste",{tree:newTree,target:topParent}))return void eventBus.fire("elements.paste.rejected",{context:{tree:newTree,position:position,target:topParent}});modeling.pasteElements(newTree,topParent,position)}},CopyPaste.prototype._computeDelta=function(elements,element){var bbox=this._bbox,delta={};return element.labelTarget?(console.log(elements),PositionUtil.delta(element,element.labelTarget)):(3===element.priority?(delta=[],forEach(element.waypoints,function(waypoint){var waypointDelta=PositionUtil.delta(waypoint,bbox);delta.push(waypointDelta)},this)):delta=PositionUtil.delta(element,bbox),delta)},CopyPaste.prototype.hasRelations=function(elements,element){var source,target;return!(element.waypoints&&(source=find(elements,{id:element.source.id}),target=find(elements,{id:element.target.id}),!source||!target))&&!(element.labelTarget&&!find(elements,{id:element.labelTarget.id}))},CopyPaste.prototype.registerDescriptor=function(descriptor){if("function"!=typeof descriptor)throw new Error("the descriptor must be a function");if(-1!==this._descriptors.indexOf(descriptor))throw new Error("this descriptor is already registered");this._descriptors.push(descriptor)},CopyPaste.prototype._executeDescriptors=function(data){return data.descriptor||(data.descriptor={}),forEach(this._descriptors,function(descriptor){data.descriptor=descriptor(data.element,data.descriptor)}),data},
CopyPaste.prototype.createTree=function(elements){function canCopy(collection,element){return rules.allowed("element.copy",{collection:collection,element:element})}function includeElement(data){var element,idx=findIndex(includedElements,{element:data.element});if(-1===idx)return includedElements.push(data);element=includedElements[idx],element.depth<data.depth&&(includedElements.splice(idx,1),includedElements.push(data))}var _elements,rules=this._rules,tree={},includedElements=[],topLevel=CopyPasteUtil.getTopLevel(elements);return tree.allShapes=[],ElementsUtil.eachElement(topLevel,function(element,i,depth){var nestedChildren=element.children;if(!element.labelTarget)return element.label&&includeElement({element:element.label,depth:depth}),function(lists){forEach(lists,function(list){list&&list.length&&forEach(list,function(elem){elem.label&&includeElement({element:elem.label,depth:depth}),includeElement({element:elem,depth:depth})})})}([element.attachers,element.incoming,element.outgoing]),includeElement({element:element,depth:depth}),nestedChildren||void 0}),includedElements=map(includedElements,function(data){return this._executeDescriptors(data)},this),includedElements=sortBy(includedElements,function(data){return data.descriptor.priority}),_elements=map(includedElements,function(data){return data.element}),forEach(includedElements,function(data){var depth=data.depth;this.hasRelations(tree.allShapes,data.element)&&canCopy(_elements,data.element)&&(tree.allShapes.push(data.element),tree[depth]||(tree[depth]=[]),tree[depth].push(data.descriptor))},this),tree}},{426:426,428:428,437:437,452:452,463:463,464:464,467:467,468:468,471:471,583:583}],324:[function(_dereq_,module,exports){module.exports={__depends__:[_dereq_(318),_dereq_(389),_dereq_(367)],__init__:["copyPaste"],copyPaste:["type",_dereq_(323)]}},{318:318,323:323,367:367,389:389}],325:[function(_dereq_,module,exports){"use strict";function Create(eventBus,dragging,rules,modeling,canvas,styles,graphicsFactory){function canCreate(shape,target,source,position){return source?rules.allowed("shape.append",{source:source,shape:shape,target:target,position:position}):rules.allowed("shape.create",{shape:shape,target:target,position:position})}function setMarker(element,marker){[MARKER_ATTACH,MARKER_OK,MARKER_NOT_OK,MARKER_NEW_PARENT].forEach(function(m){m===marker?canvas.addMarker(element,m):canvas.removeMarker(element,m)})}function createVisual(shape){var group,preview,visual;return group=canvas.getDefaultLayer().group().attr(styles.cls("djs-drag-group",["no-events"])),preview=group.group().addClass("djs-dragger"),preview.translate(shape.width/-2,shape.height/-2),visual=preview.group().addClass("djs-visual"),graphicsFactory.drawShape(visual,shape),group}eventBus.on("create.move",function(event){var context=event.context,shape=context.shape,visual=context.visual;visual||(visual=context.visual=createVisual(shape)),visual.translate(event.x,event.y);var canExecute,hover=event.hover,position={x:event.x,y:event.y};canExecute=context.canExecute=hover&&canCreate(context.shape,hover,context.source,position),hover&&null!==canExecute&&(context.target=hover,"attach"===canExecute?setMarker(hover,MARKER_ATTACH):setMarker(hover,context.canExecute?MARKER_NEW_PARENT:MARKER_NOT_OK))}),eventBus.on(["create.end","create.out","create.cleanup"],function(event){var context=event.context,target=context.target;target&&setMarker(target,null)}),eventBus.on("create.end",function(event){var isAttach,context=event.context,source=context.source,shape=context.shape,target=context.target,canExecute=context.canExecute,position={x:event.x,y:event.y};if(!canExecute)return!1;source?shape=modeling.appendShape(source,shape,position,target):(isAttach="attach"===canExecute,shape=modeling.createShape(shape,position,target,isAttach)),context.shape=shape}),eventBus.on("create.cleanup",function(event){var context=event.context;context.visual&&context.visual.remove()}),this.start=function(event,shape,source){dragging.init(event,"create",{cursor:"grabbing",autoActivate:!0,data:{shape:shape,context:{shape:shape,source:source}}})}}var MARKER_OK="drop-ok",MARKER_NOT_OK="drop-not-ok",MARKER_ATTACH="attach-ok",MARKER_NEW_PARENT="new-parent";Create.$inject=["eventBus","dragging","rules","modeling","canvas","styles","graphicsFactory"],module.exports=Create},{}],326:[function(_dereq_,module,exports){module.exports={__depends__:[_dereq_(329),_dereq_(395),_dereq_(389)],create:["type",_dereq_(325)]}},{325:325,329:329,389:389,395:395}],327:[function(_dereq_,module,exports){"use strict";function suppressEvent(event){event instanceof MouseEvent?Event.stopEvent(event,!0):Event.preventDefault(event)}function getLength(point){return Math.sqrt(Math.pow(point.x,2)+Math.pow(point.y,2))}function substract(p1,p2){return{x:p1.x-p2.x,y:p1.y-p2.y}}function Dragging(eventBus,canvas,selection){function toLocalPoint(globalPosition){var viewbox=canvas.viewbox(),clientRect=canvas._container.getBoundingClientRect();return{x:viewbox.x+round((globalPosition.x-clientRect.left)/viewbox.scale),y:viewbox.y+round((globalPosition.y-clientRect.top)/viewbox.scale)}}function fire(type,dragContext){dragContext=dragContext||context;var event=assign(new EventBusEvent,dragContext.payload,dragContext.data);return!1!==eventBus.fire("drag."+type,event)&&eventBus.fire(dragContext.prefix+"."+type,event)}function move(event,activate){var payload=context.payload,displacement=context.displacement,globalStart=context.globalStart,globalCurrent=Event.toPoint(event),globalDelta=substract(globalCurrent,globalStart),localStart=context.localStart,localCurrent=toLocalPoint(globalCurrent),localDelta=substract(localCurrent,localStart);if(!context.active&&(activate||getLength(globalDelta)>context.threshold)){if(assign(payload,{x:localStart.x+displacement.x,y:localStart.y+displacement.y,dx:0,dy:0},{originalEvent:event}),!1===fire("start"))return cancel();context.active=!0,context.keepSelection||(payload.previousSelection=selection.get(),selection.select(null)),context.cursor&&Cursor.set(context.cursor),canvas.addMarker(canvas.getRootElement(),DRAG_ACTIVE_CLS)}suppressEvent(event),context.active&&(assign(payload,{x:localCurrent.x+displacement.x,y:localCurrent.y+displacement.y,dx:localDelta.x,dy:localDelta.y},{originalEvent:event}),fire("move"))}function end(event){var previousContext,returnValue=!0;context.active&&(event&&(context.payload.originalEvent=event,suppressEvent(event)),returnValue=fire("end")),!1===returnValue&&fire("rejected"),previousContext=cleanup(!0!==returnValue),fire("ended",previousContext)}function checkCancel(event){27===event.which&&(event.preventDefault(),cancel())}function trapClickAndEnd(event){var untrap;context.active&&(untrap=ClickTrap.install(),setTimeout(untrap,400)),end(event)}function trapTouch(event){move(event)}function hover(event){var payload=context.payload;payload.hoverGfx=event.gfx,payload.hover=event.element,fire("hover")}function out(event){fire("out");var payload=context.payload;payload.hoverGfx=null,payload.hover=null}function cancel(restore){var previousContext;if(context){var wasActive=context.active;wasActive&&fire("cancel"),previousContext=cleanup(restore),wasActive&&fire("canceled",previousContext)}}function cleanup(restore){var previousContext,endDrag;fire("cleanup"),Cursor.unset(),endDrag=context.trapClick?trapClickAndEnd:end,domEvent.unbind(document,"mousemove",move),domEvent.unbind(document,"mousedown",endDrag,!0),domEvent.unbind(document,"mouseup",endDrag,!0),domEvent.unbind(document,"keyup",checkCancel),domEvent.unbind(document,"touchstart",trapTouch,!0),domEvent.unbind(document,"touchcancel",cancel,!0),domEvent.unbind(document,"touchmove",move,!0),domEvent.unbind(document,"touchend",end,!0),eventBus.off("element.hover",hover),eventBus.off("element.out",out),canvas.removeMarker(canvas.getRootElement(),DRAG_ACTIVE_CLS);var previousSelection=context.payload.previousSelection;return!1!==restore&&previousSelection&&!selection.get().length&&selection.select(previousSelection),previousContext=context,context=null,previousContext}function init(event,relativeTo,prefix,options){context&&cancel(!1),"string"==typeof relativeTo&&(options=prefix,prefix=relativeTo,relativeTo=null),options=assign({},defaultOptions,options||{});var originalEvent,globalStart,endDrag,data=options.data||{};endDrag=options.trapClick?trapClickAndEnd:end,event?(originalEvent=Event.getOriginal(event)||event,globalStart=Event.toPoint(event),suppressEvent(event)):(originalEvent=null,globalStart={x:0,y:0});var localStart=toLocalPoint(globalStart);relativeTo||(relativeTo=localStart),context=assign({prefix:prefix,data:data,payload:{},globalStart:globalStart,displacement:substract(relativeTo,localStart),localStart:localStart},options),options.manual||("undefined"!=typeof TouchEvent&&originalEvent instanceof TouchEvent?(domEvent.bind(document,"touchstart",trapTouch,!0),domEvent.bind(document,"touchcancel",cancel,!0),domEvent.bind(document,"touchmove",move,!0),domEvent.bind(document,"touchend",end,!0)):(domEvent.bind(document,"mousemove",move),domEvent.bind(document,"mousedown",endDrag,!0),domEvent.bind(document,"mouseup",endDrag,!0)),domEvent.bind(document,"keyup",checkCancel),eventBus.on("element.hover",hover),eventBus.on("element.out",out)),fire("init"),options.autoActivate&&move(event,!0)}var context,defaultOptions={threshold:5,trapClick:!0};eventBus.on("diagram.destroy",cancel),this.init=init,this.move=move,this.hover=hover,this.out=out,this.end=end,this.cancel=cancel,this.context=function(){return context},this.setOptions=function(options){assign(defaultOptions,options)}}var round=Math.round,assign=_dereq_(592),domEvent=_dereq_(610),Event=_dereq_(429),ClickTrap=_dereq_(424),Cursor=_dereq_(427),EventBusEvent=_dereq_(298).Event,DRAG_ACTIVE_CLS="djs-drag-active";Dragging.$inject=["eventBus","canvas","selection"],module.exports=Dragging},{298:298,424:424,427:427,429:429,592:592,610:610}],328:[function(_dereq_,module,exports){"use strict";function getGfx(target){var node=domClosest(target,"svg, .djs-element",!0);return node&&new Snap(node)}function HoverFix(eventBus,dragging,elementRegistry){var self=this;eventBus.on("drag.start",function(event){eventBus.once("drag.move",function(){eventBus.once("drag.move",function(event){self.ensureHover(event)})})}),this.ensureHover=function(event){if(!event.hover){var position,target,element,gfx,originalEvent=event.originalEvent;originalEvent instanceof MouseEvent&&(position=Event.toPoint(originalEvent),target=document.elementFromPoint(position.x,position.y),(gfx=getGfx(target))&&(element=elementRegistry.get(gfx),dragging.hover({element:element,gfx:gfx})))}}}var domClosest=_dereq_(607),Snap=_dereq_(441),Event=_dereq_(429);HoverFix.$inject=["eventBus","dragging","elementRegistry"],module.exports=HoverFix},{429:429,441:441,607:607}],329:[function(_dereq_,module,exports){module.exports={__init__:["hoverFix"],__depends__:[_dereq_(395)],dragging:["type",_dereq_(327)],hoverFix:["type",_dereq_(328)]}},{327:327,328:328,395:395}],330:[function(_dereq_,module,exports){"use strict";function EditorActions(eventBus,commandStack,modeling,selection,zoomScroll,copyPaste,canvas,rules,mouseTracking){this._actions={undo:function(){commandStack.undo()},redo:function(){commandStack.redo()},copy:function(){var selectedElements=selection.get();copyPaste.copy(selectedElements)},paste:function(){var context=mouseTracking.getHoverContext();copyPaste.paste(context)},stepZoom:function(opts){zoomScroll.stepZoom(opts.value)},zoom:function(opts){canvas.zoom(opts.value)},removeSelection:function(){var selectedElements=selection.get();if(selectedElements.length){var removableElements,allowed=rules.allowed("elements.delete",{elements:selectedElements});if(!1===allowed)return;removableElements=isArray(allowed)?allowed:selectedElements,removableElements.length&&modeling.removeElements(removableElements.slice())}},moveCanvas:function(opts){var dx=0,dy=0,invertY=opts.invertY,speed=opts.speed,actualSpeed=speed/Math.min(Math.sqrt(canvas.viewbox().scale),1);switch(opts.direction){case"left":dx=actualSpeed;break;case"up":dy=actualSpeed;break;case"right":dx=-actualSpeed;break;case"down":dy=-actualSpeed}dy&&invertY&&(dy=-dy),canvas.scroll({dx:dx,dy:dy})}}}function error(action,message){return new Error(action+" "+message)}var forEach=_dereq_(464),isArray=_dereq_(583);EditorActions.$inject=["eventBus","commandStack","modeling","selection","zoomScroll","copyPaste","canvas","rules","mouseTracking"],module.exports=EditorActions,EditorActions.prototype.trigger=function(action,opts){if(!this._actions[action])throw error(action,"is not a registered action");return this._actions[action](opts)},EditorActions.prototype.register=function(actions,listener){if("string"==typeof actions)return this._registerAction(actions,listener);forEach(actions,function(listener,action){this._registerAction(action,listener)},this)},EditorActions.prototype._registerAction=function(action,listener){if(this.isRegistered(action))throw error(action,"is already registered");this._actions[action]=listener},EditorActions.prototype.unregister=function(action){if(!this.isRegistered(action))throw error(action,"is not a registered action");this._actions[action]=void 0},EditorActions.prototype.length=function(){return Object.keys(this._actions).length},EditorActions.prototype.isRegistered=function(action){return!!this._actions[action]}},{464:464,583:583}],331:[function(_dereq_,module,exports){module.exports={__depends__:[_dereq_(395),_dereq_(324),_dereq_(422)],__init__:["editorActions"],editorActions:["type",_dereq_(330)]}},{324:324,330:330,395:395,422:422}],332:[function(_dereq_,module,exports){"use strict";function GlobalConnect(eventBus,dragging,connect,canvas,toolManager){var self=this;this._dragging=dragging,toolManager.registerTool("global-connect",{tool:"global-connect",dragging:"global-connect.drag"}),eventBus.on("global-connect.hover",function(event){var context=event.context,startTarget=event.hover,canStartConnect=context.canStartConnect=self.canStartConnect(startTarget);null!==canStartConnect&&(context.startTarget=startTarget,canvas.addMarker(startTarget,canStartConnect?MARKER_OK:MARKER_NOT_OK))}),eventBus.on(["global-connect.out","global-connect.cleanup"],function(event){var startTarget=event.context.startTarget,canStartConnect=event.context.canStartConnect;startTarget&&canvas.removeMarker(startTarget,canStartConnect?MARKER_OK:MARKER_NOT_OK)}),eventBus.on(["global-connect.ended"],function(event){var context=event.context,startTarget=context.startTarget;if(self.canStartConnect(startTarget))return eventBus.once("element.out",function(){eventBus.once(["connect.ended","connect.canceled"],function(){eventBus.fire("global-connect.drag.ended")}),connect.start(null,startTarget)}),!1})}var MARKER_OK="connect-ok",MARKER_NOT_OK="connect-not-ok";GlobalConnect.$inject=["eventBus","dragging","connect","canvas","toolManager"],module.exports=GlobalConnect,GlobalConnect.prototype.start=function(event){this._dragging.init(event,"global-connect",{trapClick:!1,data:{context:{}}})},GlobalConnect.prototype.toggle=function(){this.isActive()?this._dragging.cancel():this.start()},GlobalConnect.prototype.isActive=function(){var context=this._dragging.context();return context&&/^global-connect/.test(context.prefix)},GlobalConnect.prototype.registerProvider=function(provider){this._provider=provider},GlobalConnect.prototype.canStartConnect=function(startTarget){return this._provider.canStartConnect(startTarget)}},{}],333:[function(_dereq_,module,exports){module.exports={__depends__:[_dereq_(320),_dereq_(389),_dereq_(329),_dereq_(404)],globalConnect:["type",_dereq_(332)]}},{320:320,329:329,332:332,389:389,404:404}],334:[function(_dereq_,module,exports){"use strict";function HandTool(eventBus,canvas,dragging,toolManager){this._dragging=dragging,toolManager.registerTool("hand",{tool:"hand",dragging:"hand.move"}),eventBus.on("element.mousedown",HIGH_PRIORITY,function(event){if(hasPrimaryModifier(event))return this.activateMove(event.originalEvent),!1},this),eventBus.on("hand.end",function(event){var target=event.originalEvent.target;if(!(event.hover||target instanceof SVGElement))return!1;eventBus.once("hand.ended",function(){this.activateMove(event.originalEvent,{reactivate:!0})},this)},this),eventBus.on("hand.move.move",function(event){var scale=canvas.viewbox().scale;canvas.scroll({dx:event.dx*scale,dy:event.dy*scale})}),eventBus.on("hand.move.end",function(event){var context=event.context,reactivate=context.reactivate;return!hasPrimaryModifier(event)&&reactivate&&eventBus.once("hand.move.ended",function(event){this.activateHand(event.originalEvent,!0,!0)},this),!1},this)}var hasPrimaryModifier=_dereq_(435).hasPrimaryModifier,HIGH_PRIORITY=1500;HandTool.$inject=["eventBus","canvas","dragging","toolManager"],module.exports=HandTool,HandTool.prototype.activateMove=function(event,autoActivate,context){"object"==typeof autoActivate&&(context=autoActivate,autoActivate=!1),this._dragging.init(event,"hand.move",{autoActivate:autoActivate,cursor:"grab",data:{context:context||{}}})},HandTool.prototype.activateHand=function(event,autoActivate,reactivate){this._dragging.init(event,"hand",{trapClick:!1,autoActivate:autoActivate,cursor:"grab",data:{context:{reactivate:reactivate}}})},HandTool.prototype.toggle=function(){this.isActive()?this._dragging.cancel():this.activateHand()},HandTool.prototype.isActive=function(){var context=this._dragging.context();return context&&/^hand/.test(context.prefix)}},{435:435}],335:[function(_dereq_,module,exports){"use strict";module.exports={__depends__:[_dereq_(404)],__init__:["handTool"],handTool:["type",_dereq_(334)]}},{334:334,404:404}],336:[function(_dereq_,module,exports){"use strict";function InteractionEvents(eventBus,elementRegistry,styles){function fire(type,event,element){if(isPrimaryButton(event)){var target,gfx;element?gfx=elementRegistry.getGraphics(element):(target=event.delegateTarget||event.target)&&(gfx=new Snap(target),element=elementRegistry.get(gfx)),gfx&&element&&!1===eventBus.fire(type,{element:element,gfx:gfx,originalEvent:event})&&(event.stopPropagation(),event.preventDefault())}}function mouseHandler(type){var fn=handlers[type];return fn||(fn=handlers[type]=function(event){fire(type,event)}),fn}function triggerMouseEvent(eventName,event,targetElement){var localEventName=bindings[eventName];if(!localEventName)throw new Error("unmapped DOM event name <"+eventName+">");return fire(localEventName,event,targetElement)}function registerEvent(node,event,localEvent){var handler=mouseHandler(localEvent);handler.$delegate=domDelegate.bind(node,elementSelector,event,handler)}function unregisterEvent(node,event,localEvent){domDelegate.unbind(node,event,mouseHandler(localEvent).$delegate)}function registerEvents(svg){forEach(bindings,function(val,key){registerEvent(svg.node,key,val)})}function unregisterEvents(svg){forEach(bindings,function(val,key){unregisterEvent(svg.node,key,val)})}var HIT_STYLE=styles.cls("djs-hit",["no-fill","no-border"],{stroke:"white",strokeWidth:15}),handlers={},bindings={mouseover:"element.hover",mouseout:"element.out",click:"element.click",dblclick:"element.dblclick",mousedown:"element.mousedown",mouseup:"element.mouseup"},elementSelector="svg, .djs-element";eventBus.on("canvas.destroy",function(event){unregisterEvents(event.svg)}),eventBus.on("canvas.init",function(event){registerEvents(event.svg)}),eventBus.on(["shape.added","connection.added"],function(event){var hit,element=event.element,gfx=event.gfx;hit=element.waypoints?createLine(element.waypoints):Snap.create("rect",{x:0,y:0,width:element.width,height:element.height}),hit.attr(HIT_STYLE).appendTo(gfx.node)}),eventBus.on("shape.changed",function(event){var element=event.element;event.gfx.select(".djs-hit").attr({width:element.width,height:element.height})}),eventBus.on("connection.changed",function(event){var element=event.element,gfx=event.gfx,hit=gfx.select(".djs-hit");updateLine(hit,element.waypoints)}),this.fire=fire,this.triggerMouseEvent=triggerMouseEvent,this.mouseHandler=mouseHandler,this.registerEvent=registerEvent,this.unregisterEvent=unregisterEvent}var forEach=_dereq_(464),domDelegate=_dereq_(608),isPrimaryButton=_dereq_(435).isPrimaryButton,Snap=_dereq_(441),renderUtil=_dereq_(439),createLine=renderUtil.createLine,updateLine=renderUtil.updateLine;InteractionEvents.$inject=["eventBus","elementRegistry","styles"],module.exports=InteractionEvents},{435:435,439:439,441:441,464:464,608:608}],337:[function(_dereq_,module,exports){module.exports={__init__:["interactionEvents"],interactionEvents:["type",_dereq_(336)]}},{336:336}],338:[function(_dereq_,module,exports){"use strict";function Keyboard(config,eventBus,editorActions){var self=this;this._config=config||{},this._eventBus=eventBus,this._editorActions=editorActions,this._listeners=[],this._keyHandler=function(event){var i,l,target=event.target,listeners=self._listeners,code=event.keyCode||event.charCode||-1;if(!domMatches(target,"input, textarea"))for(i=0;l=listeners[i];i++)l(code,event)&&(event.preventDefault(),event.stopPropagation())},eventBus.on("diagram.destroy",function(){self._fire("destroy"),self.unbind(),self._listeners=null}),eventBus.on("diagram.init",function(){self._fire("init"),config&&config.bindTo&&self.bind(config.bindTo)}),this._init()}function hasModifier(modifiers){return modifiers.ctrlKey||modifiers.metaKey||modifiers.shiftKey||modifiers.altKey}function isCmd(modifiers){return modifiers.ctrlKey||modifiers.metaKey}function isShift(modifiers){return modifiers.shiftKey}var domEvent=_dereq_(610),domMatches=_dereq_(611);Keyboard.$inject=["config.keyboard","eventBus","editorActions"],module.exports=Keyboard,Keyboard.prototype.bind=function(node){this.unbind(),this._node=node,domEvent.bind(node,"keydown",this._keyHandler,!0),this._fire("bind")},Keyboard.prototype.getBinding=function(){return this._node},Keyboard.prototype.unbind=function(){var node=this._node;node&&(this._fire("unbind"),domEvent.unbind(node,"keydown",this._keyHandler,!0)),this._node=null},Keyboard.prototype._fire=function(event){this._eventBus.fire("keyboard."+event,{node:this._node,listeners:this._listeners})},Keyboard.prototype._init=function(){function undo(key,modifiers){if(isCmd(modifiers)&&!isShift(modifiers)&&90===key)return editorActions.trigger("undo"),!0}function redo(key,modifiers){if(isCmd(modifiers)&&(89===key||90===key&&isShift(modifiers)))return editorActions.trigger("redo"),!0}function copy(key,modifiers){if(isCmd(modifiers)&&67===key)return editorActions.trigger("copy"),!0}function paste(key,modifiers){if(isCmd(modifiers)&&86===key)return editorActions.trigger("paste"),!0}function zoomIn(key,modifiers){if((107===key||187===key||171===key||61===key)&&isCmd(modifiers))return editorActions.trigger("stepZoom",{value:1}),!0}function zoomOut(key,modifiers){if((109===key||189===key||173===key)&&isCmd(modifiers))return editorActions.trigger("stepZoom",{value:-1}),!0}function zoomDefault(key,modifiers){if((96===key||48===key)&&isCmd(modifiers))return editorActions.trigger("zoom",{value:1}),!0}function removeSelection(key,modifiers){if(46===key)return editorActions.trigger("removeSelection"),!0}function moveCanvas(key,modifiers){if([37,38,39,40].indexOf(key)>=0){var opts={invertY:config.invertY,speed:config.speed||50};switch(key){case 37:opts.direction="left";break;case 38:opts.direction="up";break;case 39:opts.direction="right";break;case 40:opts.direction="down"}return editorActions.trigger("moveCanvas",opts),!0}}var listeners=this._listeners,editorActions=this._editorActions,config=this._config;listeners.push(undo),listeners.push(redo),listeners.push(copy),listeners.push(paste),listeners.push(removeSelection),listeners.push(zoomIn),listeners.push(zoomOut),listeners.push(zoomDefault),listeners.push(moveCanvas)},Keyboard.prototype.addListener=function(listenerFn){this._listeners.push(listenerFn)},Keyboard.prototype.hasModifier=hasModifier,Keyboard.prototype.isCmd=isCmd,Keyboard.prototype.isShift=isShift},{610:610,611:611}],339:[function(_dereq_,module,exports){module.exports={__depends__:[_dereq_(331)],__init__:["keyboard"],keyboard:["type",_dereq_(338)]}},{331:331,338:338}],340:[function(_dereq_,module,exports){"use strict";function LabelSupport(eventBus,modeling,moveVisuals){CommandInterceptor.call(this,eventBus),eventBus.on("shape.move.start",HIGH_PRIORITY,function(e){var context=e.context,shapes=context.shapes,validatedShapes=context.validatedShapes;context.shapes=removeLabels(shapes),context.validatedShapes=removeLabels(validatedShapes)}),eventBus.on("shape.move.start",LOW_PRIORITY,function(e){var context=e.context,shapes=context.shapes,labels=[];forEach(shapes,function(element){var label=element.label;label&&!label.hidden&&-1===context.shapes.indexOf(label)&&labels.push(label),element.labelTarget&&labels.push(element)}),forEach(labels,function(label){moveVisuals.makeDraggable(context,label,!0)})}),this.postExecuted(["elements.move"],function(e){var context=e.context,closure=context.closure,enclosedElements=closure.enclosedElements;forEach(enclosedElements,function(e){e.label&&!enclosedElements[e.label.id]&&modeling.moveShape(e.label,context.delta,e.parent)})})}function removeLabels(elements){return filter(elements,function(element){return-1===elements.indexOf(element.labelTarget)})}var forEach=_dereq_(464),filter=_dereq_(462),inherits=_dereq_(451),LOW_PRIORITY=250,HIGH_PRIORITY=1400,CommandInterceptor=_dereq_(292);inherits(LabelSupport,CommandInterceptor),LabelSupport.$inject=["eventBus","modeling","moveVisuals"],module.exports=LabelSupport},{292:292,451:451,462:462,464:464}],341:[function(_dereq_,module,exports){module.exports={__depends__:[_dereq_(370)],__init__:["labelSupport"],labelSupport:["type",_dereq_(340)]}},{340:340,370:370}],342:[function(_dereq_,module,exports){"use strict";function LassoTool(eventBus,canvas,dragging,elementRegistry,selection,toolManager){this._selection=selection,this._dragging=dragging;var self=this,visuals={create:function(context){var frame,container=canvas.getDefaultLayer();frame=context.frame=Snap.create("rect",{class:"djs-lasso-overlay",width:1,height:1,x:0,y:0}),frame.appendTo(container)},update:function(context){var frame=context.frame,bbox=context.bbox;frame.attr({x:bbox.x,y:bbox.y,width:bbox.width,height:bbox.height})},remove:function(context){context.frame&&context.frame.remove()}};toolManager.registerTool("lasso",{tool:"lasso.selection",dragging:"lasso"}),eventBus.on("lasso.selection.end",function(event){var target=event.originalEvent.target;(event.hover||target instanceof SVGElement)&&eventBus.once("lasso.selection.ended",function(){self.activateLasso(event.originalEvent,!0)})}),eventBus.on("lasso.end",function(event){var bbox=toBBox(event),elements=elementRegistry.filter(function(element){return element});self.select(elements,bbox)}),eventBus.on("lasso.start",function(event){var context=event.context;context.bbox=toBBox(event),visuals.create(context)}),eventBus.on("lasso.move",function(event){var context=event.context;context.bbox=toBBox(event),visuals.update(context)}),eventBus.on("lasso.end",function(event){var context=event.context;visuals.remove(context)}),eventBus.on("lasso.cleanup",function(event){var context=event.context;visuals.remove(context)}),eventBus.on("element.mousedown",1500,function(event){hasSecondaryModifier(event)&&(self.activateLasso(event.originalEvent),event.stopPropagation())})}function toBBox(event){var start={x:event.x-event.dx,y:event.y-event.dy},end={x:event.x,y:event.y};return start.x<=end.x&&start.y<end.y||start.x<end.x&&start.y<=end.y?{x:start.x,y:start.y,width:end.x-start.x,height:end.y-start.y}:start.x>=end.x&&start.y<end.y||start.x>end.x&&start.y<=end.y?{x:end.x,y:start.y,width:start.x-end.x,height:end.y-start.y}:start.x<=end.x&&start.y>end.y||start.x<end.x&&start.y>=end.y?{x:start.x,y:end.y,width:end.x-start.x,height:start.y-end.y}:start.x>=end.x&&start.y>end.y||start.x>end.x&&start.y>=end.y?{x:end.x,y:end.y,width:start.x-end.x,height:start.y-end.y}:{x:end.x,y:end.y,width:0,height:0}}var values=_dereq_(600),getEnclosedElements=_dereq_(428).getEnclosedElements,hasSecondaryModifier=_dereq_(435).hasSecondaryModifier,Snap=_dereq_(441);LassoTool.$inject=["eventBus","canvas","dragging","elementRegistry","selection","toolManager"],module.exports=LassoTool,LassoTool.prototype.activateLasso=function(event,autoActivate){this._dragging.init(event,"lasso",{autoActivate:autoActivate,cursor:"crosshair",data:{context:{}}})},LassoTool.prototype.activateSelection=function(event){this._dragging.init(event,"lasso.selection",{trapClick:!1,cursor:"crosshair",data:{context:{}}})},LassoTool.prototype.select=function(elements,bbox){var selectedElements=getEnclosedElements(elements,bbox);this._selection.select(values(selectedElements))},LassoTool.prototype.toggle=function(){this.isActive()?this._dragging.cancel():this.activateSelection()},LassoTool.prototype.isActive=function(){var context=this._dragging.context();return context&&/^lasso/.test(context.prefix)}},{428:428,435:435,441:441,600:600}],343:[function(_dereq_,module,exports){"use strict";module.exports={__depends__:[_dereq_(404)],__init__:["lassoTool"],lassoTool:["type",_dereq_(342)]}},{342:342,404:404}],344:[function(_dereq_,module,exports){"use strict";function Modeling(eventBus,elementFactory,commandStack){this._eventBus=eventBus,this._elementFactory=elementFactory,this._commandStack=commandStack;var self=this;eventBus.on("diagram.init",function(){self.registerHandlers(commandStack)})}var forEach=_dereq_(464),model=_dereq_(416);Modeling.$inject=["eventBus","elementFactory","commandStack"],module.exports=Modeling,Modeling.prototype.getHandlers=function(){return{"shape.append":_dereq_(345),"shape.create":_dereq_(348),"shape.delete":_dereq_(351),"shape.move":_dereq_(355),"shape.resize":_dereq_(360),"shape.replace":_dereq_(359),spaceTool:_dereq_(361),"label.create":_dereq_(347),"connection.create":_dereq_(346),"connection.delete":_dereq_(349),"connection.move":_dereq_(353),"connection.layout":_dereq_(352),"connection.updateWaypoints":_dereq_(364),"connection.reconnectStart":_dereq_(358),"connection.reconnectEnd":_dereq_(358),"elements.move":_dereq_(354),"elements.delete":_dereq_(350),"element.updateAttachment":_dereq_(363),"element.updateAnchors":_dereq_(362),"elements.paste":_dereq_(357)}},Modeling.prototype.registerHandlers=function(commandStack){forEach(this.getHandlers(),function(handler,id){commandStack.registerHandler(id,handler)})},Modeling.prototype.moveShape=function(shape,delta,newParent,newParentIndex,hints){"object"==typeof newParentIndex&&(hints=newParentIndex,newParentIndex=null);var context={shape:shape,delta:delta,newParent:newParent,newParentIndex:newParentIndex,hints:hints||{}};this._commandStack.execute("shape.move",context)},Modeling.prototype.updateAttachment=function(shape,newHost){var context={shape:shape,newHost:newHost};this._commandStack.execute("element.updateAttachment",context)},Modeling.prototype.moveElements=function(shapes,delta,target,isAttach,hints){"object"==typeof isAttach&&(hints=isAttach,isAttach=void 0);var newHost,newParent=target;!0===isAttach&&(newHost=target,newParent=target.parent),!1===isAttach&&(newHost=null);var context={shapes:shapes,delta:delta,newParent:newParent,newHost:newHost,hints:hints||{}};this._commandStack.execute("elements.move",context)},Modeling.prototype.updateAnchors=function(element,oldBounds){var context={element:element,oldBounds:oldBounds};this._commandStack.execute("element.updateAnchors",context)},Modeling.prototype.moveConnection=function(connection,delta,newParent,newParentIndex,hints){"object"==typeof newParentIndex&&(hints=newParentIndex,newParentIndex=void 0);var context={connection:connection,delta:delta,newParent:newParent,newParentIndex:newParentIndex,hints:hints||{}};this._commandStack.execute("connection.move",context)},Modeling.prototype.layoutConnection=function(connection,hints){var context={connection:connection,hints:hints||{}}
;this._commandStack.execute("connection.layout",context)},Modeling.prototype.createConnection=function(source,target,targetIndex,connection,parent){"object"==typeof targetIndex&&(parent=connection,connection=targetIndex,targetIndex=void 0),connection=this._create("connection",connection);var context={source:source,target:target,parent:parent,parentIndex:targetIndex,connection:connection};return this._commandStack.execute("connection.create",context),context.connection},Modeling.prototype.createShape=function(shape,position,target,targetIndex,isAttach,hints){"number"!=typeof targetIndex&&(hints=isAttach,isAttach=targetIndex),"boolean"!=typeof isAttach&&(hints=isAttach,isAttach=!1),shape=this._create("shape",shape);var context={position:position,shape:shape,parent:target,parentIndex:targetIndex,host:shape.host,hints:hints||{}};return isAttach&&(context.parent=target.parent,context.host=target),this._commandStack.execute("shape.create",context),context.shape},Modeling.prototype.createLabel=function(labelTarget,position,label,parent){label=this._create("label",label);var context={labelTarget:labelTarget,position:position,parent:parent||labelTarget.parent,shape:label};return this._commandStack.execute("label.create",context),context.shape},Modeling.prototype.appendShape=function(source,shape,position,parent,connection,connectionParent){shape=this._create("shape",shape);var context={source:source,position:position,parent:parent,shape:shape,connection:connection,connectionParent:connectionParent};return this._commandStack.execute("shape.append",context),context.shape},Modeling.prototype.removeElements=function(elements){var context={elements:elements};this._commandStack.execute("elements.delete",context)},Modeling.prototype.removeShape=function(shape,hints){var context={shape:shape,hints:hints||{}};this._commandStack.execute("shape.delete",context)},Modeling.prototype.removeConnection=function(connection,hints){var context={connection:connection,hints:hints||{}};this._commandStack.execute("connection.delete",context)},Modeling.prototype.replaceShape=function(oldShape,newShape,hints){var context={oldShape:oldShape,newData:newShape,hints:hints||{}};return this._commandStack.execute("shape.replace",context),context.newShape},Modeling.prototype.pasteElements=function(tree,topParent,position){var context={tree:tree,topParent:topParent,position:position};this._commandStack.execute("elements.paste",context)},Modeling.prototype.resizeShape=function(shape,newBounds){var context={shape:shape,newBounds:newBounds};this._commandStack.execute("shape.resize",context)},Modeling.prototype.createSpace=function(movingShapes,resizingShapes,delta,direction){var context={movingShapes:movingShapes,resizingShapes:resizingShapes,delta:delta,direction:direction};this._commandStack.execute("spaceTool",context)},Modeling.prototype.updateWaypoints=function(connection,newWaypoints){var context={connection:connection,newWaypoints:newWaypoints};this._commandStack.execute("connection.updateWaypoints",context)},Modeling.prototype.reconnectStart=function(connection,newSource,dockingOrPoints){var context={connection:connection,newSource:newSource,dockingOrPoints:dockingOrPoints};this._commandStack.execute("connection.reconnectStart",context)},Modeling.prototype.reconnectEnd=function(connection,newTarget,dockingOrPoints){var context={connection:connection,newTarget:newTarget,dockingOrPoints:dockingOrPoints};this._commandStack.execute("connection.reconnectEnd",context)},Modeling.prototype.connect=function(source,target,attrs){return this.createConnection(source,target,attrs||{},source.parent)},Modeling.prototype._create=function(type,attrs){return attrs instanceof model.Base?attrs:this._elementFactory.create(type,attrs)}},{345:345,346:346,347:347,348:348,349:349,350:350,351:351,352:352,353:353,354:354,355:355,357:357,358:358,359:359,360:360,361:361,362:362,363:363,364:364,416:416,464:464}],345:[function(_dereq_,module,exports){"use strict";function AppendShapeHandler(modeling){this._modeling=modeling}function existsConnection(source,target){return any(source.outgoing,function(c){return c.target===target})}var any=_dereq_(460);_dereq_(451)(AppendShapeHandler,_dereq_(356)),AppendShapeHandler.$inject=["modeling"],module.exports=AppendShapeHandler,AppendShapeHandler.prototype.preExecute=function(context){if(!context.source)throw new Error("source required");var parent=context.parent||context.source.parent,shape=this._modeling.createShape(context.shape,context.position,parent);context.shape=shape},AppendShapeHandler.prototype.postExecute=function(context){var parent=context.connectionParent||context.shape.parent;existsConnection(context.source,context.shape)||this._modeling.connect(context.source,context.shape,context.connection,parent)}},{356:356,451:451,460:460}],346:[function(_dereq_,module,exports){"use strict";function CreateConnectionHandler(canvas,layouter){this._canvas=canvas,this._layouter=layouter}CreateConnectionHandler.$inject=["canvas","layouter"],module.exports=CreateConnectionHandler,CreateConnectionHandler.prototype.execute=function(context){var source=context.source,target=context.target,parent=context.parent;if(!source||!target)throw new Error("source and target required");if(!parent)throw new Error("parent required");var connection=context.connection;return connection.source=source,connection.target=target,connection.waypoints||(connection.waypoints=this._layouter.layoutConnection(connection)),this._canvas.addConnection(connection,parent),connection},CreateConnectionHandler.prototype.revert=function(context){var connection=context.connection;this._canvas.removeConnection(connection),connection.source=null,connection.target=null}},{}],347:[function(_dereq_,module,exports){"use strict";function CreateLabelHandler(canvas){CreateShapeHandler.call(this,canvas)}function ensureValidDimensions(label){["width","height"].forEach(function(prop){void 0===label[prop]&&(label[prop]=0)})}var inherits=_dereq_(451),CreateShapeHandler=_dereq_(348);inherits(CreateLabelHandler,CreateShapeHandler),CreateLabelHandler.$inject=["canvas"],module.exports=CreateLabelHandler;var originalExecute=CreateShapeHandler.prototype.execute;CreateLabelHandler.prototype.execute=function(context){var label=context.shape;return ensureValidDimensions(label),label.labelTarget=context.labelTarget,originalExecute.call(this,context)};var originalRevert=CreateShapeHandler.prototype.revert;CreateLabelHandler.prototype.revert=function(context){return context.shape.labelTarget=null,originalRevert.call(this,context)}},{348:348,451:451}],348:[function(_dereq_,module,exports){"use strict";function CreateShapeHandler(canvas){this._canvas=canvas}var assign=_dereq_(592),round=Math.round;CreateShapeHandler.$inject=["canvas"],module.exports=CreateShapeHandler,CreateShapeHandler.prototype.execute=function(context){var shape=context.shape,positionOrBounds=context.position,parent=context.parent,parentIndex=context.parentIndex;if(!parent)throw new Error("parent required");if(!positionOrBounds)throw new Error("position required");return void 0!==positionOrBounds.width?assign(shape,positionOrBounds):assign(shape,{x:positionOrBounds.x-round(shape.width/2),y:positionOrBounds.y-round(shape.height/2)}),this._canvas.addShape(shape,parent,parentIndex),shape},CreateShapeHandler.prototype.revert=function(context){this._canvas.removeShape(context.shape)}},{592:592}],349:[function(_dereq_,module,exports){"use strict";function DeleteConnectionHandler(canvas,modeling){this._canvas=canvas,this._modeling=modeling}var Collections=_dereq_(425);DeleteConnectionHandler.$inject=["canvas","modeling"],module.exports=DeleteConnectionHandler,DeleteConnectionHandler.prototype.preExecute=function(context){var connection=context.connection;connection.label&&this._modeling.removeShape(connection.label)},DeleteConnectionHandler.prototype.execute=function(context){var connection=context.connection,parent=connection.parent;return context.parent=parent,context.parentIndex=Collections.indexOf(parent.children,connection),context.source=connection.source,context.target=connection.target,this._canvas.removeConnection(connection),connection.source=null,connection.target=null,connection.label=null,connection},DeleteConnectionHandler.prototype.revert=function(context){var connection=context.connection,parent=context.parent,parentIndex=context.parentIndex;return connection.source=context.source,connection.target=context.target,Collections.add(parent.children,connection,parentIndex),this._canvas.addConnection(connection,parent),connection}},{425:425}],350:[function(_dereq_,module,exports){"use strict";function DeleteElementsHandler(modeling,elementRegistry){this._modeling=modeling,this._elementRegistry=elementRegistry}var forEach=_dereq_(464);_dereq_(451)(DeleteElementsHandler,_dereq_(356)),DeleteElementsHandler.$inject=["modeling","elementRegistry"],module.exports=DeleteElementsHandler,DeleteElementsHandler.prototype.postExecute=function(context){var modeling=this._modeling,elementRegistry=this._elementRegistry,elements=context.elements;forEach(elements,function(element){elementRegistry.get(element.id)&&(element.waypoints?modeling.removeConnection(element):modeling.removeShape(element))})}},{356:356,451:451,464:464}],351:[function(_dereq_,module,exports){"use strict";function DeleteShapeHandler(canvas,modeling){this._canvas=canvas,this._modeling=modeling}var Collections=_dereq_(425),saveClear=_dereq_(438).saveClear;DeleteShapeHandler.$inject=["canvas","modeling"],module.exports=DeleteShapeHandler,DeleteShapeHandler.prototype.preExecute=function(context){var modeling=this._modeling,shape=context.shape,label=shape.label;shape.labelTarget&&(context.labelTarget=shape.labelTarget,shape.labelTarget=null),label&&this._modeling.removeShape(label,{nested:!0}),saveClear(shape.incoming,function(connection){modeling.removeConnection(connection,{nested:!0})}),saveClear(shape.outgoing,function(connection){modeling.removeConnection(connection,{nested:!0})}),saveClear(shape.children,function(e){modeling.removeShape(e,{nested:!0})})},DeleteShapeHandler.prototype.execute=function(context){var canvas=this._canvas,shape=context.shape,oldParent=shape.parent;return context.oldParent=oldParent,context.oldParentIndex=Collections.indexOf(oldParent.children,shape),shape.label=null,canvas.removeShape(shape),shape},DeleteShapeHandler.prototype.revert=function(context){var canvas=this._canvas,shape=context.shape,oldParent=context.oldParent,oldParentIndex=context.oldParentIndex,labelTarget=context.labelTarget;return Collections.add(oldParent.children,shape,oldParentIndex),labelTarget&&(labelTarget.label=shape),canvas.addShape(shape,oldParent),shape}},{425:425,438:438}],352:[function(_dereq_,module,exports){"use strict";function LayoutConnectionHandler(layouter,canvas){this._layouter=layouter,this._canvas=canvas}function last(coll){return coll[coll.length-1]}function sendToFront(connection){function findIndex(array,obj){var index=array.indexOf(obj);if(index<0&&obj){index=findIndex(array,obj.parent)}return index}var connectionSiblings=connection.parent.children,connectionIdx=connectionSiblings.indexOf(connection),sourceIdx=findIndex(connectionSiblings,connection.source),targetIdx=findIndex(connectionSiblings,connection.target),insertIndex=Math.max(sourceIdx+1,targetIdx+1,connectionIdx);return connectionIdx<insertIndex&&(connectionSiblings.splice(insertIndex,0,connection),connectionSiblings.splice(connectionIdx,1)),insertIndex}var assign=_dereq_(592);LayoutConnectionHandler.$inject=["layouter","canvas"],module.exports=LayoutConnectionHandler,LayoutConnectionHandler.prototype.execute=function(context){var connection=context.connection,parent=connection.parent,connectionSiblings=parent.children,oldIndex=connectionSiblings.indexOf(connection),oldWaypoints=connection.waypoints;return assign(context,{oldWaypoints:oldWaypoints,oldIndex:oldIndex}),sendToFront(connection),connection.waypoints=this._layouter.layoutConnection(connection,context.hints),oldWaypoints.length?(oldWaypoints[0].original&&!connection.waypoints[0].original&&(connection.waypoints[0].original={x:oldWaypoints[0].original.x,y:oldWaypoints[0].original.y}),last(oldWaypoints).original&&!last(connection.waypoints).original&&(last(connection.waypoints).original={x:last(oldWaypoints).original.x,y:last(oldWaypoints).original.y}),connection):connection},LayoutConnectionHandler.prototype.revert=function(context){var connection=context.connection,parent=connection.parent,connectionSiblings=parent.children,currentIndex=connectionSiblings.indexOf(connection),oldIndex=context.oldIndex;return connection.waypoints=context.oldWaypoints,oldIndex!==currentIndex&&(connectionSiblings.splice(currentIndex,1),connectionSiblings.splice(oldIndex,0,connection)),connection}},{592:592}],353:[function(_dereq_,module,exports){"use strict";function MoveConnectionHandler(){}var forEach=_dereq_(464),Collections=_dereq_(425);module.exports=MoveConnectionHandler,MoveConnectionHandler.prototype.execute=function(context){var connection=context.connection,delta=context.delta,newParent=context.newParent||connection.parent,newParentIndex=context.newParentIndex,oldParent=connection.parent;context.oldParent=oldParent,context.oldParentIndex=Collections.remove(oldParent.children,connection),Collections.add(newParent.children,connection,newParentIndex),connection.parent=newParent;var updateAnchors=!1!==context.hints.updateAnchors;return forEach(connection.waypoints,function(p){p.x+=delta.x,p.y+=delta.y,updateAnchors&&p.original&&(p.original.x+=delta.x,p.original.y+=delta.y)}),connection},MoveConnectionHandler.prototype.revert=function(context){var connection=context.connection,newParent=connection.parent,oldParent=context.oldParent,oldParentIndex=context.oldParentIndex,delta=context.delta;Collections.remove(newParent.children,connection),Collections.add(oldParent.children,connection,oldParentIndex),connection.parent=oldParent;var updateAnchors=!1!==context.hints.updateAnchors;return forEach(connection.waypoints,function(p){p.x-=delta.x,p.y-=delta.y,updateAnchors&&p.original&&(p.original.x-=delta.x,p.original.y-=delta.y)}),connection}},{425:425,464:464}],354:[function(_dereq_,module,exports){"use strict";function MoveElementsHandler(modeling){this._helper=new MoveHelper(modeling)}var MoveHelper=_dereq_(365);MoveElementsHandler.$inject=["modeling"],module.exports=MoveElementsHandler,MoveElementsHandler.prototype.preExecute=function(context){context.closure=this._helper.getClosure(context.shapes)},MoveElementsHandler.prototype.postExecute=function(context){var primaryShape,hints=context.hints;hints&&hints.primaryShape&&(primaryShape=hints.primaryShape,hints.oldParent=primaryShape.parent),this._helper.moveClosure(context.closure,context.delta,context.newParent,context.newHost,primaryShape)},MoveElementsHandler.prototype.execute=function(context){},MoveElementsHandler.prototype.revert=function(context){}},{365:365}],355:[function(_dereq_,module,exports){"use strict";function MoveShapeHandler(modeling){this._modeling=modeling,this._helper=new MoveHelper(modeling)}var assign=_dereq_(592),forEach=_dereq_(464),pick=_dereq_(598),MoveHelper=_dereq_(365),Collections=_dereq_(425);MoveShapeHandler.$inject=["modeling"],module.exports=MoveShapeHandler,MoveShapeHandler.prototype.execute=function(context){var shape=context.shape,delta=context.delta,newParent=context.newParent||shape.parent,newParentIndex=context.newParentIndex,oldParent=shape.parent;return context.oldBounds=pick(shape,["x","y","width","height"]),context.oldParent=oldParent,context.oldParentIndex=Collections.remove(oldParent.children,shape),Collections.add(newParent.children,shape,newParentIndex),assign(shape,{parent:newParent,x:shape.x+delta.x,y:shape.y+delta.y}),shape},MoveShapeHandler.prototype.postExecute=function(context){var shape=context.shape,oldBounds=context.oldBounds,modeling=this._modeling;!1!==context.hints.updateAnchors&&modeling.updateAnchors(shape,oldBounds),!1!==context.hints.layout&&(forEach(shape.incoming,function(c){modeling.layoutConnection(c,{endChanged:!0})}),forEach(shape.outgoing,function(c){modeling.layoutConnection(c,{startChanged:!0})})),!1!==context.hints.recurse&&this.moveChildren(context)},MoveShapeHandler.prototype.revert=function(context){var shape=context.shape,oldParent=context.oldParent,oldParentIndex=context.oldParentIndex,delta=context.delta;return Collections.add(oldParent.children,shape,oldParentIndex),assign(shape,{parent:oldParent,x:shape.x-delta.x,y:shape.y-delta.y}),shape},MoveShapeHandler.prototype.moveChildren=function(context){var delta=context.delta,shape=context.shape;this._helper.moveRecursive(shape.children,delta,null)},MoveShapeHandler.prototype.getNewParent=function(context){return context.newParent||context.shape.parent}},{365:365,425:425,464:464,592:592,598:598}],356:[function(_dereq_,module,exports){"use strict";function NoopHandler(){}module.exports=NoopHandler,NoopHandler.prototype.execute=function(){},NoopHandler.prototype.revert=function(){}},{}],357:[function(_dereq_,module,exports){"use strict";function removeProperties(element,properties){forEach(properties,function(prop){element[prop]&&delete element[prop]})}function PasteHandler(eventBus,canvas,selection,elementFactory,modeling,rules){this._eventBus=eventBus,this._canvas=canvas,this._selection=selection,this._elementFactory=elementFactory,this._modeling=modeling,this._rules=rules}var forEach=_dereq_(464),map=_dereq_(467),sortBy=_dereq_(471),clone=_dereq_(581);_dereq_(451)(PasteHandler,_dereq_(356)),PasteHandler.$inject=["eventBus","canvas","selection","elementFactory","modeling","rules"],module.exports=PasteHandler,PasteHandler.prototype.preExecute=function(context){var eventBus=this._eventBus,tree=context.tree,topParent=context.topParent,position=context.position;tree.createdElements={},tree.labels=[],forEach(tree,function(elements,depthStr){var depth=parseInt(depthStr,10);isNaN(depth)||(depth||(elements=map(elements,function(descriptor){return descriptor.parent=topParent,descriptor})),elements=sortBy(elements,"priority"),forEach(elements,function(descriptor){var hints,newPosition,id=descriptor.id,parent=descriptor.parent,isAttach=!1,element=clone(descriptor);if(depth&&(element.parent=this._getCreatedElement(parent,tree)),parent){if(eventBus.fire("element.paste",{createdElements:tree.createdElements,descriptor:element}),parent=element.parent,element.waypoints)return void((element=this._createConnection(element,parent,position,tree))&&(tree.createdElements[id]={element:element,descriptor:descriptor}));if(element.parent!==topParent&&(hints={root:!1}),element.host&&(isAttach=!0,parent=this._getCreatedElement(element.host,tree)),element.labelTarget)return tree.labels.push(element);newPosition={x:Math.round(position.x+element.delta.x+element.width/2),y:Math.round(position.y+element.delta.y+element.height/2)},removeProperties(element,["id","parent","delta","host","priority"]),(element=this._createShape(element,parent,newPosition,isAttach,hints))&&(tree.createdElements[id]={element:element,descriptor:descriptor})}},this))},this)},PasteHandler.prototype.postExecute=function(context){var modeling=this._modeling,selection=this._selection,tree=context.tree,labels=tree.labels,topLevelElements=[];forEach(labels,function(labelDescriptor){var label,labelTargetPos,newPosition,labelTarget=this._getCreatedElement(labelDescriptor.labelTarget,tree);labelTarget&&(label=labelTarget.label)&&(labelTargetPos={x:labelTarget.x,y:labelTarget.y},labelTarget.waypoints&&(labelTargetPos=labelTarget.waypoints[0]),newPosition={x:Math.round(labelTargetPos.x-label.x+labelDescriptor.delta.x),y:Math.round(labelTargetPos.y-label.y+labelDescriptor.delta.y)},modeling.moveShape(label,newPosition,labelTarget.parent))},this),forEach(tree[0],function(descriptor){var id=descriptor.id,toplevel=tree.createdElements[id];toplevel&&topLevelElements.push(toplevel.element)}),selection.select(topLevelElements)},PasteHandler.prototype._createConnection=function(element,parent,parentCenter,tree){var source,target,modeling=this._modeling,rules=this._rules;return element.waypoints=map(element.waypoints,function(waypoint,idx){return{x:Math.round(parentCenter.x+element.delta[idx].x),y:Math.round(parentCenter.y+element.delta[idx].y)}}),source=this._getCreatedElement(element.source,tree),target=this._getCreatedElement(element.target,tree),source&&target&&rules.allowed("element.paste",{source:source,target:target})?(removeProperties(element,["id","parent","delta","source","target","width","height","priority"]),modeling.createConnection(source,target,element,parent)):null},PasteHandler.prototype._createShape=function(element,parent,position,isAttach,hints){var modeling=this._modeling,elementFactory=this._elementFactory;if(!this._rules.allowed("element.paste",{element:element,position:position,parent:parent}))return null;var shape=elementFactory.createShape(element);return modeling.createShape(shape,position,parent,isAttach,hints),shape},PasteHandler.prototype._getCreatedElement=function(id,tree){return tree.createdElements[id]&&tree.createdElements[id].element}},{356:356,451:451,464:464,467:467,471:471,581:581}],358:[function(_dereq_,module,exports){"use strict";function ReconnectConnectionHandler(){}var isArray=_dereq_(583);ReconnectConnectionHandler.$inject=[],module.exports=ReconnectConnectionHandler,ReconnectConnectionHandler.prototype.execute=function(context){var newWaypoints,newSource=context.newSource,newTarget=context.newTarget,connection=context.connection,dockingOrPoints=context.dockingOrPoints,oldWaypoints=connection.waypoints;if(!newSource&&!newTarget)throw new Error("newSource or newTarget are required");if(newSource&&newTarget)throw new Error("must specify either newSource or newTarget");return context.oldWaypoints=oldWaypoints,isArray(dockingOrPoints)?newWaypoints=dockingOrPoints:(newWaypoints=oldWaypoints.slice(),newWaypoints.splice(newSource?0:-1,1,dockingOrPoints)),newSource&&(context.oldSource=connection.source,connection.source=newSource),newTarget&&(context.oldTarget=connection.target,connection.target=newTarget),connection.waypoints=newWaypoints,connection},ReconnectConnectionHandler.prototype.revert=function(context){var newSource=context.newSource,newTarget=context.newTarget,connection=context.connection;return newSource&&(connection.source=context.oldSource),newTarget&&(connection.target=context.oldTarget),connection.waypoints=context.oldWaypoints,connection}},{583:583}],359:[function(_dereq_,module,exports){"use strict";function ReplaceShapeHandler(modeling,rules){this._modeling=modeling,this._rules=rules}var forEach=_dereq_(464);ReplaceShapeHandler.$inject=["modeling","rules"],module.exports=ReplaceShapeHandler,ReplaceShapeHandler.prototype.preExecute=function(context){function canReconnect(type,source,target,connection){return rules.allowed(type,{source:source,target:target,connection:connection})}var newShape,self=this,modeling=this._modeling,rules=this._rules,oldShape=context.oldShape,newData=context.newData,hints=context.hints,position={x:newData.x,y:newData.y};newShape=context.newShape=context.newShape||self.createShape(newData,position,oldShape.parent),oldShape.host&&modeling.updateAttachment(newShape,oldShape.host);var children;!1!==hints.moveChildren&&(children=oldShape.children.slice(),modeling.moveElements(children,{x:0,y:0},newShape));var incoming=oldShape.incoming.slice(),outgoing=oldShape.outgoing.slice();forEach(incoming,function(connection){var waypoints=connection.waypoints,docking=waypoints[waypoints.length-1];canReconnect("connection.reconnectEnd",connection.source,newShape,connection)&&self.reconnectEnd(connection,newShape,docking)}),forEach(outgoing,function(connection){var waypoints=connection.waypoints,docking=waypoints[0],target=connection.target;canReconnect("connection.reconnectStart",newShape,target,connection)&&self.reconnectStart(connection,newShape,docking)})},ReplaceShapeHandler.prototype.postExecute=function(context){var modeling=this._modeling,oldShape=context.oldShape,newShape=context.newShape;forEach(newShape.incoming,function(c){modeling.layoutConnection(c,{endChanged:!0})}),forEach(newShape.outgoing,function(c){modeling.layoutConnection(c,{startChanged:!0})}),modeling.removeShape(oldShape)},ReplaceShapeHandler.prototype.execute=function(context){},ReplaceShapeHandler.prototype.revert=function(context){},ReplaceShapeHandler.prototype.createShape=function(shape,position,target){return this._modeling.createShape(shape,position,target)},ReplaceShapeHandler.prototype.reconnectStart=function(connection,newSource,dockingPoint){this._modeling.reconnectStart(connection,newSource,dockingPoint)},ReplaceShapeHandler.prototype.reconnectEnd=function(connection,newTarget,dockingPoint){this._modeling.reconnectEnd(connection,newTarget,dockingPoint)}},{464:464}],360:[function(_dereq_,module,exports){"use strict";function ResizeShapeHandler(modeling){this._modeling=modeling}var assign=_dereq_(592),forEach=_dereq_(464);ResizeShapeHandler.$inject=["modeling"],module.exports=ResizeShapeHandler,ResizeShapeHandler.prototype.execute=function(context){var shape=context.shape,newBounds=context.newBounds;if(void 0===newBounds.x||void 0===newBounds.y||void 0===newBounds.width||void 0===newBounds.height)throw new Error("newBounds must have {x, y, width, height} properties");if(newBounds.width<10||newBounds.height<10)throw new Error("width and height cannot be less than 10px");return context.oldBounds={width:shape.width,height:shape.height,x:shape.x,y:shape.y},assign(shape,{width:newBounds.width,height:newBounds.height,x:newBounds.x,y:newBounds.y}),shape},ResizeShapeHandler.prototype.postExecute=function(context){var shape=context.shape,oldBounds=context.oldBounds,modeling=this._modeling;modeling.updateAnchors(shape,oldBounds),forEach(shape.incoming,function(c){modeling.layoutConnection(c,{endChanged:!0})}),forEach(shape.outgoing,function(c){modeling.layoutConnection(c,{startChanged:!0})})},ResizeShapeHandler.prototype.revert=function(context){var shape=context.shape,oldBounds=context.oldBounds;return assign(shape,{width:oldBounds.width,height:oldBounds.height,x:oldBounds.x,y:oldBounds.y}),shape}},{464:464,592:592}],361:[function(_dereq_,module,exports){"use strict";function SpaceToolHandler(modeling){this._modeling=modeling}var forEach=_dereq_(464),SpaceUtil=_dereq_(401);SpaceToolHandler.$inject=["modeling"],module.exports=SpaceToolHandler,SpaceToolHandler.prototype.preExecute=function(context){var modeling=this._modeling,resizingShapes=context.resizingShapes,delta=context.delta,direction=context.direction;forEach(resizingShapes,function(shape){var newBounds=SpaceUtil.resizeBounds(shape,direction,delta);modeling.resizeShape(shape,newBounds)})},SpaceToolHandler.prototype.postExecute=function(context){var modeling=this._modeling,movingShapes=context.movingShapes,delta=context.delta;modeling.moveElements(movingShapes,delta)},SpaceToolHandler.prototype.execute=function(context){},SpaceToolHandler.prototype.revert=function(context){}},{401:401,464:464}],362:[function(_dereq_,module,exports){"use strict";function UpdateAnchorsHandler(){}var forEach=_dereq_(464),getNewAttachPoint=_dereq_(423).getNewAttachPoint;module.exports=UpdateAnchorsHandler,UpdateAnchorsHandler.prototype.execute=function(context){function updateAnchors(connections,anchorPosition){forEach(connections,function(c){var waypoints=c.waypoints,pointIndex="end"===anchorPosition?waypoints.length-1:0,point=waypoints[pointIndex];oldAnchors.push({point:point,oldOriginal:point.original}),point.original=getNewAttachPoint(point.original||point,oldBounds,element),changedConnections.push(c)})}var element=context.element,oldBounds=context.oldBounds,changedConnections=context.changedConnections=[],oldAnchors=context.oldAnchors=[];return updateAnchors(element.incoming,"end"),updateAnchors(element.outgoing,"start"),changedConnections},UpdateAnchorsHandler.prototype.revert=function(context){var oldAnchors=context.oldAnchors,changedConnections=context.changedConnections;return forEach(oldAnchors,function(anchor){anchor.point.original=anchor.oldOriginal}),changedConnections}},{423:423,464:464}],363:[function(_dereq_,module,exports){"use strict";function UpdateAttachmentHandler(modeling){this._modeling=modeling}function removeAttacher(host,attacher){return Collections.remove(host&&host.attachers,attacher)}function addAttacher(host,attacher,idx){if(host){var attachers=host.attachers;attachers||(host.attachers=attachers=[]),Collections.add(attachers,attacher,idx)}}var Collections=_dereq_(425);module.exports=UpdateAttachmentHandler,UpdateAttachmentHandler.$inject=["modeling"],UpdateAttachmentHandler.prototype.execute=function(context){var shape=context.shape,newHost=context.newHost,oldHost=shape.host;return context.oldHost=oldHost,context.attacherIdx=removeAttacher(oldHost,shape),addAttacher(newHost,shape),shape.host=newHost,shape},UpdateAttachmentHandler.prototype.revert=function(context){var shape=context.shape,newHost=context.newHost,oldHost=context.oldHost,attacherIdx=context.attacherIdx;return shape.host=oldHost,removeAttacher(newHost,shape),addAttacher(oldHost,shape,attacherIdx),shape}},{425:425}],364:[function(_dereq_,module,exports){"use strict";function UpdateWaypointsHandler(){}module.exports=UpdateWaypointsHandler,UpdateWaypointsHandler.prototype.execute=function(context){var connection=context.connection,newWaypoints=context.newWaypoints;return context.oldWaypoints=connection.waypoints,connection.waypoints=newWaypoints,connection},UpdateWaypointsHandler.prototype.revert=function(context){var connection=context.connection,oldWaypoints=context.oldWaypoints;return connection.waypoints=oldWaypoints,connection}},{}],365:[function(_dereq_,module,exports){"use strict";function MoveHelper(modeling){this._modeling=modeling}var forEach=_dereq_(464),Elements=_dereq_(428);module.exports=MoveHelper,MoveHelper.prototype.moveRecursive=function(elements,delta,newParent){return elements?this.moveClosure(this.getClosure(elements),delta,newParent):[]},MoveHelper.prototype.moveClosure=function(closure,delta,newParent,newHost,primaryShape){var modeling=this._modeling,allShapes=closure.allShapes,allConnections=closure.allConnections,enclosedConnections=closure.enclosedConnections,topLevel=closure.topLevel,keepParent=!1;primaryShape&&primaryShape.parent===newParent&&(keepParent=!0),forEach(allShapes,function(shape){modeling.moveShape(shape,delta,topLevel[shape.id]&&!keepParent&&newParent,{recurse:!1,layout:!1})}),forEach(allConnections,function(c){var startMoved=!!allShapes[c.source.id],endMoved=!!allShapes[c.target.id];enclosedConnections[c.id]&&startMoved&&endMoved?modeling.moveConnection(c,delta,topLevel[c.id]&&newParent,{updateAnchors:!1}):modeling.layoutConnection(c,{startChanged:startMoved,endChanged:endMoved})})},MoveHelper.prototype.getClosure=function(elements){return Elements.getClosure(elements)}},{428:428,464:464}],366:[function(_dereq_,module,exports){"use strict";function MouseTracking(eventBus,canvas){this._eventBus=eventBus,this._canvas=canvas,this._init()}var bind=_dereq_(473);MouseTracking.$inject=["eventBus","canvas"],module.exports=MouseTracking,MouseTracking.prototype.getHoverContext=function(){var viewbox=this._canvas.viewbox();return{element:this._hoverElement,point:{x:viewbox.x+Math.round(this._mouseX/viewbox.scale),y:viewbox.y+Math.round(this._mouseY/viewbox.scale)}}},MouseTracking.prototype._init=function(){var eventBus=this._eventBus,canvas=this._canvas,container=canvas.getContainer();this._setMousePosition=bind(this._setMousePosition,this),container.addEventListener("mousemove",this._setMousePosition),eventBus.on("diagram.destroy",function(){container.removeEventListener("mousemove",this._setMousePosition)},this),eventBus.on("element.hover",this._setHoverElement,this)},MouseTracking.prototype._setHoverElement=function(event){this._hoverElement=event.element},MouseTracking.prototype._setMousePosition=function(event){
this._mouseX=event.offsetX,this._mouseY=event.offsetY}},{473:473}],367:[function(_dereq_,module,exports){"use strict";module.exports={__init__:["mouseTracking"],mouseTracking:["type",_dereq_(366)]}},{366:366}],368:[function(_dereq_,module,exports){"use strict";function mid(element){return{x:element.x+round(element.width/2),y:element.y+round(element.height/2)}}function MoveEvents(eventBus,dragging,modeling,selection,rules){function canMove(shapes,delta,position,target){return rules.allowed("elements.move",{shapes:shapes,delta:delta,position:position,target:target})}function start(event,element,activate){if(!element.waypoints&&element.parent){var referencePoint=mid(element);dragging.init(event,referencePoint,"shape.move",{cursor:"grabbing",autoActivate:activate,data:{shape:element,context:{}}})}}eventBus.on("shape.move.start",HIGH_PRIORITY,function(event){var context=event.context,shape=event.shape,shapes=selection.get().slice();-1===shapes.indexOf(shape)&&(shapes=[shape]),shapes=removeNested(shapes),assign(context,{shapes:shapes,validatedShapes:shapes,shape:shape})}),eventBus.on("shape.move.start",MEDIUM_PRIORITY,function(event){var context=event.context,validatedShapes=context.validatedShapes;if(!(context.canExecute=canMove(validatedShapes)))return event.stopPropagation(),!1}),eventBus.on("shape.move.move",LOW_PRIORITY,function(event){var canExecute,context=event.context,validatedShapes=context.validatedShapes,hover=event.hover,delta={x:event.dx,y:event.dy},position={x:event.x,y:event.y};if(canExecute=canMove(validatedShapes,delta,position,hover),context.delta=delta,context.canExecute=canExecute,null===canExecute)return void(context.target=null);context.target=hover}),eventBus.on("shape.move.end",function(event){var context=event.context,delta=context.delta,canExecute=context.canExecute,isAttach="attach"===canExecute,shapes=context.shapes;if(!canExecute)return!1;delta.x=round(delta.x),delta.y=round(delta.y),modeling.moveElements(shapes,delta,context.target,isAttach,{primaryShape:context.shape})}),eventBus.on("element.mousedown",function(event){var originalEvent=getOriginalEvent(event);if(!originalEvent)throw new Error("must supply DOM mousedown event");start(originalEvent,event.element)}),this.start=start}function removeNested(elements){var ids=groupBy(elements,"id");return filter(elements,function(element){for(;element=element.parent;)if(ids[element.id])return!1;return!0})}var assign=_dereq_(592),filter=_dereq_(462),groupBy=_dereq_(465),LOW_PRIORITY=500,MEDIUM_PRIORITY=1250,HIGH_PRIORITY=1500,getOriginalEvent=_dereq_(429).getOriginal,round=Math.round;MoveEvents.$inject=["eventBus","dragging","modeling","selection","rules"],module.exports=MoveEvents},{429:429,462:462,465:465,592:592}],369:[function(_dereq_,module,exports){"use strict";function MoveVisuals(eventBus,elementRegistry,canvas,styles){function getGfx(e){return elementRegistry.getGraphics(e)}function getVisualDragShapes(shapes){return removeEdges(getAllDraggedElements(shapes))}function getAllDraggedElements(shapes){var allShapes=Elements.selfAndAllChildren(shapes,!0),allConnections=map(allShapes,function(shape){return(shape.incoming||[]).concat(shape.outgoing||[])});return flatten(allShapes.concat(allConnections),!0)}function setMarker(element,marker){[MARKER_ATTACH,MARKER_OK,MARKER_NOT_OK,MARKER_NEW_PARENT].forEach(function(m){m===marker?canvas.addMarker(element,m):canvas.removeMarker(element,m)})}function addDragger(context,element){var dragGroup=context.dragGroup;dragGroup||(dragGroup=context.dragGroup=canvas.getDefaultLayer().group().attr(styles.cls("djs-drag-group",["no-events"])));var gfx=getGfx(element),dragger=gfx.clone(),bbox=gfx.getBBox();return dragger.attr(styles.cls("djs-dragger",[],{x:bbox.x,y:bbox.y})),dragGroup.add(dragger),dragger}function makeDraggable(context,element,addMarker){addDragger(context,element),addMarker&&canvas.addMarker(element,MARKER_DRAGGING),context.allDraggedElements?context.allDraggedElements.push(element):context.allDraggedElements=[element]}this.addDragger=addDragger,this.makeDraggable=makeDraggable,eventBus.on("shape.move.start",LOW_PRIORITY,function(event){var context=event.context,dragShapes=context.shapes,allDraggedElements=context.allDraggedElements;getVisualDragShapes(dragShapes).forEach(function(shape){addDragger(context,shape)}),allDraggedElements=allDraggedElements?flatten(allDraggedElements,getAllDraggedElements(dragShapes)):getAllDraggedElements(dragShapes),forEach(allDraggedElements,function(e){canvas.addMarker(e,MARKER_DRAGGING)}),context.allDraggedElements=allDraggedElements,context.differentParents=haveDifferentParents(dragShapes)}),eventBus.on("shape.move.move",LOW_PRIORITY,function(event){var context=event.context,dragGroup=context.dragGroup,target=context.target,parent=context.shape.parent,canExecute=context.canExecute;target&&("attach"===canExecute?setMarker(target,MARKER_ATTACH):context.canExecute&&target&&target.id!==parent.id?setMarker(target,MARKER_NEW_PARENT):setMarker(target,context.canExecute?MARKER_OK:MARKER_NOT_OK)),dragGroup.translate(event.dx,event.dy)}),eventBus.on(["shape.move.out","shape.move.cleanup"],function(event){var context=event.context,target=context.target;target&&setMarker(target,null)}),eventBus.on("shape.move.cleanup",function(event){var context=event.context,allDraggedElements=context.allDraggedElements,dragGroup=context.dragGroup;forEach(allDraggedElements,function(e){canvas.removeMarker(e,MARKER_DRAGGING)}),dragGroup&&dragGroup.remove()})}function removeEdges(elements){return filter(elements,function(element){if(element.waypoints){var srcFound=find(elements,element.source),targetFound=find(elements,element.target);return srcFound&&targetFound}return!0})}function haveDifferentParents(elements){return 1!==size(groupBy(elements,function(e){return e.parent&&e.parent.id}))}var flatten=_dereq_(453),forEach=_dereq_(464),filter=_dereq_(462),find=_dereq_(463),size=_dereq_(469),groupBy=_dereq_(465),map=_dereq_(467),Elements=_dereq_(428),LOW_PRIORITY=500,MARKER_DRAGGING="djs-dragging",MARKER_OK="drop-ok",MARKER_NOT_OK="drop-not-ok",MARKER_NEW_PARENT="new-parent",MARKER_ATTACH="attach-ok";MoveVisuals.$inject=["eventBus","elementRegistry","canvas","styles"],module.exports=MoveVisuals},{428:428,453:453,462:462,463:463,464:464,465:465,467:467,469:469}],370:[function(_dereq_,module,exports){module.exports={__depends__:[_dereq_(337),_dereq_(395),_dereq_(373),_dereq_(389),_dereq_(329)],__init__:["move","moveVisuals"],move:["type",_dereq_(368)],moveVisuals:["type",_dereq_(369)]}},{329:329,337:337,368:368,369:369,373:373,389:389,395:395}],371:[function(_dereq_,module,exports){"use strict";function OrderingProvider(eventBus){CommandInterceptor.call(this,eventBus);var self=this;this.preExecute(["shape.create","connection.create"],function(event){var context=event.context,element=context.shape||context.connection,parent=context.parent,ordering=self.getOrdering(element,parent);ordering&&(void 0!==ordering.parent&&(context.parent=ordering.parent),context.parentIndex=ordering.index)}),this.preExecute(["shape.move","connection.move"],function(event){var context=event.context,element=context.shape||context.connection,parent=context.newParent||element.parent,ordering=self.getOrdering(element,parent);ordering&&(void 0!==ordering.parent&&(context.newParent=ordering.parent),context.newParentIndex=ordering.index)})}var inherits=_dereq_(451),CommandInterceptor=_dereq_(292);OrderingProvider.prototype.getOrdering=function(element,newParent){return null},inherits(OrderingProvider,CommandInterceptor),module.exports=OrderingProvider},{292:292,451:451}],372:[function(_dereq_,module,exports){"use strict";function Outline(eventBus,styles,elementRegistry){function createOutline(gfx,bounds){return gfx.rect(10,10,0,0).attr(OUTLINE_STYLE)}this.offset=6;var OUTLINE_STYLE=styles.cls("djs-outline",["no-fill"]),self=this;eventBus.on(["shape.added","shape.changed"],function(event){var element=event.element,gfx=event.gfx,outline=gfx.select(".djs-outline");outline||(outline=createOutline(gfx,element)),self.updateShapeOutline(outline,element)}),eventBus.on(["connection.added","connection.changed"],function(event){var element=event.element,gfx=event.gfx,outline=gfx.select(".djs-outline");outline||(outline=createOutline(gfx,element)),self.updateConnectionOutline(outline,element)})}var getBBox=_dereq_(428).getBBox;Outline.prototype.updateShapeOutline=function(outline,element){outline.attr({x:-this.offset,y:-this.offset,width:element.width+2*this.offset,height:element.height+2*this.offset})},Outline.prototype.updateConnectionOutline=function(outline,connection){var bbox=getBBox(connection);outline.attr({x:bbox.x-this.offset,y:bbox.y-this.offset,width:bbox.width+2*this.offset,height:bbox.height+2*this.offset})},Outline.$inject=["eventBus","styles","elementRegistry"],module.exports=Outline},{428:428}],373:[function(_dereq_,module,exports){"use strict";module.exports={__init__:["outline"],outline:["type",_dereq_(372)]}},{372:372}],374:[function(_dereq_,module,exports){"use strict";function createRoot(parent){var root=domify('<div class="djs-overlay-container" style="position: absolute; width: 0; height: 0;" />');return parent.insertBefore(root,parent.firstChild),root}function setPosition(el,x,y){assign(el.style,{left:x+"px",top:y+"px"})}function setVisible(el,visible){el.style.display=!1===visible?"none":""}function Overlays(eventBus,canvas,elementRegistry){this._eventBus=eventBus,this._canvas=canvas,this._elementRegistry=elementRegistry,this._ids=ids,this._overlayDefaults={show:{minZoom:.7,maxZoom:5}},this._overlays={},this._overlayContainers=[],this._overlayRoot=createRoot(canvas.getContainer()),this._init()}var isArray=_dereq_(583),isString=_dereq_(589),isObject=_dereq_(587),assign=_dereq_(592),forEach=_dereq_(464),find=_dereq_(463),filter=_dereq_(462),domify=_dereq_(609),domClasses=_dereq_(605),domAttr=_dereq_(604),domRemove=_dereq_(613),getBBox=_dereq_(428).getBBox,ids=new(_dereq_(432))("ov");Overlays.$inject=["eventBus","canvas","elementRegistry"],module.exports=Overlays,Overlays.prototype.get=function(search){if(isString(search)&&(search={id:search}),isString(search.element)&&(search.element=this._elementRegistry.get(search.element)),search.element){var container=this._getOverlayContainer(search.element,!0);return container?search.type?filter(container.overlays,{type:search.type}):container.overlays.slice():[]}return search.type?filter(this._overlays,{type:search.type}):search.id?this._overlays[search.id]:null},Overlays.prototype.add=function(element,type,overlay){if(isObject(type)&&(overlay=type,type=null),element.id||(element=this._elementRegistry.get(element)),!overlay.position)throw new Error("must specifiy overlay position");if(!overlay.html)throw new Error("must specifiy overlay html");if(!element)throw new Error("invalid element specified");var id=this._ids.next();return overlay=assign({},this._overlayDefaults,overlay,{id:id,type:type,element:element,html:overlay.html}),this._addOverlay(overlay),id},Overlays.prototype.remove=function(filter){var overlays=this.get(filter)||[];isArray(overlays)||(overlays=[overlays]);var self=this;forEach(overlays,function(overlay){var container=self._getOverlayContainer(overlay.element,!0);if(overlay&&(domRemove(overlay.html),domRemove(overlay.htmlContainer),delete overlay.htmlContainer,delete overlay.element,delete self._overlays[overlay.id]),container){var idx=container.overlays.indexOf(overlay);-1!==idx&&container.overlays.splice(idx,1)}})},Overlays.prototype.show=function(){setVisible(this._overlayRoot)},Overlays.prototype.hide=function(){setVisible(this._overlayRoot,!1)},Overlays.prototype._updateOverlayContainer=function(container){var element=container.element,html=container.html,x=element.x,y=element.y;if(element.waypoints){var bbox=getBBox(element);x=bbox.x,y=bbox.y}setPosition(html,x,y),domAttr(container.html,"data-container-id",element.id)},Overlays.prototype._updateOverlay=function(overlay){var position=overlay.position,htmlContainer=overlay.htmlContainer,element=overlay.element,left=position.left,top=position.top;if(void 0!==position.right){var width;width=element.waypoints?getBBox(element).width:element.width,left=-1*position.right+width}if(void 0!==position.bottom){var height;height=element.waypoints?getBBox(element).height:element.height,top=-1*position.bottom+height}setPosition(htmlContainer,left||0,top||0)},Overlays.prototype._createOverlayContainer=function(element){var html=domify('<div class="djs-overlays" style="position: absolute" />');this._overlayRoot.appendChild(html);var container={html:html,element:element,overlays:[]};return this._updateOverlayContainer(container),this._overlayContainers.push(container),container},Overlays.prototype._updateRoot=function(viewbox){var a=viewbox.scale||1,d=viewbox.scale||1,matrix="matrix("+a+",0,0,"+d+","+-1*viewbox.x*a+","+-1*viewbox.y*d+")";this._overlayRoot.style.transform=matrix,this._overlayRoot.style["-ms-transform"]=matrix,this._overlayRoot.style["-webkit-transform"]=matrix},Overlays.prototype._getOverlayContainer=function(element,raw){var container=find(this._overlayContainers,function(c){return c.element===element});return container||raw?container:this._createOverlayContainer(element)},Overlays.prototype._addOverlay=function(overlay){var htmlContainer,overlayContainer,id=overlay.id,element=overlay.element,html=overlay.html;html.get&&(html=html.get(0)),isString(html)&&(html=domify(html)),overlayContainer=this._getOverlayContainer(element),htmlContainer=domify('<div class="djs-overlay" data-overlay-id="'+id+'" style="position: absolute">'),htmlContainer.appendChild(html),overlay.type&&domClasses(htmlContainer).add("djs-overlay-"+overlay.type),overlay.htmlContainer=htmlContainer,overlayContainer.overlays.push(overlay),overlayContainer.html.appendChild(htmlContainer),this._overlays[id]=overlay,this._updateOverlay(overlay),this._updateOverlayVisibilty(overlay,this._canvas.viewbox())},Overlays.prototype._updateOverlayVisibilty=function(overlay,viewbox){var show=overlay.show,htmlContainer=overlay.htmlContainer,visible=!0;show&&((show.minZoom>viewbox.scale||show.maxZoom<viewbox.scale)&&(visible=!1),setVisible(htmlContainer,visible))},Overlays.prototype._updateOverlaysVisibilty=function(viewbox){var self=this;forEach(this._overlays,function(overlay){self._updateOverlayVisibilty(overlay,viewbox)})},Overlays.prototype._init=function(){function updateViewbox(viewbox){self._updateRoot(viewbox),self._updateOverlaysVisibilty(viewbox),self.show()}var eventBus=this._eventBus,self=this;eventBus.on("canvas.viewbox.changing",function(event){self.hide()}),eventBus.on("canvas.viewbox.changed",function(event){updateViewbox(event.viewbox)}),eventBus.on(["shape.remove","connection.remove"],function(e){var element=e.element,overlays=self.get({element:element});forEach(overlays,function(o){self.remove(o.id)});var container=self._getOverlayContainer(element);if(container){domRemove(container.html);var i=self._overlayContainers.indexOf(container);-1!==i&&self._overlayContainers.splice(i,1)}}),eventBus.on(["element.changed"],function(e){var element=e.element,container=self._getOverlayContainer(element,!0);container&&(forEach(container.overlays,function(overlay){self._updateOverlay(overlay)}),self._updateOverlayContainer(container))}),eventBus.on("element.marker.update",function(e){var container=self._getOverlayContainer(e.element,!0);container&&domClasses(container.html)[e.add?"add":"remove"](e.marker)})}},{428:428,432:432,462:462,463:463,464:464,583:583,587:587,589:589,592:592,604:604,605:605,609:609,613:613}],375:[function(_dereq_,module,exports){module.exports={__init__:["overlays"],overlays:["type",_dereq_(374)]}},{374:374}],376:[function(_dereq_,module,exports){"use strict";function Palette(eventBus,canvas,dragging){this._eventBus=eventBus,this._canvas=canvas,this._dragging=dragging,this._providers=[];var self=this;eventBus.on("tool-manager.update",function(event){var tool=event.tool;self.updateToolHighlight(tool)}),eventBus.on("i18n.changed",function(){self._update()})}var isFunction=_dereq_(584),forEach=_dereq_(464),domify=_dereq_(609),domQuery=_dereq_(612),domAttr=_dereq_(604),domClear=_dereq_(606),domClasses=_dereq_(605),domMatches=_dereq_(611),domDelegate=_dereq_(608),domEvent=_dereq_(610);Palette.$inject=["eventBus","canvas","dragging"],module.exports=Palette,Palette.prototype.registerProvider=function(provider){this._providers.push(provider),this._container||this._init(),this._update()},Palette.prototype.getEntries=function(){var entries={};return forEach(this._providers,function(provider){var e=provider.getPaletteEntries();forEach(e,function(entry,id){entries[id]=entry})}),entries},Palette.prototype._init=function(){var canvas=this._canvas,eventBus=this._eventBus,parent=canvas.getContainer(),container=this._container=domify(Palette.HTML_MARKUP),self=this;parent.appendChild(container),domDelegate.bind(container,".djs-palette-toggle, .entry","click",function(event){var target=event.delegateTarget;if(domMatches(target,".djs-palette-toggle"))return self.toggle();self.trigger("click",event)}),domEvent.bind(container,"mousedown",function(event){event.stopPropagation()}),domDelegate.bind(container,".entry","dragstart",function(event){self.trigger("dragstart",event)}),eventBus.fire("palette.create",{html:container}),eventBus.on("canvas.resized",function(){parent.clientHeight<650?domClasses(container).add("two-column"):domClasses(container).remove("two-column")})},Palette.prototype._update=function(){var entriesContainer=domQuery(".djs-palette-entries",this._container),entries=this._entries=this.getEntries();domClear(entriesContainer),forEach(entries,function(entry,id){var grouping=entry.group||"default",container=domQuery("[data-group="+grouping+"]",entriesContainer);container||(container=domify('<div class="group" data-group="'+grouping+'"></div>'),entriesContainer.appendChild(container));var html=entry.html||(entry.separator?'<hr class="separator" />':'<div class="entry" draggable="true"></div>'),control=domify(html);container.appendChild(control),entry.separator||(domAttr(control,"data-action",id),entry.title&&domAttr(control,"title",entry.title),entry.className&&domClasses(control).add(entry.className),entry.imageUrl&&control.appendChild(domify('<img src="'+entry.imageUrl+'">')))}),this.open(!0)},Palette.prototype.trigger=function(action,event,autoActivate){var entry,handler,originalEvent,entries=this._entries,button=event.delegateTarget||event.target;if(!button)return event.preventDefault();(entry=entries[domAttr(button,"data-action")])&&(handler=entry.action,originalEvent=event.originalEvent||event,isFunction(handler)?"click"===action&&handler(originalEvent,autoActivate):handler[action]&&handler[action](originalEvent,autoActivate),event.preventDefault())},Palette.prototype.close=function(){domClasses(this._container).remove("open")},Palette.prototype.open=function(){domClasses(this._container).add("open")},Palette.prototype.toggle=function(open){this.isOpen()?this.close():this.open()},Palette.prototype.isActiveTool=function(tool){return tool&&this._activeTool===tool},Palette.prototype.updateToolHighlight=function(name){var entriesContainer,toolsContainer;this._toolsContainer||(entriesContainer=domQuery(".djs-palette-entries",this._container),this._toolsContainer=domQuery("[data-group=tools]",entriesContainer)),toolsContainer=this._toolsContainer,forEach(toolsContainer.children,function(tool){var actionName=tool.getAttribute("data-action");actionName&&(actionName=actionName.replace("-tool",""),tool.classList.contains("entry")&&actionName===name?domClasses(tool).add("highlighted-entry"):domClasses(tool).remove("highlighted-entry"))})},Palette.prototype.isOpen=function(){return this._container&&domClasses(this._container).has("open")},Palette.HTML_MARKUP='<div class="djs-palette"><div class="djs-palette-entries"></div><div class="djs-palette-toggle"></div></div>'},{464:464,584:584,604:604,605:605,606:606,608:608,609:609,610:610,611:611,612:612}],377:[function(_dereq_,module,exports){"use strict";module.exports={__depends__:[_dereq_(404)],__init__:["palette"],palette:["type",_dereq_(376)]}},{376:376,404:404}],378:[function(_dereq_,module,exports){"use strict";function PopupMenu(eventBus,canvas){this._eventBus=eventBus,this._canvas=canvas,this._providers={}}var forEach=_dereq_(464),assign=_dereq_(592),find=_dereq_(463),domDelegate=_dereq_(608),domify=_dereq_(609),domClasses=_dereq_(605),domAttr=_dereq_(604),domRemove=_dereq_(613);PopupMenu.$inject=["eventBus","canvas"],PopupMenu.prototype.registerProvider=function(id,provider){this._providers[id]=provider},PopupMenu.prototype.create=function(id,element){var provider=this._providers[id];if(!provider)throw new Error("Provider is not registered: "+id);if(!element)throw new Error("Element is missing");var current=this._current={provider:provider,className:id,element:element};return provider.getHeaderEntries&&(current.headerEntries=provider.getHeaderEntries(element)),current.entries=provider.getEntries(element),this},PopupMenu.prototype.isEmpty=function(){var current=this._current;return 0===current.entries.length&&current.headerEntries&&0===current.headerEntries.length},PopupMenu.prototype.open=function(position){if(!position)throw new Error("the position argument is missing");this.isOpen()&&this.close();var current=this._current,canvas=this._canvas,parent=canvas.getContainer();if(current.position=position,current.container=this._createContainer(),current.headerEntries){var headerEntriesContainer=this._createEntries(current.headerEntries,"djs-popup-header");current.container.appendChild(headerEntriesContainer)}if(current.entries){var entriesContainer=this._createEntries(current.entries,"djs-popup-body");current.container.appendChild(entriesContainer)}return this._attachContainer(current.container,parent,position.cursor),this},PopupMenu.prototype.close=function(){this.isOpen()&&(this._unbindHandlers(),domRemove(this._current.container),this._current.container=null)},PopupMenu.prototype.isOpen=function(){return!!this._current.container},PopupMenu.prototype.trigger=function(event){event.preventDefault();var element=event.delegateTarget||event.target,entryId=domAttr(element,"data-id"),entry=this._getEntry(entryId);if(entry.action)return entry.action.call(null,event,entry)},PopupMenu.prototype._getEntry=function(entryId){var search={id:entryId},entry=find(this._current.entries,search)||find(this._current.headerEntries,search);if(!entry)throw new Error("entry not found");return entry},PopupMenu.prototype._createContainer=function(){var container=domify('<div class="djs-popup">'),position=this._current.position,className=this._current.className;return assign(container.style,{position:"absolute",left:position.x+"px",top:position.y+"px",visibility:"hidden"}),domClasses(container).add(className),container},PopupMenu.prototype._attachContainer=function(container,parent,cursor){var self=this;domDelegate.bind(container,".entry","click",function(event){self.trigger(event)});var zoom=this._canvas.zoom();container.style.transformOrigin="top left",container.style.transform="scale("+zoom+")",parent.appendChild(container),cursor&&this._assureIsInbounds(container,cursor),this._bindHandlers()},PopupMenu.prototype._assureIsInbounds=function(container,cursor){var left,top,canvas=this._canvas,clientRect=canvas._container.getBoundingClientRect(),conX=container.offsetLeft,conY=container.offsetTop,conWidth=container.scrollWidth,conHeight=container.scrollHeight,overAxis={},curPos={x:cursor.x-clientRect.left,y:cursor.y-clientRect.top};conX+conWidth>clientRect.width&&(overAxis.x=!0),conY+conHeight>clientRect.height&&(overAxis.y=!0),overAxis.x&&overAxis.y?(left=curPos.x-conWidth+"px",top=curPos.y-conHeight+"px"):overAxis.x?(left=curPos.x-conWidth+"px",top=curPos.y+"px"):overAxis.y&&(left=curPos.x+"px",top=curPos.y-conHeight+"px"),assign(container.style,{left:left,top:top},{visibility:"visible","z-index":1e3})},PopupMenu.prototype._createEntries=function(entries,className){var entriesContainer=domify("<div>"),self=this;return domClasses(entriesContainer).add(className),forEach(entries,function(entry){var entryContainer=self._createEntry(entry,entriesContainer);entriesContainer.appendChild(entryContainer)}),entriesContainer},PopupMenu.prototype._createEntry=function(entry){if(!entry.id)throw new Error("every entry must have the id property set");var entryContainer=domify("<div>"),entryClasses=domClasses(entryContainer);if(entryClasses.add("entry"),entry.className&&entryClasses.add(entry.className),domAttr(entryContainer,"data-id",entry.id),entry.label){var label=domify("<span>");label.textContent=entry.label,entryContainer.appendChild(label)}return entry.imageUrl&&entryContainer.appendChild(domify('<img src="'+entry.imageUrl+'" />')),!0===entry.active&&entryClasses.add("active"),!0===entry.disabled&&entryClasses.add("disabled"),entry.title&&(entryContainer.title=entry.title),entryContainer},PopupMenu.prototype._bindHandlers=function(){function close(){self.close()}var eventBus=this._eventBus,self=this;eventBus.once("contextPad.close",close),eventBus.once("canvas.viewbox.changing",close),eventBus.once("commandStack.changed",close)},PopupMenu.prototype._unbindHandlers=function(){function close(){self.close()}var eventBus=this._eventBus,self=this;eventBus.off("contextPad.close",close),eventBus.off("canvas.viewbox.changed",close),eventBus.off("commandStack.changed",close)},module.exports=PopupMenu},{463:463,464:464,592:592,604:604,605:605,608:608,609:609,613:613}],379:[function(_dereq_,module,exports){"use strict";module.exports={__init__:["popupMenu"],popupMenu:["type",_dereq_(378)]}},{378:378}],380:[function(_dereq_,module,exports){"use strict";function Replace(modeling){this._modeling=modeling}module.exports=Replace,Replace.$inject=["modeling"],Replace.prototype.replaceElement=function(oldElement,newElementData,options){var modeling=this._modeling,newElement=null;return oldElement.waypoints||(newElementData.x=Math.ceil(oldElement.x+(newElementData.width||oldElement.width)/2),newElementData.y=Math.ceil(oldElement.y+(newElementData.height||oldElement.height)/2),newElement=modeling.replaceShape(oldElement,newElementData,options)),newElement}},{}],381:[function(_dereq_,module,exports){"use strict";module.exports={__init__:["replace"],replace:["type",_dereq_(380)]}},{380:380}],382:[function(_dereq_,module,exports){"use strict";function Resize(eventBus,rules,modeling,dragging){this._dragging=dragging,this._rules=rules;var self=this;eventBus.on("resize.start",function(event){var context=event.context,resizeConstraints=context.resizeConstraints,minBounds=context.minBounds;void 0===resizeConstraints&&(void 0===minBounds&&(minBounds=self.computeMinResizeBox(context)),context.resizeConstraints={min:asTRBL(minBounds)})}),eventBus.on("resize.move",function(event){var delta,newBounds,context=event.context,shape=context.shape,direction=context.direction,resizeConstraints=context.resizeConstraints;delta={x:event.dx,y:event.dy},context.delta=delta,newBounds=ResizeUtil.resizeBounds(shape,direction,delta),context.newBounds=ResizeUtil.ensureConstraints(newBounds,resizeConstraints),context.canExecute=self.canResize(context)}),eventBus.on("resize.end",function(event){var context=event.context,shape=context.shape,canExecute=context.canExecute,newBounds=context.newBounds;canExecute&&(newBounds=roundBounds(newBounds),modeling.resizeShape(shape,newBounds))})}var pick=_dereq_(598),assign=_dereq_(592),ResizeUtil=_dereq_(384),asTRBL=_dereq_(414).asTRBL,roundBounds=_dereq_(414).roundBounds;Resize.prototype.canResize=function(context){var rules=this._rules,ctx=pick(context,["newBounds","shape","delta","direction"]);return rules.allowed("shape.resize",ctx)},Resize.prototype.activate=function(event,shape,contextOrDirection){var context,direction,dragging=this._dragging;if("string"==typeof contextOrDirection&&(contextOrDirection={direction:contextOrDirection}),context=assign({shape:shape},contextOrDirection),!(direction=context.direction))throw new Error("must provide a direction (nw|se|ne|sw)");dragging.init(event,"resize",{autoActivate:!0,cursor:"resize-"+(/nw|se/.test(direction)?"nwse":"nesw"),data:{shape:shape,context:context}})},Resize.prototype.computeMinResizeBox=function(context){var minDimensions,childrenBounds,shape=context.shape,direction=context.direction;return minDimensions=context.minDimensions||{width:10,height:10},childrenBounds=ResizeUtil.computeChildrenBBox(shape,context.childrenBoxPadding),ResizeUtil.getMinResizeBounds(direction,shape,minDimensions,childrenBounds)},Resize.$inject=["eventBus","rules","modeling","dragging"],module.exports=Resize},{384:384,414:414,592:592,598:598}],383:[function(_dereq_,module,exports){"use strict";function ResizeHandles(eventBus,canvas,selection,resize){this._resize=resize,this._canvas=canvas;var self=this;eventBus.on("selection.changed",function(e){var newSelection=e.newSelection;self.removeResizers(),1===newSelection.length&&forEach(newSelection,self.addResizer,self)}),eventBus.on("shape.changed",function(e){var shape=e.element;selection.isSelected(shape)&&(self.removeResizers(),self.addResizer(shape))})}var forEach=_dereq_(464),Snap=_dereq_(441),domEvent=_dereq_(610),isPrimaryButton=_dereq_(435).isPrimaryButton,asTRBL=_dereq_(414).asTRBL;ResizeHandles.prototype.makeDraggable=function(element,gfx,direction){function startResize(event){isPrimaryButton(event)&&resize.activate(event,element,direction)}var resize=this._resize;domEvent.bind(gfx.node,"mousedown",startResize),domEvent.bind(gfx.node,"touchstart",startResize)},ResizeHandles.prototype._createResizer=function(element,x,y,rotation,direction){var resizersParent=this._getResizersParent(),group=resizersParent.group().addClass("djs-resizer").addClass("djs-resizer-"+element.id).addClass("djs-resizer-"+direction);group.rect(-7,-7,5,5).addClass("djs-resizer-visual"),group.rect(-7,-7,20,20).addClass("djs-resizer-hit");var matrix=(new Snap.Matrix).translate(x,y).rotate(rotation,0,0);return group.transform(matrix),group},ResizeHandles.prototype.createResizer=function(element,direction){var resizer,trbl=asTRBL(element);resizer="nw"===direction?this._createResizer(element,trbl.left,trbl.top,0,direction):"ne"===direction?this._createResizer(element,trbl.right,trbl.top,90,direction):"se"===direction?this._createResizer(element,trbl.right,trbl.bottom,180,direction):this._createResizer(element,trbl.left,trbl.bottom,270,direction),this.makeDraggable(element,resizer,direction)},ResizeHandles.prototype.addResizer=function(shape){this._resize.canResize({shape:shape})&&(this.createResizer(shape,"nw"),this.createResizer(shape,"ne"),this.createResizer(shape,"se"),this.createResizer(shape,"sw"))},ResizeHandles.prototype.removeResizers=function(){var resizersParent=this._getResizersParent(),resizers=resizersParent.selectAll(".djs-resizer");forEach(resizers,function(resizer){resizer.remove()})},ResizeHandles.prototype._getResizersParent=function(){return this._canvas.getLayer("resizers")},ResizeHandles.$inject=["eventBus","canvas","selection","resize"],module.exports=ResizeHandles},{414:414,435:435,441:441,464:464,610:610}],384:[function(_dereq_,module,exports){"use strict";function isNumber(a){return"number"==typeof a}function applyConstraints(attr,trbl,resizeConstraints){var value=trbl[attr],minValue=resizeConstraints.min&&resizeConstraints.min[attr],maxValue=resizeConstraints.max&&resizeConstraints.max[attr];return isNumber(minValue)&&(value=(/top|left/.test(attr)?min:max)(value,minValue)),isNumber(maxValue)&&(value=(/top|left/.test(attr)?max:min)(value,maxValue)),value}function asPadding(mayBePadding,defaultValue){return void 0!==mayBePadding?mayBePadding:DEFAULT_CHILD_BOX_PADDING}function addPadding(bbox,padding){var left,right,top,bottom;return"object"==typeof padding?(left=asPadding(padding.left),right=asPadding(padding.right),top=asPadding(padding.top),bottom=asPadding(padding.bottom)):left=right=top=bottom=asPadding(padding),{
x:bbox.x-left,y:bbox.y-top,width:bbox.width+left+right,height:bbox.height+top+bottom}}function isBBoxChild(element){return!element.waypoints&&"label"!==element.type}function computeChildrenBBox(shapeOrChildren,padding){var elements;if(elements=void 0===shapeOrChildren.length?filter(shapeOrChildren.children,isBBoxChild):shapeOrChildren,elements.length)return addPadding(getBBox(elements),padding)}var filter=_dereq_(462),max=Math.max,min=Math.min,DEFAULT_CHILD_BOX_PADDING=20,getBBox=_dereq_(428).getBBox,asTRBL=_dereq_(414).asTRBL,asBounds=_dereq_(414).asBounds;module.exports.substractTRBL=function(trblA,trblB){return{top:trblA.top-trblB.top,right:trblA.right-trblB.right,bottom:trblA.bottom-trblB.bottom,left:trblA.left-trblB.left}},module.exports.resizeBounds=function(bounds,direction,delta){var dx=delta.x,dy=delta.y;switch(direction){case"nw":return{x:bounds.x+dx,y:bounds.y+dy,width:bounds.width-dx,height:bounds.height-dy};case"sw":return{x:bounds.x+dx,y:bounds.y,width:bounds.width-dx,height:bounds.height+dy};case"ne":return{x:bounds.x,y:bounds.y+dy,width:bounds.width+dx,height:bounds.height-dy};case"se":return{x:bounds.x,y:bounds.y,width:bounds.width+dx,height:bounds.height+dy};default:throw new Error("unrecognized direction: "+direction)}},module.exports.resizeTRBL=function(bounds,resize){return{x:bounds.x+(resize.left||0),y:bounds.y+(resize.top||0),width:bounds.width-(resize.left||0)+(resize.right||0),height:bounds.height-(resize.top||0)+(resize.bottom||0)}},module.exports.reattachPoint=function(bounds,newBounds,point){var sx=bounds.width/newBounds.width,sy=bounds.height/newBounds.height;return{x:Math.round(newBounds.x+newBounds.width/2)-Math.floor((bounds.x+bounds.width/2-point.x)/sx),y:Math.round(newBounds.y+newBounds.height/2)-Math.floor((bounds.y+bounds.height/2-point.y)/sy)}},module.exports.ensureConstraints=function(currentBounds,resizeConstraints){if(!resizeConstraints)return currentBounds;var currentTrbl=asTRBL(currentBounds);return asBounds({top:applyConstraints("top",currentTrbl,resizeConstraints),right:applyConstraints("right",currentTrbl,resizeConstraints),bottom:applyConstraints("bottom",currentTrbl,resizeConstraints),left:applyConstraints("left",currentTrbl,resizeConstraints)})},module.exports.getMinResizeBounds=function(direction,currentBounds,minDimensions,childrenBounds){var currentBox=asTRBL(currentBounds),minBox={top:/n/.test(direction)?currentBox.bottom-minDimensions.height:currentBox.top,left:/w/.test(direction)?currentBox.right-minDimensions.width:currentBox.left,bottom:/s/.test(direction)?currentBox.top+minDimensions.height:currentBox.bottom,right:/e/.test(direction)?currentBox.left+minDimensions.width:currentBox.right},childrenBox=childrenBounds?asTRBL(childrenBounds):minBox,combinedBox={top:min(minBox.top,childrenBox.top),left:min(minBox.left,childrenBox.left),bottom:max(minBox.bottom,childrenBox.bottom),right:max(minBox.right,childrenBox.right)};return asBounds(combinedBox)},module.exports.addPadding=addPadding,module.exports.computeChildrenBBox=computeChildrenBBox},{414:414,428:428,462:462}],385:[function(_dereq_,module,exports){"use strict";function ResizeVisuals(eventBus,canvas){this._canvas=canvas;var self=this;eventBus.on("resize.start",LOW_PRIORITY,function(event){var context=event.context,shape=context.shape;canvas.addMarker(shape,MARKER_RESIZING),self.create(context)}),eventBus.on("resize.move",LOW_PRIORITY,function(event){var context=event.context;self.update(context)}),eventBus.on("resize.cleanup",function(event){var context=event.context,shape=context.shape;canvas.removeMarker(shape,MARKER_RESIZING),self.remove(context)})}var Snap=_dereq_(441),MARKER_RESIZING="djs-resizing",LOW_PRIORITY=500;ResizeVisuals.prototype.create=function(context){var frame,container=this._canvas.getDefaultLayer(),shape=context.shape;frame=context.frame=Snap.create("rect",{class:"djs-resize-overlay",width:shape.width+10,height:shape.height+10,x:shape.x-5,y:shape.y-5}),frame.appendTo(container)},ResizeVisuals.prototype.update=function(context){var frame=context.frame,bounds=context.newBounds;bounds.width>5&&frame.attr({x:bounds.x,width:bounds.width}),bounds.height>5&&frame.attr({y:bounds.y,height:bounds.height}),frame[context.canExecute?"removeClass":"addClass"]("resize-not-ok")},ResizeVisuals.prototype.remove=function(context){context.frame&&context.frame.remove()},ResizeVisuals.$inject=["eventBus","canvas"],module.exports=ResizeVisuals},{441:441}],386:[function(_dereq_,module,exports){module.exports={__depends__:[_dereq_(389),_dereq_(329)],__init__:["resize","resizeVisuals","resizeHandles"],resize:["type",_dereq_(382)],resizeVisuals:["type",_dereq_(385)],resizeHandles:["type",_dereq_(383)]}},{329:329,382:382,383:383,385:385,389:389}],387:[function(_dereq_,module,exports){"use strict";function RuleProvider(eventBus){CommandInterceptor.call(this,eventBus),this.init()}var inherits=_dereq_(451),CommandInterceptor=_dereq_(292);RuleProvider.$inject=["eventBus"],inherits(RuleProvider,CommandInterceptor),module.exports=RuleProvider,RuleProvider.prototype.addRule=function(actions,priority,fn){var self=this;"string"==typeof actions&&(actions=[actions]),actions.forEach(function(action){self.canExecute(action,priority,function(context,action,event){return fn(context)},!0)})},RuleProvider.prototype.init=function(){}},{292:292,451:451}],388:[function(_dereq_,module,exports){"use strict";function Rules(injector){this._commandStack=injector.get("commandStack",!1)}Rules.$inject=["injector"],module.exports=Rules,Rules.prototype.allowed=function(action,context){var allowed=!0,commandStack=this._commandStack;return commandStack&&(allowed=commandStack.canExecute(action,context)),void 0===allowed||allowed}},{}],389:[function(_dereq_,module,exports){module.exports={__init__:["rules"],rules:["type",_dereq_(388)]}},{388:388}],390:[function(_dereq_,module,exports){"use strict";function SearchPad(canvas,eventBus,overlays,selection){this._open=!1,this._results=[],this._eventMaps=[],this._canvas=canvas,this._eventBus=eventBus,this._overlays=overlays,this._selection=selection,this._container=domify(SearchPad.BOX_HTML),this._searchInput=domQuery(SearchPad.INPUT_SELECTOR,this._container),this._resultsContainer=domQuery(SearchPad.RESULTS_CONTAINER_SELECTOR,this._container),this._canvas.getContainer().appendChild(this._container),eventBus.on(["canvas.destroy","diagram.destroy"],this.close,this)}function constructOverlay(box){var w=box.width+12,h=box.height+12;return{position:{bottom:h-6,right:w-6},show:!0,html:'<div style="'+["width: "+w+"px","height: "+h+"px"].join("; ")+'" class="'+SearchPad.OVERLAY_CLASS+'"></div>'}}function createInnerTextNode(parentNode,tokens,template){var text=createHtmlText(tokens),childNode=domify(template);childNode.innerHTML=text,parentNode.appendChild(childNode)}function createHtmlText(tokens){var htmlText="";return tokens.forEach(function(t){t.matched?htmlText+='<strong class="'+SearchPad.RESULT_HIGHLIGHT_CLASS+'">'+t.matched+"</strong>":htmlText+=t.normal}),""!==htmlText?htmlText:null}var domClear=_dereq_(606),domDelegate=_dereq_(608),domQuery=_dereq_(612),domClasses=_dereq_(605),domAttr=_dereq_(604),domify=_dereq_(609),getBoundingBox=_dereq_(428).getBBox;SearchPad.$inject=["canvas","eventBus","overlays","selection"],SearchPad.prototype._bindEvents=function(){function listen(el,selector,type,fn){self._eventMaps.push({el:el,type:type,listener:domDelegate.bind(el,selector,type,fn)})}var self=this;listen(document,"html","click",function(e){self.close()}),listen(this._container,SearchPad.INPUT_SELECTOR,"click",function(e){e.stopPropagation(),e.delegateTarget.focus()}),listen(this._container,SearchPad.RESULT_SELECTOR,"mouseover",function(e){e.stopPropagation(),self._scrollToNode(e.delegateTarget),self._preselect(e.delegateTarget)}),listen(this._container,SearchPad.RESULT_SELECTOR,"click",function(e){e.stopPropagation(),self._select(e.delegateTarget)}),listen(this._container,SearchPad.INPUT_SELECTOR,"keydown",function(e){38===e.keyCode&&e.preventDefault(),40===e.keyCode&&e.preventDefault()}),listen(this._container,SearchPad.INPUT_SELECTOR,"keyup",function(e){if(27===e.keyCode)return self.close();if(13===e.keyCode){var selected=self._getCurrentResult();return selected?self._select(selected):self.close()}return 38===e.keyCode?self._scrollToDirection(!0):40===e.keyCode?self._scrollToDirection():void(37!==e.keyCode&&39!==e.keyCode&&self._search(e.delegateTarget.value))})},SearchPad.prototype._unbindEvents=function(){this._eventMaps.forEach(function(m){domDelegate.unbind(m.el,m.type,m.listener)})},SearchPad.prototype._search=function(pattern){var self=this;if(this._clearResults(),pattern&&""!==pattern){var searchResults=this._searchProvider.find(pattern);if(searchResults.length){searchResults.forEach(function(result){var id=result.element.id,node=self._createResultNode(result,id);self._results[id]={element:result.element,node:node}});var node=domQuery(SearchPad.RESULT_SELECTOR,this._resultsContainer);this._scrollToNode(node),this._preselect(node)}}},SearchPad.prototype._scrollToDirection=function(previous){var selected=this._getCurrentResult();if(selected){var node=previous?selected.previousElementSibling:selected.nextElementSibling;node&&(this._scrollToNode(node),this._preselect(node))}},SearchPad.prototype._scrollToNode=function(node){if(node&&node!==this._getCurrentResult()){var nodeOffset=node.offsetTop,containerScroll=this._resultsContainer.scrollTop,bottomScroll=nodeOffset-this._resultsContainer.clientHeight+node.clientHeight;nodeOffset<containerScroll?this._resultsContainer.scrollTop=nodeOffset:containerScroll<bottomScroll&&(this._resultsContainer.scrollTop=bottomScroll)}},SearchPad.prototype._clearResults=function(){domClear(this._resultsContainer),this._results=[],this._resetOverlay(),this._eventBus.fire("searchPad.cleared")},SearchPad.prototype._getCurrentResult=function(){return domQuery(SearchPad.RESULT_SELECTED_SELECTOR,this._resultsContainer)},SearchPad.prototype._createResultNode=function(result,id){var node=domify(SearchPad.RESULT_HTML);return result.primaryTokens.length>0&&createInnerTextNode(node,result.primaryTokens,SearchPad.RESULT_PRIMARY_HTML),createInnerTextNode(node,result.secondaryTokens,SearchPad.RESULT_SECONDARY_HTML),domAttr(node,SearchPad.RESULT_ID_ATTRIBUTE,id),this._resultsContainer.appendChild(node),node},SearchPad.prototype.registerProvider=function(provider){this._searchProvider=provider},SearchPad.prototype.open=function(){if(!this._searchProvider)throw new Error("no search provider registered");this.isOpen()||(this._bindEvents(),this._open=!0,domClasses(this._container).add("open"),this._searchInput.focus(),this._eventBus.fire("searchPad.opened"))},SearchPad.prototype.close=function(){this.isOpen()&&(this._unbindEvents(),this._open=!1,domClasses(this._container).remove("open"),this._clearResults(),this._searchInput.value="",this._searchInput.blur(),this._resetOverlay(),this._eventBus.fire("searchPad.closed"))},SearchPad.prototype.toggle=function(){this.isOpen()?this.close():this.open()},SearchPad.prototype.isOpen=function(){return this._open},SearchPad.prototype._preselect=function(node){var selectedNode=this._getCurrentResult();if(node!==selectedNode){selectedNode&&domClasses(selectedNode).remove(SearchPad.RESULT_SELECTED_CLASS);var id=domAttr(node,SearchPad.RESULT_ID_ATTRIBUTE),element=this._results[id].element;domClasses(node).add(SearchPad.RESULT_SELECTED_CLASS),this._resetOverlay(element),this._centerViewbox(element),this._selection.select(element),this._eventBus.fire("searchPad.preselected",element)}},SearchPad.prototype._select=function(node){var id=domAttr(node,SearchPad.RESULT_ID_ATTRIBUTE),element=this._results[id].element;this.close(),this._resetOverlay(),this._centerViewbox(element),this._selection.select(element),this._eventBus.fire("searchPad.selected",element)},SearchPad.prototype._centerViewbox=function(element){var viewbox=this._canvas.viewbox(),box=getBoundingBox(element),newViewbox={x:box.x+box.width/2-viewbox.outer.width/2,y:box.y+box.height/2-viewbox.outer.height/2,width:viewbox.outer.width,height:viewbox.outer.height};this._canvas.viewbox(newViewbox),this._canvas.zoom(viewbox.scale)},SearchPad.prototype._resetOverlay=function(element){if(this._overlayId&&this._overlays.remove(this._overlayId),element){var box=getBoundingBox(element),overlay=constructOverlay(box);this._overlayId=this._overlays.add(element,overlay)}},module.exports=SearchPad,SearchPad.CONTAINER_SELECTOR=".djs-search-container",SearchPad.INPUT_SELECTOR=".djs-search-input input",SearchPad.RESULTS_CONTAINER_SELECTOR=".djs-search-results",SearchPad.RESULT_SELECTOR=".djs-search-result",SearchPad.RESULT_SELECTED_CLASS="djs-search-result-selected",SearchPad.RESULT_SELECTED_SELECTOR="."+SearchPad.RESULT_SELECTED_CLASS,SearchPad.RESULT_ID_ATTRIBUTE="data-result-id",SearchPad.RESULT_HIGHLIGHT_CLASS="djs-search-highlight",SearchPad.OVERLAY_CLASS="djs-search-overlay",SearchPad.BOX_HTML='<div class="djs-search-container djs-draggable djs-scrollable"><div class="djs-search-input"><input type="text"/></div><div class="djs-search-results"></div></div>',SearchPad.RESULT_HTML='<div class="djs-search-result"></div>',SearchPad.RESULT_PRIMARY_HTML='<div class="djs-search-result-primary"></div>',SearchPad.RESULT_SECONDARY_HTML='<p class="djs-search-result-secondary"></p>'},{428:428,604:604,605:605,606:606,608:608,609:609,612:612}],391:[function(_dereq_,module,exports){module.exports={__depends__:[_dereq_(375),_dereq_(395)],searchPad:["type",_dereq_(390)]}},{375:375,390:390,395:395}],392:[function(_dereq_,module,exports){"use strict";function Selection(eventBus){this._eventBus=eventBus,this._selectedElements=[];var self=this;eventBus.on(["shape.remove","connection.remove"],function(e){var element=e.element;self.deselect(element)}),eventBus.on(["diagram.clear"],function(e){self.select(null)})}var isArray=_dereq_(583),forEach=_dereq_(464);Selection.$inject=["eventBus"],module.exports=Selection,Selection.prototype.deselect=function(element){var selectedElements=this._selectedElements,idx=selectedElements.indexOf(element);if(-1!==idx){var oldSelection=selectedElements.slice();selectedElements.splice(idx,1),this._eventBus.fire("selection.changed",{oldSelection:oldSelection,newSelection:selectedElements})}},Selection.prototype.get=function(){return this._selectedElements},Selection.prototype.isSelected=function(element){return-1!==this._selectedElements.indexOf(element)},Selection.prototype.select=function(elements,add){var selectedElements=this._selectedElements,oldSelection=selectedElements.slice();isArray(elements)||(elements=elements?[elements]:[]),add?forEach(elements,function(element){-1===selectedElements.indexOf(element)&&selectedElements.push(element)}):this._selectedElements=selectedElements=elements.slice(),this._eventBus.fire("selection.changed",{oldSelection:oldSelection,newSelection:selectedElements})}},{464:464,583:583}],393:[function(_dereq_,module,exports){"use strict";function SelectionBehavior(eventBus,selection,canvas,elementRegistry){eventBus.on("create.end",500,function(e){e.context.canExecute&&selection.select(e.context.shape)}),eventBus.on("connect.end",500,function(e){e.context.canExecute&&e.context.target&&selection.select(e.context.target)}),eventBus.on("shape.move.end",500,function(e){var previousSelection=e.previousSelection||[],shape=elementRegistry.get(e.context.shape.id);shape&&-1===previousSelection.indexOf(shape)&&selection.select(shape)}),eventBus.on("element.click",function(event){var element=event.element;element===canvas.getRootElement()&&(element=null);var isSelected=selection.isSelected(element),isMultiSelect=selection.get().length>1,add=hasPrimaryModifier(event);if(isSelected&&isMultiSelect)return add?selection.deselect(element):selection.select(element);isSelected?selection.deselect(element):selection.select(element,add)})}var hasPrimaryModifier=_dereq_(435).hasPrimaryModifier;SelectionBehavior.$inject=["eventBus","selection","canvas","elementRegistry"],module.exports=SelectionBehavior},{435:435}],394:[function(_dereq_,module,exports){"use strict";function SelectionVisuals(events,canvas,selection,graphicsFactory,styles){function addMarker(e,cls){canvas.addMarker(e,cls)}function removeMarker(e,cls){canvas.removeMarker(e,cls)}this._multiSelectionBox=null,events.on("element.hover",function(event){addMarker(event.element,MARKER_HOVER)}),events.on("element.out",function(event){removeMarker(event.element,MARKER_HOVER)}),events.on("selection.changed",function(event){function deselect(s){removeMarker(s,MARKER_SELECTED)}function select(s){addMarker(s,MARKER_SELECTED)}var oldSelection=event.oldSelection,newSelection=event.newSelection;forEach(oldSelection,function(e){-1===newSelection.indexOf(e)&&deselect(e)}),forEach(newSelection,function(e){-1===oldSelection.indexOf(e)&&select(e)})})}var forEach=_dereq_(464),MARKER_HOVER="hover",MARKER_SELECTED="selected";SelectionVisuals.$inject=["eventBus","canvas","selection","graphicsFactory","styles"],module.exports=SelectionVisuals},{464:464}],395:[function(_dereq_,module,exports){module.exports={__init__:["selectionVisuals","selectionBehavior"],__depends__:[_dereq_(337),_dereq_(373)],selection:["type",_dereq_(392)],selectionVisuals:["type",_dereq_(394)],selectionBehavior:["type",_dereq_(393)]}},{337:337,373:373,392:392,393:393,394:394}],396:[function(_dereq_,module,exports){"use strict";function SnapContext(){this._targets={},this._snapOrigins={},this._snapLocations=[],this._defaultSnaps={}}function SnapPoints(defaultSnaps){this._snapValues={}}var forEach=_dereq_(464),snapTo=_dereq_(397).snapTo;SnapContext.prototype.getSnapOrigin=function(snapLocation){return this._snapOrigins[snapLocation]},SnapContext.prototype.setSnapOrigin=function(snapLocation,initialValue){this._snapOrigins[snapLocation]=initialValue,-1===this._snapLocations.indexOf(snapLocation)&&this._snapLocations.push(snapLocation)},SnapContext.prototype.addDefaultSnap=function(type,point){var snapValues=this._defaultSnaps[type];snapValues||(snapValues=this._defaultSnaps[type]=[]),snapValues.push(point)},SnapContext.prototype.getSnapLocations=function(){return this._snapLocations},SnapContext.prototype.setSnapLocations=function(snapLocations){this._snapLocations=snapLocations},SnapContext.prototype.pointsForTarget=function(target){var targetId=target.id||target,snapPoints=this._targets[targetId];return snapPoints||(snapPoints=this._targets[targetId]=new SnapPoints,snapPoints.initDefaults(this._defaultSnaps)),snapPoints},module.exports=SnapContext,SnapPoints.prototype.add=function(snapLocation,point){var snapValues=this._snapValues[snapLocation];snapValues||(snapValues=this._snapValues[snapLocation]={x:[],y:[]}),-1===snapValues.x.indexOf(point.x)&&snapValues.x.push(point.x),-1===snapValues.y.indexOf(point.y)&&snapValues.y.push(point.y)},SnapPoints.prototype.snap=function(point,snapLocation,axis,tolerance){var snappingValues=this._snapValues[snapLocation];return snappingValues&&snapTo(point[axis],snappingValues[axis],tolerance)},SnapPoints.prototype.initDefaults=function(defaultSnaps){var self=this;forEach(defaultSnaps||{},function(snapPoints,snapLocation){forEach(snapPoints,function(point){self.add(snapLocation,point)})})}},{397:397,464:464}],397:[function(_dereq_,module,exports){"use strict";function snapTo(value,values,tolerance){tolerance=void 0===tolerance?10:tolerance;var idx,snapValue;for(idx=0;idx<values.length;idx++)if(snapValue=values[idx],abs(snapValue-value)<=tolerance)return snapValue}function topLeft(bounds){return{x:bounds.x,y:bounds.y}}function mid(bounds,defaultValue){return!bounds||isNaN(bounds.x)||isNaN(bounds.y)?defaultValue:{x:round(bounds.x+bounds.width/2),y:round(bounds.y+bounds.height/2)}}function bottomRight(bounds){return{x:bounds.x+bounds.width,y:bounds.y+bounds.height}}var abs=Math.abs,round=Math.round;module.exports.snapTo=snapTo,module.exports.topLeft=topLeft,module.exports.mid=mid,module.exports.bottomRight=bottomRight,module.exports.isSnapped=function(event,axis){var snapped=event.snapped;return!!snapped&&("string"==typeof axis?snapped[axis]:snapped.x&&snapped.y)},module.exports.setSnapped=function(event,axis,value){if("string"!=typeof axis)throw new Error("axis must be in [x, y]");if("number"!=typeof value&&!1!==value)throw new Error("value must be Number or false");var delta,previousValue=event[axis],snapped=event.snapped=event.snapped||{};return!1===value?snapped[axis]=!1:(snapped[axis]=!0,delta=value-previousValue,event[axis]+=delta,event["d"+axis]+=delta),previousValue}},{}],398:[function(_dereq_,module,exports){"use strict";function Snapping(eventBus,canvas){this._canvas=canvas;var self=this;eventBus.on(["shape.move.start","create.start"],function(event){self.initSnap(event)}),eventBus.on(["shape.move.move","shape.move.end","create.move","create.end"],function(event){event.originalEvent&&event.originalEvent.ctrlKey||isSnapped(event)||self.snap(event)}),eventBus.on(["shape.move.cleanup","create.cleanup"],function(event){self.hide()}),this._asyncHide=debounce(this.hide,1e3)}var filter=_dereq_(462),forEach=_dereq_(464),debounce=_dereq_(474),mid=_dereq_(397).mid,SnapContext=_dereq_(396),SnapUtil=_dereq_(397),isSnapped=SnapUtil.isSnapped,setSnapped=SnapUtil.setSnapped;Snapping.$inject=["eventBus","canvas"],module.exports=Snapping,Snapping.prototype.initSnap=function(event){var context=event.context,shape=context.shape,snapContext=context.snapContext;snapContext||(snapContext=context.snapContext=new SnapContext);var snapMid=mid(shape,event);return snapContext.setSnapOrigin("mid",{x:snapMid.x-event.x,y:snapMid.y-event.y}),snapContext},Snapping.prototype.snap=function(event){var context=event.context,snapContext=context.snapContext,shape=context.shape,target=context.target,snapLocations=snapContext.getSnapLocations();if(target){var snapPoints=snapContext.pointsForTarget(target);snapPoints.initialized||(this.addTargetSnaps(snapPoints,shape,target),snapPoints.initialized=!0);var snapping={x:isSnapped(event,"x"),y:isSnapped(event,"y")};forEach(snapLocations,function(location){var snapOrigin=snapContext.getSnapOrigin(location),snapCurrent={x:event.x+snapOrigin.x,y:event.y+snapOrigin.y};if(forEach(["x","y"],function(axis){var locationSnapping;snapping[axis]||void 0!==(locationSnapping=snapPoints.snap(snapCurrent,location,axis,7))&&(snapping[axis]={value:locationSnapping,originValue:locationSnapping-snapOrigin[axis]})}),snapping.x&&snapping.y)return!1}),this.showSnapLine("vertical",snapping.x&&snapping.x.value),this.showSnapLine("horizontal",snapping.y&&snapping.y.value),forEach(["x","y"],function(axis){var axisSnapping=snapping[axis];"object"==typeof axisSnapping&&setSnapped(event,axis,axisSnapping.originValue)})}},Snapping.prototype._createLine=function(orientation){var root=this._canvas.getLayer("snap"),line=root.path("M0,0 L0,0").addClass("djs-snap-line");return{update:function(position){"number"!=typeof position?line.attr({display:"none"}):"horizontal"===orientation?line.attr({path:"M-100000,"+position+" L+100000,"+position,display:""}):line.attr({path:"M "+position+",-100000 L "+position+", +100000",display:""})}}},Snapping.prototype._createSnapLines=function(){this._snapLines={horizontal:this._createLine("horizontal"),vertical:this._createLine("vertical")}},Snapping.prototype.showSnapLine=function(orientation,position){var line=this.getSnapLine(orientation);line&&line.update(position),this._asyncHide()},Snapping.prototype.getSnapLine=function(orientation){return this._snapLines||this._createSnapLines(),this._snapLines[orientation]},Snapping.prototype.hide=function(){forEach(this._snapLines,function(l){l.update()})},Snapping.prototype.addTargetSnaps=function(snapPoints,shape,target){var siblings=this.getSiblings(shape,target);forEach(siblings,function(s){snapPoints.add("mid",mid(s))})},Snapping.prototype.getSiblings=function(element,target){return target&&filter(target.children,function(e){return!e.hidden&&!e.labelTarget&&!e.waypoints&&e.host!==element&&e!==element})}},{396:396,397:397,462:462,464:464,474:474}],399:[function(_dereq_,module,exports){"use strict";function SpaceTool(eventBus,dragging,canvas,modeling,rules,toolManager){this._canvas=canvas,this._dragging=dragging,this._modeling=modeling,this._rules=rules,this._toolManager=toolManager;var self=this;toolManager.registerTool("space",{tool:"spaceTool.selection",dragging:"spaceTool"}),eventBus.on("spaceTool.selection.end",function(event){var target=event.originalEvent.target;(event.hover||target instanceof SVGElement)&&eventBus.once("spaceTool.selection.ended",function(){self.activateMakeSpace(event.originalEvent)})}),eventBus.on("spaceTool.move",HIGH_PRIORITY,function(event){var context=event.context;context.initialized||(context.initialized=self.initializeMakeSpace(event,context))}),eventBus.on("spaceTool.end",function(event){var context=event.context,axis=context.axis,direction=context.direction,movingShapes=context.movingShapes,resizingShapes=context.resizingShapes;if(context.initialized){var delta={x:round(event.dx),y:round(event.dy)};delta[AXIS_INVERTED[axis]]=0;var insideBounds=!0;forEach(resizingShapes,function(shape){if("w"===direction&&event.x>shape.x+shape.width||"e"===direction&&event.x<shape.x||"n"===direction&&event.y>shape.y+shape.height||"s"===direction&&event.y<shape.y)return void(insideBounds=!1)}),insideBounds&&self.makeSpace(movingShapes,resizingShapes,delta,direction)}})}var SpaceUtil=_dereq_(401),Cursor=_dereq_(427),hasPrimaryModifier=_dereq_(435).hasPrimaryModifier,abs=Math.abs,round=Math.round,HIGH_PRIORITY=1500,AXIS_TO_DIMENSION={x:"width",y:"height"},AXIS_INVERTED={x:"y",y:"x"},getAllChildren=_dereq_(428).selfAndAllChildren,assign=_dereq_(592),forEach=_dereq_(464);SpaceTool.$inject=["eventBus","dragging","canvas","modeling","rules","toolManager"],module.exports=SpaceTool,SpaceTool.prototype.activateSelection=function(event,autoActivate){this._dragging.init(event,"spaceTool.selection",{trapClick:!1,cursor:"crosshair",autoActivate:autoActivate,data:{context:{}}})},SpaceTool.prototype.activateMakeSpace=function(event){this._dragging.init(event,"spaceTool",{autoActivate:!0,cursor:"crosshair",data:{context:{}}})},SpaceTool.prototype.makeSpace=function(movingShapes,resizingShapes,delta,direction){return this._modeling.createSpace(movingShapes,resizingShapes,delta,direction)},SpaceTool.prototype.initializeMakeSpace=function(event,context){var axis=abs(event.dx)>abs(event.dy)?"x":"y",offset=event["d"+axis],spacePos=event[axis]-offset;if(abs(offset)<5)return!1;offset<0&&(offset*=-1),hasPrimaryModifier(event)&&(offset*=-1);var rootShape=this._canvas.getRootElement(),allShapes=getAllChildren(rootShape,!0),adjustments=this.calculateAdjustments(allShapes,axis,offset,spacePos);return assign(context,adjustments,{axis:axis,direction:SpaceUtil.getDirection(axis,offset)}),Cursor.set("resize-"+("x"===axis?"ew":"ns")),!0},SpaceTool.prototype.calculateAdjustments=function(elements,axis,offset,spacePos){var movingShapes=[],resizingShapes=[],rules=this._rules;return elements.forEach(function(shape){var shapeStart=shape[axis],shapeEnd=shapeStart+shape[AXIS_TO_DIMENSION[axis]];if(shape.parent&&!shape.waypoints)return offset>0&&shapeStart>spacePos?movingShapes.push(shape):offset<0&&shapeEnd<spacePos?movingShapes.push(shape):shapeStart<spacePos&&shapeEnd>spacePos&&rules.allowed("shape.resize",{shape:shape})?resizingShapes.push(shape):void 0}),{movingShapes:movingShapes,resizingShapes:resizingShapes}},SpaceTool.prototype.toggle=function(){this.isActive()?this._dragging.cancel():this.activateSelection()},SpaceTool.prototype.isActive=function(){var context=this._dragging.context();return context&&/^spaceTool/.test(context.prefix)}},{401:401,427:427,428:428,435:435,464:464,592:592}],400:[function(_dereq_,module,exports){"use strict";function SpaceToolVisuals(eventBus,elementRegistry,canvas,styles){function getGfx(e){return elementRegistry.getGraphics(e)}function addDragger(shape,dragGroup){var gfx=getGfx(shape),dragger=gfx.clone(),bbox=gfx.getBBox();dragger.attr(styles.cls("djs-dragger",[],{x:bbox.x,y:bbox.y})),dragGroup.add(dragger)}eventBus.on("spaceTool.selection.start",function(event){var space=canvas.getLayer("space"),context=event.context,orientation={x:"M 0,-10000 L 0,10000",y:"M -10000,0 L 10000,0"},crosshairGroup=space.group().attr(styles.cls("djs-crosshair-group",["no-events"]));crosshairGroup.path(orientation.x).addClass("djs-crosshair"),crosshairGroup.path(orientation.y).addClass("djs-crosshair"),context.crosshairGroup=crosshairGroup}),eventBus.on("spaceTool.selection.move",function(event){event.context.crosshairGroup.translate(event.x,event.y)}),eventBus.on("spaceTool.selection.cleanup",function(event){var context=event.context,crosshairGroup=context.crosshairGroup;crosshairGroup&&crosshairGroup.remove()}),eventBus.on("spaceTool.move",LOW_PRIORITY,function(event){var context=event.context,line=context.line,axis=context.axis,dragShapes=context.movingShapes;if(context.initialized){if(!context.dragGroup){line=canvas.getLayer("space").path("M0,0 L0,0").addClass("djs-crosshair"),context.line=line;var dragGroup=canvas.getDefaultLayer().group().attr(styles.cls("djs-drag-group",["no-events"]));forEach(dragShapes,function(shape){addDragger(shape,dragGroup),canvas.addMarker(shape,MARKER_DRAGGING)}),context.dragGroup=dragGroup}var orientation={x:"M"+event.x+", -10000 L"+event.x+", 10000",y:"M -10000, "+event.y+" L 10000, "+event.y};line.attr({path:orientation[axis],display:""});var opposite={x:"y",y:"x"},delta={x:event.dx,y:event.dy};delta[opposite[context.axis]]=0,context.dragGroup.translate(delta.x,delta.y)}}),eventBus.on("spaceTool.cleanup",function(event){var context=event.context,shapes=context.movingShapes,line=context.line,dragGroup=context.dragGroup;forEach(shapes,function(e){canvas.removeMarker(e,MARKER_DRAGGING)}),dragGroup&&(line.remove(),dragGroup.remove())})}var forEach=_dereq_(464),MARKER_DRAGGING="djs-dragging",LOW_PRIORITY=250;SpaceToolVisuals.$inject=["eventBus","elementRegistry","canvas","styles"],module.exports=SpaceToolVisuals},{464:464}],401:[function(_dereq_,module,exports){"use strict";function getDirection(axis,offset){if("x"===axis){if(offset>0)return"e";if(offset<0)return"w"}if("y"===axis){if(offset>0)return"s";if(offset<0)return"n"}return null}module.exports.getDirection=getDirection,module.exports.resizeBounds=function(bounds,direction,delta){var dx=delta.x,dy=delta.y;switch(direction){case"n":return{x:bounds.x,y:bounds.y+dy,width:bounds.width,height:bounds.height-dy};case"s":return{x:bounds.x,y:bounds.y,width:bounds.width,height:bounds.height+dy};case"w":return{x:bounds.x+dx,y:bounds.y,width:bounds.width-dx,height:bounds.height};case"e":return{x:bounds.x,y:bounds.y,width:bounds.width+dx,height:bounds.height};default:throw new Error("unrecognized direction: "+direction)}}},{}],402:[function(_dereq_,module,exports){"use strict";module.exports={__init__:["spaceToolVisuals"],__depends__:[_dereq_(329),_dereq_(389),_dereq_(404)],spaceTool:["type",_dereq_(399)],spaceToolVisuals:["type",_dereq_(400)]}},{329:329,389:389,399:399,400:400,404:404}],403:[function(_dereq_,module,exports){"use strict";function ToolManager(eventBus,dragging){this._eventBus=eventBus,this._dragging=dragging,this._tools=[],this._active=null}var forEach=_dereq_(464);ToolManager.$inject=["eventBus","dragging"],module.exports=ToolManager,ToolManager.prototype.registerTool=function(name,events){var tools=this._tools;if(!events)throw new Error('A tool has to be registered with it\'s "events"');tools.push(name),this.bindEvents(name,events)},ToolManager.prototype.isActive=function(tool){return tool&&this._active===tool},ToolManager.prototype.length=function(tool){return this._tools.length},ToolManager.prototype.setActive=function(tool){var eventBus=this._eventBus;this._active!==tool&&(this._active=tool,eventBus.fire("tool-manager.update",{tool:tool}))},ToolManager.prototype.bindEvents=function(name,events){var eventBus=this._eventBus,dragging=this._dragging,eventsToRegister=[]
;eventBus.on(events.tool+".init",function(event){if(!event.context.reactivate&&this.isActive(name))return this.setActive(null),void dragging.cancel();this.setActive(name)},this),forEach(events,function(event){eventsToRegister.push(event+".ended"),eventsToRegister.push(event+".canceled")}),eventBus.on(eventsToRegister,250,function(event){var originalEvent=event.originalEvent;!this._active||originalEvent&&"tools"===originalEvent.target.parentElement.getAttribute("data-group")||this.setActive(null)},this)}},{464:464}],404:[function(_dereq_,module,exports){"use strict";module.exports={__depends__:[_dereq_(329)],__init__:["toolManager"],toolManager:["type",_dereq_(403)]}},{329:329,403:403}],405:[function(_dereq_,module,exports){"use strict";function createRoot(parent){var root=domify('<div class="djs-tooltip-container" style="position: absolute; width: 0; height: 0;" />');return parent.insertBefore(root,parent.firstChild),root}function setPosition(el,x,y){assign(el.style,{left:x+"px",top:y+"px"})}function setVisible(el,visible){el.style.display=!1===visible?"none":""}function Tooltips(eventBus,canvas){this._eventBus=eventBus,this._canvas=canvas,this._ids=ids,this._tooltipDefaults={show:{minZoom:.7,maxZoom:5}},this._tooltips={},this._tooltipRoot=createRoot(canvas.getContainer());var self=this;domDelegate.bind(this._tooltipRoot,tooltipSelector,"mousedown",function(event){event.stopPropagation()}),domDelegate.bind(this._tooltipRoot,tooltipSelector,"mouseover",function(event){self.trigger("mouseover",event)}),domDelegate.bind(this._tooltipRoot,tooltipSelector,"mouseout",function(event){self.trigger("mouseout",event)}),this._init()}var isString=_dereq_(589),assign=_dereq_(592),forEach=_dereq_(464),domify=_dereq_(609),domAttr=_dereq_(604),domClasses=_dereq_(605),domRemove=_dereq_(613),domDelegate=_dereq_(608),ids=new(_dereq_(432))("tt"),tooltipSelector=".djs-tooltip";Tooltips.$inject=["eventBus","canvas"],module.exports=Tooltips,Tooltips.prototype.add=function(tooltip){if(!tooltip.position)throw new Error("must specifiy tooltip position");if(!tooltip.html)throw new Error("must specifiy tooltip html");var id=this._ids.next();return tooltip=assign({},this._tooltipDefaults,tooltip,{id:id}),this._addTooltip(tooltip),tooltip.timeout&&this.setTimeout(tooltip),id},Tooltips.prototype.trigger=function(action,event){var node=event.delegateTarget||event.target,tooltip=this.get(domAttr(node,"data-tooltip-id"));tooltip&&("mouseover"===action&&tooltip.timeout&&this.clearTimeout(tooltip),"mouseout"===action&&tooltip.timeout&&(tooltip.timeout=1e3,this.setTimeout(tooltip)))},Tooltips.prototype.get=function(id){return"string"!=typeof id&&(id=id.id),this._tooltips[id]},Tooltips.prototype.clearTimeout=function(tooltip){if(tooltip=this.get(tooltip)){var removeTimer=tooltip.removeTimer;removeTimer&&(clearTimeout(removeTimer),tooltip.removeTimer=null)}},Tooltips.prototype.setTimeout=function(tooltip){if(tooltip=this.get(tooltip)){this.clearTimeout(tooltip);var self=this;tooltip.removeTimer=setTimeout(function(){self.remove(tooltip)},tooltip.timeout)}},Tooltips.prototype.remove=function(id){var tooltip=this.get(id);tooltip&&(domRemove(tooltip.html),domRemove(tooltip.htmlContainer),delete tooltip.htmlContainer,delete this._tooltips[tooltip.id])},Tooltips.prototype.show=function(){setVisible(this._tooltipRoot)},Tooltips.prototype.hide=function(){setVisible(this._tooltipRoot,!1)},Tooltips.prototype._updateRoot=function(viewbox){var a=viewbox.scale||1,d=viewbox.scale||1,matrix="matrix("+a+",0,0,"+d+","+-1*viewbox.x*a+","+-1*viewbox.y*d+")";this._tooltipRoot.style.transform=matrix,this._tooltipRoot.style["-ms-transform"]=matrix},Tooltips.prototype._addTooltip=function(tooltip){var htmlContainer,id=tooltip.id,html=tooltip.html,tooltipRoot=this._tooltipRoot;html.get&&(html=html.get(0)),isString(html)&&(html=domify(html)),htmlContainer=domify('<div data-tooltip-id="'+id+'" class="djs-tooltip" style="position: absolute">'),htmlContainer.appendChild(html),tooltip.type&&domClasses(htmlContainer).add("djs-tooltip-"+tooltip.type),tooltip.className&&domClasses(htmlContainer).add(tooltip.className),tooltip.htmlContainer=htmlContainer,tooltipRoot.appendChild(htmlContainer),this._tooltips[id]=tooltip,this._updateTooltip(tooltip)},Tooltips.prototype._updateTooltip=function(tooltip){var position=tooltip.position;setPosition(tooltip.htmlContainer,position.x,position.y)},Tooltips.prototype._updateTooltipVisibilty=function(viewbox){forEach(this._tooltips,function(tooltip){var show=tooltip.show,htmlContainer=tooltip.htmlContainer,visible=!0;show&&((show.minZoom>viewbox.scale||show.maxZoom<viewbox.scale)&&(visible=!1),setVisible(htmlContainer,visible))})},Tooltips.prototype._init=function(){function updateViewbox(viewbox){self._updateRoot(viewbox),self._updateTooltipVisibilty(viewbox),self.show()}var self=this;this._eventBus.on("canvas.viewbox.changing",function(event){self.hide()}),this._eventBus.on("canvas.viewbox.changed",function(event){updateViewbox(event.viewbox)})}},{432:432,464:464,589:589,592:592,604:604,605:605,608:608,609:609,613:613}],406:[function(_dereq_,module,exports){module.exports={__init__:["tooltips"],tooltips:["type",_dereq_(405)]}},{405:405}],407:[function(_dereq_,module,exports){"use strict";function TouchFix(canvas,eventBus){var self=this;eventBus.on("canvas.init",function(e){self.addBBoxMarker(e.svg)})}TouchFix.$inject=["canvas","eventBus"],module.exports=TouchFix,TouchFix.prototype.addBBoxMarker=function(paper){var markerStyle={fill:"none",class:"outer-bound-marker"};paper.rect(-1e4,-1e4,10,10).attr(markerStyle),paper.rect(1e4,1e4,10,10).attr(markerStyle)}},{}],408:[function(_dereq_,module,exports){"use strict";function log(){}function get(service,injector){return injector.get(service,!1)}function createTouchRecognizer(node){function stopEvent(event){Event.stopEvent(event,!0)}function stopMouse(event){forEach(mouseEvents,function(e){domEvent.bind(node,e,stopEvent,!0)})}function allowMouse(event){setTimeout(function(){forEach(mouseEvents,function(e){domEvent.unbind(node,e,stopEvent,!0)})},500)}domEvent.bind(node,"touchstart",stopMouse,!0),domEvent.bind(node,"touchend",allowMouse,!0),domEvent.bind(node,"touchcancel",allowMouse,!0);var recognizer=new Hammer.Manager(node,{inputClass:Hammer.TouchInput,recognizers:[]}),tap=new Hammer.Tap,pan=new Hammer.Pan({threshold:10}),press=new Hammer.Press,pinch=new Hammer.Pinch,doubleTap=new Hammer.Tap({event:"doubletap",taps:2});return pinch.requireFailure(pan),pinch.requireFailure(press),recognizer.add([pan,press,pinch,doubleTap,tap]),recognizer.reset=function(force){var recognizers=this.recognizers,session=this.session;session.stopped||(log("recognizer","stop"),recognizer.stop(force),setTimeout(function(){var i,r;for(log("recognizer","reset"),i=0;r=recognizers[i];i++)r.reset(),r.state=8;session.curRecognizer=null},0))},recognizer.on("hammer.input",function(event){event.srcEvent.defaultPrevented&&recognizer.reset(!0)}),recognizer}function TouchInteractionEvents(injector,canvas,eventBus,elementRegistry,interactionEvents){function handler(type){return function(event){log("element",type,event),interactionEvents.fire(type,event)}}function getGfx(target){var node=domClosest(target,"svg, .djs-element",!0);return node&&new Snap(node)}function initEvents(svg){function startGrabCanvas(event){function update(e){var dx=e.deltaX-lx,dy=e.deltaY-ly;canvas.scroll({dx:dx,dy:dy}),lx=e.deltaX,ly=e.deltaY}function end(e){recognizer.off("panmove",update),recognizer.off("panend",end),recognizer.off("pancancel",end),log("canvas","grab end")}log("canvas","grab start");var lx=0,ly=0;recognizer.on("panmove",update),recognizer.on("panend",end),recognizer.on("pancancel",end)}function startGrab(event){var gfx=getGfx(event.target),element=gfx&&elementRegistry.get(gfx);if(move&&canvas.getRootElement()!==element)return log("element","move start",element,event,!0),move.start(event,element,!0);startGrabCanvas(event)}function startZoom(e){function update(e){var ratio=1-(1-e.scale)/1.5,newZoom=Math.max(MIN_ZOOM,Math.min(MAX_ZOOM,ratio*zoom));canvas.zoom(newZoom,mid),Event.stopEvent(e,!0)}function end(e){recognizer.off("pinchmove",update),recognizer.off("pinchend",end),recognizer.off("pinchcancel",end),recognizer.reset(!0),log("canvas","zoom end")}log("canvas","zoom start");var zoom=canvas.zoom(),mid=e.center;recognizer.on("pinchmove",update),recognizer.on("pinchend",end),recognizer.on("pinchcancel",end)}recognizer=createTouchRecognizer(svg),recognizer.on("doubletap",handler("element.dblclick")),recognizer.on("tap",handler("element.click")),recognizer.on("panstart",startGrab),recognizer.on("press",startGrab),recognizer.on("pinchstart",startZoom)}var recognizer,dragging=get("dragging",injector),move=get("move",injector),contextPad=get("contextPad",injector),palette=get("palette",injector);dragging&&eventBus.on("drag.move",function(event){var originalEvent=event.originalEvent;if(originalEvent&&!(originalEvent instanceof MouseEvent)){var position=Event.toPoint(originalEvent),node=document.elementFromPoint(position.x,position.y),gfx=getGfx(node),element=gfx&&elementRegistry.get(gfx);element!==event.hover&&(event.hover&&dragging.out(event),element&&(dragging.hover({element:element,gfx:gfx}),event.hover=element,event.hoverGfx=gfx))}}),contextPad&&eventBus.on("contextPad.create",function(event){var node=event.pad.html,padRecognizer=createTouchRecognizer(node);padRecognizer.on("panstart",function(event){log("context-pad","panstart",event),contextPad.trigger("dragstart",event,!0)}),padRecognizer.on("press",function(event){log("context-pad","press",event),contextPad.trigger("dragstart",event,!0)}),padRecognizer.on("tap",function(event){log("context-pad","tap",event),contextPad.trigger("click",event)})}),palette&&eventBus.on("palette.create",function(event){var node=event.html,padRecognizer=createTouchRecognizer(node);padRecognizer.on("panstart",function(event){log("palette","panstart",event),palette.trigger("dragstart",event,!0)}),padRecognizer.on("press",function(event){log("palette","press",event),palette.trigger("dragstart",event,!0)}),padRecognizer.on("tap",function(event){log("palette","tap",event),palette.trigger("click",event)})}),eventBus.on("canvas.init",function(event){initEvents(event.svg.node)})}var forEach=_dereq_(464),domEvent=_dereq_(610),domClosest=_dereq_(607),Hammer=_dereq_(448),Snap=_dereq_(441),Event=_dereq_(429),MIN_ZOOM=.2,MAX_ZOOM=4,mouseEvents=["mousedown","mouseup","mouseover","mouseout","click","dblclick"];TouchInteractionEvents.$inject=["injector","canvas","eventBus","elementRegistry","interactionEvents","touchFix"],module.exports=TouchInteractionEvents},{429:429,441:441,448:448,464:464,607:607,610:610}],409:[function(_dereq_,module,exports){module.exports={__depends__:[_dereq_(337)],__init__:["touchInteractionEvents"],touchInteractionEvents:["type",_dereq_(408)],touchFix:["type",_dereq_(407)]}},{337:337,407:407,408:408}],410:[function(_dereq_,module,exports){module.exports={translate:["value",_dereq_(411)]}},{411:411}],411:[function(_dereq_,module,exports){"use strict";module.exports=function(template,replacements){return replacements=replacements||{},template.replace(/{([^}]+)}/g,function(_,key){return replacements[key]||"{"+key+"}"})}},{}],412:[function(_dereq_,module,exports){"use strict";function BaseLayouter(){}var getMid=_dereq_(414).getMid;module.exports=BaseLayouter,BaseLayouter.prototype.layoutConnection=function(connection,hints){return[getMid(connection.source),getMid(connection.target)]}},{414:414}],413:[function(_dereq_,module,exports){"use strict";function dockingToPoint(docking){return assign({original:docking.point.original||docking.point},docking.actual)}function CroppingConnectionDocking(elementRegistry,graphicsFactory){this._elementRegistry=elementRegistry,this._graphicsFactory=graphicsFactory}var assign=_dereq_(592),LayoutUtil=_dereq_(414);CroppingConnectionDocking.$inject=["elementRegistry","graphicsFactory"],module.exports=CroppingConnectionDocking,CroppingConnectionDocking.prototype.getCroppedWaypoints=function(connection,source,target){source=source||connection.source,target=target||connection.target;var sourceDocking=this.getDockingPoint(connection,source,!0),targetDocking=this.getDockingPoint(connection,target),croppedWaypoints=connection.waypoints.slice(sourceDocking.idx+1,targetDocking.idx);return croppedWaypoints.unshift(dockingToPoint(sourceDocking)),croppedWaypoints.push(dockingToPoint(targetDocking)),croppedWaypoints},CroppingConnectionDocking.prototype.getDockingPoint=function(connection,shape,dockStart){var dockingIdx,dockingPoint,croppedPoint,waypoints=connection.waypoints;return dockingIdx=dockStart?0:waypoints.length-1,dockingPoint=waypoints[dockingIdx],croppedPoint=this._getIntersection(shape,connection,dockStart),{point:dockingPoint,actual:croppedPoint||dockingPoint,idx:dockingIdx}},CroppingConnectionDocking.prototype._getIntersection=function(shape,connection,takeFirst){var shapePath=this._getShapePath(shape),connectionPath=this._getConnectionPath(connection);return LayoutUtil.getElementLineIntersection(shapePath,connectionPath,takeFirst)},CroppingConnectionDocking.prototype._getConnectionPath=function(connection){return this._graphicsFactory.getConnectionPath(connection)},CroppingConnectionDocking.prototype._getShapePath=function(shape){return this._graphicsFactory.getShapePath(shape)},CroppingConnectionDocking.prototype._getGfx=function(element){return this._elementRegistry.getGraphics(element)}},{414:414,592:592}],414:[function(_dereq_,module,exports){"use strict";function roundBounds(bounds){return{x:Math.round(bounds.x),y:Math.round(bounds.y),width:Math.round(bounds.width),height:Math.round(bounds.height)}}function roundPoint(point){return{x:Math.round(point.x),y:Math.round(point.y)}}function asTRBL(bounds){return{top:bounds.y,right:bounds.x+(bounds.width||0),bottom:bounds.y+(bounds.height||0),left:bounds.x}}function asBounds(trbl){return{x:trbl.left,y:trbl.top,width:trbl.right-trbl.left,height:trbl.bottom-trbl.top}}function getMid(bounds){return roundPoint({x:bounds.x+(bounds.width||0)/2,y:bounds.y+(bounds.height||0)/2})}function getOrientation(rect,reference,padding){padding=padding||0,isObject(padding)||(padding={x:padding,y:padding});var rectOrientation=asTRBL(rect),referenceOrientation=asTRBL(reference),top=rectOrientation.bottom+padding.y<=referenceOrientation.top,right=rectOrientation.left-padding.x>=referenceOrientation.right,bottom=rectOrientation.top-padding.y>=referenceOrientation.bottom,left=rectOrientation.right+padding.x<=referenceOrientation.left,vertical=top?"top":bottom?"bottom":null,horizontal=left?"left":right?"right":null;return horizontal&&vertical?vertical+"-"+horizontal:horizontal||vertical||"intersect"}function getElementLineIntersection(elementPath,linePath,cropStart){var intersections=getIntersections(elementPath,linePath);return 1===intersections.length?roundPoint(intersections[0]):2===intersections.length&&pointDistance(intersections[0],intersections[1])<1?roundPoint(intersections[0]):intersections.length>1?(intersections=sortBy(intersections,function(i){var distance=Math.floor(100*i.t2)||1;return distance=100-distance,distance=(distance<10?"0":"")+distance,i.segment2+"#"+distance}),roundPoint(intersections[cropStart?0:intersections.length-1])):null}function getIntersections(a,b){return Snap.path.intersection(a,b)}var isObject=_dereq_(587),sortBy=_dereq_(471),pointDistance=_dereq_(430).pointDistance,Snap=_dereq_(441);module.exports.roundBounds=roundBounds,module.exports.roundPoint=roundPoint,module.exports.asTRBL=asTRBL,module.exports.asBounds=asBounds,module.exports.getMid=getMid,module.exports.getOrientation=getOrientation,module.exports.getElementLineIntersection=getElementLineIntersection,module.exports.getIntersections=getIntersections},{430:430,441:441,471:471,587:587}],415:[function(_dereq_,module,exports){"use strict";function inRange(a,start,end){return a>=start&&a<=end}function isInRange(axis,a,b){var size={x:"width",y:"height"};return inRange(a[axis],b[axis],b[axis]+b[size[axis]])}function getDirections(orientation,defaultLayout){switch(orientation){case"intersect":return null;case"top":case"bottom":return"v:v";case"left":case"right":return"h:h";default:return defaultLayout}}var isArray=_dereq_(583),find=_dereq_(463),without=_dereq_(458),assign=_dereq_(592),LayoutUtil=_dereq_(414),Geometry=_dereq_(430),getOrientation=LayoutUtil.getOrientation,getMid=LayoutUtil.getMid,pointsAligned=Geometry.pointsAligned,pointInRect=Geometry.pointInRect,pointDistance=Geometry.pointDistance,INTERSECTION_THRESHOLD=20,ORIENTATION_THRESHOLD={"h:h":20,"v:v":20,"h:v":-10,"v:h":-10};module.exports.getBendpoints=function(a,b,directions){directions=directions||"h:h";var xmid,ymid;if("h:v"===directions)return[{x:b.x,y:a.y}];if("v:h"===directions)return[{x:a.x,y:b.y}];if("h:h"===directions)return xmid=Math.round((b.x-a.x)/2+a.x),[{x:xmid,y:a.y},{x:xmid,y:b.y}];if("v:v"===directions)return ymid=Math.round((b.y-a.y)/2+a.y),[{x:a.x,y:ymid},{x:b.x,y:ymid}];throw new Error("unknown directions: <"+directions+">: directions must be specified as {a direction}:{b direction} (direction in h|v)")},module.exports.connectPoints=function(a,b,directions){var points=[];return pointsAligned(a,b)||(points=this.getBendpoints(a,b,directions)),points.unshift(a),points.push(b),points},module.exports.connectRectangles=function(source,target,start,end,hints){var preferredLayouts=hints&&hints.preferredLayouts||[],preferredLayout=without(preferredLayouts,"straight")[0]||"h:h",threshold=ORIENTATION_THRESHOLD[preferredLayout]||0,orientation=getOrientation(source,target,threshold),directions=getDirections(orientation,preferredLayout);if(start=start||getMid(source),end=end||getMid(target),directions){if("h:h"===directions)switch(orientation){case"top-right":case"right":case"bottom-right":start={original:start,x:source.x,y:start.y},end={original:end,x:target.x+target.width,y:end.y};break;case"top-left":case"left":case"bottom-left":start={original:start,x:source.x+source.width,y:start.y},end={original:end,x:target.x,y:end.y}}if("v:v"===directions)switch(orientation){case"top-left":case"top":case"top-right":start={original:start,x:start.x,y:source.y+source.height},end={original:end,x:end.x,y:target.y};break;case"bottom-left":case"bottom":case"bottom-right":start={original:start,x:start.x,y:source.y},end={original:end,x:end.x,y:target.y+target.height}}return this.connectPoints(start,end,directions)}},module.exports.repairConnection=function(source,target,start,end,waypoints,hints){isArray(start)&&(waypoints=start,hints=end,start=getMid(source),end=getMid(target)),hints=assign({preferredLayouts:[]},hints);var repairedWaypoints,preferredLayouts=hints.preferredLayouts,layoutStraight=-1!==preferredLayouts.indexOf("straight");return layoutStraight&&(repairedWaypoints=this.layoutStraight(source,target,start,end,hints)),repairedWaypoints||(hints.endChanged?(repairedWaypoints=this._repairConnectionSide(target,source,end,waypoints.slice().reverse()),repairedWaypoints=repairedWaypoints&&repairedWaypoints.reverse()):hints.startChanged?repairedWaypoints=this._repairConnectionSide(source,target,start,waypoints):waypoints&&waypoints.length&&(repairedWaypoints=waypoints)),repairedWaypoints||(repairedWaypoints=this.connectRectangles(source,target,start,end,hints)),repairedWaypoints},module.exports.layoutStraight=function(source,target,start,end,hints){var primaryAxis,orientation,axis={};return orientation=getOrientation(source,target),/^(top|bottom|left|right)$/.test(orientation)?(/top|bottom/.test(orientation)&&(primaryAxis="x"),/left|right/.test(orientation)&&(primaryAxis="y"),isInRange(primaryAxis,start,target)?(axis[primaryAxis]=start[primaryAxis],[{x:start.x,y:start.y},{x:void 0!==axis.x?axis.x:end.x,y:void 0!==axis.y?axis.y:end.y,original:{x:void 0!==axis.x?axis.x:end.x,y:void 0!==axis.y?axis.y:end.y}}]):null):null},module.exports._repairConnectionSide=function(moved,other,newDocking,points){if(function(moved,other,points){return points.length<3||!(points.length>4)&&!!find(points,function(p,idx){var q=points[idx-1];return q&&pointDistance(p,q)<3})}(moved,other,points))return null;var slicedPoints,oldDocking=points[0],newPoints=points.slice();return newPoints[0]=newDocking,newPoints[1]=function(candidate,oldPeer,newPeer){switch(pointsAligned(oldPeer,candidate)){case"v":return{x:candidate.x,y:newPeer.y};case"h":return{x:newPeer.x,y:candidate.y}}return{x:candidate.x,y:candidate.y}}(newPoints[1],oldDocking,newDocking),slicedPoints=function(points,a,b){var i;for(i=points.length-2;0!==i;i--)if(pointInRect(points[i],a,INTERSECTION_THRESHOLD)||pointInRect(points[i],b,INTERSECTION_THRESHOLD))return points.slice(i);return points}(newPoints,moved,other),slicedPoints!==newPoints?this._repairConnectionSide(moved,other,newDocking,slicedPoints):newPoints}},{414:414,430:430,458:458,463:463,583:583,592:592}],416:[function(_dereq_,module,exports){"use strict";function Base(){Object.defineProperty(this,"businessObject",{writable:!0}),parentRefs.bind(this,"parent"),labelRefs.bind(this,"label"),outgoingRefs.bind(this,"outgoing"),incomingRefs.bind(this,"incoming")}function Shape(){Base.call(this),parentRefs.bind(this,"children"),attacherRefs.bind(this,"host"),attacherRefs.bind(this,"attachers")}function Root(){Shape.call(this)}function Label(){Shape.call(this),labelRefs.bind(this,"labelTarget")}function Connection(){Base.call(this),outgoingRefs.bind(this,"source"),incomingRefs.bind(this,"target")}var assign=_dereq_(592),inherits=_dereq_(451),Refs=_dereq_(626),parentRefs=new Refs({name:"children",enumerable:!0,collection:!0},{name:"parent"}),labelRefs=new Refs({name:"label",enumerable:!0},{name:"labelTarget"}),attacherRefs=new Refs({name:"attachers",collection:!0},{name:"host"}),outgoingRefs=new Refs({name:"outgoing",collection:!0},{name:"source"}),incomingRefs=new Refs({name:"incoming",collection:!0},{name:"target"});inherits(Shape,Base),inherits(Root,Shape),inherits(Label,Shape),inherits(Connection,Base);var types={connection:Connection,shape:Shape,label:Label,root:Root};module.exports.create=function(type,attrs){var Type=types[type];if(!Type)throw new Error("unknown type: <"+type+">");return assign(new Type,attrs)},module.exports.Base=Base,module.exports.Root=Root,module.exports.Shape=Shape,module.exports.Connection=Connection,module.exports.Label=Label},{451:451,592:592,626:626}],417:[function(_dereq_,module,exports){"use strict";function length(point){return Math.sqrt(Math.pow(point.x,2)+Math.pow(point.y,2))}function MoveCanvas(eventBus,canvas){function handleMove(event){var start=context.start,position=EventUtil.toPoint(event),delta=substract(position,start);if(!context.dragging&&length(delta)>THRESHOLD&&(context.dragging=!0,ClickTrap.install(),Cursor.set("grab")),context.dragging){var lastPosition=context.last||context.start;delta=substract(position,lastPosition),canvas.scroll({dx:delta.x,dy:delta.y}),context.last=position}event.preventDefault()}function handleEnd(event){domEvent.unbind(document,"mousemove",handleMove),domEvent.unbind(document,"mouseup",handleEnd),context=null,Cursor.unset(),EventUtil.stopEvent(event)}function handleStart(event){domClosest(event.target,".djs-draggable")||event.button||event.ctrlKey||event.shiftKey||event.altKey||(context={start:EventUtil.toPoint(event)},domEvent.bind(document,"mousemove",handleMove),domEvent.bind(document,"mouseup",handleEnd),EventUtil.stopEvent(event))}var context,container=canvas._container;domEvent.bind(container,"mousedown",handleStart)}var Cursor=_dereq_(427),ClickTrap=_dereq_(424),substract=_dereq_(434).substract,domEvent=_dereq_(610),domClosest=_dereq_(607),EventUtil=_dereq_(429),THRESHOLD=15;MoveCanvas.$inject=["eventBus","canvas"],module.exports=MoveCanvas},{424:424,427:427,429:429,434:434,607:607,610:610}],418:[function(_dereq_,module,exports){module.exports={__init__:["moveCanvas"],moveCanvas:["type",_dereq_(417)]}},{417:417}],419:[function(_dereq_,module,exports){module.exports={__depends__:[_dereq_(409)]}},{409:409}],420:[function(_dereq_,module,exports){"use strict";function ZoomScroll(eventBus,canvas,config){this._enabled=!1,this._canvas=canvas,this._container=canvas._container,this._handleWheel=bind(this._handleWheel,this);var newEnabled=!config||!1!==config.enabled,self=this;eventBus.on("canvas.init",function(e){self._init(newEnabled)})}var domEvent=_dereq_(610),domClosest=_dereq_(607),hasPrimaryModifier=_dereq_(435).hasPrimaryModifier,hasSecondaryModifier=_dereq_(435).hasSecondaryModifier,isMac=_dereq_(436).isMac,getStepRange=_dereq_(421).getStepRange,cap=_dereq_(421).cap,log10=_dereq_(434).log10,bind=_dereq_(473),RANGE={min:.2,max:4};ZoomScroll.$inject=["eventBus","canvas","config.zoomScroll"],module.exports=ZoomScroll,ZoomScroll.prototype.scroll=function(delta){this._canvas.scroll(delta)},ZoomScroll.prototype.reset=function(){this._canvas.zoom("fit-viewport")},ZoomScroll.prototype.zoom=function(direction,position){var canvas=this._canvas,currentZoom=canvas.zoom(!1),factor=Math.pow(1+Math.abs(direction),direction>0?1:-1);canvas.zoom(cap(RANGE,currentZoom*factor),position)},ZoomScroll.prototype._handleWheel=function(event){if(!domClosest(event.target,".djs-scrollable",!0)){var element=this._container;event.preventDefault();var factor,isVerticalScroll=hasPrimaryModifier(event),isHorizontalScroll=hasSecondaryModifier(event);if(isVerticalScroll||isHorizontalScroll){factor=isMac?0===event.deltaMode?1.25:50:0===event.deltaMode?.025:.5;var delta={};isHorizontalScroll?delta.dx=factor*(event.deltaX||event.deltaY):delta.dy=factor*event.deltaY,this.scroll(delta)}else{factor=0===event.deltaMode?.025:.5;var elementRect=element.getBoundingClientRect(),offset={x:event.clientX-elementRect.left,y:event.clientY-elementRect.top};this.zoom(event.deltaY*factor/-5,offset)}}},ZoomScroll.prototype.stepZoom=function(direction,position){var canvas=this._canvas,stepRange=getStepRange(RANGE,10);direction=direction>0?1:-1;var currentLinearZoomLevel=log10(canvas.zoom()),newLinearZoomLevel=Math.round(currentLinearZoomLevel/stepRange)*stepRange;newLinearZoomLevel+=stepRange*direction;var newLogZoomLevel=Math.pow(10,newLinearZoomLevel);canvas.zoom(cap(RANGE,newLogZoomLevel),position)},ZoomScroll.prototype.toggle=function(newEnabled){var element=this._container,handleWheel=this._handleWheel,oldEnabled=this._enabled;return void 0===newEnabled&&(newEnabled=!oldEnabled),oldEnabled!==newEnabled&&domEvent[newEnabled?"bind":"unbind"](element,"wheel",handleWheel,!1),this._enabled=newEnabled,newEnabled},ZoomScroll.prototype._init=function(newEnabled){this.toggle(newEnabled)}},{421:421,434:434,435:435,436:436,473:473,607:607,610:610}],421:[function(_dereq_,module,exports){"use strict";var log10=_dereq_(434).log10;module.exports.getStepRange=function(range,steps){var minLinearRange=log10(range.min),maxLinearRange=log10(range.max);return(Math.abs(minLinearRange)+Math.abs(maxLinearRange))/steps},module.exports.cap=function(range,scale){return Math.max(range.min,Math.min(range.max,scale))}},{434:434}],422:[function(_dereq_,module,exports){module.exports={__init__:["zoomScroll"],zoomScroll:["type",_dereq_(420)]}},{420:420}],423:[function(_dereq_,module,exports){"use strict";function getNewAttachPoint(point,oldBounds,newBounds){var oldCenter=center(oldBounds),newCenter=center(newBounds),oldDelta=delta(point,oldCenter),newDelta={x:oldDelta.x*(newBounds.width/oldBounds.width),y:oldDelta.y*(newBounds.height/oldBounds.height)};return roundPoint({x:newCenter.x+newDelta.x,y:newCenter.y+newDelta.y})}function getNewAttachShapeDelta(shape,oldBounds,newBounds){var shapeCenter=center(shape),oldCenter=center(oldBounds),newCenter=center(newBounds),shapeDelta=delta(shape,shapeCenter),oldCenterDelta=delta(shapeCenter,oldCenter),newCenterDelta={x:oldCenterDelta.x*(newBounds.width/oldBounds.width),y:oldCenterDelta.y*(newBounds.height/oldBounds.height)},newShapeCenter={x:newCenter.x+newCenterDelta.x,y:newCenter.y+newCenterDelta.y};return roundPoint({x:newShapeCenter.x+shapeDelta.x-shape.x,y:newShapeCenter.y+shapeDelta.y-shape.y})}var roundPoint=_dereq_(414).roundPoint,center=_dereq_(437).center,delta=_dereq_(437).delta;module.exports.getNewAttachPoint=getNewAttachPoint,module.exports.getNewAttachShapeDelta=getNewAttachShapeDelta},{414:414,437:437}],424:[function(_dereq_,module,exports){"use strict";function trap(event){stopEvent(event),toggle(!1)}function toggle(active){domEvent[active?"bind":"unbind"](document.body,"click",trap,!0)}function install(){return toggle(!0),function(){toggle(!1)}}var domEvent=_dereq_(610),stopEvent=_dereq_(429).stopEvent;module.exports.install=install},{429:429,610:610}],425:[function(_dereq_,module,exports){"use strict";module.exports.remove=function(collection,element){if(!collection||!element)return-1;var idx=collection.indexOf(element);return-1!==idx&&collection.splice(idx,1),idx},module.exports.add=function(collection,element,idx){if(collection&&element){"number"!=typeof idx&&(idx=-1);var currentIdx=collection.indexOf(element);if(-1!==currentIdx){if(currentIdx===idx)return;if(-1===idx)return;collection.splice(currentIdx,1)}-1!==idx?collection.splice(idx,0,element):collection.push(element)}},module.exports.indexOf=function(collection,element){return collection&&element?collection.indexOf(element):-1}},{}],426:[function(_dereq_,module,exports){"use strict";function getTopLevel(elements){var topLevel={},parents=[],result=[],clearedParents=[];return forEach(elements,function(element){var parent=element.parent;topLevel[parent.id]||(topLevel[parent.id]=[]),-1===parents.indexOf(parent.id)&&parents.push(parent.id),topLevel[parent.id].push(element)}),forEach(parents,function(parent){forEach(topLevel[parent],function(element){topLevel[element.id]&&clearedParents.push(element.id)})}),forEach(parents,function(parent){-1===clearedParents.indexOf(parent)&&(result=result.concat(topLevel[parent]))}),result}var forEach=_dereq_(464);module.exports.getTopLevel=getTopLevel},{464:464}],427:[function(_dereq_,module,exports){"use strict";var domClasses=_dereq_(605),CURSOR_CLS_PATTERN=/^djs-cursor-.*$/;module.exports.set=function(mode){var classes=domClasses(document.body);classes.removeMatching(CURSOR_CLS_PATTERN),mode&&classes.add("djs-cursor-"+mode)},module.exports.unset=function(){this.set(null)},module.exports.has=function(mode){return domClasses(document.body).has("djs-cursor-"+mode)}},{605:605}],428:[function(_dereq_,module,exports){"use strict";function add(elements,e,unique){var canAdd=!unique||-1===elements.indexOf(e);return canAdd&&elements.push(e),canAdd}function eachElement(elements,fn,depth){depth=depth||0,isArray(elements)||(elements=[elements]),forEach(elements,function(s,i){var filter=fn(s,i,depth);isArray(filter)&&filter.length&&eachElement(filter,fn,depth+1)})}function selfAndChildren(elements,unique,maxDepth){var result=[],processedChildren=[];return eachElement(elements,function(element,i,depth){add(result,element,unique);var children=element.children;if((-1===maxDepth||depth<maxDepth)&&children&&add(processedChildren,children,unique))return children}),result}function selfAndDirectChildren(elements,allowDuplicates){return selfAndChildren(elements,!allowDuplicates,1)}function selfAndAllChildren(elements,allowDuplicates){return selfAndChildren(elements,!allowDuplicates,-1)}function getClosure(elements){function handleConnection(c){topLevel[c.source.id]&&topLevel[c.target.id]&&(topLevel[c.id]=c),allShapes[c.source.id]&&allShapes[c.target.id]&&(enclosedConnections[c.id]=enclosedElements[c.id]=c),allConnections[c.id]=c}function handleElement(element){if(enclosedElements[element.id]=element,!element.waypoints)return allShapes[element.id]=element,forEach(element.incoming,handleConnection),forEach(element.outgoing,handleConnection),element.children;enclosedConnections[element.id]=allConnections[element.id]=element}var topLevel=groupBy(elements,function(e){return e.id}),allShapes={},allConnections={},enclosedElements={},enclosedConnections={}
;return eachElement(elements,handleElement),{allShapes:allShapes,allConnections:allConnections,topLevel:topLevel,enclosedConnections:enclosedConnections,enclosedElements:enclosedElements}}function getBBox(elements,stopRecursion){stopRecursion=!!stopRecursion,isArray(elements)||(elements=[elements]);var minX,minY,maxX,maxY;return forEach(elements,function(element){var bbox=element;element.waypoints&&!stopRecursion&&(bbox=getBBox(element.waypoints,!0));var x=bbox.x,y=bbox.y,height=bbox.height||0,width=bbox.width||0;(x<minX||void 0===minX)&&(minX=x),(y<minY||void 0===minY)&&(minY=y),(x+width>maxX||void 0===maxX)&&(maxX=x+width),(y+height>maxY||void 0===maxY)&&(maxY=y+height)}),{x:minX,y:minY,height:maxY-minY,width:maxX-minX}}function getEnclosedElements(elements,bbox){var filteredElements={};return forEach(elements,function(element){var e=element;e.waypoints&&(e=getBBox(e)),!isNumber(bbox.y)&&e.x>bbox.x&&(filteredElements[element.id]=element),!isNumber(bbox.x)&&e.y>bbox.y&&(filteredElements[element.id]=element),e.x>bbox.x&&e.y>bbox.y&&(isNumber(bbox.width)&&isNumber(bbox.height)&&e.width+e.x<bbox.width+bbox.x&&e.height+e.y<bbox.height+bbox.y?filteredElements[element.id]=element:isNumber(bbox.width)&&isNumber(bbox.height)||(filteredElements[element.id]=element))}),filteredElements}function getElementType(element){return"waypoints"in element?"connection":"x"in element?"shape":"root"}var isArray=_dereq_(583),isNumber=_dereq_(586),groupBy=_dereq_(465),forEach=_dereq_(464);module.exports.add=add,module.exports.eachElement=eachElement,module.exports.selfAndDirectChildren=selfAndDirectChildren,module.exports.selfAndAllChildren=selfAndAllChildren,module.exports.getBBox=getBBox,module.exports.getEnclosedElements=getEnclosedElements,module.exports.getClosure=getClosure,module.exports.getType=getElementType},{464:464,465:465,583:583,586:586}],429:[function(_dereq_,module,exports){"use strict";function __preventDefault(event){return event&&event.preventDefault()}function __stopPropagation(event,immediate){event&&(event.stopPropagation&&event.stopPropagation(),immediate&&event.stopImmediatePropagation&&event.stopImmediatePropagation())}function getOriginal(event){return event.originalEvent||event.srcEvent}function stopEvent(event,immediate){stopPropagation(event,immediate),preventDefault(event)}function preventDefault(event){__preventDefault(event),__preventDefault(getOriginal(event))}function stopPropagation(event,immediate){__stopPropagation(event,immediate),__stopPropagation(getOriginal(event),immediate)}function toPoint(event){return event.pointers&&event.pointers.length&&(event=event.pointers[0]),event.touches&&event.touches.length&&(event=event.touches[0]),event?{x:event.clientX,y:event.clientY}:null}module.exports.getOriginal=getOriginal,module.exports.stopEvent=stopEvent,module.exports.preventDefault=preventDefault,module.exports.stopPropagation=stopPropagation,module.exports.toPoint=toPoint},{}],430:[function(_dereq_,module,exports){"use strict";function pointDistance(a,b){return a&&b?Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2)):-1}function pointsAligned(a,b){return Math.abs(a.x-b.x)<=ALIGNED_THRESHOLD?"h":Math.abs(a.y-b.y)<=ALIGNED_THRESHOLD&&"v"}module.exports.pointDistance=pointDistance,module.exports.pointsOnLine=function(p,q,r){if(!p||!q||!r)return!1;var val=(q.x-p.x)*(r.y-p.y)-(q.y-p.y)*(r.x-p.x),dist=pointDistance(p,q);return Math.abs(val/dist)<5};var ALIGNED_THRESHOLD=2;module.exports.pointsAligned=pointsAligned,module.exports.pointInRect=function(p,rect,tolerance){return tolerance=tolerance||0,p.x>rect.x-tolerance&&p.y>rect.y-tolerance&&p.x<rect.x+rect.width+tolerance&&p.y<rect.y+rect.height+tolerance},module.exports.getMidPoint=function(p,q){return{x:Math.round(p.x+(q.x-p.x)/2),y:Math.round(p.y+(q.y-p.y)/2)}}},{}],431:[function(_dereq_,module,exports){"use strict";function getVisual(gfx){return gfx.select(".djs-visual")}function getChildren(gfx){return gfx.parent().children()[1]}function getBBox(gfx){return getVisual(gfx).select("*").getBBox()}module.exports.getVisual=getVisual,module.exports.getChildren=getChildren,module.exports.getBBox=getBBox},{}],432:[function(_dereq_,module,exports){"use strict";function IdGenerator(prefix){this._counter=0,this._prefix=(prefix?prefix+"-":"")+Math.floor(1e9*Math.random())+"-"}module.exports=IdGenerator,IdGenerator.prototype.next=function(){return this._prefix+ ++this._counter}},{}],433:[function(_dereq_,module,exports){"use strict";function circlePath(center,r){return[["M",center.x,center.y],["m",0,-r],["a",r,r,0,1,1,0,2*r],["a",r,r,0,1,1,0,-2*r],["z"]]}function linePath(points){var segments=[];return points.forEach(function(p,idx){segments.push([0===idx?"M":"L",p.x,p.y])}),segments}function getBendpointIntersection(waypoints,reference){var i,w;for(i=0;w=waypoints[i];i++)if(pointDistance(w,reference)<=INTERSECTION_THRESHOLD)return{point:waypoints[i],bendpoint:!0,index:i};return null}function getPathIntersection(waypoints,reference){var idx,intersections=Snap.path.intersection(circlePath(reference,INTERSECTION_THRESHOLD),linePath(waypoints)),a=intersections[0],b=intersections[intersections.length-1];return a?a!==b?a.segment2!==b.segment2?(idx=max(a.segment2,b.segment2)-1,{point:waypoints[idx],bendpoint:!0,index:idx}):{point:{x:round(a.x+b.x)/2,y:round(a.y+b.y)/2},index:a.segment2}:{point:{x:round(a.x),y:round(a.y)},index:a.segment2}:null}var pointDistance=_dereq_(430).pointDistance,Snap=_dereq_(441),round=Math.round,max=Math.max,INTERSECTION_THRESHOLD=10;module.exports.getApproxIntersection=function(waypoints,reference){return getBendpointIntersection(waypoints,reference)||getPathIntersection(waypoints,reference)}},{430:430,441:441}],434:[function(_dereq_,module,exports){"use strict";function log10(x){return Math.log(x)/Math.log(10)}function substract(p1,p2){return{x:p1.x-p2.x,y:p1.y-p2.y}}module.exports.log10=log10,module.exports.substract=substract},{}],435:[function(_dereq_,module,exports){"use strict";function isPrimaryButton(event){return!(getOriginalEvent(event)||event).button}var getOriginalEvent=_dereq_(429).getOriginal,isMac=_dereq_(436).isMac;module.exports.isPrimaryButton=isPrimaryButton,module.exports.isMac=isMac,module.exports.hasPrimaryModifier=function(event){var originalEvent=getOriginalEvent(event)||event;return!!isPrimaryButton(event)&&(isMac()?originalEvent.metaKey:originalEvent.ctrlKey)},module.exports.hasSecondaryModifier=function(event){var originalEvent=getOriginalEvent(event)||event;return isPrimaryButton(event)&&originalEvent.shiftKey}},{429:429,436:436}],436:[function(_dereq_,module,exports){"use strict";module.exports.isMac=function(){return/mac/i.test(navigator.platform)}},{}],437:[function(_dereq_,module,exports){"use strict";function center(bounds){return{x:bounds.x+bounds.width/2,y:bounds.y+bounds.height/2}}function delta(a,b){return{x:a.x-b.x,y:a.y-b.y}}module.exports.center=center,module.exports.delta=delta},{}],438:[function(_dereq_,module,exports){"use strict";module.exports.saveClear=function(collection,removeFn){if("function"!=typeof removeFn)throw new Error("removeFn iterator must be a function");if(collection){for(var e;e=collection[0];)removeFn(e);return collection}}},{}],439:[function(_dereq_,module,exports){"use strict";function toSVGPoints(points){for(var p,result="",i=0;p=points[i];i++)result+=p.x+","+p.y+" ";return result}var Snap=_dereq_(441);module.exports.componentsToPath=function(elements){return elements.join(",").replace(/,?([A-z]),?/g,"$1")},module.exports.toSVGPoints=toSVGPoints,module.exports.createLine=function(points,attrs){return Snap.create("polyline",{points:toSVGPoints(points)}).attr(attrs||{})},module.exports.updateLine=function(gfx,points){return gfx.attr({points:toSVGPoints(points)})}},{441:441}],440:[function(_dereq_,module,exports){"use strict";function parseAlign(align){var parts=align.split("-");return{horizontal:parts[0]||"center",vertical:parts[1]||"top"}}function parsePadding(padding){return isObject(padding)?assign({top:0,left:0,right:0,bottom:0},padding):{top:padding,left:padding,right:padding,bottom:padding}}function getTextBBox(text,fakeText){return fakeText.textContent=text,pick(fakeText.getBBox(),["width","height"])}function layoutNext(lines,maxWidth,fakeText){for(var textBBox,originalLine=lines.shift(),fitLine=originalLine;;){if(textBBox=getTextBBox(fitLine,fakeText),textBBox.width=fitLine?textBBox.width:0," "===fitLine||""===fitLine||textBBox.width<Math.round(maxWidth)||fitLine.length<4)return fit(lines,fitLine,originalLine,textBBox);fitLine=shortenLine(fitLine,textBBox.width,maxWidth)}}function fit(lines,fitLine,originalLine,textBBox){if(fitLine.length<originalLine.length){var nextLine=lines[0]||"",remainder=originalLine.slice(fitLine.length).trim();nextLine=/-\s*$/.test(remainder)?remainder.replace(/-\s*$/,"")+nextLine.replace(/^\s+/,""):remainder+" "+nextLine,lines[0]=nextLine}return{width:textBBox.width,height:textBBox.height,text:fitLine}}function semanticShorten(line,maxLength){var part,parts=line.split(/(\s|-)/g),shortenedParts=[],length=0;if(parts.length>1)for(;part=parts.shift();){if(!(part.length+length<maxLength)){"-"===part&&shortenedParts.pop();break}shortenedParts.push(part),length+=part.length}return shortenedParts.join("")}function shortenLine(line,width,maxWidth){var length=Math.max(line.length*(maxWidth/width),1),shortenedLine=semanticShorten(line,length);return shortenedLine||(shortenedLine=line.slice(0,Math.max(Math.round(length-1),1))),shortenedLine}function Text(config){this._config=assign({},{size:DEFAULT_LABEL_SIZE,padding:DEFAULT_BOX_PADDING,style:{},align:"center-top"},config||{})}var isObject=_dereq_(587),assign=_dereq_(592),pick=_dereq_(598),forEach=_dereq_(464),reduce=_dereq_(468),merge=_dereq_(595),Snap=_dereq_(441),DEFAULT_BOX_PADDING=0,DEFAULT_LABEL_SIZE={width:150,height:50};Text.prototype.createText=function(parent,text,options){for(var box=merge({},this._config.size,options.box||{}),style=merge({},this._config.style,options.style||{}),align=parseAlign(options.align||this._config.align),padding=parsePadding(void 0!==options.padding?options.padding:this._config.padding),lines=text.split(/\r?\n/g),layouted=[],maxWidth=box.width-padding.left-padding.right,fakeText=parent.paper.text(0,0,"").attr(style).node;lines.length;)layouted.push(layoutNext(lines,maxWidth,fakeText));var y,x,totalHeight=reduce(layouted,function(sum,line,idx){return sum+line.height},0);switch(align.vertical){case"middle":y=(box.height-totalHeight)/2-layouted[0].height/4;break;default:y=padding.top}var textElement=parent.text().attr(style);return forEach(layouted,function(line){switch(y+=line.height,align.horizontal){case"left":x=padding.left;break;case"right":x=maxWidth-padding.right-line.width;break;default:x=Math.max((maxWidth-line.width)/2+padding.left,0)}var tspan=Snap.create("tspan",{x:x,y:y}).node;tspan.textContent=line.text,textElement.append(tspan)}),fakeText.parentNode.removeChild(fakeText),textElement},module.exports=Text},{441:441,464:464,468:468,587:587,592:592,595:595,598:598}],441:[function(_dereq_,module,exports){"use strict";var snapsvg=module.exports=_dereq_(630);snapsvg.plugin(function(Snap,Element){Element.prototype.children=function(){for(var out=[],ch=this.node.childNodes,i=0,ii=ch.length;i<ii;i++)out[i]=new Snap(ch[i]);return out}}),snapsvg.plugin(function(Snap,Element,Paper,global){function split(str){return str.split(/\s+/)}function join(array){return array.join(" ")}function getClasses(e){return split(e.attr("class")||"")}function setClasses(e,classes){e.attr("class",join(classes))}Element.prototype.addClass=function(cls){var i,e,current=getClasses(this),add=split(cls);for(i=0,e;e=add[i];i++)-1===current.indexOf(e)&&current.push(e);return setClasses(this,current),this},Element.prototype.hasClass=function(cls){if(!cls)throw new Error("[snapsvg] syntax: hasClass(clsStr)");return-1!==getClasses(this).indexOf(cls)},Element.prototype.removeClass=function(cls){var i,e,idx,current=getClasses(this),remove=split(cls);for(i=0,e;e=remove[i];i++)-1!==(idx=current.indexOf(e))&&current.splice(idx,1);return setClasses(this,current),this}}),snapsvg.plugin(function(Snap,Element,Paper,global){Element.prototype.translate=function(x,y){var matrix=new Snap.Matrix;return matrix.translate(x,y),this.transform(matrix)}}),snapsvg.plugin(function(Snap){Snap.create=function(name,attrs){return Snap._.wrap(Snap._.$(name,attrs))}}),snapsvg.plugin(function(Snap,Element,Paper,global){Snap.createSnapAt=function(width,height,parentNode){var svg=document.createElementNS("http://www.w3.org/2000/svg","svg");return svg.setAttribute("width",width),svg.setAttribute("height",height),parentNode||(parentNode=document.body),parentNode.appendChild(svg),new Snap(svg)}})},{630:630}],442:[function(_dereq_,module,exports){var isArray=function(obj){return"[object Array]"===Object.prototype.toString.call(obj)},annotate=function(){var args=Array.prototype.slice.call(arguments);1===args.length&&isArray(args[0])&&(args=args[0]);var fn=args.pop();return fn.$inject=args,fn},FN_ARGS=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,FN_ARG=/\/\*([^\*]*)\*\//m,parse=function(fn){if("function"!=typeof fn)throw new Error('Cannot annotate "'+fn+'". Expected a function!');var match=fn.toString().match(FN_ARGS);return match[1]&&match[1].split(",").map(function(arg){return match=arg.match(FN_ARG),match?match[1].trim():arg.trim()})||[]};exports.annotate=annotate,exports.parse=parse,exports.isArray=isArray},{}],443:[function(_dereq_,module,exports){module.exports={annotate:_dereq_(442).annotate,Module:_dereq_(445),Injector:_dereq_(444)}},{442:442,444:444,445:445}],444:[function(_dereq_,module,exports){var Module=_dereq_(445),autoAnnotate=_dereq_(442).parse,annotate=_dereq_(442).annotate,isArray=_dereq_(442).isArray,Injector=function(modules,parent){parent=parent||{get:function(name,strict){if(currentlyResolving.push(name),!1===strict)return null;throw error('No provider for "'+name+'"!')}};var currentlyResolving=[],providers=this._providers=Object.create(parent._providers||null),instances=this._instances=Object.create(null),self=instances.injector=this,error=function(msg){var stack=currentlyResolving.join(" -> ");return currentlyResolving.length=0,new Error(stack?msg+" (Resolving: "+stack+")":msg)},get=function(name,strict){if(!providers[name]&&-1!==name.indexOf(".")){for(var parts=name.split("."),pivot=get(parts.shift());parts.length;)pivot=pivot[parts.shift()];return pivot}if(Object.hasOwnProperty.call(instances,name))return instances[name];if(Object.hasOwnProperty.call(providers,name)){if(-1!==currentlyResolving.indexOf(name))throw currentlyResolving.push(name),error("Cannot resolve circular dependency!");return currentlyResolving.push(name),instances[name]=providers[name][0](providers[name][1]),currentlyResolving.pop(),instances[name]}return parent.get(name,strict)},instantiate=function(Type){var instance=Object.create(Type.prototype),returned=invoke(Type,instance);return"object"==typeof returned?returned:instance},invoke=function(fn,context){if("function"!=typeof fn){if(!isArray(fn))throw new Error('Cannot invoke "'+fn+'". Expected a function!');fn=annotate(fn.slice())}var inject=fn.$inject&&fn.$inject||autoAnnotate(fn),dependencies=inject.map(function(dep){return get(dep)});return fn.apply(context,dependencies)},createPrivateInjectorFactory=function(privateChildInjector){return annotate(function(key){return privateChildInjector.get(key)})},createChild=function(modules,forceNewInstances){if(forceNewInstances&&forceNewInstances.length){var provider,cacheIdx,privateChildInjector,privateChildInjectorFactory,fromParentModule=Object.create(null),matchedScopes=Object.create(null),privateInjectorsCache=[],privateChildInjectors=[],privateChildFactories=[];for(var name in providers)provider=providers[name],-1!==forceNewInstances.indexOf(name)&&("private"===provider[2]?(cacheIdx=privateInjectorsCache.indexOf(provider[3]),-1===cacheIdx?(privateChildInjector=provider[3].createChild([],forceNewInstances),privateChildInjectorFactory=createPrivateInjectorFactory(privateChildInjector),privateInjectorsCache.push(provider[3]),privateChildInjectors.push(privateChildInjector),privateChildFactories.push(privateChildInjectorFactory),fromParentModule[name]=[privateChildInjectorFactory,name,"private",privateChildInjector]):fromParentModule[name]=[privateChildFactories[cacheIdx],name,"private",privateChildInjectors[cacheIdx]]):fromParentModule[name]=[provider[2],provider[1]],matchedScopes[name]=!0),"factory"!==provider[2]&&"type"!==provider[2]||!provider[1].$scope||forceNewInstances.forEach(function(scope){-1!==provider[1].$scope.indexOf(scope)&&(fromParentModule[name]=[provider[2],provider[1]],matchedScopes[scope]=!0)});forceNewInstances.forEach(function(scope){if(!matchedScopes[scope])throw new Error('No provider for "'+scope+'". Cannot use provider from the parent!')}),modules.unshift(fromParentModule)}return new Injector(modules,self)},factoryMap={factory:invoke,type:instantiate,value:function(value){return value}};modules.forEach(function(module){function arrayUnwrap(type,value){return"value"!==type&&isArray(value)&&(value=annotate(value.slice())),value}if(module instanceof Module)module.forEach(function(provider){var name=provider[0],type=provider[1],value=provider[2];providers[name]=[factoryMap[type],arrayUnwrap(type,value),type]});else if("object"==typeof module)if(module.__exports__){var clonedModule=Object.keys(module).reduce(function(m,key){return"__"!==key.substring(0,2)&&(m[key]=module[key]),m},Object.create(null)),privateInjector=new Injector((module.__modules__||[]).concat([clonedModule]),self),getFromPrivateInjector=annotate(function(key){return privateInjector.get(key)});module.__exports__.forEach(function(key){providers[key]=[getFromPrivateInjector,key,"private",privateInjector]})}else Object.keys(module).forEach(function(name){if("private"===module[name][2])return void(providers[name]=module[name]);var type=module[name][0],value=module[name][1];providers[name]=[factoryMap[type],arrayUnwrap(type,value),type]})}),this.get=get,this.invoke=invoke,this.instantiate=instantiate,this.createChild=createChild};module.exports=Injector},{442:442,445:445}],445:[function(_dereq_,module,exports){var Module=function(){var providers=[];this.factory=function(name,factory){return providers.push([name,"factory",factory]),this},this.value=function(name,value){return providers.push([name,"value",value]),this},this.type=function(name,type){return providers.push([name,"type",type]),this},this.forEach=function(iterator){providers.forEach(iterator)}};module.exports=Module},{}],446:[function(_dereq_,module,exports){arguments[4][81][0].apply(exports,arguments)},{81:81}],447:[function(_dereq_,module,exports){!function(glob){var current_event,stop,has="hasOwnProperty",separator=/[\.\/]/,comaseparator=/\s*,\s*/,numsort=function(a,b){return a-b},events={n:{}},firstDefined=function(){for(var i=0,ii=this.length;i<ii;i++)if(void 0!==this[i])return this[i]},lastDefined=function(){for(var i=this.length;--i;)if(void 0!==this[i])return this[i]},eve=function(name,scope){name=String(name);var l,oldstop=stop,args=Array.prototype.slice.call(arguments,2),listeners=eve.listeners(name),z=0,indexed=[],queue={},out=[],ce=current_event;out.firstDefined=firstDefined,out.lastDefined=lastDefined,current_event=name,stop=0;for(var i=0,ii=listeners.length;i<ii;i++)"zIndex"in listeners[i]&&(indexed.push(listeners[i].zIndex),listeners[i].zIndex<0&&(queue[listeners[i].zIndex]=listeners[i]));for(indexed.sort(numsort);indexed[z]<0;)if(l=queue[indexed[z++]],out.push(l.apply(scope,args)),stop)return stop=oldstop,out;for(i=0;i<ii;i++)if("zIndex"in(l=listeners[i]))if(l.zIndex==indexed[z]){if(out.push(l.apply(scope,args)),stop)break;do{if(z++,l=queue[indexed[z]],l&&out.push(l.apply(scope,args)),stop)break}while(l)}else queue[l.zIndex]=l;else if(out.push(l.apply(scope,args)),stop)break;return stop=oldstop,current_event=ce,out};eve._events=events,eve.listeners=function(name){var item,items,k,i,ii,j,jj,nes,names=name.split(separator),e=events,es=[e],out=[];for(i=0,ii=names.length;i<ii;i++){for(nes=[],j=0,jj=es.length;j<jj;j++)for(e=es[j].n,items=[e[names[i]],e["*"]],k=2;k--;)(item=items[k])&&(nes.push(item),out=out.concat(item.f||[]));es=nes}return out},eve.on=function(name,f){if(name=String(name),"function"!=typeof f)return function(){};for(var names=name.split(comaseparator),i=0,ii=names.length;i<ii;i++)!function(name){for(var exist,names=name.split(separator),e=events,i=0,ii=names.length;i<ii;i++)e=e.n,e=e.hasOwnProperty(names[i])&&e[names[i]]||(e[names[i]]={n:{}});for(e.f=e.f||[],i=0,ii=e.f.length;i<ii;i++)if(e.f[i]==f){exist=!0;break}!exist&&e.f.push(f)}(names[i]);return function(zIndex){+zIndex==+zIndex&&(f.zIndex=+zIndex)}},eve.f=function(event){var attrs=[].slice.call(arguments,1);return function(){eve.apply(null,[event,null].concat(attrs).concat([].slice.call(arguments,0)))}},eve.stop=function(){stop=1},eve.nt=function(subname){return subname?new RegExp("(?:\\.|\\/|^)"+subname+"(?:\\.|\\/|$)").test(current_event):current_event},eve.nts=function(){return current_event.split(separator)},eve.off=eve.unbind=function(name,f){if(!name)return void(eve._events=events={n:{}});var names=name.split(comaseparator);if(names.length>1)for(var i=0,ii=names.length;i<ii;i++)eve.off(names[i],f);else{names=name.split(separator);var e,key,splice,i,ii,j,jj,cur=[events];for(i=0,ii=names.length;i<ii;i++)for(j=0;j<cur.length;j+=splice.length-2){if(splice=[j,1],e=cur[j].n,"*"!=names[i])e[names[i]]&&splice.push(e[names[i]]);else for(key in e)e[has](key)&&splice.push(e[key]);cur.splice.apply(cur,splice)}for(i=0,ii=cur.length;i<ii;i++)for(e=cur[i];e.n;){if(f){if(e.f){for(j=0,jj=e.f.length;j<jj;j++)if(e.f[j]==f){e.f.splice(j,1);break}!e.f.length&&delete e.f}for(key in e.n)if(e.n[has](key)&&e.n[key].f){var funcs=e.n[key].f;for(j=0,jj=funcs.length;j<jj;j++)if(funcs[j]==f){funcs.splice(j,1);break}!funcs.length&&delete e.n[key].f}}else{delete e.f;for(key in e.n)e.n[has](key)&&e.n[key].f&&delete e.n[key].f}e=e.n}}},eve.once=function(name,f){var f2=function(){return eve.unbind(name,f2),f.apply(this,arguments)};return eve.on(name,f2)},eve.version="0.4.2",eve.toString=function(){return"You are running Eve 0.4.2"},void 0!==module&&module.exports?module.exports=eve:"function"==typeof define&&define.amd?define("eve",[],function(){return eve}):glob.eve=eve}(this)},{}],448:[function(_dereq_,module,exports){!function(window,document,exportName,undefined){"use strict";function setTimeoutContext(fn,timeout,context){return setTimeout(bindFn(fn,context),timeout)}function invokeArrayArg(arg,fn,context){return!!Array.isArray(arg)&&(each(arg,context[fn],context),!0)}function each(obj,iterator,context){var i;if(obj)if(obj.forEach)obj.forEach(iterator,context);else if(obj.length!==undefined)for(i=0;i<obj.length;)iterator.call(context,obj[i],i,obj),i++;else for(i in obj)obj.hasOwnProperty(i)&&iterator.call(context,obj[i],i,obj)}function deprecate(method,name,message){var deprecationMessage="DEPRECATED METHOD: "+name+"\n"+message+" AT \n";return function(){var e=new Error("get-stack-trace"),stack=e&&e.stack?e.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",log=window.console&&(window.console.warn||window.console.log);return log&&log.call(window.console,deprecationMessage,stack),method.apply(this,arguments)}}function inherit(child,base,properties){var childP,baseP=base.prototype;childP=child.prototype=Object.create(baseP),childP.constructor=child,childP._super=baseP,properties&&assign(childP,properties)}function bindFn(fn,context){return function(){return fn.apply(context,arguments)}}function boolOrFn(val,args){return typeof val==TYPE_FUNCTION?val.apply(args?args[0]||undefined:undefined,args):val}function ifUndefined(val1,val2){return val1===undefined?val2:val1}function addEventListeners(target,types,handler){each(splitStr(types),function(type){target.addEventListener(type,handler,!1)})}function removeEventListeners(target,types,handler){each(splitStr(types),function(type){target.removeEventListener(type,handler,!1)})}function hasParent(node,parent){for(;node;){if(node==parent)return!0;node=node.parentNode}return!1}function inStr(str,find){return str.indexOf(find)>-1}function splitStr(str){return str.trim().split(/\s+/g)}function inArray(src,find,findByKey){if(src.indexOf&&!findByKey)return src.indexOf(find);for(var i=0;i<src.length;){if(findByKey&&src[i][findByKey]==find||!findByKey&&src[i]===find)return i;i++}return-1}function toArray(obj){return Array.prototype.slice.call(obj,0)}function uniqueArray(src,key,sort){for(var results=[],values=[],i=0;i<src.length;){var val=key?src[i][key]:src[i];inArray(values,val)<0&&results.push(src[i]),values[i]=val,i++}return sort&&(results=key?results.sort(function(a,b){return a[key]>b[key]}):results.sort()),results}function prefixed(obj,property){for(var prefix,prop,camelProp=property[0].toUpperCase()+property.slice(1),i=0;i<VENDOR_PREFIXES.length;){if(prefix=VENDOR_PREFIXES[i],(prop=prefix?prefix+camelProp:property)in obj)return prop;i++}return undefined}function uniqueId(){return _uniqueId++}function getWindowForElement(element){var doc=element.ownerDocument||element;return doc.defaultView||doc.parentWindow||window}function Input(manager,callback){var self=this;this.manager=manager,this.callback=callback,this.element=manager.element,this.target=manager.options.inputTarget,this.domHandler=function(ev){boolOrFn(manager.options.enable,[manager])&&self.handler(ev)},this.init()}function createInputInstance(manager){var inputClass=manager.options.inputClass;return new(inputClass||(SUPPORT_POINTER_EVENTS?PointerEventInput:SUPPORT_ONLY_TOUCH?TouchInput:SUPPORT_TOUCH?TouchMouseInput:MouseInput))(manager,inputHandler)}function inputHandler(manager,eventType,input){var pointersLen=input.pointers.length,changedPointersLen=input.changedPointers.length,isFirst=eventType&INPUT_START&&pointersLen-changedPointersLen==0,isFinal=eventType&(INPUT_END|INPUT_CANCEL)&&pointersLen-changedPointersLen==0;input.isFirst=!!isFirst,input.isFinal=!!isFinal,isFirst&&(manager.session={}),input.eventType=eventType,computeInputData(manager,input),manager.emit("hammer.input",input),manager.recognize(input),manager.session.prevInput=input}function computeInputData(manager,input){var session=manager.session,pointers=input.pointers,pointersLength=pointers.length;session.firstInput||(session.firstInput=simpleCloneInputData(input)),pointersLength>1&&!session.firstMultiple?session.firstMultiple=simpleCloneInputData(input):1===pointersLength&&(session.firstMultiple=!1);var firstInput=session.firstInput,firstMultiple=session.firstMultiple,offsetCenter=firstMultiple?firstMultiple.center:firstInput.center,center=input.center=getCenter(pointers);input.timeStamp=now(),input.deltaTime=input.timeStamp-firstInput.timeStamp,input.angle=getAngle(offsetCenter,center),input.distance=getDistance(offsetCenter,center),computeDeltaXY(session,input),input.offsetDirection=getDirection(input.deltaX,input.deltaY);var overallVelocity=getVelocity(input.deltaTime,input.deltaX,input.deltaY);input.overallVelocityX=overallVelocity.x,input.overallVelocityY=overallVelocity.y,input.overallVelocity=abs(overallVelocity.x)>abs(overallVelocity.y)?overallVelocity.x:overallVelocity.y,input.scale=firstMultiple?getScale(firstMultiple.pointers,pointers):1,input.rotation=firstMultiple?getRotation(firstMultiple.pointers,pointers):0,input.maxPointers=session.prevInput?input.pointers.length>session.prevInput.maxPointers?input.pointers.length:session.prevInput.maxPointers:input.pointers.length,computeIntervalInputData(session,input);var target=manager.element;hasParent(input.srcEvent.target,target)&&(target=input.srcEvent.target),input.target=target}function computeDeltaXY(session,input){var center=input.center,offset=session.offsetDelta||{},prevDelta=session.prevDelta||{},prevInput=session.prevInput||{};input.eventType!==INPUT_START&&prevInput.eventType!==INPUT_END||(prevDelta=session.prevDelta={x:prevInput.deltaX||0,y:prevInput.deltaY||0},offset=session.offsetDelta={x:center.x,y:center.y}),input.deltaX=prevDelta.x+(center.x-offset.x),input.deltaY=prevDelta.y+(center.y-offset.y)}function computeIntervalInputData(session,input){var velocity,velocityX,velocityY,direction,last=session.lastInterval||input,deltaTime=input.timeStamp-last.timeStamp;if(input.eventType!=INPUT_CANCEL&&(deltaTime>COMPUTE_INTERVAL||last.velocity===undefined)){var deltaX=input.deltaX-last.deltaX,deltaY=input.deltaY-last.deltaY,v=getVelocity(deltaTime,deltaX,deltaY);velocityX=v.x,velocityY=v.y,velocity=abs(v.x)>abs(v.y)?v.x:v.y,direction=getDirection(deltaX,deltaY),session.lastInterval=input}else velocity=last.velocity,velocityX=last.velocityX,velocityY=last.velocityY,direction=last.direction;input.velocity=velocity,input.velocityX=velocityX,input.velocityY=velocityY,input.direction=direction}function simpleCloneInputData(input){for(var pointers=[],i=0;i<input.pointers.length;)pointers[i]={clientX:round(input.pointers[i].clientX),clientY:round(input.pointers[i].clientY)},i++;return{timeStamp:now(),pointers:pointers,center:getCenter(pointers),deltaX:input.deltaX,deltaY:input.deltaY}}function getCenter(pointers){var pointersLength=pointers.length;if(1===pointersLength)return{x:round(pointers[0].clientX),y:round(pointers[0].clientY)};for(var x=0,y=0,i=0;i<pointersLength;)x+=pointers[i].clientX,y+=pointers[i].clientY,i++;return{x:round(x/pointersLength),y:round(y/pointersLength)}}function getVelocity(deltaTime,x,y){return{x:x/deltaTime||0,y:y/deltaTime||0}}function getDirection(x,y){return x===y?DIRECTION_NONE:abs(x)>=abs(y)?x<0?DIRECTION_LEFT:DIRECTION_RIGHT:y<0?DIRECTION_UP:DIRECTION_DOWN}function getDistance(p1,p2,props){props||(props=PROPS_XY);var x=p2[props[0]]-p1[props[0]],y=p2[props[1]]-p1[props[1]];return Math.sqrt(x*x+y*y)}function getAngle(p1,p2,props){props||(props=PROPS_XY);var x=p2[props[0]]-p1[props[0]],y=p2[props[1]]-p1[props[1]];return 180*Math.atan2(y,x)/Math.PI}function getRotation(start,end){return getAngle(end[1],end[0],PROPS_CLIENT_XY)+getAngle(start[1],start[0],PROPS_CLIENT_XY)}function getScale(start,end){return getDistance(end[0],end[1],PROPS_CLIENT_XY)/getDistance(start[0],start[1],PROPS_CLIENT_XY)}function MouseInput(){this.evEl=MOUSE_ELEMENT_EVENTS,this.evWin=MOUSE_WINDOW_EVENTS,this.pressed=!1,Input.apply(this,arguments)}function PointerEventInput(){this.evEl=POINTER_ELEMENT_EVENTS,this.evWin=POINTER_WINDOW_EVENTS,Input.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function SingleTouchInput(){this.evTarget=SINGLE_TOUCH_TARGET_EVENTS,this.evWin=SINGLE_TOUCH_WINDOW_EVENTS,this.started=!1,Input.apply(this,arguments)}function normalizeSingleTouches(ev,type){var all=toArray(ev.touches),changed=toArray(ev.changedTouches);return type&(INPUT_END|INPUT_CANCEL)&&(all=uniqueArray(all.concat(changed),"identifier",!0)),[all,changed]}function TouchInput(){this.evTarget=TOUCH_TARGET_EVENTS,this.targetIds={},Input.apply(this,arguments)}function getTouches(ev,type){var allTouches=toArray(ev.touches),targetIds=this.targetIds;if(type&(INPUT_START|INPUT_MOVE)&&1===allTouches.length)return targetIds[allTouches[0].identifier]=!0,[allTouches,allTouches];var i,targetTouches,changedTouches=toArray(ev.changedTouches),changedTargetTouches=[],target=this.target;if(targetTouches=allTouches.filter(function(touch){return hasParent(touch.target,target)}),type===INPUT_START)for(i=0;i<targetTouches.length;)targetIds[targetTouches[i].identifier]=!0,i++;for(i=0;i<changedTouches.length;)targetIds[changedTouches[i].identifier]&&changedTargetTouches.push(changedTouches[i]),type&(INPUT_END|INPUT_CANCEL)&&delete targetIds[changedTouches[i].identifier],i++;return changedTargetTouches.length?[uniqueArray(targetTouches.concat(changedTargetTouches),"identifier",!0),changedTargetTouches]:void 0}function TouchMouseInput(){Input.apply(this,arguments);var handler=bindFn(this.handler,this)
;this.touch=new TouchInput(this.manager,handler),this.mouse=new MouseInput(this.manager,handler),this.primaryTouch=null,this.lastTouches=[]}function recordTouches(eventType,eventData){eventType&INPUT_START?(this.primaryTouch=eventData.changedPointers[0].identifier,setLastTouch.call(this,eventData)):eventType&(INPUT_END|INPUT_CANCEL)&&setLastTouch.call(this,eventData)}function setLastTouch(eventData){var touch=eventData.changedPointers[0];if(touch.identifier===this.primaryTouch){var lastTouch={x:touch.clientX,y:touch.clientY};this.lastTouches.push(lastTouch);var lts=this.lastTouches,removeLastTouch=function(){var i=lts.indexOf(lastTouch);i>-1&&lts.splice(i,1)};setTimeout(removeLastTouch,DEDUP_TIMEOUT)}}function isSyntheticEvent(eventData){for(var x=eventData.srcEvent.clientX,y=eventData.srcEvent.clientY,i=0;i<this.lastTouches.length;i++){var t=this.lastTouches[i],dx=Math.abs(x-t.x),dy=Math.abs(y-t.y);if(dx<=DEDUP_DISTANCE&&dy<=DEDUP_DISTANCE)return!0}return!1}function TouchAction(manager,value){this.manager=manager,this.set(value)}function cleanTouchActions(actions){if(inStr(actions,TOUCH_ACTION_NONE))return TOUCH_ACTION_NONE;var hasPanX=inStr(actions,TOUCH_ACTION_PAN_X),hasPanY=inStr(actions,TOUCH_ACTION_PAN_Y);return hasPanX&&hasPanY?TOUCH_ACTION_NONE:hasPanX||hasPanY?hasPanX?TOUCH_ACTION_PAN_X:TOUCH_ACTION_PAN_Y:inStr(actions,TOUCH_ACTION_MANIPULATION)?TOUCH_ACTION_MANIPULATION:TOUCH_ACTION_AUTO}function Recognizer(options){this.options=assign({},this.defaults,options||{}),this.id=uniqueId(),this.manager=null,this.options.enable=ifUndefined(this.options.enable,!0),this.state=STATE_POSSIBLE,this.simultaneous={},this.requireFail=[]}function stateStr(state){return state&STATE_CANCELLED?"cancel":state&STATE_ENDED?"end":state&STATE_CHANGED?"move":state&STATE_BEGAN?"start":""}function directionStr(direction){return direction==DIRECTION_DOWN?"down":direction==DIRECTION_UP?"up":direction==DIRECTION_LEFT?"left":direction==DIRECTION_RIGHT?"right":""}function getRecognizerByNameIfManager(otherRecognizer,recognizer){var manager=recognizer.manager;return manager?manager.get(otherRecognizer):otherRecognizer}function AttrRecognizer(){Recognizer.apply(this,arguments)}function PanRecognizer(){AttrRecognizer.apply(this,arguments),this.pX=null,this.pY=null}function PinchRecognizer(){AttrRecognizer.apply(this,arguments)}function PressRecognizer(){Recognizer.apply(this,arguments),this._timer=null,this._input=null}function RotateRecognizer(){AttrRecognizer.apply(this,arguments)}function SwipeRecognizer(){AttrRecognizer.apply(this,arguments)}function TapRecognizer(){Recognizer.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Hammer(element,options){return options=options||{},options.recognizers=ifUndefined(options.recognizers,Hammer.defaults.preset),new Manager(element,options)}function Manager(element,options){this.options=assign({},Hammer.defaults,options||{}),this.options.inputTarget=this.options.inputTarget||element,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=element,this.input=createInputInstance(this),this.touchAction=new TouchAction(this,this.options.touchAction),toggleCssProps(this,!0),each(this.options.recognizers,function(item){var recognizer=this.add(new item[0](item[1]));item[2]&&recognizer.recognizeWith(item[2]),item[3]&&recognizer.requireFailure(item[3])},this)}function toggleCssProps(manager,add){var element=manager.element;if(element.style){var prop;each(manager.options.cssProps,function(value,name){prop=prefixed(element.style,name),add?(manager.oldCssProps[prop]=element.style[prop],element.style[prop]=value):element.style[prop]=manager.oldCssProps[prop]||""}),add||(manager.oldCssProps={})}}function triggerDomEvent(event,data){var gestureEvent=document.createEvent("Event");gestureEvent.initEvent(event,!0,!0),gestureEvent.gesture=data,data.target.dispatchEvent(gestureEvent)}var assign,VENDOR_PREFIXES=["","webkit","Moz","MS","ms","o"],TEST_ELEMENT=document.createElement("div"),TYPE_FUNCTION="function",round=Math.round,abs=Math.abs,now=Date.now;assign="function"!=typeof Object.assign?function(target){if(target===undefined||null===target)throw new TypeError("Cannot convert undefined or null to object");for(var output=Object(target),index=1;index<arguments.length;index++){var source=arguments[index];if(source!==undefined&&null!==source)for(var nextKey in source)source.hasOwnProperty(nextKey)&&(output[nextKey]=source[nextKey])}return output}:Object.assign;var extend=deprecate(function(dest,src,merge){for(var keys=Object.keys(src),i=0;i<keys.length;)(!merge||merge&&dest[keys[i]]===undefined)&&(dest[keys[i]]=src[keys[i]]),i++;return dest},"extend","Use `assign`."),merge=deprecate(function(dest,src){return extend(dest,src,!0)},"merge","Use `assign`."),_uniqueId=1,MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android/i,SUPPORT_TOUCH="ontouchstart"in window,SUPPORT_POINTER_EVENTS=prefixed(window,"PointerEvent")!==undefined,SUPPORT_ONLY_TOUCH=SUPPORT_TOUCH&&MOBILE_REGEX.test(navigator.userAgent),COMPUTE_INTERVAL=25,INPUT_START=1,INPUT_MOVE=2,INPUT_END=4,INPUT_CANCEL=8,DIRECTION_NONE=1,DIRECTION_LEFT=2,DIRECTION_RIGHT=4,DIRECTION_UP=8,DIRECTION_DOWN=16,DIRECTION_HORIZONTAL=DIRECTION_LEFT|DIRECTION_RIGHT,DIRECTION_VERTICAL=DIRECTION_UP|DIRECTION_DOWN,DIRECTION_ALL=DIRECTION_HORIZONTAL|DIRECTION_VERTICAL,PROPS_XY=["x","y"],PROPS_CLIENT_XY=["clientX","clientY"];Input.prototype={handler:function(){},init:function(){this.evEl&&addEventListeners(this.element,this.evEl,this.domHandler),this.evTarget&&addEventListeners(this.target,this.evTarget,this.domHandler),this.evWin&&addEventListeners(getWindowForElement(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&removeEventListeners(this.element,this.evEl,this.domHandler),this.evTarget&&removeEventListeners(this.target,this.evTarget,this.domHandler),this.evWin&&removeEventListeners(getWindowForElement(this.element),this.evWin,this.domHandler)}};var MOUSE_INPUT_MAP={mousedown:INPUT_START,mousemove:INPUT_MOVE,mouseup:INPUT_END},MOUSE_ELEMENT_EVENTS="mousedown",MOUSE_WINDOW_EVENTS="mousemove mouseup";inherit(MouseInput,Input,{handler:function(ev){var eventType=MOUSE_INPUT_MAP[ev.type];eventType&INPUT_START&&0===ev.button&&(this.pressed=!0),eventType&INPUT_MOVE&&1!==ev.which&&(eventType=INPUT_END),this.pressed&&(eventType&INPUT_END&&(this.pressed=!1),this.callback(this.manager,eventType,{pointers:[ev],changedPointers:[ev],pointerType:"mouse",srcEvent:ev}))}});var POINTER_INPUT_MAP={pointerdown:INPUT_START,pointermove:INPUT_MOVE,pointerup:INPUT_END,pointercancel:INPUT_CANCEL,pointerout:INPUT_CANCEL},IE10_POINTER_TYPE_ENUM={2:"touch",3:"pen",4:"mouse",5:"kinect"},POINTER_ELEMENT_EVENTS="pointerdown",POINTER_WINDOW_EVENTS="pointermove pointerup pointercancel";window.MSPointerEvent&&!window.PointerEvent&&(POINTER_ELEMENT_EVENTS="MSPointerDown",POINTER_WINDOW_EVENTS="MSPointerMove MSPointerUp MSPointerCancel"),inherit(PointerEventInput,Input,{handler:function(ev){var store=this.store,removePointer=!1,eventTypeNormalized=ev.type.toLowerCase().replace("ms",""),eventType=POINTER_INPUT_MAP[eventTypeNormalized],pointerType=IE10_POINTER_TYPE_ENUM[ev.pointerType]||ev.pointerType,isTouch="touch"==pointerType,storeIndex=inArray(store,ev.pointerId,"pointerId");eventType&INPUT_START&&(0===ev.button||isTouch)?storeIndex<0&&(store.push(ev),storeIndex=store.length-1):eventType&(INPUT_END|INPUT_CANCEL)&&(removePointer=!0),storeIndex<0||(store[storeIndex]=ev,this.callback(this.manager,eventType,{pointers:store,changedPointers:[ev],pointerType:pointerType,srcEvent:ev}),removePointer&&store.splice(storeIndex,1))}});var SINGLE_TOUCH_INPUT_MAP={touchstart:INPUT_START,touchmove:INPUT_MOVE,touchend:INPUT_END,touchcancel:INPUT_CANCEL},SINGLE_TOUCH_TARGET_EVENTS="touchstart",SINGLE_TOUCH_WINDOW_EVENTS="touchstart touchmove touchend touchcancel";inherit(SingleTouchInput,Input,{handler:function(ev){var type=SINGLE_TOUCH_INPUT_MAP[ev.type];if(type===INPUT_START&&(this.started=!0),this.started){var touches=normalizeSingleTouches.call(this,ev,type);type&(INPUT_END|INPUT_CANCEL)&&touches[0].length-touches[1].length==0&&(this.started=!1),this.callback(this.manager,type,{pointers:touches[0],changedPointers:touches[1],pointerType:"touch",srcEvent:ev})}}});var TOUCH_INPUT_MAP={touchstart:INPUT_START,touchmove:INPUT_MOVE,touchend:INPUT_END,touchcancel:INPUT_CANCEL},TOUCH_TARGET_EVENTS="touchstart touchmove touchend touchcancel";inherit(TouchInput,Input,{handler:function(ev){var type=TOUCH_INPUT_MAP[ev.type],touches=getTouches.call(this,ev,type);touches&&this.callback(this.manager,type,{pointers:touches[0],changedPointers:touches[1],pointerType:"touch",srcEvent:ev})}});var DEDUP_TIMEOUT=2500,DEDUP_DISTANCE=25;inherit(TouchMouseInput,Input,{handler:function(manager,inputEvent,inputData){var isTouch="touch"==inputData.pointerType,isMouse="mouse"==inputData.pointerType;if(!(isMouse&&inputData.sourceCapabilities&&inputData.sourceCapabilities.firesTouchEvents)){if(isTouch)recordTouches.call(this,inputEvent,inputData);else if(isMouse&&isSyntheticEvent.call(this,inputData))return;this.callback(manager,inputEvent,inputData)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var PREFIXED_TOUCH_ACTION=prefixed(TEST_ELEMENT.style,"touchAction"),NATIVE_TOUCH_ACTION=PREFIXED_TOUCH_ACTION!==undefined,TOUCH_ACTION_AUTO="auto",TOUCH_ACTION_MANIPULATION="manipulation",TOUCH_ACTION_NONE="none",TOUCH_ACTION_PAN_X="pan-x",TOUCH_ACTION_PAN_Y="pan-y",TOUCH_ACTION_MAP=function(){if(!NATIVE_TOUCH_ACTION)return!1;var touchMap={},cssSupports=window.CSS&&window.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(val){touchMap[val]=!cssSupports||window.CSS.supports("touch-action",val)}),touchMap}();TouchAction.prototype={set:function(value){"compute"==value&&(value=this.compute()),NATIVE_TOUCH_ACTION&&this.manager.element.style&&TOUCH_ACTION_MAP[value]&&(this.manager.element.style[PREFIXED_TOUCH_ACTION]=value),this.actions=value.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var actions=[];return each(this.manager.recognizers,function(recognizer){boolOrFn(recognizer.options.enable,[recognizer])&&(actions=actions.concat(recognizer.getTouchAction()))}),cleanTouchActions(actions.join(" "))},preventDefaults:function(input){var srcEvent=input.srcEvent,direction=input.offsetDirection;if(this.manager.session.prevented)return void srcEvent.preventDefault();var actions=this.actions,hasNone=inStr(actions,TOUCH_ACTION_NONE)&&!TOUCH_ACTION_MAP[TOUCH_ACTION_NONE],hasPanY=inStr(actions,TOUCH_ACTION_PAN_Y)&&!TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_Y],hasPanX=inStr(actions,TOUCH_ACTION_PAN_X)&&!TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_X];if(hasNone){var isTapPointer=1===input.pointers.length,isTapMovement=input.distance<2,isTapTouchTime=input.deltaTime<250;if(isTapPointer&&isTapMovement&&isTapTouchTime)return}return hasPanX&&hasPanY?void 0:hasNone||hasPanY&&direction&DIRECTION_HORIZONTAL||hasPanX&&direction&DIRECTION_VERTICAL?this.preventSrc(srcEvent):void 0},preventSrc:function(srcEvent){this.manager.session.prevented=!0,srcEvent.preventDefault()}};var STATE_POSSIBLE=1,STATE_BEGAN=2,STATE_CHANGED=4,STATE_ENDED=8,STATE_RECOGNIZED=STATE_ENDED,STATE_CANCELLED=16;Recognizer.prototype={defaults:{},set:function(options){return assign(this.options,options),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(otherRecognizer){if(invokeArrayArg(otherRecognizer,"recognizeWith",this))return this;var simultaneous=this.simultaneous;return otherRecognizer=getRecognizerByNameIfManager(otherRecognizer,this),simultaneous[otherRecognizer.id]||(simultaneous[otherRecognizer.id]=otherRecognizer,otherRecognizer.recognizeWith(this)),this},dropRecognizeWith:function(otherRecognizer){return invokeArrayArg(otherRecognizer,"dropRecognizeWith",this)?this:(otherRecognizer=getRecognizerByNameIfManager(otherRecognizer,this),delete this.simultaneous[otherRecognizer.id],this)},requireFailure:function(otherRecognizer){if(invokeArrayArg(otherRecognizer,"requireFailure",this))return this;var requireFail=this.requireFail;return otherRecognizer=getRecognizerByNameIfManager(otherRecognizer,this),-1===inArray(requireFail,otherRecognizer)&&(requireFail.push(otherRecognizer),otherRecognizer.requireFailure(this)),this},dropRequireFailure:function(otherRecognizer){if(invokeArrayArg(otherRecognizer,"dropRequireFailure",this))return this;otherRecognizer=getRecognizerByNameIfManager(otherRecognizer,this);var index=inArray(this.requireFail,otherRecognizer);return index>-1&&this.requireFail.splice(index,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(otherRecognizer){return!!this.simultaneous[otherRecognizer.id]},emit:function(input){function emit(event){self.manager.emit(event,input)}var self=this,state=this.state;state<STATE_ENDED&&emit(self.options.event+stateStr(state)),emit(self.options.event),input.additionalEvent&&emit(input.additionalEvent),state>=STATE_ENDED&&emit(self.options.event+stateStr(state))},tryEmit:function(input){if(this.canEmit())return this.emit(input);this.state=32},canEmit:function(){for(var i=0;i<this.requireFail.length;){if(!(this.requireFail[i].state&(32|STATE_POSSIBLE)))return!1;i++}return!0},recognize:function(inputData){var inputDataClone=assign({},inputData);if(!boolOrFn(this.options.enable,[this,inputDataClone]))return this.reset(),void(this.state=32);this.state&(STATE_RECOGNIZED|STATE_CANCELLED|32)&&(this.state=STATE_POSSIBLE),this.state=this.process(inputDataClone),this.state&(STATE_BEGAN|STATE_CHANGED|STATE_ENDED|STATE_CANCELLED)&&this.tryEmit(inputDataClone)},process:function(inputData){},getTouchAction:function(){},reset:function(){}},inherit(AttrRecognizer,Recognizer,{defaults:{pointers:1},attrTest:function(input){var optionPointers=this.options.pointers;return 0===optionPointers||input.pointers.length===optionPointers},process:function(input){var state=this.state,eventType=input.eventType,isRecognized=state&(STATE_BEGAN|STATE_CHANGED),isValid=this.attrTest(input);return isRecognized&&(eventType&INPUT_CANCEL||!isValid)?state|STATE_CANCELLED:isRecognized||isValid?eventType&INPUT_END?state|STATE_ENDED:state&STATE_BEGAN?state|STATE_CHANGED:STATE_BEGAN:32}}),inherit(PanRecognizer,AttrRecognizer,{defaults:{event:"pan",threshold:10,pointers:1,direction:DIRECTION_ALL},getTouchAction:function(){var direction=this.options.direction,actions=[];return direction&DIRECTION_HORIZONTAL&&actions.push(TOUCH_ACTION_PAN_Y),direction&DIRECTION_VERTICAL&&actions.push(TOUCH_ACTION_PAN_X),actions},directionTest:function(input){var options=this.options,hasMoved=!0,distance=input.distance,direction=input.direction,x=input.deltaX,y=input.deltaY;return direction&options.direction||(options.direction&DIRECTION_HORIZONTAL?(direction=0===x?DIRECTION_NONE:x<0?DIRECTION_LEFT:DIRECTION_RIGHT,hasMoved=x!=this.pX,distance=Math.abs(input.deltaX)):(direction=0===y?DIRECTION_NONE:y<0?DIRECTION_UP:DIRECTION_DOWN,hasMoved=y!=this.pY,distance=Math.abs(input.deltaY))),input.direction=direction,hasMoved&&distance>options.threshold&&direction&options.direction},attrTest:function(input){return AttrRecognizer.prototype.attrTest.call(this,input)&&(this.state&STATE_BEGAN||!(this.state&STATE_BEGAN)&&this.directionTest(input))},emit:function(input){this.pX=input.deltaX,this.pY=input.deltaY;var direction=directionStr(input.direction);direction&&(input.additionalEvent=this.options.event+direction),this._super.emit.call(this,input)}}),inherit(PinchRecognizer,AttrRecognizer,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[TOUCH_ACTION_NONE]},attrTest:function(input){return this._super.attrTest.call(this,input)&&(Math.abs(input.scale-1)>this.options.threshold||this.state&STATE_BEGAN)},emit:function(input){if(1!==input.scale){var inOut=input.scale<1?"in":"out";input.additionalEvent=this.options.event+inOut}this._super.emit.call(this,input)}}),inherit(PressRecognizer,Recognizer,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[TOUCH_ACTION_AUTO]},process:function(input){var options=this.options,validPointers=input.pointers.length===options.pointers,validMovement=input.distance<options.threshold,validTime=input.deltaTime>options.time;if(this._input=input,!validMovement||!validPointers||input.eventType&(INPUT_END|INPUT_CANCEL)&&!validTime)this.reset();else if(input.eventType&INPUT_START)this.reset(),this._timer=setTimeoutContext(function(){this.state=STATE_RECOGNIZED,this.tryEmit()},options.time,this);else if(input.eventType&INPUT_END)return STATE_RECOGNIZED;return 32},reset:function(){clearTimeout(this._timer)},emit:function(input){this.state===STATE_RECOGNIZED&&(input&&input.eventType&INPUT_END?this.manager.emit(this.options.event+"up",input):(this._input.timeStamp=now(),this.manager.emit(this.options.event,this._input)))}}),inherit(RotateRecognizer,AttrRecognizer,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[TOUCH_ACTION_NONE]},attrTest:function(input){return this._super.attrTest.call(this,input)&&(Math.abs(input.rotation)>this.options.threshold||this.state&STATE_BEGAN)}}),inherit(SwipeRecognizer,AttrRecognizer,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:DIRECTION_HORIZONTAL|DIRECTION_VERTICAL,pointers:1},getTouchAction:function(){return PanRecognizer.prototype.getTouchAction.call(this)},attrTest:function(input){var velocity,direction=this.options.direction;return direction&(DIRECTION_HORIZONTAL|DIRECTION_VERTICAL)?velocity=input.overallVelocity:direction&DIRECTION_HORIZONTAL?velocity=input.overallVelocityX:direction&DIRECTION_VERTICAL&&(velocity=input.overallVelocityY),this._super.attrTest.call(this,input)&&direction&input.offsetDirection&&input.distance>this.options.threshold&&input.maxPointers==this.options.pointers&&abs(velocity)>this.options.velocity&&input.eventType&INPUT_END},emit:function(input){var direction=directionStr(input.offsetDirection);direction&&this.manager.emit(this.options.event+direction,input),this.manager.emit(this.options.event,input)}}),inherit(TapRecognizer,Recognizer,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[TOUCH_ACTION_MANIPULATION]},process:function(input){var options=this.options,validPointers=input.pointers.length===options.pointers,validMovement=input.distance<options.threshold,validTouchTime=input.deltaTime<options.time;if(this.reset(),input.eventType&INPUT_START&&0===this.count)return this.failTimeout();if(validMovement&&validTouchTime&&validPointers){if(input.eventType!=INPUT_END)return this.failTimeout();var validInterval=!this.pTime||input.timeStamp-this.pTime<options.interval,validMultiTap=!this.pCenter||getDistance(this.pCenter,input.center)<options.posThreshold;this.pTime=input.timeStamp,this.pCenter=input.center,validMultiTap&&validInterval?this.count+=1:this.count=1,this._input=input;if(0===this.count%options.taps)return this.hasRequireFailures()?(this._timer=setTimeoutContext(function(){this.state=STATE_RECOGNIZED,this.tryEmit()},options.interval,this),STATE_BEGAN):STATE_RECOGNIZED}return 32},failTimeout:function(){return this._timer=setTimeoutContext(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==STATE_RECOGNIZED&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Hammer.VERSION="2.0.7",Hammer.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[RotateRecognizer,{enable:!1}],[PinchRecognizer,{enable:!1},["rotate"]],[SwipeRecognizer,{direction:DIRECTION_HORIZONTAL}],[PanRecognizer,{direction:DIRECTION_HORIZONTAL},["swipe"]],[TapRecognizer],[TapRecognizer,{event:"doubletap",taps:2},["tap"]],[PressRecognizer]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};Manager.prototype={set:function(options){return assign(this.options,options),options.touchAction&&this.touchAction.update(),options.inputTarget&&(this.input.destroy(),this.input.target=options.inputTarget,this.input.init()),this},stop:function(force){this.session.stopped=force?2:1},recognize:function(inputData){var session=this.session;if(!session.stopped){this.touchAction.preventDefaults(inputData);var recognizer,recognizers=this.recognizers,curRecognizer=session.curRecognizer;(!curRecognizer||curRecognizer&&curRecognizer.state&STATE_RECOGNIZED)&&(curRecognizer=session.curRecognizer=null);for(var i=0;i<recognizers.length;)recognizer=recognizers[i],2===session.stopped||curRecognizer&&recognizer!=curRecognizer&&!recognizer.canRecognizeWith(curRecognizer)?recognizer.reset():recognizer.recognize(inputData),!curRecognizer&&recognizer.state&(STATE_BEGAN|STATE_CHANGED|STATE_ENDED)&&(curRecognizer=session.curRecognizer=recognizer),i++}},get:function(recognizer){if(recognizer instanceof Recognizer)return recognizer;for(var recognizers=this.recognizers,i=0;i<recognizers.length;i++)if(recognizers[i].options.event==recognizer)return recognizers[i];return null},add:function(recognizer){if(invokeArrayArg(recognizer,"add",this))return this;var existing=this.get(recognizer.options.event);return existing&&this.remove(existing),this.recognizers.push(recognizer),recognizer.manager=this,this.touchAction.update(),recognizer},remove:function(recognizer){if(invokeArrayArg(recognizer,"remove",this))return this;if(recognizer=this.get(recognizer)){var recognizers=this.recognizers,index=inArray(recognizers,recognizer);-1!==index&&(recognizers.splice(index,1),this.touchAction.update())}return this},on:function(events,handler){if(events!==undefined&&handler!==undefined){var handlers=this.handlers;return each(splitStr(events),function(event){handlers[event]=handlers[event]||[],handlers[event].push(handler)}),this}},off:function(events,handler){if(events!==undefined){var handlers=this.handlers;return each(splitStr(events),function(event){handler?handlers[event]&&handlers[event].splice(inArray(handlers[event],handler),1):delete handlers[event]}),this}},emit:function(event,data){this.options.domEvents&&triggerDomEvent(event,data);var handlers=this.handlers[event]&&this.handlers[event].slice();if(handlers&&handlers.length){data.type=event,data.preventDefault=function(){data.srcEvent.preventDefault()};for(var i=0;i<handlers.length;)handlers[i](data),i++}},destroy:function(){this.element&&toggleCssProps(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},assign(Hammer,{INPUT_START:INPUT_START,INPUT_MOVE:INPUT_MOVE,INPUT_END:INPUT_END,INPUT_CANCEL:INPUT_CANCEL,STATE_POSSIBLE:STATE_POSSIBLE,STATE_BEGAN:STATE_BEGAN,STATE_CHANGED:STATE_CHANGED,STATE_ENDED:STATE_ENDED,STATE_RECOGNIZED:STATE_RECOGNIZED,STATE_CANCELLED:STATE_CANCELLED,STATE_FAILED:32,DIRECTION_NONE:DIRECTION_NONE,DIRECTION_LEFT:DIRECTION_LEFT,DIRECTION_RIGHT:DIRECTION_RIGHT,DIRECTION_UP:DIRECTION_UP,DIRECTION_DOWN:DIRECTION_DOWN,DIRECTION_HORIZONTAL:DIRECTION_HORIZONTAL,DIRECTION_VERTICAL:DIRECTION_VERTICAL,DIRECTION_ALL:DIRECTION_ALL,Manager:Manager,Input:Input,TouchAction:TouchAction,TouchInput:TouchInput,MouseInput:MouseInput,PointerEventInput:PointerEventInput,TouchMouseInput:TouchMouseInput,SingleTouchInput:SingleTouchInput,Recognizer:Recognizer,AttrRecognizer:AttrRecognizer,Tap:TapRecognizer,Pan:PanRecognizer,Swipe:SwipeRecognizer,Pinch:PinchRecognizer,Rotate:RotateRecognizer,Press:PressRecognizer,on:addEventListeners,off:removeEventListeners,each:each,merge:merge,extend:extend,assign:assign,inherit:inherit,bindFn:bindFn,prefixed:prefixed}),(void 0!==window?window:"undefined"!=typeof self?self:{}).Hammer=Hammer,"function"==typeof define&&define.amd?define(function(){return Hammer}):void 0!==module&&module.exports?module.exports=Hammer:window.Hammer=Hammer}(window,document)},{}],449:[function(_dereq_,module,exports){arguments[4][82][0].apply(exports,arguments)},{82:82}],450:[function(_dereq_,module,exports){arguments[4][83][0].apply(exports,arguments)},{449:449,83:83}],451:[function(_dereq_,module,exports){arguments[4][84][0].apply(exports,arguments)},{84:84}],452:[function(_dereq_,module,exports){var createFindIndex=_dereq_(542),findIndex=createFindIndex();module.exports=findIndex},{542:542}],453:[function(_dereq_,module,exports){function flatten(array,isDeep,guard){var length=array?array.length:0;return guard&&isIterateeCall(array,isDeep,guard)&&(isDeep=!1),length?baseFlatten(array,isDeep):[]}var baseFlatten=_dereq_(502),isIterateeCall=_dereq_(562);module.exports=flatten},{502:502,562:562}],454:[function(_dereq_,module,exports){arguments[4][86][0].apply(exports,arguments)},{86:86}],455:[function(_dereq_,module,exports){var baseFlatten=_dereq_(502),baseUniq=_dereq_(525),restParam=_dereq_(476),union=restParam(function(arrays){return baseUniq(baseFlatten(arrays,!1,!0))});module.exports=union},{476:476,502:502,525:525}],456:[function(_dereq_,module,exports){function uniq(array,isSorted,iteratee,thisArg){return(array?array.length:0)?(null!=isSorted&&"boolean"!=typeof isSorted&&(thisArg=iteratee,iteratee=isIterateeCall(array,isSorted,thisArg)?void 0:isSorted,isSorted=!1),iteratee=null==iteratee?iteratee:baseCallback(iteratee,thisArg,3),isSorted?sortedUniq(array,iteratee):baseUniq(array,iteratee)):[]}var baseCallback=_dereq_(490),baseUniq=_dereq_(525),isIterateeCall=_dereq_(562),sortedUniq=_dereq_(577);module.exports=uniq},{490:490,525:525,562:562,577:577}],457:[function(_dereq_,module,exports){module.exports=_dereq_(456)},{456:456}],458:[function(_dereq_,module,exports){var baseDifference=_dereq_(496),isArrayLike=_dereq_(560),restParam=_dereq_(476),without=restParam(function(array,values){return isArrayLike(array)?baseDifference(array,values):[]});module.exports=without},{476:476,496:496,560:560}],459:[function(_dereq_,module,exports){function lodash(value){if(isObjectLike(value)&&!isArray(value)&&!(value instanceof LazyWrapper)){if(value instanceof LodashWrapper)return value;if(hasOwnProperty.call(value,"__chain__")&&hasOwnProperty.call(value,"__wrapped__"))return wrapperClone(value)}return new LodashWrapper(value)}var LazyWrapper=_dereq_(477),LodashWrapper=_dereq_(478),baseLodash=_dereq_(511),isArray=_dereq_(583),isObjectLike=_dereq_(566),wrapperClone=_dereq_(580),objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty;lodash.prototype=baseLodash.prototype,module.exports=lodash},{477:477,478:478,511:511,566:566,580:580,583:583}],460:[function(_dereq_,module,exports){arguments[4][88][0].apply(exports,arguments)},{470:470,88:88}],461:[function(_dereq_,module,exports){function every(collection,predicate,thisArg){var func=isArray(collection)?arrayEvery:baseEvery;return thisArg&&isIterateeCall(collection,predicate,thisArg)&&(predicate=void 0),"function"==typeof predicate&&void 0===thisArg||(predicate=baseCallback(predicate,thisArg,3)),func(collection,predicate)}var arrayEvery=_dereq_(482),baseCallback=_dereq_(490),baseEvery=_dereq_(498),isArray=_dereq_(583),isIterateeCall=_dereq_(562);module.exports=every},{482:482,490:490,498:498,562:562,583:583}],462:[function(_dereq_,module,exports){arguments[4][89][0].apply(exports,arguments)},{483:483,490:490,499:499,583:583,89:89}],463:[function(_dereq_,module,exports){arguments[4][90][0].apply(exports,arguments)},{497:497,541:541,90:90}],464:[function(_dereq_,module,exports){arguments[4][91][0].apply(exports,arguments)},{481:481,497:497,543:543,91:91}],465:[function(_dereq_,module,exports){var createAggregator=_dereq_(534),objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,groupBy=createAggregator(function(result,value,key){hasOwnProperty.call(result,key)?result[key].push(value):result[key]=[value]});module.exports=groupBy},{534:534}],466:[function(_dereq_,module,exports){function includes(collection,target,fromIndex,guard){var length=collection?getLength(collection):0;return isLength(length)||(collection=values(collection),length=collection.length),fromIndex="number"!=typeof fromIndex||guard&&isIterateeCall(target,fromIndex,guard)?0:fromIndex<0?nativeMax(length+fromIndex,0):fromIndex||0,"string"==typeof collection||!isArray(collection)&&isString(collection)?fromIndex<=length&&collection.indexOf(target,fromIndex)>-1:!!length&&baseIndexOf(collection,target,fromIndex)>-1}var baseIndexOf=_dereq_(507),getLength=_dereq_(553),isArray=_dereq_(583),isIterateeCall=_dereq_(562),isLength=_dereq_(565),isString=_dereq_(589),values=_dereq_(600),nativeMax=Math.max;module.exports=includes},{507:507,553:553,562:562,565:565,583:583,589:589,600:600}],467:[function(_dereq_,module,exports){arguments[4][93][0].apply(exports,arguments)},{484:484,490:490,512:512,583:583,93:93}],468:[function(_dereq_,module,exports){var arrayReduce=_dereq_(486),baseEach=_dereq_(497),createReduce=_dereq_(546),reduce=createReduce(arrayReduce,baseEach);module.exports=reduce},{486:486,497:497,546:546}],469:[function(_dereq_,module,exports){function size(collection){var length=collection?getLength(collection):0;return isLength(length)?length:keys(collection).length}var getLength=_dereq_(553),isLength=_dereq_(565),keys=_dereq_(593);module.exports=size},{553:553,565:565,593:593}],470:[function(_dereq_,module,exports){arguments[4][94][0].apply(exports,arguments)},{487:487,490:490,522:522,562:562,583:583,94:94}],471:[function(_dereq_,module,exports){function sortBy(collection,iteratee,thisArg){if(null==collection)return[];thisArg&&isIterateeCall(collection,iteratee,thisArg)&&(iteratee=void 0);var index=-1;iteratee=baseCallback(iteratee,thisArg,3);var result=baseMap(collection,function(value,key,collection){return{criteria:iteratee(value,key,collection),index:++index,value:value}});return baseSortBy(result,compareAscending)}var baseCallback=_dereq_(490),baseMap=_dereq_(512),baseSortBy=_dereq_(523),compareAscending=_dereq_(531),isIterateeCall=_dereq_(562);module.exports=sortBy},{490:490,512:512,523:523,531:531,562:562}],472:[function(_dereq_,module,exports){arguments[4][95][0].apply(exports,arguments)},{555:555,95:95}],473:[function(_dereq_,module,exports){var createWrapper=_dereq_(547),replaceHolders=_dereq_(574),restParam=_dereq_(476),bind=restParam(function(func,thisArg,partials){var bitmask=1;if(partials.length){var holders=replaceHolders(partials,bind.placeholder);bitmask|=32}return createWrapper(func,bitmask,thisArg,partials,holders)});bind.placeholder={},module.exports=bind},{476:476,547:547,574:574}],474:[function(_dereq_,module,exports){arguments[4][96][0].apply(exports,arguments)},{472:472,587:587,96:96}],475:[function(_dereq_,module,exports){var baseDelay=_dereq_(495),restParam=_dereq_(476),defer=restParam(function(func,args){return baseDelay(func,1,args)});module.exports=defer},{476:476,495:495}],476:[function(_dereq_,module,exports){arguments[4][97][0].apply(exports,arguments)},{97:97}],477:[function(_dereq_,module,exports){function LazyWrapper(value){this.__wrapped__=value,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=POSITIVE_INFINITY,this.__views__=[]}var baseCreate=_dereq_(494),baseLodash=_dereq_(511),POSITIVE_INFINITY=Number.POSITIVE_INFINITY;LazyWrapper.prototype=baseCreate(baseLodash.prototype),LazyWrapper.prototype.constructor=LazyWrapper,module.exports=LazyWrapper},{494:494,511:511}],478:[function(_dereq_,module,exports){function LodashWrapper(value,chainAll,actions){this.__wrapped__=value,this.__actions__=actions||[],this.__chain__=!!chainAll}var baseCreate=_dereq_(494),baseLodash=_dereq_(511);LodashWrapper.prototype=baseCreate(baseLodash.prototype),LodashWrapper.prototype.constructor=LodashWrapper,module.exports=LodashWrapper},{494:494,511:511}],479:[function(_dereq_,module,exports){(function(global){function SetCache(values){var length=values?values.length:0;for(this.data={hash:nativeCreate(null),set:new Set
};length--;)this.push(values[length])}var cachePush=_dereq_(530),getNative=_dereq_(555),Set=getNative(global,"Set"),nativeCreate=getNative(Object,"create");SetCache.prototype.push=cachePush,module.exports=SetCache}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{530:530,555:555}],480:[function(_dereq_,module,exports){function arrayCopy(source,array){var index=-1,length=source.length;for(array||(array=Array(length));++index<length;)array[index]=source[index];return array}module.exports=arrayCopy},{}],481:[function(_dereq_,module,exports){arguments[4][99][0].apply(exports,arguments)},{99:99}],482:[function(_dereq_,module,exports){function arrayEvery(array,predicate){for(var index=-1,length=array.length;++index<length;)if(!predicate(array[index],index,array))return!1;return!0}module.exports=arrayEvery},{}],483:[function(_dereq_,module,exports){arguments[4][100][0].apply(exports,arguments)},{100:100}],484:[function(_dereq_,module,exports){arguments[4][101][0].apply(exports,arguments)},{101:101}],485:[function(_dereq_,module,exports){arguments[4][102][0].apply(exports,arguments)},{102:102}],486:[function(_dereq_,module,exports){function arrayReduce(array,iteratee,accumulator,initFromArray){var index=-1,length=array.length;for(initFromArray&&length&&(accumulator=array[++index]);++index<length;)accumulator=iteratee(accumulator,array[index],index,array);return accumulator}module.exports=arrayReduce},{}],487:[function(_dereq_,module,exports){arguments[4][103][0].apply(exports,arguments)},{103:103}],488:[function(_dereq_,module,exports){arguments[4][104][0].apply(exports,arguments)},{104:104,593:593}],489:[function(_dereq_,module,exports){arguments[4][105][0].apply(exports,arguments)},{105:105,493:493,593:593}],490:[function(_dereq_,module,exports){arguments[4][106][0].apply(exports,arguments)},{106:106,513:513,514:514,527:527,601:601,603:603}],491:[function(_dereq_,module,exports){function baseClone(value,isDeep,customizer,key,object,stackA,stackB){var result;if(customizer&&(result=object?customizer(value,key,object):customizer(value)),void 0!==result)return result;if(!isObject(value))return value;var isArr=isArray(value);if(isArr){if(result=initCloneArray(value),!isDeep)return arrayCopy(value,result)}else{var tag=objToString.call(value),isFunc=tag==funcTag;if(tag!=objectTag&&tag!=argsTag&&(!isFunc||object))return cloneableTags[tag]?initCloneByTag(value,tag,isDeep):object?value:{};if(result=initCloneObject(isFunc?{}:value),!isDeep)return baseAssign(result,value)}stackA||(stackA=[]),stackB||(stackB=[]);for(var length=stackA.length;length--;)if(stackA[length]==value)return stackB[length];return stackA.push(value),stackB.push(result),(isArr?arrayEach:baseForOwn)(value,function(subValue,key){result[key]=baseClone(subValue,isDeep,customizer,key,value,stackA,stackB)}),result}var arrayCopy=_dereq_(480),arrayEach=_dereq_(481),baseAssign=_dereq_(489),baseForOwn=_dereq_(505),initCloneArray=_dereq_(557),initCloneByTag=_dereq_(558),initCloneObject=_dereq_(559),isArray=_dereq_(583),isObject=_dereq_(587),argsTag="[object Arguments]",funcTag="[object Function]",objectTag="[object Object]",cloneableTags={};cloneableTags[argsTag]=cloneableTags["[object Array]"]=cloneableTags["[object ArrayBuffer]"]=cloneableTags["[object Boolean]"]=cloneableTags["[object Date]"]=cloneableTags["[object Float32Array]"]=cloneableTags["[object Float64Array]"]=cloneableTags["[object Int8Array]"]=cloneableTags["[object Int16Array]"]=cloneableTags["[object Int32Array]"]=cloneableTags["[object Number]"]=cloneableTags[objectTag]=cloneableTags["[object RegExp]"]=cloneableTags["[object String]"]=cloneableTags["[object Uint8Array]"]=cloneableTags["[object Uint8ClampedArray]"]=cloneableTags["[object Uint16Array]"]=cloneableTags["[object Uint32Array]"]=!0,cloneableTags["[object Error]"]=cloneableTags[funcTag]=cloneableTags["[object Map]"]=cloneableTags["[object Set]"]=cloneableTags["[object WeakMap]"]=!1;var objectProto=Object.prototype,objToString=objectProto.toString;module.exports=baseClone},{480:480,481:481,489:489,505:505,557:557,558:558,559:559,583:583,587:587}],492:[function(_dereq_,module,exports){function baseCompareAscending(value,other){if(value!==other){var valIsNull=null===value,valIsUndef=void 0===value,valIsReflexive=value===value,othIsNull=null===other,othIsUndef=void 0===other,othIsReflexive=other===other;if(value>other&&!othIsNull||!valIsReflexive||valIsNull&&!othIsUndef&&othIsReflexive||valIsUndef&&othIsReflexive)return 1;if(value<other&&!valIsNull||!othIsReflexive||othIsNull&&!valIsUndef&&valIsReflexive||othIsUndef&&valIsReflexive)return-1}return 0}module.exports=baseCompareAscending},{}],493:[function(_dereq_,module,exports){arguments[4][107][0].apply(exports,arguments)},{107:107}],494:[function(_dereq_,module,exports){arguments[4][108][0].apply(exports,arguments)},{108:108,587:587}],495:[function(_dereq_,module,exports){function baseDelay(func,wait,args){if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return setTimeout(function(){func.apply(void 0,args)},wait)}var FUNC_ERROR_TEXT="Expected a function";module.exports=baseDelay},{}],496:[function(_dereq_,module,exports){arguments[4][109][0].apply(exports,arguments)},{109:109,507:507,529:529,539:539}],497:[function(_dereq_,module,exports){arguments[4][110][0].apply(exports,arguments)},{110:110,505:505,536:536}],498:[function(_dereq_,module,exports){function baseEvery(collection,predicate){var result=!0;return baseEach(collection,function(value,index,collection){return result=!!predicate(value,index,collection)}),result}var baseEach=_dereq_(497);module.exports=baseEvery},{497:497}],499:[function(_dereq_,module,exports){arguments[4][111][0].apply(exports,arguments)},{111:111,497:497}],500:[function(_dereq_,module,exports){arguments[4][112][0].apply(exports,arguments)},{112:112}],501:[function(_dereq_,module,exports){arguments[4][113][0].apply(exports,arguments)},{113:113}],502:[function(_dereq_,module,exports){arguments[4][114][0].apply(exports,arguments)},{114:114,485:485,560:560,566:566,582:582,583:583}],503:[function(_dereq_,module,exports){arguments[4][115][0].apply(exports,arguments)},{115:115,537:537}],504:[function(_dereq_,module,exports){function baseForIn(object,iteratee){return baseFor(object,iteratee,keysIn)}var baseFor=_dereq_(503),keysIn=_dereq_(594);module.exports=baseForIn},{503:503,594:594}],505:[function(_dereq_,module,exports){arguments[4][116][0].apply(exports,arguments)},{116:116,503:503,593:593}],506:[function(_dereq_,module,exports){arguments[4][117][0].apply(exports,arguments)},{117:117,578:578}],507:[function(_dereq_,module,exports){arguments[4][118][0].apply(exports,arguments)},{118:118,556:556}],508:[function(_dereq_,module,exports){arguments[4][119][0].apply(exports,arguments)},{119:119,509:509,566:566,587:587}],509:[function(_dereq_,module,exports){arguments[4][120][0].apply(exports,arguments)},{120:120,548:548,549:549,550:550,583:583,590:590}],510:[function(_dereq_,module,exports){arguments[4][121][0].apply(exports,arguments)},{121:121,508:508,578:578}],511:[function(_dereq_,module,exports){function baseLodash(){}module.exports=baseLodash},{}],512:[function(_dereq_,module,exports){arguments[4][122][0].apply(exports,arguments)},{122:122,497:497,560:560}],513:[function(_dereq_,module,exports){arguments[4][123][0].apply(exports,arguments)},{123:123,510:510,554:554,578:578}],514:[function(_dereq_,module,exports){arguments[4][124][0].apply(exports,arguments)},{124:124,454:454,506:506,508:508,521:521,563:563,567:567,578:578,579:579,583:583}],515:[function(_dereq_,module,exports){function baseMerge(object,source,customizer,stackA,stackB){if(!isObject(object))return object;var isSrcArr=isArrayLike(source)&&(isArray(source)||isTypedArray(source)),props=isSrcArr?void 0:keys(source);return arrayEach(props||source,function(srcValue,key){if(props&&(key=srcValue,srcValue=source[key]),isObjectLike(srcValue))stackA||(stackA=[]),stackB||(stackB=[]),baseMergeDeep(object,source,key,baseMerge,customizer,stackA,stackB);else{var value=object[key],result=customizer?customizer(value,srcValue,key,object,source):void 0,isCommon=void 0===result;isCommon&&(result=srcValue),void 0===result&&(!isSrcArr||key in object)||!isCommon&&(result===result?result===value:value!==value)||(object[key]=result)}}),object}var arrayEach=_dereq_(481),baseMergeDeep=_dereq_(516),isArray=_dereq_(583),isArrayLike=_dereq_(560),isObject=_dereq_(587),isObjectLike=_dereq_(566),isTypedArray=_dereq_(590),keys=_dereq_(593);module.exports=baseMerge},{481:481,516:516,560:560,566:566,583:583,587:587,590:590,593:593}],516:[function(_dereq_,module,exports){function baseMergeDeep(object,source,key,mergeFunc,customizer,stackA,stackB){for(var length=stackA.length,srcValue=source[key];length--;)if(stackA[length]==srcValue)return void(object[key]=stackB[length]);var value=object[key],result=customizer?customizer(value,srcValue,key,object,source):void 0,isCommon=void 0===result;isCommon&&(result=srcValue,isArrayLike(srcValue)&&(isArray(srcValue)||isTypedArray(srcValue))?result=isArray(value)?value:isArrayLike(value)?arrayCopy(value):[]:isPlainObject(srcValue)||isArguments(srcValue)?result=isArguments(value)?toPlainObject(value):isPlainObject(value)?value:{}:isCommon=!1),stackA.push(srcValue),stackB.push(result),isCommon?object[key]=mergeFunc(result,srcValue,customizer,stackA,stackB):(result===result?result!==value:value===value)&&(object[key]=result)}var arrayCopy=_dereq_(480),isArguments=_dereq_(582),isArray=_dereq_(583),isArrayLike=_dereq_(560),isPlainObject=_dereq_(588),isTypedArray=_dereq_(590),toPlainObject=_dereq_(591);module.exports=baseMergeDeep},{480:480,560:560,582:582,583:583,588:588,590:590,591:591}],517:[function(_dereq_,module,exports){arguments[4][125][0].apply(exports,arguments)},{125:125}],518:[function(_dereq_,module,exports){arguments[4][126][0].apply(exports,arguments)},{126:126,506:506,579:579}],519:[function(_dereq_,module,exports){function baseReduce(collection,iteratee,accumulator,initFromCollection,eachFunc){return eachFunc(collection,function(value,index,collection){accumulator=initFromCollection?(initFromCollection=!1,value):iteratee(accumulator,value,index,collection)}),accumulator}module.exports=baseReduce},{}],520:[function(_dereq_,module,exports){var identity=_dereq_(601),metaMap=_dereq_(569),baseSetData=metaMap?function(func,data){return metaMap.set(func,data),func}:identity;module.exports=baseSetData},{569:569,601:601}],521:[function(_dereq_,module,exports){arguments[4][127][0].apply(exports,arguments)},{127:127}],522:[function(_dereq_,module,exports){arguments[4][128][0].apply(exports,arguments)},{128:128,497:497}],523:[function(_dereq_,module,exports){function baseSortBy(array,comparer){var length=array.length;for(array.sort(comparer);length--;)array[length]=array[length].value;return array}module.exports=baseSortBy},{}],524:[function(_dereq_,module,exports){arguments[4][129][0].apply(exports,arguments)},{129:129}],525:[function(_dereq_,module,exports){arguments[4][130][0].apply(exports,arguments)},{130:130,507:507,529:529,539:539}],526:[function(_dereq_,module,exports){function baseValues(object,props){for(var index=-1,length=props.length,result=Array(length);++index<length;)result[index]=object[props[index]];return result}module.exports=baseValues},{}],527:[function(_dereq_,module,exports){arguments[4][131][0].apply(exports,arguments)},{131:131,601:601}],528:[function(_dereq_,module,exports){(function(global){function bufferClone(buffer){var result=new ArrayBuffer(buffer.byteLength);return new Uint8Array(result).set(new Uint8Array(buffer)),result}var ArrayBuffer=global.ArrayBuffer,Uint8Array=global.Uint8Array;module.exports=bufferClone}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],529:[function(_dereq_,module,exports){arguments[4][132][0].apply(exports,arguments)},{132:132,587:587}],530:[function(_dereq_,module,exports){arguments[4][133][0].apply(exports,arguments)},{133:133,587:587}],531:[function(_dereq_,module,exports){function compareAscending(object,other){return baseCompareAscending(object.criteria,other.criteria)||object.index-other.index}var baseCompareAscending=_dereq_(492);module.exports=compareAscending},{492:492}],532:[function(_dereq_,module,exports){function composeArgs(args,partials,holders){for(var holdersLength=holders.length,argsIndex=-1,argsLength=nativeMax(args.length-holdersLength,0),leftIndex=-1,leftLength=partials.length,result=Array(leftLength+argsLength);++leftIndex<leftLength;)result[leftIndex]=partials[leftIndex];for(;++argsIndex<holdersLength;)result[holders[argsIndex]]=args[argsIndex];for(;argsLength--;)result[leftIndex++]=args[argsIndex++];return result}var nativeMax=Math.max;module.exports=composeArgs},{}],533:[function(_dereq_,module,exports){function composeArgsRight(args,partials,holders){for(var holdersIndex=-1,holdersLength=holders.length,argsIndex=-1,argsLength=nativeMax(args.length-holdersLength,0),rightIndex=-1,rightLength=partials.length,result=Array(argsLength+rightLength);++argsIndex<argsLength;)result[argsIndex]=args[argsIndex];for(var offset=argsIndex;++rightIndex<rightLength;)result[offset+rightIndex]=partials[rightIndex];for(;++holdersIndex<holdersLength;)result[offset+holders[holdersIndex]]=args[argsIndex++];return result}var nativeMax=Math.max;module.exports=composeArgsRight},{}],534:[function(_dereq_,module,exports){arguments[4][134][0].apply(exports,arguments)},{134:134,490:490,497:497,583:583}],535:[function(_dereq_,module,exports){arguments[4][135][0].apply(exports,arguments)},{135:135,476:476,527:527,562:562}],536:[function(_dereq_,module,exports){arguments[4][136][0].apply(exports,arguments)},{136:136,553:553,565:565,578:578}],537:[function(_dereq_,module,exports){arguments[4][137][0].apply(exports,arguments)},{137:137,578:578}],538:[function(_dereq_,module,exports){(function(global){function createBindWrapper(func,thisArg){function wrapper(){return(this&&this!==global&&this instanceof wrapper?Ctor:func).apply(thisArg,arguments)}var Ctor=createCtorWrapper(func);return wrapper}var createCtorWrapper=_dereq_(540);module.exports=createBindWrapper}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{540:540}],539:[function(_dereq_,module,exports){(function(global){function createCache(values){return nativeCreate&&Set?new SetCache(values):null}var SetCache=_dereq_(479),getNative=_dereq_(555),Set=getNative(global,"Set"),nativeCreate=getNative(Object,"create");module.exports=createCache}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{479:479,555:555}],540:[function(_dereq_,module,exports){function createCtorWrapper(Ctor){return function(){var args=arguments;switch(args.length){case 0:return new Ctor;case 1:return new Ctor(args[0]);case 2:return new Ctor(args[0],args[1]);case 3:return new Ctor(args[0],args[1],args[2]);case 4:return new Ctor(args[0],args[1],args[2],args[3]);case 5:return new Ctor(args[0],args[1],args[2],args[3],args[4]);case 6:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5]);case 7:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5],args[6])}var thisBinding=baseCreate(Ctor.prototype),result=Ctor.apply(thisBinding,args);return isObject(result)?result:thisBinding}}var baseCreate=_dereq_(494),isObject=_dereq_(587);module.exports=createCtorWrapper},{494:494,587:587}],541:[function(_dereq_,module,exports){arguments[4][139][0].apply(exports,arguments)},{139:139,490:490,500:500,501:501,583:583}],542:[function(_dereq_,module,exports){function createFindIndex(fromRight){return function(array,predicate,thisArg){return array&&array.length?(predicate=baseCallback(predicate,thisArg,3),baseFindIndex(array,predicate,fromRight)):-1}}var baseCallback=_dereq_(490),baseFindIndex=_dereq_(501);module.exports=createFindIndex},{490:490,501:501}],543:[function(_dereq_,module,exports){arguments[4][140][0].apply(exports,arguments)},{140:140,527:527,583:583}],544:[function(_dereq_,module,exports){(function(global){function createHybridWrapper(func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity){function wrapper(){for(var length=arguments.length,index=length,args=Array(length);index--;)args[index]=arguments[index];if(partials&&(args=composeArgs(args,partials,holders)),partialsRight&&(args=composeArgsRight(args,partialsRight,holdersRight)),isCurry||isCurryRight){var placeholder=wrapper.placeholder,argsHolders=replaceHolders(args,placeholder);if((length-=argsHolders.length)<arity){var newArgPos=argPos?arrayCopy(argPos):void 0,newArity=nativeMax(arity-length,0),newsHolders=isCurry?argsHolders:void 0,newHoldersRight=isCurry?void 0:argsHolders,newPartials=isCurry?args:void 0,newPartialsRight=isCurry?void 0:args;bitmask|=isCurry?PARTIAL_FLAG:PARTIAL_RIGHT_FLAG,bitmask&=~(isCurry?PARTIAL_RIGHT_FLAG:PARTIAL_FLAG),isCurryBound||(bitmask&=~(BIND_FLAG|BIND_KEY_FLAG));var newData=[func,bitmask,thisArg,newPartials,newsHolders,newPartialsRight,newHoldersRight,newArgPos,ary,newArity],result=createHybridWrapper.apply(void 0,newData);return isLaziable(func)&&setData(result,newData),result.placeholder=placeholder,result}}var thisBinding=isBind?thisArg:this,fn=isBindKey?thisBinding[func]:func;return argPos&&(args=reorder(args,argPos)),isAry&&ary<args.length&&(args.length=ary),this&&this!==global&&this instanceof wrapper&&(fn=Ctor||createCtorWrapper(func)),fn.apply(thisBinding,args)}var isAry=bitmask&ARY_FLAG,isBind=bitmask&BIND_FLAG,isBindKey=bitmask&BIND_KEY_FLAG,isCurry=bitmask&CURRY_FLAG,isCurryBound=bitmask&CURRY_BOUND_FLAG,isCurryRight=bitmask&CURRY_RIGHT_FLAG,Ctor=isBindKey?void 0:createCtorWrapper(func);return wrapper}var arrayCopy=_dereq_(480),composeArgs=_dereq_(532),composeArgsRight=_dereq_(533),createCtorWrapper=_dereq_(540),isLaziable=_dereq_(564),reorder=_dereq_(573),replaceHolders=_dereq_(574),setData=_dereq_(575),BIND_FLAG=1,BIND_KEY_FLAG=2,CURRY_BOUND_FLAG=4,CURRY_FLAG=8,CURRY_RIGHT_FLAG=16,PARTIAL_FLAG=32,PARTIAL_RIGHT_FLAG=64,ARY_FLAG=128,nativeMax=Math.max;module.exports=createHybridWrapper}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{480:480,532:532,533:533,540:540,564:564,573:573,574:574,575:575}],545:[function(_dereq_,module,exports){(function(global){function createPartialWrapper(func,bitmask,thisArg,partials){function wrapper(){for(var argsIndex=-1,argsLength=arguments.length,leftIndex=-1,leftLength=partials.length,args=Array(leftLength+argsLength);++leftIndex<leftLength;)args[leftIndex]=partials[leftIndex];for(;argsLength--;)args[leftIndex++]=arguments[++argsIndex];return(this&&this!==global&&this instanceof wrapper?Ctor:func).apply(isBind?thisArg:this,args)}var isBind=bitmask&BIND_FLAG,Ctor=createCtorWrapper(func);return wrapper}var createCtorWrapper=_dereq_(540),BIND_FLAG=1;module.exports=createPartialWrapper}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{540:540}],546:[function(_dereq_,module,exports){function createReduce(arrayFunc,eachFunc){return function(collection,iteratee,accumulator,thisArg){var initFromArray=arguments.length<3;return"function"==typeof iteratee&&void 0===thisArg&&isArray(collection)?arrayFunc(collection,iteratee,accumulator,initFromArray):baseReduce(collection,baseCallback(iteratee,thisArg,4),accumulator,initFromArray,eachFunc)}}var baseCallback=_dereq_(490),baseReduce=_dereq_(519),isArray=_dereq_(583);module.exports=createReduce},{490:490,519:519,583:583}],547:[function(_dereq_,module,exports){function createWrapper(func,bitmask,thisArg,partials,holders,argPos,ary,arity){var isBindKey=bitmask&BIND_KEY_FLAG;if(!isBindKey&&"function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);var length=partials?partials.length:0;if(length||(bitmask&=~(PARTIAL_FLAG|PARTIAL_RIGHT_FLAG),partials=holders=void 0),length-=holders?holders.length:0,bitmask&PARTIAL_RIGHT_FLAG){var partialsRight=partials,holdersRight=holders;partials=holders=void 0}var data=isBindKey?void 0:getData(func),newData=[func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity];if(data&&(mergeData(newData,data),bitmask=newData[1],arity=newData[9]),newData[9]=null==arity?isBindKey?0:func.length:nativeMax(arity-length,0)||0,bitmask==BIND_FLAG)var result=createBindWrapper(newData[0],newData[2]);else result=bitmask!=PARTIAL_FLAG&&bitmask!=(BIND_FLAG|PARTIAL_FLAG)||newData[4].length?createHybridWrapper.apply(void 0,newData):createPartialWrapper.apply(void 0,newData);return(data?baseSetData:setData)(result,newData)}var baseSetData=_dereq_(520),createBindWrapper=_dereq_(538),createHybridWrapper=_dereq_(544),createPartialWrapper=_dereq_(545),getData=_dereq_(551),mergeData=_dereq_(568),setData=_dereq_(575),BIND_FLAG=1,BIND_KEY_FLAG=2,PARTIAL_FLAG=32,PARTIAL_RIGHT_FLAG=64,FUNC_ERROR_TEXT="Expected a function",nativeMax=Math.max;module.exports=createWrapper},{520:520,538:538,544:544,545:545,551:551,568:568,575:575}],548:[function(_dereq_,module,exports){arguments[4][141][0].apply(exports,arguments)},{141:141,487:487}],549:[function(_dereq_,module,exports){arguments[4][142][0].apply(exports,arguments)},{142:142}],550:[function(_dereq_,module,exports){arguments[4][143][0].apply(exports,arguments)},{143:143,593:593}],551:[function(_dereq_,module,exports){var metaMap=_dereq_(569),noop=_dereq_(602),getData=metaMap?function(func){return metaMap.get(func)}:noop;module.exports=getData},{569:569,602:602}],552:[function(_dereq_,module,exports){function getFuncName(func){for(var result=func.name+"",array=realNames[result],length=array?array.length:0;length--;){var data=array[length],otherFunc=data.func;if(null==otherFunc||otherFunc==func)return data.name}return result}var realNames=_dereq_(572);module.exports=getFuncName},{572:572}],553:[function(_dereq_,module,exports){arguments[4][144][0].apply(exports,arguments)},{144:144,517:517}],554:[function(_dereq_,module,exports){arguments[4][145][0].apply(exports,arguments)},{145:145,567:567,597:597}],555:[function(_dereq_,module,exports){arguments[4][146][0].apply(exports,arguments)},{146:146,585:585}],556:[function(_dereq_,module,exports){arguments[4][147][0].apply(exports,arguments)},{147:147}],557:[function(_dereq_,module,exports){function initCloneArray(array){var length=array.length,result=new array.constructor(length);return length&&"string"==typeof array[0]&&hasOwnProperty.call(array,"index")&&(result.index=array.index,result.input=array.input),result}var objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty;module.exports=initCloneArray},{}],558:[function(_dereq_,module,exports){function initCloneByTag(object,tag,isDeep){var Ctor=object.constructor;switch(tag){case arrayBufferTag:return bufferClone(object);case boolTag:case dateTag:return new Ctor(+object);case float32Tag:case float64Tag:case int8Tag:case int16Tag:case int32Tag:case uint8Tag:case uint8ClampedTag:case uint16Tag:case uint32Tag:var buffer=object.buffer;return new Ctor(isDeep?bufferClone(buffer):buffer,object.byteOffset,object.length);case numberTag:case stringTag:return new Ctor(object);case regexpTag:var result=new Ctor(object.source,reFlags.exec(object));result.lastIndex=object.lastIndex}return result}var bufferClone=_dereq_(528),boolTag="[object Boolean]",dateTag="[object Date]",numberTag="[object Number]",regexpTag="[object RegExp]",stringTag="[object String]",arrayBufferTag="[object ArrayBuffer]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",reFlags=/\w*$/;module.exports=initCloneByTag},{528:528}],559:[function(_dereq_,module,exports){function initCloneObject(object){var Ctor=object.constructor;return"function"==typeof Ctor&&Ctor instanceof Ctor||(Ctor=Object),new Ctor}module.exports=initCloneObject},{}],560:[function(_dereq_,module,exports){arguments[4][148][0].apply(exports,arguments)},{148:148,553:553,565:565}],561:[function(_dereq_,module,exports){arguments[4][149][0].apply(exports,arguments)},{149:149}],562:[function(_dereq_,module,exports){arguments[4][150][0].apply(exports,arguments)},{150:150,560:560,561:561,587:587}],563:[function(_dereq_,module,exports){arguments[4][151][0].apply(exports,arguments)},{151:151,578:578,583:583}],564:[function(_dereq_,module,exports){function isLaziable(func){var funcName=getFuncName(func),other=lodash[funcName];if("function"!=typeof other||!(funcName in LazyWrapper.prototype))return!1;if(func===other)return!0;var data=getData(other);return!!data&&func===data[0]}var LazyWrapper=_dereq_(477),getData=_dereq_(551),getFuncName=_dereq_(552),lodash=_dereq_(459);module.exports=isLaziable},{459:459,477:477,551:551,552:552}],565:[function(_dereq_,module,exports){arguments[4][152][0].apply(exports,arguments)},{152:152}],566:[function(_dereq_,module,exports){arguments[4][153][0].apply(exports,arguments)},{153:153}],567:[function(_dereq_,module,exports){arguments[4][154][0].apply(exports,arguments)},{154:154,587:587}],568:[function(_dereq_,module,exports){function mergeData(data,source){var bitmask=data[1],srcBitmask=source[1],newBitmask=bitmask|srcBitmask,isCommon=newBitmask<ARY_FLAG,isCombo=srcBitmask==ARY_FLAG&&bitmask==CURRY_FLAG||srcBitmask==ARY_FLAG&&bitmask==REARG_FLAG&&data[7].length<=source[8]||srcBitmask==(ARY_FLAG|REARG_FLAG)&&bitmask==CURRY_FLAG;if(!isCommon&&!isCombo)return data;srcBitmask&BIND_FLAG&&(data[2]=source[2],newBitmask|=bitmask&BIND_FLAG?0:CURRY_BOUND_FLAG);var value=source[3];if(value){var partials=data[3];data[3]=partials?composeArgs(partials,value,source[4]):arrayCopy(value),data[4]=partials?replaceHolders(data[3],PLACEHOLDER):arrayCopy(source[4])}return value=source[5],value&&(partials=data[5],data[5]=partials?composeArgsRight(partials,value,source[6]):arrayCopy(value),data[6]=partials?replaceHolders(data[5],PLACEHOLDER):arrayCopy(source[6])),value=source[7],value&&(data[7]=arrayCopy(value)),srcBitmask&ARY_FLAG&&(data[8]=null==data[8]?source[8]:nativeMin(data[8],source[8])),null==data[9]&&(data[9]=source[9]),data[0]=source[0],data[1]=newBitmask,data}var arrayCopy=_dereq_(480),composeArgs=_dereq_(532),composeArgsRight=_dereq_(533),replaceHolders=_dereq_(574),BIND_FLAG=1,CURRY_BOUND_FLAG=4,CURRY_FLAG=8,ARY_FLAG=128,REARG_FLAG=256,PLACEHOLDER="__lodash_placeholder__",nativeMin=Math.min;module.exports=mergeData},{480:480,532:532,533:533,574:574}],569:[function(_dereq_,module,exports){(function(global){var getNative=_dereq_(555),WeakMap=getNative(global,"WeakMap"),metaMap=WeakMap&&new WeakMap;module.exports=metaMap}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{555:555}],570:[function(_dereq_,module,exports){function pickByArray(object,props){object=toObject(object);for(var index=-1,length=props.length,result={};++index<length;){var key=props[index];key in object&&(result[key]=object[key])}return result}var toObject=_dereq_(578);module.exports=pickByArray},{578:578}],571:[function(_dereq_,module,exports){function pickByCallback(object,predicate){var result={};return baseForIn(object,function(value,key,object){predicate(value,key,object)&&(result[key]=value)}),result}var baseForIn=_dereq_(504);module.exports=pickByCallback},{504:504}],572:[function(_dereq_,module,exports){var realNames={};module.exports=realNames},{}],573:[function(_dereq_,module,exports){function reorder(array,indexes){for(var arrLength=array.length,length=nativeMin(indexes.length,arrLength),oldArray=arrayCopy(array);length--;){var index=indexes[length];array[length]=isIndex(index,arrLength)?oldArray[index]:void 0}return array}var arrayCopy=_dereq_(480),isIndex=_dereq_(561),nativeMin=Math.min;module.exports=reorder},{480:480,561:561}],574:[function(_dereq_,module,exports){function replaceHolders(array,placeholder){for(var index=-1,length=array.length,resIndex=-1,result=[];++index<length;)array[index]===placeholder&&(array[index]=PLACEHOLDER,result[++resIndex]=index);return result}var PLACEHOLDER="__lodash_placeholder__";module.exports=replaceHolders},{}],575:[function(_dereq_,module,exports){var baseSetData=_dereq_(520),now=_dereq_(472),setData=function(){var count=0,lastCalled=0;return function(key,value){var stamp=now(),remaining=16-(stamp-lastCalled);if(lastCalled=stamp,remaining>0){if(++count>=150)return key}else count=0;return baseSetData(key,value)}}();module.exports=setData},{472:472,520:520}],576:[function(_dereq_,module,exports){arguments[4][155][0].apply(exports,arguments)},{155:155,561:561,565:565,582:582,583:583,594:594}],577:[function(_dereq_,module,exports){function sortedUniq(array,iteratee){for(var seen,index=-1,length=array.length,resIndex=-1,result=[];++index<length;){var value=array[index],computed=iteratee?iteratee(value,index,array):value;index&&seen===computed||(seen=computed,result[++resIndex]=value)}return result}module.exports=sortedUniq},{}],578:[function(_dereq_,module,exports){arguments[4][156][0].apply(exports,arguments)},{156:156,587:587}],579:[function(_dereq_,module,exports){arguments[4][157][0].apply(exports,arguments)},{157:157,524:524,583:583}],580:[function(_dereq_,module,exports){function wrapperClone(wrapper){return wrapper instanceof LazyWrapper?wrapper.clone():new LodashWrapper(wrapper.__wrapped__,wrapper.__chain__,arrayCopy(wrapper.__actions__))}var LazyWrapper=_dereq_(477),LodashWrapper=_dereq_(478),arrayCopy=_dereq_(480);module.exports=wrapperClone},{477:477,478:478,480:480}],581:[function(_dereq_,module,exports){function clone(value,isDeep,customizer,thisArg){return isDeep&&"boolean"!=typeof isDeep&&isIterateeCall(value,isDeep,customizer)?isDeep=!1:"function"==typeof isDeep&&(thisArg=customizer,customizer=isDeep,isDeep=!1),"function"==typeof customizer?baseClone(value,isDeep,bindCallback(customizer,thisArg,3)):baseClone(value,isDeep)}var baseClone=_dereq_(491),bindCallback=_dereq_(527),isIterateeCall=_dereq_(562);module.exports=clone},{491:491,527:527,562:562}],582:[function(_dereq_,module,exports){arguments[4][158][0].apply(exports,arguments)},{158:158,560:560,566:566}],583:[function(_dereq_,module,exports){arguments[4][159][0].apply(exports,arguments)},{159:159,555:555,565:565,566:566}],584:[function(_dereq_,module,exports){arguments[4][161][0].apply(exports,arguments)},{161:161,587:587}],585:[function(_dereq_,module,exports){arguments[4][162][0].apply(exports,arguments)},{162:162,566:566,584:584}],586:[function(_dereq_,module,exports){function isNumber(value){return"number"==typeof value||isObjectLike(value)&&objToString.call(value)==numberTag}var isObjectLike=_dereq_(566),numberTag="[object Number]",objectProto=Object.prototype,objToString=objectProto.toString;module.exports=isNumber},{566:566}],587:[function(_dereq_,module,exports){arguments[4][163][0].apply(exports,arguments)},{163:163}],588:[function(_dereq_,module,exports){function isPlainObject(value){var Ctor;if(!isObjectLike(value)||objToString.call(value)!=objectTag||isArguments(value)||!hasOwnProperty.call(value,"constructor")&&"function"==typeof(Ctor=value.constructor)&&!(Ctor instanceof Ctor))return!1;var result;return baseForIn(value,function(subValue,key){result=key}),void 0===result||hasOwnProperty.call(value,result)}var baseForIn=_dereq_(504),isArguments=_dereq_(582),isObjectLike=_dereq_(566),objectTag="[object Object]",objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,objToString=objectProto.toString;module.exports=isPlainObject},{504:504,566:566,582:582}],589:[function(_dereq_,module,exports){arguments[4][164][0].apply(exports,arguments)},{164:164,566:566}],590:[function(_dereq_,module,exports){arguments[4][165][0].apply(exports,arguments)},{165:165,565:565,
566:566}],591:[function(_dereq_,module,exports){function toPlainObject(value){return baseCopy(value,keysIn(value))}var baseCopy=_dereq_(493),keysIn=_dereq_(594);module.exports=toPlainObject},{493:493,594:594}],592:[function(_dereq_,module,exports){arguments[4][166][0].apply(exports,arguments)},{166:166,488:488,489:489,535:535}],593:[function(_dereq_,module,exports){arguments[4][168][0].apply(exports,arguments)},{168:168,555:555,560:560,576:576,587:587}],594:[function(_dereq_,module,exports){arguments[4][169][0].apply(exports,arguments)},{169:169,561:561,565:565,582:582,583:583,587:587}],595:[function(_dereq_,module,exports){var baseMerge=_dereq_(515),createAssigner=_dereq_(535),merge=createAssigner(baseMerge);module.exports=merge},{515:515,535:535}],596:[function(_dereq_,module,exports){var arrayMap=_dereq_(484),baseDifference=_dereq_(496),baseFlatten=_dereq_(502),bindCallback=_dereq_(527),keysIn=_dereq_(594),pickByArray=_dereq_(570),pickByCallback=_dereq_(571),restParam=_dereq_(476),omit=restParam(function(object,props){if(null==object)return{};if("function"!=typeof props[0]){var props=arrayMap(baseFlatten(props),String);return pickByArray(object,baseDifference(keysIn(object),props))}var predicate=bindCallback(props[0],props[1],3);return pickByCallback(object,function(value,key,object){return!predicate(value,key,object)})});module.exports=omit},{476:476,484:484,496:496,502:502,527:527,570:570,571:571,594:594}],597:[function(_dereq_,module,exports){arguments[4][170][0].apply(exports,arguments)},{170:170,578:578,593:593}],598:[function(_dereq_,module,exports){var baseFlatten=_dereq_(502),bindCallback=_dereq_(527),pickByArray=_dereq_(570),pickByCallback=_dereq_(571),restParam=_dereq_(476),pick=restParam(function(object,props){return null==object?{}:"function"==typeof props[0]?pickByCallback(object,bindCallback(props[0],props[1],3)):pickByArray(object,baseFlatten(props))});module.exports=pick},{476:476,502:502,527:527,570:570,571:571}],599:[function(_dereq_,module,exports){arguments[4][171][0].apply(exports,arguments)},{171:171,481:481,490:490,494:494,505:505,583:583,584:584,587:587,590:590}],600:[function(_dereq_,module,exports){function values(object){return baseValues(object,keys(object))}var baseValues=_dereq_(526),keys=_dereq_(593);module.exports=values},{526:526,593:593}],601:[function(_dereq_,module,exports){arguments[4][172][0].apply(exports,arguments)},{172:172}],602:[function(_dereq_,module,exports){function noop(){}module.exports=noop},{}],603:[function(_dereq_,module,exports){arguments[4][173][0].apply(exports,arguments)},{173:173,517:517,518:518,563:563}],604:[function(_dereq_,module,exports){arguments[4][174][0].apply(exports,arguments)},{174:174}],605:[function(_dereq_,module,exports){arguments[4][175][0].apply(exports,arguments)},{175:175,278:278}],606:[function(_dereq_,module,exports){arguments[4][176][0].apply(exports,arguments)},{176:176}],607:[function(_dereq_,module,exports){arguments[4][177][0].apply(exports,arguments)},{177:177,279:279}],608:[function(_dereq_,module,exports){arguments[4][178][0].apply(exports,arguments)},{178:178,280:280}],609:[function(_dereq_,module,exports){arguments[4][179][0].apply(exports,arguments)},{179:179,446:446}],610:[function(_dereq_,module,exports){arguments[4][180][0].apply(exports,arguments)},{180:180,283:283}],611:[function(_dereq_,module,exports){arguments[4][181][0].apply(exports,arguments)},{181:181,285:285}],612:[function(_dereq_,module,exports){arguments[4][182][0].apply(exports,arguments)},{182:182,286:286}],613:[function(_dereq_,module,exports){arguments[4][183][0].apply(exports,arguments)},{183:183}],614:[function(_dereq_,module,exports){"use strict";function capitalize(string){return string.charAt(0).toUpperCase()+string.slice(1)}function lower(string){return string.charAt(0).toLowerCase()+string.slice(1)}function hasLowerCaseAlias(pkg){return pkg.xml&&"lowerCase"===pkg.xml.tagAlias}function serializeFormat(element){return element.xml&&element.xml.serialize}module.exports.aliasToName=function(alias,pkg){return hasLowerCaseAlias(pkg)?capitalize(alias):alias},module.exports.nameToAlias=function(name,pkg){return hasLowerCaseAlias(pkg)?lower(name):name},module.exports.DEFAULT_NS_MAP={xsi:"http://www.w3.org/2001/XMLSchema-instance"};var XSI_TYPE=module.exports.XSI_TYPE="xsi:type";module.exports.serializeAsType=function(element){return serializeFormat(element)===XSI_TYPE},module.exports.serializeAsProperty=function(element){return"property"===serializeFormat(element)}},{}],615:[function(_dereq_,module,exports){"use strict";function parseNodeAttributes(node){var nodeAttrs=node.attributes;return reduce(nodeAttrs,function(result,v,k){var name,ns;return v.local?(ns=parseNameNs(v.name,v.prefix),name=ns.name):name=v.prefix,result[name]=v.value,result},{})}function normalizeType(node,attr,model){var typePrefix,nameNs=parseNameNs(attr.value),uri=node.ns[nameNs.prefix||""],localName=nameNs.localName,pkg=uri&&model.getPackage(uri);pkg&&(typePrefix=pkg.xml&&pkg.xml.typePrefix,typePrefix&&0===localName.indexOf(typePrefix)&&(localName=localName.slice(typePrefix.length)),attr.value=pkg.prefix+":"+localName)}function normalizeNamespaces(node,model,defaultNsUri){var uri,prefix;if(uri=node.uri||defaultNsUri){var pkg=model.getPackage(uri);prefix=pkg?pkg.prefix:node.prefix,node.prefix=prefix,node.uri=uri}forEach(node.attributes,function(attr){attr.uri===XSI_URI&&"type"===attr.local&&normalizeType(node,attr,model),normalizeNamespaces(attr,model,null)})}function error(message){return new Error(message)}function getModdleDescriptor(element){return element.$descriptor}function Context(options){assign(this,options),this.elementsById={},this.references=[],this.warnings=[],this.addReference=function(reference){this.references.push(reference)},this.addElement=function(element){if(!element)throw error("expected element");var id,elementsById=this.elementsById,descriptor=getModdleDescriptor(element),idProperty=descriptor.idProperty;if(idProperty&&(id=element.get(idProperty.name))){if(elementsById[id])throw error("duplicate ID <"+id+">");elementsById[id]=element}},this.addWarning=function(warning){this.warnings.push(warning)}}function BaseHandler(){}function NoopHandler(){}function BodyHandler(){}function ReferenceHandler(property,context){this.property=property,this.context=context}function ValueHandler(propertyDesc,element){this.element=element,this.propertyDesc=propertyDesc}function BaseElementHandler(){}function ElementHandler(model,type,context){this.model=model,this.type=model.getType(type),this.context=context}function GenericElementHandler(model,type,context){this.model=model,this.context=context}function XMLReader(options){options instanceof Moddle&&(options={model:options}),assign(this,{lax:!1},options)}var reduce=_dereq_(468),forEach=_dereq_(464),find=_dereq_(463),assign=_dereq_(592),defer=_dereq_(475),Stack=_dereq_(631),SaxParser=_dereq_(629).parser,Moddle=_dereq_(617),parseNameNs=_dereq_(622).parseName,Types=_dereq_(625),coerceType=Types.coerceType,isSimpleType=Types.isSimple,common=_dereq_(614),XSI_TYPE=common.XSI_TYPE,XSI_URI=common.DEFAULT_NS_MAP.xsi,serializeAsType=common.serializeAsType,aliasToName=common.aliasToName;BaseHandler.prototype.handleEnd=function(){},BaseHandler.prototype.handleText=function(){},BaseHandler.prototype.handleNode=function(){},NoopHandler.prototype=new BaseHandler,NoopHandler.prototype.handleNode=function(){return this},BodyHandler.prototype=new BaseHandler,BodyHandler.prototype.handleText=function(text){this.body=(this.body||"")+text},ReferenceHandler.prototype=new BodyHandler,ReferenceHandler.prototype.handleNode=function(node){if(this.element)throw error("expected no sub nodes");return this.element=this.createReference(node),this},ReferenceHandler.prototype.handleEnd=function(){this.element.id=this.body},ReferenceHandler.prototype.createReference=function(node){return{property:this.property.ns.name,id:""}},ValueHandler.prototype=new BodyHandler,ValueHandler.prototype.handleEnd=function(){var value=this.body,element=this.element,propertyDesc=this.propertyDesc;value=coerceType(propertyDesc.type,value),propertyDesc.isMany?element.get(propertyDesc.name).push(value):element.set(propertyDesc.name,value)},BaseElementHandler.prototype=Object.create(BodyHandler.prototype),BaseElementHandler.prototype.handleNode=function(node){var parser=this,element=this.element;return element?parser=this.handleChild(node):(element=this.element=this.createElement(node),this.context.addElement(element)),parser},ElementHandler.prototype=new BaseElementHandler,ElementHandler.prototype.addReference=function(reference){this.context.addReference(reference)},ElementHandler.prototype.handleEnd=function(){var value=this.body,element=this.element,descriptor=getModdleDescriptor(element),bodyProperty=descriptor.bodyProperty;bodyProperty&&void 0!==value&&(value=coerceType(bodyProperty.type,value),element.set(bodyProperty.name,value))},ElementHandler.prototype.createElement=function(node){var attributes=parseNodeAttributes(node),Type=this.type,descriptor=getModdleDescriptor(Type),context=this.context,instance=new Type({});return forEach(attributes,function(value,name){var values,prop=descriptor.propertiesByName[name];prop&&prop.isReference?prop.isMany?(values=value.split(" "),forEach(values,function(v){context.addReference({element:instance,property:prop.ns.name,id:v})})):context.addReference({element:instance,property:prop.ns.name,id:value}):(prop&&(value=coerceType(prop.type,value)),instance.set(name,value))}),instance},ElementHandler.prototype.getPropertyForNode=function(node){var elementTypeName,elementType,typeAnnotation,nameNs=parseNameNs(node.local,node.prefix),type=this.type,model=this.model,descriptor=getModdleDescriptor(type),propertyName=nameNs.name,property=descriptor.propertiesByName[propertyName];if(property)return serializeAsType(property)&&(typeAnnotation=node.attributes[XSI_TYPE])?(elementTypeName=typeAnnotation.value,elementType=model.getType(elementTypeName),assign({},property,{effectiveType:getModdleDescriptor(elementType).name})):property;if(model.getPackage(nameNs.prefix)){if(elementTypeName=nameNs.prefix+":"+aliasToName(nameNs.localName,descriptor.$pkg),elementType=model.getType(elementTypeName),property=find(descriptor.properties,function(p){return!p.isVirtual&&!p.isReference&&!p.isAttribute&&elementType.hasType(p.type)}))return assign({},property,{effectiveType:getModdleDescriptor(elementType).name})}else if(property=find(descriptor.properties,function(p){return!p.isReference&&!p.isAttribute&&"Element"===p.type}))return property;throw error("unrecognized element <"+nameNs.name+">")},ElementHandler.prototype.toString=function(){return"ElementDescriptor["+getModdleDescriptor(this.type).name+"]"},ElementHandler.prototype.valueHandler=function(propertyDesc,element){return new ValueHandler(propertyDesc,element)},ElementHandler.prototype.referenceHandler=function(propertyDesc){return new ReferenceHandler(propertyDesc,this.context)},ElementHandler.prototype.handler=function(type){return"Element"===type?new GenericElementHandler(this.model,type,this.context):new ElementHandler(this.model,type,this.context)},ElementHandler.prototype.handleChild=function(node){var propertyDesc,type,element,childHandler;if(propertyDesc=this.getPropertyForNode(node),element=this.element,type=propertyDesc.effectiveType||propertyDesc.type,isSimpleType(type))return this.valueHandler(propertyDesc,element);childHandler=propertyDesc.isReference?this.referenceHandler(propertyDesc).handleNode(node):this.handler(type).handleNode(node);var newElement=childHandler.element;return void 0!==newElement&&(propertyDesc.isMany?element.get(propertyDesc.name).push(newElement):element.set(propertyDesc.name,newElement),propertyDesc.isReference?(assign(newElement,{element:element}),this.context.addReference(newElement)):newElement.$parent=element),childHandler},GenericElementHandler.prototype=Object.create(BaseElementHandler.prototype),GenericElementHandler.prototype.createElement=function(node){var name=node.name,prefix=node.prefix,uri=node.ns[prefix],attributes=node.attributes;return this.model.createAny(name,uri,attributes)},GenericElementHandler.prototype.handleChild=function(node){var children,handler=new GenericElementHandler(this.model,"Element",this.context).handleNode(node),element=this.element,newElement=handler.element;return void 0!==newElement&&(children=element.$children=element.$children||[],children.push(newElement),newElement.$parent=element),handler},GenericElementHandler.prototype.handleText=function(text){this.body=this.body||""+text},GenericElementHandler.prototype.handleEnd=function(){this.body&&(this.element.$body=this.body)},XMLReader.prototype.fromXML=function(xml,options,done){function resolveReferences(){var i,r,elementsById=context.elementsById,references=context.references;for(i=0;r=references[i];i++){var element=r.element,reference=elementsById[r.id],property=getModdleDescriptor(element).propertiesByName[r.property];if(reference||context.addWarning({message:"unresolved reference <"+r.id+">",element:r.element,property:r.property,value:r.id}),property.isMany){var collection=element.get(property.name),idx=collection.indexOf(r);-1===idx&&(idx=collection.length),reference?collection[idx]=reference:collection.splice(idx,1)}else element.set(property.name,reference)}}function handleClose(tagName){stack.pop().handleEnd()}function handleOpen(node){var handler=stack.peek();normalizeNamespaces(node,model);try{stack.push(handler.handleNode(node))}catch(e){var line=this.line,column=this.column,message="unparsable content <"+node.name+"> detected\n\tline: "+line+"\n\tcolumn: "+column+"\n\tnested error: "+e.message;if(!lax)throw console.error("could not parse document"),console.error(e),error(message);context.addWarning({message:message,error:e}),console.warn("could not parse node"),console.warn(e),stack.push(new NoopHandler)}}function handleText(text){stack.peek().handleText(text)}var rootHandler=options.rootHandler;options instanceof ElementHandler?(rootHandler=options,options={}):"string"==typeof options?(rootHandler=this.handler(options),options={}):"string"==typeof rootHandler&&(rootHandler=this.handler(rootHandler));var model=this.model,lax=this.lax,context=new Context(assign({},options,{rootHandler:rootHandler})),parser=new SaxParser(!0,{xmlns:!0,trim:!0}),stack=new Stack;rootHandler.context=context,stack.push(rootHandler),parser.onopentag=handleOpen,parser.oncdata=parser.ontext=handleText,parser.onclosetag=handleClose,parser.onend=resolveReferences,defer(function(){var error;try{parser.write(xml).close()}catch(e){error=e}done(error,error?void 0:rootHandler.element,context)})},XMLReader.prototype.handler=function(name){return new ElementHandler(this.model,name)},module.exports=XMLReader,module.exports.ElementHandler=ElementHandler},{463:463,464:464,468:468,475:475,592:592,614:614,617:617,622:622,625:625,629:629,631:631}],616:[function(_dereq_,module,exports){"use strict";function nsName(ns){return isString(ns)?ns:(ns.prefix?ns.prefix+":":"")+ns.localName}function getNsAttrs(namespaces){function isUsed(ns){return namespaces.used[ns.uri]}function toAttr(ns){return{name:"xmlns"+(ns.prefix?":"+ns.prefix:""),value:ns.uri}}var allNs=[].concat(namespaces.wellknown,namespaces.custom);return map(filter(allNs,isUsed),toAttr)}function getElementNs(ns,descriptor){return descriptor.isGeneric?descriptor.name:assign({localName:nameToAlias(descriptor.ns.localName,descriptor.$pkg)},ns)}function getPropertyNs(ns,descriptor){return assign({localName:descriptor.ns.localName},ns)}function getSerializableProperties(element){var descriptor=element.$descriptor;return filter(descriptor.properties,function(p){var name=p.name;if(p.isVirtual)return!1;if(!element.hasOwnProperty(name))return!1;var value=element[name];return value!==p.default&&(null!==value&&(!p.isMany||value.length))})}function escapeAttr(str){return str=isString(str)?str:""+str,str.replace(ESCAPE_CHARS,function(str){return"&#"+ESCAPE_MAP[str]+";"})}function filterAttributes(props){return filter(props,function(p){return p.isAttr})}function filterContained(props){return filter(props,function(p){return!p.isAttr})}function ReferenceSerializer(parent,ns){this.ns=ns}function BodySerializer(){}function ValueSerializer(ns){this.ns=ns}function ElementSerializer(parent,ns){this.body=[],this.attrs=[],this.parent=parent,this.ns=ns}function TypeSerializer(parent,ns){ElementSerializer.call(this,parent,ns)}function SavingWriter(){this.value="",this.write=function(str){this.value+=str}}function FormatingWriter(out,format){var indent=[""];this.append=function(str){return out.write(str),this},this.appendNewLine=function(){return format&&out.write("\n"),this},this.appendIndent=function(){return format&&out.write(indent.join("  ")),this},this.indent=function(){return indent.push(""),this},this.unindent=function(){return indent.pop(),this}}function XMLWriter(options){function toXML(tree,writer){var internalWriter=writer||new SavingWriter,formatingWriter=new FormatingWriter(internalWriter,options.format);if(options.preamble&&formatingWriter.append(XML_PREAMBLE),(new ElementSerializer).build(tree).serializeTo(formatingWriter),!writer)return internalWriter.value}return options=assign({format:!1,preamble:!0},options||{}),{toXML:toXML}}var map=_dereq_(467),forEach=_dereq_(464),isString=_dereq_(589),filter=_dereq_(462),assign=_dereq_(592),Types=_dereq_(625),parseNameNs=_dereq_(622).parseName,common=_dereq_(614),nameToAlias=common.nameToAlias,serializeAsType=common.serializeAsType,serializeAsProperty=common.serializeAsProperty,XML_PREAMBLE='<?xml version="1.0" encoding="UTF-8"?>\n',ESCAPE_CHARS=/(<|>|'|"|&|\n\r|\n)/g,DEFAULT_NS_MAP=common.DEFAULT_NS_MAP,XSI_TYPE=common.XSI_TYPE,ESCAPE_MAP={"\n":"10","\n\r":"10",'"':"34","'":"39","<":"60",">":"62","&":"38"};ReferenceSerializer.prototype.build=function(element){return this.element=element,this},ReferenceSerializer.prototype.serializeTo=function(writer){writer.appendIndent().append("<"+nsName(this.ns)+">"+this.element.id+"</"+nsName(this.ns)+">").appendNewLine()},BodySerializer.prototype.serializeValue=BodySerializer.prototype.serializeTo=function(writer){var escape=this.escape;escape&&writer.append("<![CDATA["),writer.append(this.value),escape&&writer.append("]]>")},BodySerializer.prototype.build=function(prop,value){return this.value=value,"String"===prop.type&&-1!==value.search(ESCAPE_CHARS)&&(this.escape=!0),this},ValueSerializer.prototype=new BodySerializer,ValueSerializer.prototype.serializeTo=function(writer){writer.appendIndent().append("<"+nsName(this.ns)+">"),this.serializeValue(writer),writer.append("</"+nsName(this.ns)+">").appendNewLine()},ElementSerializer.prototype.build=function(element){this.element=element;var otherAttrs=this.parseNsAttributes(element);if(this.ns||(this.ns=this.nsTagName(element.$descriptor)),element.$descriptor.isGeneric)this.parseGeneric(element);else{var properties=getSerializableProperties(element);this.parseAttributes(filterAttributes(properties)),this.parseContainments(filterContained(properties)),this.parseGenericAttributes(element,otherAttrs)}return this},ElementSerializer.prototype.nsTagName=function(descriptor){return getElementNs(this.logNamespaceUsed(descriptor.ns),descriptor)},ElementSerializer.prototype.nsPropertyTagName=function(descriptor){return getPropertyNs(this.logNamespaceUsed(descriptor.ns),descriptor)},ElementSerializer.prototype.isLocalNs=function(ns){return ns.uri===this.ns.uri},ElementSerializer.prototype.nsAttributeName=function(element){var ns;if(ns=isString(element)?parseNameNs(element):element.ns,element.inherited)return{localName:ns.localName};var effectiveNs=this.logNamespaceUsed(ns);return this.isLocalNs(effectiveNs)?{localName:ns.localName}:assign({localName:ns.localName},effectiveNs)},ElementSerializer.prototype.parseGeneric=function(element){var self=this,body=this.body,attrs=this.attrs;forEach(element,function(val,key){"$body"===key?body.push((new BodySerializer).build({type:"String"},val)):"$children"===key?forEach(val,function(child){body.push(new ElementSerializer(self).build(child))}):0!==key.indexOf("$")&&attrs.push({name:key,value:escapeAttr(val)})})},ElementSerializer.prototype.parseNsAttributes=function(element){var self=this,genericAttrs=element.$attrs,model=element.$model,attributes=[];return forEach(genericAttrs,function(value,name){var ns,nameNs=parseNameNs(name);"xmlns"===nameNs.prefix&&(ns={prefix:nameNs.localName,uri:value}),nameNs.prefix||"xmlns"!==nameNs.localName||(ns={uri:value}),ns?model.getPackage(value)?self.logNamespace(ns,!0):self.logNamespaceUsed(ns):attributes.push({name:name,value:value})}),attributes},ElementSerializer.prototype.parseGenericAttributes=function(element,attributes){var self=this;forEach(attributes,function(attr){if(attr.name!==XSI_TYPE)try{self.addAttribute(self.nsAttributeName(attr.name),attr.value)}catch(e){console.warn("missing namespace information for ",attr.name,"=",attr.value,"on",element,e)}})},ElementSerializer.prototype.parseContainments=function(properties){var self=this,body=this.body,element=this.element;forEach(properties,function(p){var value=element.get(p.name),isReference=p.isReference,isMany=p.isMany,ns=self.nsPropertyTagName(p);if(isMany||(value=[value]),p.isBody)body.push((new BodySerializer).build(p,value[0]));else if(Types.isSimple(p.type))forEach(value,function(v){body.push(new ValueSerializer(ns).build(p,v))});else if(isReference)forEach(value,function(v){body.push(new ReferenceSerializer(self,ns).build(v))});else{var asType=serializeAsType(p),asProperty=serializeAsProperty(p);forEach(value,function(v){var serializer;serializer=asType?new TypeSerializer(self,ns):asProperty?new ElementSerializer(self,ns):new ElementSerializer(self),body.push(serializer.build(v))})}})},ElementSerializer.prototype.getNamespaces=function(){var namespaces=this.namespaces,parent=this.parent;return namespaces||(namespaces=this.namespaces=parent?parent.getNamespaces():{prefixMap:{},uriMap:{},used:{},wellknown:[],custom:[]}),namespaces},ElementSerializer.prototype.logNamespace=function(ns,wellknown){var namespaces=this.getNamespaces(),nsUri=ns.uri;return namespaces.uriMap[nsUri]||(namespaces.uriMap[nsUri]=ns,wellknown?namespaces.wellknown.push(ns):namespaces.custom.push(ns)),namespaces.prefixMap[ns.prefix]=nsUri,ns},ElementSerializer.prototype.logNamespaceUsed=function(ns){var element=this.element,model=element.$model,namespaces=this.getNamespaces(),prefix=ns.prefix,wellknownUri=DEFAULT_NS_MAP[prefix]||model&&(model.getPackage(prefix)||{}).uri,uri=ns.uri||namespaces.prefixMap[prefix]||wellknownUri;if(!uri)throw new Error("no namespace uri given for prefix <"+ns.prefix+">");return ns=namespaces.uriMap[uri],ns||(ns=this.logNamespace({prefix:prefix,uri:uri},wellknownUri)),namespaces.used[ns.uri]||(namespaces.used[ns.uri]=ns),ns},ElementSerializer.prototype.parseAttributes=function(properties){var self=this,element=this.element;forEach(properties,function(p){var value=element.get(p.name);if(p.isReference)if(p.isMany){var values=[];forEach(value,function(v){values.push(v.id)}),value=values.join(" ")}else value=value.id;self.addAttribute(self.nsAttributeName(p),value)})},ElementSerializer.prototype.addAttribute=function(name,value){var attrs=this.attrs;isString(value)&&(value=escapeAttr(value)),attrs.push({name:name,value:value})},ElementSerializer.prototype.serializeAttributes=function(writer){var attrs=this.attrs;!this.parent&&(attrs=getNsAttrs(this.namespaces).concat(attrs)),forEach(attrs,function(a){writer.append(" ").append(nsName(a.name)).append('="').append(a.value).append('"')})},ElementSerializer.prototype.serializeTo=function(writer){var hasBody=this.body.length,indent=!(1===this.body.length&&this.body[0]instanceof BodySerializer);writer.appendIndent().append("<"+nsName(this.ns)),this.serializeAttributes(writer),writer.append(hasBody?">":" />"),hasBody&&(indent&&writer.appendNewLine().indent(),forEach(this.body,function(b){b.serializeTo(writer)}),indent&&writer.unindent().appendIndent(),writer.append("</"+nsName(this.ns)+">")),writer.appendNewLine()},TypeSerializer.prototype=new ElementSerializer,TypeSerializer.prototype.build=function(element){var descriptor=element.$descriptor;this.element=element,this.typeNs=this.nsTagName(descriptor);var typeNs=this.typeNs,pkg=element.$model.getPackage(typeNs.uri),typePrefix=pkg.xml&&pkg.xml.typePrefix||"";return this.addAttribute(this.nsAttributeName(XSI_TYPE),(typeNs.prefix?typeNs.prefix+":":"")+typePrefix+descriptor.ns.localName),ElementSerializer.prototype.build.call(this,element)},TypeSerializer.prototype.isLocalNs=function(ns){return ns.uri===this.typeNs.uri},module.exports=XMLWriter},{462:462,464:464,467:467,589:589,592:592,614:614,622:622,625:625}],617:[function(_dereq_,module,exports){module.exports=_dereq_(621)},{621:621}],618:[function(_dereq_,module,exports){"use strict";function Base(){}Base.prototype.get=function(name){return this.$model.properties.get(this,name)},Base.prototype.set=function(name,value){this.$model.properties.set(this,name,value)},module.exports=Base},{}],619:[function(_dereq_,module,exports){"use strict";function DescriptorBuilder(nameNs){this.ns=nameNs,this.name=nameNs.name,this.allTypes=[],this.properties=[],this.propertiesByName={}}var pick=_dereq_(598),assign=_dereq_(592),forEach=_dereq_(464),parseNameNs=_dereq_(622).parseName;module.exports=DescriptorBuilder,DescriptorBuilder.prototype.build=function(){return pick(this,["ns","name","allTypes","properties","propertiesByName","bodyProperty","idProperty"])},DescriptorBuilder.prototype.addProperty=function(p,idx,validate){"boolean"==typeof idx&&(validate=idx,idx=void 0),this.addNamedProperty(p,!1!==validate);var properties=this.properties;void 0!==idx?properties.splice(idx,0,p):properties.push(p)},DescriptorBuilder.prototype.replaceProperty=function(oldProperty,newProperty,replace){var oldNameNs=oldProperty.ns,props=this.properties,propertiesByName=this.propertiesByName,rename=oldProperty.name!==newProperty.name;if(oldProperty.isId){if(!newProperty.isId)throw new Error("property <"+newProperty.ns.name+"> must be id property to refine <"+oldProperty.ns.name+">");this.setIdProperty(newProperty,!1)}if(oldProperty.isBody){if(!newProperty.isBody)throw new Error("property <"+newProperty.ns.name+"> must be body property to refine <"+oldProperty.ns.name+">");this.setBodyProperty(newProperty,!1)}var idx=props.indexOf(oldProperty);if(-1===idx)throw new Error("property <"+oldNameNs.name+"> not found in property list");props.splice(idx,1),this.addProperty(newProperty,replace?void 0:idx,rename),propertiesByName[oldNameNs.name]=propertiesByName[oldNameNs.localName]=newProperty},DescriptorBuilder.prototype.redefineProperty=function(p,targetPropertyName,replace){var nsPrefix=p.ns.prefix,parts=targetPropertyName.split("#"),name=parseNameNs(parts[0],nsPrefix),attrName=parseNameNs(parts[1],name.prefix).name,redefinedProperty=this.propertiesByName[attrName];if(!redefinedProperty)throw new Error("refined property <"+attrName+"> not found");this.replaceProperty(redefinedProperty,p,replace),delete p.redefines},DescriptorBuilder.prototype.addNamedProperty=function(p,validate){var ns=p.ns,propsByName=this.propertiesByName;validate&&(this.assertNotDefined(p,ns.name),this.assertNotDefined(p,ns.localName)),propsByName[ns.name]=propsByName[ns.localName]=p},DescriptorBuilder.prototype.removeNamedProperty=function(p){var ns=p.ns,propsByName=this.propertiesByName;delete propsByName[ns.name],delete propsByName[ns.localName]},DescriptorBuilder.prototype.setBodyProperty=function(p,validate){if(validate&&this.bodyProperty)throw new Error("body property defined multiple times (<"+this.bodyProperty.ns.name+">, <"+p.ns.name+">)");this.bodyProperty=p},DescriptorBuilder.prototype.setIdProperty=function(p,validate){if(validate&&this.idProperty)throw new Error("id property defined multiple times (<"+this.idProperty.ns.name+">, <"+p.ns.name+">)");this.idProperty=p},DescriptorBuilder.prototype.assertNotDefined=function(p,name){var propertyName=p.name,definedProperty=this.propertiesByName[propertyName];if(definedProperty)throw new Error("property <"+propertyName+"> already defined; override of <"+definedProperty.definedBy.ns.name+"#"+definedProperty.ns.name+"> by <"+p.definedBy.ns.name+"#"+p.ns.name+"> not allowed without redefines")},DescriptorBuilder.prototype.hasProperty=function(name){return this.propertiesByName[name]},DescriptorBuilder.prototype.addTrait=function(t,inherited){var allTypes=this.allTypes;-1===allTypes.indexOf(t)&&(forEach(t.properties,function(p){p=assign({},p,{name:p.ns.localName,inherited:inherited}),Object.defineProperty(p,"definedBy",{value:t});var replaces=p.replaces,redefines=p.redefines;replaces||redefines?this.redefineProperty(p,replaces||redefines,replaces):(p.isBody&&this.setBodyProperty(p),p.isId&&this.setIdProperty(p),this.addProperty(p))},this),allTypes.push(t))}},{464:464,592:592,598:598,622:622}],620:[function(_dereq_,module,exports){"use strict";function Factory(model,properties){this.model=model,this.properties=properties}var forEach=_dereq_(464),Base=_dereq_(618);module.exports=Factory,Factory.prototype.createType=function(descriptor){function ModdleElement(attrs){props.define(this,"$type",{value:name,enumerable:!0}),props.define(this,"$attrs",{value:{}}),props.define(this,"$parent",{writable:!0}),forEach(attrs,function(val,key){this.set(key,val)},this)}var model=this.model,props=this.properties,prototype=Object.create(Base.prototype);forEach(descriptor.properties,function(p){p.isMany||void 0===p.default||(prototype[p.name]=p.default)}),props.defineModel(prototype,model),props.defineDescriptor(prototype,descriptor);var name=descriptor.ns.name;return ModdleElement.prototype=prototype,ModdleElement.hasType=prototype.$instanceOf=this.model.hasType,props.defineModel(ModdleElement,model),props.defineDescriptor(ModdleElement,descriptor),ModdleElement}},{464:464,618:618}],621:[function(_dereq_,module,exports){"use strict";function Moddle(packages){this.properties=new Properties(this),this.factory=new Factory(this,this.properties),this.registry=new Registry(packages,this.properties),this.typeCache={}}var isString=_dereq_(589),isObject=_dereq_(587),forEach=_dereq_(464),find=_dereq_(463),Factory=_dereq_(620),Registry=_dereq_(624),Properties=_dereq_(623),parseNameNs=_dereq_(622).parseName;module.exports=Moddle,Moddle.prototype.create=function(descriptor,attrs){var Type=this.getType(descriptor);if(!Type)throw new Error("unknown type <"+descriptor+">");return new Type(attrs)},Moddle.prototype.getType=function(descriptor){var cache=this.typeCache,name=isString(descriptor)?descriptor:descriptor.ns.name,type=cache[name];return type||(descriptor=this.registry.getEffectiveDescriptor(name),type=cache[name]=this.factory.createType(descriptor)),type},Moddle.prototype.createAny=function(name,nsUri,properties){var nameNs=parseNameNs(name),element={$type:name},descriptor={name:name,isGeneric:!0,ns:{prefix:nameNs.prefix,localName:nameNs.localName,uri:nsUri}};return this.properties.defineDescriptor(element,descriptor),this.properties.defineModel(element,this),this.properties.define(element,"$parent",{enumerable:!1,writable:!0}),forEach(properties,function(a,key){isObject(a)&&void 0!==a.value?element[a.name]=a.value:element[key]=a}),element},Moddle.prototype.getPackage=function(uriOrPrefix){return this.registry.getPackage(uriOrPrefix)},Moddle.prototype.getPackages=function(){return this.registry.getPackages()},Moddle.prototype.getElementDescriptor=function(element){return element.$descriptor},Moddle.prototype.hasType=function(element,type){void 0===type&&(type=element,element=this);var descriptor=element.$model.getElementDescriptor(element);return!!find(descriptor.allTypes,function(t){return t.name===type})},Moddle.prototype.getPropertyDescriptor=function(element,property){return this.getElementDescriptor(element).propertiesByName[property]}},{463:463,464:464,587:587,589:589,620:620,622:622,
623:623,624:624}],622:[function(_dereq_,module,exports){"use strict";module.exports.parseName=function(name,defaultPrefix){var localName,prefix,parts=name.split(/:/);if(1===parts.length)localName=name,prefix=defaultPrefix;else{if(2!==parts.length)throw new Error("expected <prefix:localName> or <localName>, got "+name);localName=parts[1],prefix=parts[0]}return name=(prefix?prefix+":":"")+localName,{name:name,prefix:prefix,localName:localName}}},{}],623:[function(_dereq_,module,exports){"use strict";function Properties(model){this.model=model}function isUndefined(val){return void 0===val}function defineProperty(target,property,value){Object.defineProperty(target,property.name,{enumerable:!property.isReference,writable:!0,value:value,configurable:!0})}module.exports=Properties,Properties.prototype.set=function(target,name,value){var property=this.model.getPropertyDescriptor(target,name),propertyName=property&&property.name;isUndefined(value)?property?delete target[propertyName]:delete target.$attrs[name]:property?propertyName in target?target[propertyName]=value:defineProperty(target,property,value):target.$attrs[name]=value},Properties.prototype.get=function(target,name){var property=this.model.getPropertyDescriptor(target,name);if(!property)return target.$attrs[name];var propertyName=property.name;return!target[propertyName]&&property.isMany&&defineProperty(target,property,[]),target[propertyName]},Properties.prototype.define=function(target,name,options){Object.defineProperty(target,name,options)},Properties.prototype.defineDescriptor=function(target,descriptor){this.define(target,"$descriptor",{value:descriptor})},Properties.prototype.defineModel=function(target,model){this.define(target,"$model",{value:model})}},{}],624:[function(_dereq_,module,exports){"use strict";function Registry(packages,properties){this.packageMap={},this.typeMap={},this.packages=[],this.properties=properties,forEach(packages,this.registerPackage,this)}var assign=_dereq_(592),forEach=_dereq_(464),Types=_dereq_(625),DescriptorBuilder=_dereq_(619),parseNameNs=_dereq_(622).parseName,isBuiltInType=Types.isBuiltIn;module.exports=Registry,Registry.prototype.getPackage=function(uriOrPrefix){return this.packageMap[uriOrPrefix]},Registry.prototype.getPackages=function(){return this.packages},Registry.prototype.registerPackage=function(pkg){pkg=assign({},pkg),forEach(pkg.types,function(descriptor){this.registerType(descriptor,pkg)},this),this.packageMap[pkg.uri]=this.packageMap[pkg.prefix]=pkg,this.packages.push(pkg)},Registry.prototype.registerType=function(type,pkg){type=assign({},type,{superClass:(type.superClass||[]).slice(),extends:(type.extends||[]).slice(),properties:(type.properties||[]).slice()});var ns=parseNameNs(type.name,pkg.prefix),name=ns.name,propertiesByName={};forEach(type.properties,function(p){var propertyNs=parseNameNs(p.name,ns.prefix),propertyName=propertyNs.name;isBuiltInType(p.type)||(p.type=parseNameNs(p.type,propertyNs.prefix).name),assign(p,{ns:propertyNs,name:propertyName}),propertiesByName[propertyName]=p}),assign(type,{ns:ns,name:name,propertiesByName:propertiesByName}),forEach(type.extends,function(extendsName){var extended=this.typeMap[extendsName];extended.traits=extended.traits||[],extended.traits.push(name)},this),this.definePackage(type,pkg),this.typeMap[name]=type},Registry.prototype.mapTypes=function(nsName,iterator,trait){function traverseTrait(cls){return traverseSuper(cls,!0)}function traverseSuper(cls,trait){var parentNs=parseNameNs(cls,isBuiltInType(cls)?"":nsName.prefix);self.mapTypes(parentNs,iterator,trait)}var type=isBuiltInType(nsName.name)?{name:nsName.name}:this.typeMap[nsName.name],self=this;if(!type)throw new Error("unknown type <"+nsName.name+">");forEach(type.superClass,trait?traverseTrait:traverseSuper),iterator(type,!trait),forEach(type.traits,traverseTrait)},Registry.prototype.getEffectiveDescriptor=function(name){var nsName=parseNameNs(name),builder=new DescriptorBuilder(nsName);this.mapTypes(nsName,function(type,inherited){builder.addTrait(type,inherited)});var descriptor=builder.build();return this.definePackage(descriptor,descriptor.allTypes[descriptor.allTypes.length-1].$pkg),descriptor},Registry.prototype.definePackage=function(target,pkg){this.properties.define(target,"$pkg",{value:pkg})}},{464:464,592:592,619:619,622:622,625:625}],625:[function(_dereq_,module,exports){"use strict";var BUILTINS={String:!0,Boolean:!0,Integer:!0,Real:!0,Element:!0},TYPE_CONVERTERS={String:function(s){return s},Boolean:function(s){return"true"===s},Integer:function(s){return parseInt(s,10)},Real:function(s){return parseFloat(s,10)}};module.exports.coerceType=function(type,value){var converter=TYPE_CONVERTERS[type];return converter?converter(value):value},module.exports.isBuiltIn=function(type){return!!BUILTINS[type]},module.exports.isSimple=function(type){return!!TYPE_CONVERTERS[type]}},{}],626:[function(_dereq_,module,exports){module.exports=_dereq_(628),module.exports.Collection=_dereq_(627)},{627:627,628:628}],627:[function(_dereq_,module,exports){"use strict";function extend(collection,refs,property,target){var inverseProperty=property.inverse;return Object.defineProperty(collection,"remove",{value:function(element){var idx=this.indexOf(element);return-1!==idx&&(this.splice(idx,1),refs.unset(element,inverseProperty,target)),element}}),Object.defineProperty(collection,"contains",{value:function(element){return-1!==this.indexOf(element)}}),Object.defineProperty(collection,"add",{value:function(element){this.contains(element)||(this.push(element),refs.set(element,inverseProperty,target))}}),Object.defineProperty(collection,"__refs_collection",{value:!0}),collection}function isExtended(collection){return!0===collection.__refs_collection}module.exports.extend=extend,module.exports.isExtended=isExtended},{}],628:[function(_dereq_,module,exports){"use strict";function hasOwnProperty(e,property){return Object.prototype.hasOwnProperty.call(e,property.name||property)}function defineCollectionProperty(ref,property,target){Object.defineProperty(target,property.name,{enumerable:property.enumerable,value:Collection.extend(target[property.name]||[],ref,property,target)})}function defineProperty(ref,property,target){var inverseProperty=property.inverse,_value=target[property.name];Object.defineProperty(target,property.name,{enumerable:property.enumerable,get:function(){return _value},set:function(value){if(value!==_value){var old=_value;_value=null,old&&ref.unset(old,inverseProperty,target),_value=value,ref.set(_value,inverseProperty,target)}}})}function Refs(a,b){if(!(this instanceof Refs))return new Refs(a,b);a.inverse=b,b.inverse=a,this.props={},this.props[a.name]=a,this.props[b.name]=b}var Collection=_dereq_(627);Refs.prototype.bind=function(target,property){if("string"==typeof property){if(!this.props[property])throw new Error("no property <"+property+"> in ref");property=this.props[property]}property.collection?defineCollectionProperty(this,property,target):defineProperty(this,property,target)},Refs.prototype.ensureRefsCollection=function(target,property){var collection=target[property.name];return Collection.isExtended(collection)||defineCollectionProperty(this,property,target),collection},Refs.prototype.ensureBound=function(target,property){hasOwnProperty(target,property)||this.bind(target,property)},Refs.prototype.unset=function(target,property,value){target&&(this.ensureBound(target,property),property.collection?this.ensureRefsCollection(target,property).remove(value):target[property.name]=void 0)},Refs.prototype.set=function(target,property,value){target&&(this.ensureBound(target,property),property.collection?this.ensureRefsCollection(target,property).add(value):target[property.name]=value)},module.exports=Refs},{627:627}],629:[function(_dereq_,module,exports){(function(Buffer){!function(sax){function SAXParser(strict,opt){if(!(this instanceof SAXParser))return new SAXParser(strict,opt);var parser=this;clearBuffers(parser),parser.q=parser.c="",parser.bufferCheckPosition=sax.MAX_BUFFER_LENGTH,parser.opt=opt||{},parser.opt.lowercase=parser.opt.lowercase||parser.opt.lowercasetags,parser.looseCase=parser.opt.lowercase?"toLowerCase":"toUpperCase",parser.tags=[],parser.closed=parser.closedRoot=parser.sawRoot=!1,parser.tag=parser.error=null,parser.strict=!!strict,parser.noscript=!(!strict&&!parser.opt.noscript),parser.state=S.BEGIN,parser.ENTITIES=Object.create(sax.ENTITIES),parser.attribList=[],parser.opt.xmlns&&(parser.ns=Object.create(rootNS)),parser.trackPosition=!1!==parser.opt.position,parser.trackPosition&&(parser.position=parser.line=parser.column=0),emit(parser,"onready")}function checkBufferLength(parser){for(var maxAllowed=Math.max(sax.MAX_BUFFER_LENGTH,10),maxActual=0,i=0,l=buffers.length;i<l;i++){var len=parser[buffers[i]].length;if(len>maxAllowed)switch(buffers[i]){case"textNode":closeText(parser);break;case"cdata":emitNode(parser,"oncdata",parser.cdata),parser.cdata="";break;case"script":emitNode(parser,"onscript",parser.script),parser.script="";break;default:error(parser,"Max buffer length exceeded: "+buffers[i])}maxActual=Math.max(maxActual,len)}parser.bufferCheckPosition=sax.MAX_BUFFER_LENGTH-maxActual+parser.position}function clearBuffers(parser){for(var i=0,l=buffers.length;i<l;i++)parser[buffers[i]]=""}function flushBuffers(parser){closeText(parser),""!==parser.cdata&&(emitNode(parser,"oncdata",parser.cdata),parser.cdata=""),""!==parser.script&&(emitNode(parser,"onscript",parser.script),parser.script="")}function createStream(strict,opt){return new SAXStream(strict,opt)}function SAXStream(strict,opt){if(!(this instanceof SAXStream))return new SAXStream(strict,opt);Stream.apply(this),this._parser=new SAXParser(strict,opt),this.writable=!0,this.readable=!0;var me=this;this._parser.onend=function(){me.emit("end")},this._parser.onerror=function(er){me.emit("error",er),me._parser.error=null},this._decoder=null,streamWraps.forEach(function(ev){Object.defineProperty(me,"on"+ev,{get:function(){return me._parser["on"+ev]},set:function(h){if(!h)return me.removeAllListeners(ev),me._parser["on"+ev]=h;me.on(ev,h)},enumerable:!0,configurable:!1})})}function charClass(str){return str.split("").reduce(function(s,c){return s[c]=!0,s},{})}function isRegExp(c){return"[object RegExp]"===Object.prototype.toString.call(c)}function is(charclass,c){return isRegExp(charclass)?!!c.match(charclass):charclass[c]}function not(charclass,c){return!is(charclass,c)}function emit(parser,event,data){parser[event]&&parser[event](data)}function emitNode(parser,nodeType,data){parser.textNode&&closeText(parser),emit(parser,nodeType,data)}function closeText(parser){parser.textNode=textopts(parser.opt,parser.textNode),parser.textNode&&emit(parser,"ontext",parser.textNode),parser.textNode=""}function textopts(opt,text){return opt.trim&&(text=text.trim()),opt.normalize&&(text=text.replace(/\s+/g," ")),text}function error(parser,er){return closeText(parser),parser.trackPosition&&(er+="\nLine: "+parser.line+"\nColumn: "+parser.column+"\nChar: "+parser.c),er=new Error(er),parser.error=er,emit(parser,"onerror",er),parser}function end(parser){return parser.closedRoot||strictFail(parser,"Unclosed root tag"),parser.state!==S.BEGIN&&parser.state!==S.TEXT&&error(parser,"Unexpected end"),closeText(parser),parser.c="",parser.closed=!0,emit(parser,"onend"),SAXParser.call(parser,parser.strict,parser.opt),parser}function strictFail(parser,message){if("object"!=typeof parser||!(parser instanceof SAXParser))throw new Error("bad call to strictFail");parser.strict&&error(parser,message)}function newTag(parser){parser.strict||(parser.tagName=parser.tagName[parser.looseCase]());var parent=parser.tags[parser.tags.length-1]||parser,tag=parser.tag={name:parser.tagName,attributes:{}};parser.opt.xmlns&&(tag.ns=parent.ns),parser.attribList.length=0}function qname(name,attribute){var i=name.indexOf(":"),qualName=i<0?["",name]:name.split(":"),prefix=qualName[0],local=qualName[1];return attribute&&"xmlns"===name&&(prefix="xmlns",local=""),{prefix:prefix,local:local}}function attrib(parser){if(parser.strict||(parser.attribName=parser.attribName[parser.looseCase]()),-1!==parser.attribList.indexOf(parser.attribName)||parser.tag.attributes.hasOwnProperty(parser.attribName))return parser.attribName=parser.attribValue="";if(parser.opt.xmlns){var qn=qname(parser.attribName,!0),prefix=qn.prefix,local=qn.local;if("xmlns"===prefix)if("xml"===local&&parser.attribValue!==XML_NAMESPACE)strictFail(parser,"xml: prefix must be bound to "+XML_NAMESPACE+"\nActual: "+parser.attribValue);else if("xmlns"===local&&parser.attribValue!==XMLNS_NAMESPACE)strictFail(parser,"xmlns: prefix must be bound to "+XMLNS_NAMESPACE+"\nActual: "+parser.attribValue);else{var tag=parser.tag,parent=parser.tags[parser.tags.length-1]||parser;tag.ns===parent.ns&&(tag.ns=Object.create(parent.ns)),tag.ns[local]=parser.attribValue}parser.attribList.push([parser.attribName,parser.attribValue])}else parser.tag.attributes[parser.attribName]=parser.attribValue,emitNode(parser,"onattribute",{name:parser.attribName,value:parser.attribValue});parser.attribName=parser.attribValue=""}function openTag(parser,selfClosing){if(parser.opt.xmlns){var tag=parser.tag,qn=qname(parser.tagName);tag.prefix=qn.prefix,tag.local=qn.local,tag.uri=tag.ns[qn.prefix]||"",tag.prefix&&!tag.uri&&(strictFail(parser,"Unbound namespace prefix: "+JSON.stringify(parser.tagName)),tag.uri=qn.prefix);var parent=parser.tags[parser.tags.length-1]||parser;tag.ns&&parent.ns!==tag.ns&&Object.keys(tag.ns).forEach(function(p){emitNode(parser,"onopennamespace",{prefix:p,uri:tag.ns[p]})});for(var i=0,l=parser.attribList.length;i<l;i++){var nv=parser.attribList[i],name=nv[0],value=nv[1],qualName=qname(name,!0),prefix=qualName.prefix,local=qualName.local,uri=""==prefix?"":tag.ns[prefix]||"",a={name:name,value:value,prefix:prefix,local:local,uri:uri};prefix&&"xmlns"!=prefix&&!uri&&(strictFail(parser,"Unbound namespace prefix: "+JSON.stringify(prefix)),a.uri=prefix),parser.tag.attributes[name]=a,emitNode(parser,"onattribute",a)}parser.attribList.length=0}parser.tag.isSelfClosing=!!selfClosing,parser.sawRoot=!0,parser.tags.push(parser.tag),emitNode(parser,"onopentag",parser.tag),selfClosing||(parser.noscript||"script"!==parser.tagName.toLowerCase()?parser.state=S.TEXT:parser.state=S.SCRIPT,parser.tag=null,parser.tagName=""),parser.attribName=parser.attribValue="",parser.attribList.length=0}function closeTag(parser){if(!parser.tagName)return strictFail(parser,"Weird empty close tag."),parser.textNode+="</>",void(parser.state=S.TEXT);if(parser.script){if("script"!==parser.tagName)return parser.script+="</"+parser.tagName+">",parser.tagName="",void(parser.state=S.SCRIPT);emitNode(parser,"onscript",parser.script),parser.script=""}var t=parser.tags.length,tagName=parser.tagName;parser.strict||(tagName=tagName[parser.looseCase]());for(var closeTo=tagName;t--;){if(parser.tags[t].name===closeTo)break;strictFail(parser,"Unexpected close tag")}if(t<0)return strictFail(parser,"Unmatched closing tag: "+parser.tagName),parser.textNode+="</"+parser.tagName+">",void(parser.state=S.TEXT);parser.tagName=tagName;for(var s=parser.tags.length;s-- >t;){var tag=parser.tag=parser.tags.pop();parser.tagName=parser.tag.name,emitNode(parser,"onclosetag",parser.tagName);var x={};for(var i in tag.ns)x[i]=tag.ns[i];var parent=parser.tags[parser.tags.length-1]||parser;parser.opt.xmlns&&tag.ns!==parent.ns&&Object.keys(tag.ns).forEach(function(p){var n=tag.ns[p];emitNode(parser,"onclosenamespace",{prefix:p,uri:n})})}0===t&&(parser.closedRoot=!0),parser.tagName=parser.attribValue=parser.attribName="",parser.attribList.length=0,parser.state=S.TEXT}function parseEntity(parser){var num,entity=parser.entity,entityLC=entity.toLowerCase(),numStr="";return parser.ENTITIES[entity]?parser.ENTITIES[entity]:parser.ENTITIES[entityLC]?parser.ENTITIES[entityLC]:(entity=entityLC,"#"===entity.charAt(0)&&("x"===entity.charAt(1)?(entity=entity.slice(2),num=parseInt(entity,16),numStr=num.toString(16)):(entity=entity.slice(1),num=parseInt(entity,10),numStr=num.toString(10))),entity=entity.replace(/^0+/,""),numStr.toLowerCase()!==entity?(strictFail(parser,"Invalid character entity"),"&"+parser.entity+";"):String.fromCodePoint(num))}function write(chunk){var parser=this;if(this.error)throw this.error;if(parser.closed)return error(parser,"Cannot write after close. Assign an onready handler.");if(null===chunk)return end(parser);for(var i=0,c="";parser.c=c=chunk.charAt(i++);)switch(parser.trackPosition&&(parser.position++,"\n"===c?(parser.line++,parser.column=0):parser.column++),parser.state){case S.BEGIN:"<"===c?(parser.state=S.OPEN_WAKA,parser.startTagPosition=parser.position):not(whitespace,c)&&(strictFail(parser,"Non-whitespace before first tag."),parser.textNode=c,parser.state=S.TEXT);continue;case S.TEXT:if(parser.sawRoot&&!parser.closedRoot){for(var starti=i-1;c&&"<"!==c&&"&"!==c;)(c=chunk.charAt(i++))&&parser.trackPosition&&(parser.position++,"\n"===c?(parser.line++,parser.column=0):parser.column++);parser.textNode+=chunk.substring(starti,i-1)}"<"===c?(parser.state=S.OPEN_WAKA,parser.startTagPosition=parser.position):(!not(whitespace,c)||parser.sawRoot&&!parser.closedRoot||strictFail(parser,"Text data outside of root node."),"&"===c?parser.state=S.TEXT_ENTITY:parser.textNode+=c);continue;case S.SCRIPT:"<"===c?parser.state=S.SCRIPT_ENDING:parser.script+=c;continue;case S.SCRIPT_ENDING:"/"===c?parser.state=S.CLOSE_TAG:(parser.script+="<"+c,parser.state=S.SCRIPT);continue;case S.OPEN_WAKA:if("!"===c)parser.state=S.SGML_DECL,parser.sgmlDecl="";else if(is(whitespace,c));else if(is(nameStart,c))parser.state=S.OPEN_TAG,parser.tagName=c;else if("/"===c)parser.state=S.CLOSE_TAG,parser.tagName="";else if("?"===c)parser.state=S.PROC_INST,parser.procInstName=parser.procInstBody="";else{if(strictFail(parser,"Unencoded <"),parser.startTagPosition+1<parser.position){var pad=parser.position-parser.startTagPosition;c=new Array(pad).join(" ")+c}parser.textNode+="<"+c,parser.state=S.TEXT}continue;case S.SGML_DECL:(parser.sgmlDecl+c).toUpperCase()===CDATA?(emitNode(parser,"onopencdata"),parser.state=S.CDATA,parser.sgmlDecl="",parser.cdata=""):parser.sgmlDecl+c==="--"?(parser.state=S.COMMENT,parser.comment="",parser.sgmlDecl=""):(parser.sgmlDecl+c).toUpperCase()===DOCTYPE?(parser.state=S.DOCTYPE,(parser.doctype||parser.sawRoot)&&strictFail(parser,"Inappropriately located doctype declaration"),parser.doctype="",parser.sgmlDecl=""):">"===c?(emitNode(parser,"onsgmldeclaration",parser.sgmlDecl),parser.sgmlDecl="",parser.state=S.TEXT):is(quote,c)?(parser.state=S.SGML_DECL_QUOTED,parser.sgmlDecl+=c):parser.sgmlDecl+=c;continue;case S.SGML_DECL_QUOTED:c===parser.q&&(parser.state=S.SGML_DECL,parser.q=""),parser.sgmlDecl+=c;continue;case S.DOCTYPE:">"===c?(parser.state=S.TEXT,emitNode(parser,"ondoctype",parser.doctype),parser.doctype=!0):(parser.doctype+=c,"["===c?parser.state=S.DOCTYPE_DTD:is(quote,c)&&(parser.state=S.DOCTYPE_QUOTED,parser.q=c));continue;case S.DOCTYPE_QUOTED:parser.doctype+=c,c===parser.q&&(parser.q="",parser.state=S.DOCTYPE);continue;case S.DOCTYPE_DTD:parser.doctype+=c,"]"===c?parser.state=S.DOCTYPE:is(quote,c)&&(parser.state=S.DOCTYPE_DTD_QUOTED,parser.q=c);continue;case S.DOCTYPE_DTD_QUOTED:parser.doctype+=c,c===parser.q&&(parser.state=S.DOCTYPE_DTD,parser.q="");continue;case S.COMMENT:"-"===c?parser.state=S.COMMENT_ENDING:parser.comment+=c;continue;case S.COMMENT_ENDING:"-"===c?(parser.state=S.COMMENT_ENDED,parser.comment=textopts(parser.opt,parser.comment),parser.comment&&emitNode(parser,"oncomment",parser.comment),parser.comment=""):(parser.comment+="-"+c,parser.state=S.COMMENT);continue;case S.COMMENT_ENDED:">"!==c?(strictFail(parser,"Malformed comment"),parser.comment+="--"+c,parser.state=S.COMMENT):parser.state=S.TEXT;continue;case S.CDATA:"]"===c?parser.state=S.CDATA_ENDING:parser.cdata+=c;continue;case S.CDATA_ENDING:"]"===c?parser.state=S.CDATA_ENDING_2:(parser.cdata+="]"+c,parser.state=S.CDATA);continue;case S.CDATA_ENDING_2:">"===c?(parser.cdata&&emitNode(parser,"oncdata",parser.cdata),emitNode(parser,"onclosecdata"),parser.cdata="",parser.state=S.TEXT):"]"===c?parser.cdata+="]":(parser.cdata+="]]"+c,parser.state=S.CDATA);continue;case S.PROC_INST:"?"===c?parser.state=S.PROC_INST_ENDING:is(whitespace,c)?parser.state=S.PROC_INST_BODY:parser.procInstName+=c;continue;case S.PROC_INST_BODY:if(!parser.procInstBody&&is(whitespace,c))continue;"?"===c?parser.state=S.PROC_INST_ENDING:parser.procInstBody+=c;continue;case S.PROC_INST_ENDING:">"===c?(emitNode(parser,"onprocessinginstruction",{name:parser.procInstName,body:parser.procInstBody}),parser.procInstName=parser.procInstBody="",parser.state=S.TEXT):(parser.procInstBody+="?"+c,parser.state=S.PROC_INST_BODY);continue;case S.OPEN_TAG:is(nameBody,c)?parser.tagName+=c:(newTag(parser),">"===c?openTag(parser):"/"===c?parser.state=S.OPEN_TAG_SLASH:(not(whitespace,c)&&strictFail(parser,"Invalid character in tag name"),parser.state=S.ATTRIB));continue;case S.OPEN_TAG_SLASH:">"===c?(openTag(parser,!0),closeTag(parser)):(strictFail(parser,"Forward-slash in opening tag not followed by >"),parser.state=S.ATTRIB);continue;case S.ATTRIB:if(is(whitespace,c))continue;">"===c?openTag(parser):"/"===c?parser.state=S.OPEN_TAG_SLASH:is(nameStart,c)?(parser.attribName=c,parser.attribValue="",parser.state=S.ATTRIB_NAME):strictFail(parser,"Invalid attribute name");continue;case S.ATTRIB_NAME:"="===c?parser.state=S.ATTRIB_VALUE:">"===c?(strictFail(parser,"Attribute without value"),parser.attribValue=parser.attribName,attrib(parser),openTag(parser)):is(whitespace,c)?parser.state=S.ATTRIB_NAME_SAW_WHITE:is(nameBody,c)?parser.attribName+=c:strictFail(parser,"Invalid attribute name");continue;case S.ATTRIB_NAME_SAW_WHITE:if("="===c)parser.state=S.ATTRIB_VALUE;else{if(is(whitespace,c))continue;strictFail(parser,"Attribute without value"),parser.tag.attributes[parser.attribName]="",parser.attribValue="",emitNode(parser,"onattribute",{name:parser.attribName,value:""}),parser.attribName="",">"===c?openTag(parser):is(nameStart,c)?(parser.attribName=c,parser.state=S.ATTRIB_NAME):(strictFail(parser,"Invalid attribute name"),parser.state=S.ATTRIB)}continue;case S.ATTRIB_VALUE:if(is(whitespace,c))continue;is(quote,c)?(parser.q=c,parser.state=S.ATTRIB_VALUE_QUOTED):(strictFail(parser,"Unquoted attribute value"),parser.state=S.ATTRIB_VALUE_UNQUOTED,parser.attribValue=c);continue;case S.ATTRIB_VALUE_QUOTED:if(c!==parser.q){"&"===c?parser.state=S.ATTRIB_VALUE_ENTITY_Q:parser.attribValue+=c;continue}attrib(parser),parser.q="",parser.state=S.ATTRIB_VALUE_CLOSED;continue;case S.ATTRIB_VALUE_CLOSED:is(whitespace,c)?parser.state=S.ATTRIB:">"===c?openTag(parser):"/"===c?parser.state=S.OPEN_TAG_SLASH:is(nameStart,c)?(strictFail(parser,"No whitespace between attributes"),parser.attribName=c,parser.attribValue="",parser.state=S.ATTRIB_NAME):strictFail(parser,"Invalid attribute name");continue;case S.ATTRIB_VALUE_UNQUOTED:if(not(attribEnd,c)){"&"===c?parser.state=S.ATTRIB_VALUE_ENTITY_U:parser.attribValue+=c;continue}attrib(parser),">"===c?openTag(parser):parser.state=S.ATTRIB;continue;case S.CLOSE_TAG:if(parser.tagName)">"===c?closeTag(parser):is(nameBody,c)?parser.tagName+=c:parser.script?(parser.script+="</"+parser.tagName,parser.tagName="",parser.state=S.SCRIPT):(not(whitespace,c)&&strictFail(parser,"Invalid tagname in closing tag"),parser.state=S.CLOSE_TAG_SAW_WHITE);else{if(is(whitespace,c))continue;not(nameStart,c)?parser.script?(parser.script+="</"+c,parser.state=S.SCRIPT):strictFail(parser,"Invalid tagname in closing tag."):parser.tagName=c}continue;case S.CLOSE_TAG_SAW_WHITE:if(is(whitespace,c))continue;">"===c?closeTag(parser):strictFail(parser,"Invalid characters in closing tag");continue;case S.TEXT_ENTITY:case S.ATTRIB_VALUE_ENTITY_Q:case S.ATTRIB_VALUE_ENTITY_U:switch(parser.state){case S.TEXT_ENTITY:var returnState=S.TEXT,buffer="textNode";break;case S.ATTRIB_VALUE_ENTITY_Q:var returnState=S.ATTRIB_VALUE_QUOTED,buffer="attribValue";break;case S.ATTRIB_VALUE_ENTITY_U:var returnState=S.ATTRIB_VALUE_UNQUOTED,buffer="attribValue"}";"===c?(parser[buffer]+=parseEntity(parser),parser.entity="",parser.state=returnState):is(entity,c)?parser.entity+=c:(strictFail(parser,"Invalid character entity"),parser[buffer]+="&"+parser.entity+c,parser.entity="",parser.state=returnState);continue;default:throw new Error(parser,"Unknown state: "+parser.state)}return parser.position>=parser.bufferCheckPosition&&checkBufferLength(parser),parser}sax.parser=function(strict,opt){return new SAXParser(strict,opt)},sax.SAXParser=SAXParser,sax.SAXStream=SAXStream,sax.createStream=createStream,sax.MAX_BUFFER_LENGTH=65536;var buffers=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];sax.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(o){function f(){this.__proto__=o}return f.prototype=o,new f}),Object.getPrototypeOf||(Object.getPrototypeOf=function(o){return o.__proto__}),Object.keys||(Object.keys=function(o){var a=[];for(var i in o)o.hasOwnProperty(i)&&a.push(i);return a}),SAXParser.prototype={end:function(){end(this)},write:write,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){flushBuffers(this)}};try{var Stream=_dereq_(660).Stream}catch(ex){var Stream=function(){}}var streamWraps=sax.EVENTS.filter(function(ev){return"error"!==ev&&"end"!==ev});SAXStream.prototype=Object.create(Stream.prototype,{constructor:{value:SAXStream}}),SAXStream.prototype.write=function(data){if("function"==typeof Buffer&&"function"==typeof Buffer.isBuffer&&Buffer.isBuffer(data)){if(!this._decoder){var SD=_dereq_(661).StringDecoder;this._decoder=new SD("utf8")}data=this._decoder.write(data)}return this._parser.write(data.toString()),this.emit("data",data),!0},SAXStream.prototype.end=function(chunk){return chunk&&chunk.length&&this.write(chunk),this._parser.end(),!0},SAXStream.prototype.on=function(ev,handler){var me=this;return me._parser["on"+ev]||-1===streamWraps.indexOf(ev)||(me._parser["on"+ev]=function(){var args=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);args.splice(0,0,ev),me.emit.apply(me,args)}),Stream.prototype.on.call(me,ev,handler)};var whitespace="\r\n\t ",number="0124356789",letter="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",quote="'\"",entity=number+letter+"#",attribEnd=whitespace+">",CDATA="[CDATA[",DOCTYPE="DOCTYPE",XML_NAMESPACE="http://www.w3.org/XML/1998/namespace",XMLNS_NAMESPACE="http://www.w3.org/2000/xmlns/",rootNS={xml:XML_NAMESPACE,xmlns:XMLNS_NAMESPACE};whitespace=charClass(whitespace),number=charClass(number),letter=charClass(letter);var nameStart=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,nameBody=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/;quote=charClass(quote),entity=charClass(entity),attribEnd=charClass(attribEnd);var S=0;sax.STATE={BEGIN:S++,TEXT:S++,TEXT_ENTITY:S++,OPEN_WAKA:S++,SGML_DECL:S++,SGML_DECL_QUOTED:S++,DOCTYPE:S++,DOCTYPE_QUOTED:S++,DOCTYPE_DTD:S++,DOCTYPE_DTD_QUOTED:S++,COMMENT_STARTING:S++,COMMENT:S++,COMMENT_ENDING:S++,COMMENT_ENDED:S++,CDATA:S++,CDATA_ENDING:S++,CDATA_ENDING_2:S++,PROC_INST:S++,PROC_INST_BODY:S++,PROC_INST_ENDING:S++,OPEN_TAG:S++,OPEN_TAG_SLASH:S++,ATTRIB:S++,ATTRIB_NAME:S++,ATTRIB_NAME_SAW_WHITE:S++,ATTRIB_VALUE:S++,ATTRIB_VALUE_QUOTED:S++,ATTRIB_VALUE_CLOSED:S++,ATTRIB_VALUE_UNQUOTED:S++,ATTRIB_VALUE_ENTITY_Q:S++,ATTRIB_VALUE_ENTITY_U:S++,CLOSE_TAG:S++,CLOSE_TAG_SAW_WHITE:S++,SCRIPT:S++,SCRIPT_ENDING:S++},sax.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(sax.ENTITIES).forEach(function(key){var e=sax.ENTITIES[key],s="number"==typeof e?String.fromCharCode(e):e;sax.ENTITIES[key]=s});for(var S in sax.STATE)sax.STATE[sax.STATE[S]]=S;S=sax.STATE,String.fromCodePoint||function(){var stringFromCharCode=String.fromCharCode,floor=Math.floor,fromCodePoint=function(){var highSurrogate,lowSurrogate,codeUnits=[],index=-1,length=arguments.length;if(!length)return"";for(var result="";++index<length;){var codePoint=Number(arguments[index]);if(!isFinite(codePoint)||codePoint<0||codePoint>1114111||floor(codePoint)!=codePoint)throw RangeError("Invalid code point: "+codePoint);codePoint<=65535?codeUnits.push(codePoint):(codePoint-=65536,highSurrogate=55296+(codePoint>>10),lowSurrogate=codePoint%1024+56320,codeUnits.push(highSurrogate,lowSurrogate)),(index+1==length||codeUnits.length>16384)&&(result+=stringFromCharCode.apply(null,codeUnits),codeUnits.length=0)}return result};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:fromCodePoint,configurable:!0,writable:!0}):String.fromCodePoint=fromCodePoint}()}(void 0===exports?sax={}:exports)}).call(this,void 0)},{660:660,661:661}],630:[function(_dereq_,module,exports){!function(glob,factory){if("function"==typeof define&&define.amd)define(["eve"],function(eve){return factory(glob,eve)});else if(void 0!==exports){var eve=_dereq_(447);module.exports=factory(glob,eve)}else factory(glob,glob.eve)
}(window||this,function(window,eve){var mina=function(eve){var animations={},requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){setTimeout(callback,16)},isArray=Array.isArray||function(a){return a instanceof Array||"[object Array]"==Object.prototype.toString.call(a)},idgen=0,idprefix="M"+(+new Date).toString(36),ID=function(){return idprefix+(idgen++).toString(36)},timer=Date.now||function(){return+new Date},sta=function(val){var a=this;if(null==val)return a.s;var ds=a.s-val;a.b+=a.dur*ds,a.B+=a.dur*ds,a.s=val},speed=function(val){var a=this;if(null==val)return a.spd;a.spd=val},duration=function(val){var a=this;if(null==val)return a.dur;a.s=a.s*val/a.dur,a.dur=val},stopit=function(){var a=this;delete animations[a.id],a.update(),eve("mina.stop."+a.id,a)},pause=function(){var a=this;a.pdif||(delete animations[a.id],a.update(),a.pdif=a.get()-a.b)},resume=function(){var a=this;a.pdif&&(a.b=a.get()-a.pdif,delete a.pdif,animations[a.id]=a)},update=function(){var res,a=this;if(isArray(a.start)){res=[];for(var j=0,jj=a.start.length;j<jj;j++)res[j]=+a.start[j]+(a.end[j]-a.start[j])*a.easing(a.s)}else res=+a.start+(a.end-a.start)*a.easing(a.s);a.set(res)},frame=function(){var len=0;for(var i in animations)if(animations.hasOwnProperty(i)){var a=animations[i],b=a.get();len++,a.s=(b-a.b)/(a.dur/a.spd),a.s>=1&&(delete animations[i],a.s=1,len--,function(a){setTimeout(function(){eve("mina.finish."+a.id,a)})}(a)),a.update()}len&&requestAnimFrame(frame)},mina=function(a,A,b,B,get,set,easing){var anim={id:ID(),start:a,end:A,b:b,s:0,dur:B-b,spd:1,get:get,set:set,easing:easing||mina.linear,status:sta,speed:speed,duration:duration,stop:stopit,pause:pause,resume:resume,update:update};animations[anim.id]=anim;var i,len=0;for(i in animations)if(animations.hasOwnProperty(i)&&2==++len)break;return 1==len&&requestAnimFrame(frame),anim};return mina.time=timer,mina.getById=function(id){return animations[id]||null},mina.linear=function(n){return n},mina.easeout=function(n){return Math.pow(n,1.7)},mina.easein=function(n){return Math.pow(n,.48)},mina.easeinout=function(n){if(1==n)return 1;if(0==n)return 0;var q=.48-n/1.04,Q=Math.sqrt(.1734+q*q),x=Q-q,X=Math.pow(Math.abs(x),1/3)*(x<0?-1:1),y=-Q-q,Y=Math.pow(Math.abs(y),1/3)*(y<0?-1:1),t=X+Y+.5;return 3*(1-t)*t*t+t*t*t},mina.backin=function(n){if(1==n)return 1;var s=1.70158;return n*n*((s+1)*n-s)},mina.backout=function(n){if(0==n)return 0;n-=1;var s=1.70158;return n*n*((s+1)*n+s)+1},mina.elastic=function(n){return n==!!n?n:Math.pow(2,-10*n)*Math.sin((n-.075)*(2*Math.PI)/.3)+1},mina.bounce=function(n){var l,s=7.5625,p=2.75;return n<1/p?l=s*n*n:n<2/p?(n-=1.5/p,l=s*n*n+.75):n<2.5/p?(n-=2.25/p,l=s*n*n+.9375):(n-=2.625/p,l=s*n*n+.984375),l},window.mina=mina,mina}(void 0===eve?function(){}:eve),Snap=function(root){function Snap(w,h){if(w){if(w.tagName)return wrap(w);if(is(w,"array")&&Snap.set)return Snap.set.apply(Snap,w);if(w instanceof Element)return w;if(null==h)return w=glob.doc.querySelector(w),wrap(w)}return w=null==w?"100%":w,h=null==h?"100%":h,new Paper(w,h)}function $(el,attr){if(attr){if("#text"==el&&(el=glob.doc.createTextNode(attr.text||"")),"string"==typeof el&&(el=$(el)),"string"==typeof attr)return"xlink:"==attr.substring(0,6)?el.getAttributeNS(xlink,attr.substring(6)):"xml:"==attr.substring(0,4)?el.getAttributeNS(xmlns,attr.substring(4)):el.getAttribute(attr);for(var key in attr)if(attr[has](key)){var val=Str(attr[key]);val?"xlink:"==key.substring(0,6)?el.setAttributeNS(xlink,key.substring(6),val):"xml:"==key.substring(0,4)?el.setAttributeNS(xmlns,key.substring(4),val):el.setAttribute(key,val):el.removeAttribute(key)}}else el=glob.doc.createElementNS(xmlns,el);return el}function is(o,type){return type=Str.prototype.toLowerCase.call(type),"finite"==type?isFinite(o):!("array"!=type||!(o instanceof Array||Array.isArray&&Array.isArray(o)))||("null"==type&&null===o||type==typeof o&&null!==o||"object"==type&&o===Object(o)||objectToString.call(o).slice(8,-1).toLowerCase()==type)}function clone(obj){if("function"==typeof obj||Object(obj)!==obj)return obj;var res=new obj.constructor;for(var key in obj)obj[has](key)&&(res[key]=clone(obj[key]));return res}function repush(array,item){for(var i=0,ii=array.length;i<ii;i++)if(array[i]===item)return array.push(array.splice(i,1)[0])}function cacher(f,scope,postprocessor){function newf(){var arg=Array.prototype.slice.call(arguments,0),args=arg.join("␀"),cache=newf.cache=newf.cache||{},count=newf.count=newf.count||[];return cache[has](args)?(repush(count,args),postprocessor?postprocessor(cache[args]):cache[args]):(count.length>=1e3&&delete cache[count.shift()],count.push(args),cache[args]=f.apply(scope,arg),postprocessor?postprocessor(cache[args]):cache[args])}return newf}function angle(x1,y1,x2,y2,x3,y3){if(null==x3){var x=x1-x2,y=y1-y2;return x||y?(180+180*math.atan2(-y,-x)/PI+360)%360:0}return angle(x1,y1,x3,y3)-angle(x2,y2,x3,y3)}function rad(deg){return deg%360*PI/180}function deg(rad){return 180*rad/PI%360}function svgTransform2string(tstr){var res=[];return tstr=tstr.replace(/(?:^|\s)(\w+)\(([^)]+)\)/g,function(all,name,params){return params=params.split(/\s*,\s*|\s+/),"rotate"==name&&1==params.length&&params.push(0,0),"scale"==name&&(params.length>2?params=params.slice(0,2):2==params.length&&params.push(0,0),1==params.length&&params.push(params[0],0,0)),"skewX"==name?res.push(["m",1,0,math.tan(rad(params[0])),1,0,0]):"skewY"==name?res.push(["m",1,math.tan(rad(params[0])),0,1,0,0]):res.push([name.charAt(0)].concat(params)),all}),res}function transform2matrix(tstr,bbox){var tdata=parseTransformString(tstr),m=new Snap.Matrix;if(tdata)for(var i=0,ii=tdata.length;i<ii;i++){var x1,y1,x2,y2,bb,t=tdata[i],tlen=t.length,command=Str(t[0]).toLowerCase(),absolute=t[0]!=command,inver=absolute?m.invert():0;"t"==command&&2==tlen?m.translate(t[1],0):"t"==command&&3==tlen?absolute?(x1=inver.x(0,0),y1=inver.y(0,0),x2=inver.x(t[1],t[2]),y2=inver.y(t[1],t[2]),m.translate(x2-x1,y2-y1)):m.translate(t[1],t[2]):"r"==command?2==tlen?(bb=bb||bbox,m.rotate(t[1],bb.x+bb.width/2,bb.y+bb.height/2)):4==tlen&&(absolute?(x2=inver.x(t[2],t[3]),y2=inver.y(t[2],t[3]),m.rotate(t[1],x2,y2)):m.rotate(t[1],t[2],t[3])):"s"==command?2==tlen||3==tlen?(bb=bb||bbox,m.scale(t[1],t[tlen-1],bb.x+bb.width/2,bb.y+bb.height/2)):4==tlen?absolute?(x2=inver.x(t[2],t[3]),y2=inver.y(t[2],t[3]),m.scale(t[1],t[1],x2,y2)):m.scale(t[1],t[1],t[2],t[3]):5==tlen&&(absolute?(x2=inver.x(t[3],t[4]),y2=inver.y(t[3],t[4]),m.scale(t[1],t[2],x2,y2)):m.scale(t[1],t[2],t[3],t[4])):"m"==command&&7==tlen&&m.add(t[1],t[2],t[3],t[4],t[5],t[6])}return m}function getSomeDefs(el){var p=el.node.ownerSVGElement&&wrap(el.node.ownerSVGElement)||el.node.parentNode&&wrap(el.node.parentNode)||Snap.select("svg")||Snap(0,0),pdefs=p.select("defs"),defs=null!=pdefs&&pdefs.node;return defs||(defs=make("defs",p.node).node),defs}function getSomeSVG(el){return el.node.ownerSVGElement&&wrap(el.node.ownerSVGElement)||Snap.select("svg")}function unit2px(el,name,value){function getW(val){if(null==val)return E;if(val==+val)return val;$(mgr,{width:val});try{return mgr.getBBox().width}catch(e){return 0}}function getH(val){if(null==val)return E;if(val==+val)return val;$(mgr,{height:val});try{return mgr.getBBox().height}catch(e){return 0}}function set(nam,f){null==name?out[nam]=f(el.attr(nam)||0):nam==name&&(out=f(null==value?el.attr(nam)||0:value))}var svg=getSomeSVG(el).node,out={},mgr=svg.querySelector(".svg---mgr");switch(mgr||(mgr=$("rect"),$(mgr,{x:-9e9,y:-9e9,width:10,height:10,class:"svg---mgr",fill:"none"}),svg.appendChild(mgr)),el.type){case"rect":set("rx",getW),set("ry",getH);case"image":set("width",getW),set("height",getH);case"text":set("x",getW),set("y",getH);break;case"circle":set("cx",getW),set("cy",getH),set("r",getW);break;case"ellipse":set("cx",getW),set("cy",getH),set("rx",getW),set("ry",getH);break;case"line":set("x1",getW),set("x2",getW),set("y1",getH),set("y2",getH);break;case"marker":set("refX",getW),set("markerWidth",getW),set("refY",getH),set("markerHeight",getH);break;case"radialGradient":set("fx",getW),set("fy",getH);break;case"tspan":set("dx",getW),set("dy",getH);break;default:set(name,getW)}return svg.removeChild(mgr),out}function add2group(list){is(list,"array")||(list=Array.prototype.slice.call(arguments,0));for(var i=0,j=0,node=this.node;this[i];)delete this[i++];for(i=0;i<list.length;i++)"set"==list[i].type?list[i].forEach(function(el){node.appendChild(el.node)}):node.appendChild(list[i].node);var children=node.childNodes;for(i=0;i<children.length;i++)this[j++]=wrap(children[i]);return this}function Element(el){if(el.snap in hub)return hub[el.snap];var svg;try{svg=el.ownerSVGElement}catch(e){}this.node=el,svg&&(this.paper=new Paper(svg)),this.type=el.tagName;var id=this.id=ID(this);if(this.anims={},this._={transform:[]},el.snap=id,hub[id]=this,"g"==this.type&&(this.add=add2group),this.type in{g:1,mask:1,pattern:1,symbol:1})for(var method in Paper.prototype)Paper.prototype[has](method)&&(this[method]=Paper.prototype[method])}function Fragment(frag){this.node=frag}function make(name,parent){var res=$(name);return parent.appendChild(res),wrap(res)}function Paper(w,h){var res,desc,defs,proto=Paper.prototype;if(w&&"svg"==w.tagName){if(w.snap in hub)return hub[w.snap];var doc=w.ownerDocument;res=new Element(w),desc=w.getElementsByTagName("desc")[0],defs=w.getElementsByTagName("defs")[0],desc||(desc=$("desc"),desc.appendChild(doc.createTextNode("Created with Snap")),res.node.appendChild(desc)),defs||(defs=$("defs"),res.node.appendChild(defs)),res.defs=defs;for(var key in proto)proto[has](key)&&(res[key]=proto[key]);res.paper=res.root=res}else res=make("svg",glob.doc.body),$(res.node,{height:h,version:1.1,width:w,xmlns:xmlns});return res}function wrap(dom){return dom?dom instanceof Element||dom instanceof Fragment?dom:dom.tagName&&"svg"==dom.tagName.toLowerCase()?new Paper(dom):dom.tagName&&"object"==dom.tagName.toLowerCase()&&"image/svg+xml"==dom.type?new Paper(dom.contentDocument.getElementsByTagName("svg")[0]):new Element(dom):dom}Snap.version="0.3.0",Snap.toString=function(){return"Snap v"+this.version},Snap._={};var glob={win:root.window,doc:root.window.document};Snap._.glob=glob;var has="hasOwnProperty",Str=String,toFloat=parseFloat,toInt=parseInt,math=Math,mmax=math.max,mmin=math.min,abs=math.abs,PI=(math.pow,math.PI),E=(math.round,""),objectToString=Object.prototype.toString,colourRegExp=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?%?)\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?%?)\s*\))\s*$/i,commaSpaces=(Snap._.separator=/[,\s]+/,/[\s]*,[\s]*/),hsrg={hs:1,rg:1},pathCommand=/([a-z])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\s]*,?[\s]*)+)/gi,tCommand=/([rstm])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\s]*,?[\s]*)+)/gi,pathValues=/(-?\d*\.?\d*(?:e[\-+]?\\d+)?)[\s]*,?[\s]*/gi,idgen=0,idprefix="S"+(+new Date).toString(36),ID=function(el){return(el&&el.type?el.type:E)+idprefix+(idgen++).toString(36)},xlink="http://www.w3.org/1999/xlink",xmlns="http://www.w3.org/2000/svg",hub={};Snap.url=function(url){return"url('#"+url+"')"};Snap._.$=$,Snap._.id=ID,Snap.format=function(){var tokenRegex=/\{([^\}]+)\}/g,objNotationRegex=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,replacer=function(all,key,obj){var res=obj;return key.replace(objNotationRegex,function(all,name,quote,quotedName,isFunc){name=name||quotedName,res&&(name in res&&(res=res[name]),"function"==typeof res&&isFunc&&(res=res()))}),res=(null==res||res==obj?all:res)+""};return function(str,obj){return Str(str).replace(tokenRegex,function(all,key){return replacer(all,key,obj)})}}(),Snap._.clone=clone,Snap._.cacher=cacher,Snap.rad=rad,Snap.deg=deg,Snap.angle=angle,Snap.is=is,Snap.snapTo=function(values,value,tolerance){if(tolerance=is(tolerance,"finite")?tolerance:10,is(values,"array")){for(var i=values.length;i--;)if(abs(values[i]-value)<=tolerance)return values[i]}else{values=+values;var rem=value%values;if(rem<tolerance)return value-rem;if(rem>values-tolerance)return value-rem+values}return value},Snap.getRGB=cacher(function(colour){if(!colour||(colour=Str(colour)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:rgbtoString};if("none"==colour)return{r:-1,g:-1,b:-1,hex:"none",toString:rgbtoString};if(!(hsrg[has](colour.toLowerCase().substring(0,2))||"#"==colour.charAt())&&(colour=toHex(colour)),!colour)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:rgbtoString};var red,green,blue,opacity,t,values,rgb=colour.match(colourRegExp);return rgb?(rgb[2]&&(blue=toInt(rgb[2].substring(5),16),green=toInt(rgb[2].substring(3,5),16),red=toInt(rgb[2].substring(1,3),16)),rgb[3]&&(blue=toInt((t=rgb[3].charAt(3))+t,16),green=toInt((t=rgb[3].charAt(2))+t,16),red=toInt((t=rgb[3].charAt(1))+t,16)),rgb[4]&&(values=rgb[4].split(commaSpaces),red=toFloat(values[0]),"%"==values[0].slice(-1)&&(red*=2.55),green=toFloat(values[1]),"%"==values[1].slice(-1)&&(green*=2.55),blue=toFloat(values[2]),"%"==values[2].slice(-1)&&(blue*=2.55),"rgba"==rgb[1].toLowerCase().slice(0,4)&&(opacity=toFloat(values[3])),values[3]&&"%"==values[3].slice(-1)&&(opacity/=100)),rgb[5]?(values=rgb[5].split(commaSpaces),red=toFloat(values[0]),"%"==values[0].slice(-1)&&(red/=100),green=toFloat(values[1]),"%"==values[1].slice(-1)&&(green/=100),blue=toFloat(values[2]),"%"==values[2].slice(-1)&&(blue/=100),("deg"==values[0].slice(-3)||"°"==values[0].slice(-1))&&(red/=360),"hsba"==rgb[1].toLowerCase().slice(0,4)&&(opacity=toFloat(values[3])),values[3]&&"%"==values[3].slice(-1)&&(opacity/=100),Snap.hsb2rgb(red,green,blue,opacity)):rgb[6]?(values=rgb[6].split(commaSpaces),red=toFloat(values[0]),"%"==values[0].slice(-1)&&(red/=100),green=toFloat(values[1]),"%"==values[1].slice(-1)&&(green/=100),blue=toFloat(values[2]),"%"==values[2].slice(-1)&&(blue/=100),("deg"==values[0].slice(-3)||"°"==values[0].slice(-1))&&(red/=360),"hsla"==rgb[1].toLowerCase().slice(0,4)&&(opacity=toFloat(values[3])),values[3]&&"%"==values[3].slice(-1)&&(opacity/=100),Snap.hsl2rgb(red,green,blue,opacity)):(red=mmin(math.round(red),255),green=mmin(math.round(green),255),blue=mmin(math.round(blue),255),opacity=mmin(mmax(opacity,0),1),rgb={r:red,g:green,b:blue,toString:rgbtoString},rgb.hex="#"+(16777216|blue|green<<8|red<<16).toString(16).slice(1),rgb.opacity=is(opacity,"finite")?opacity:1,rgb)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:rgbtoString}},Snap),Snap.hsb=cacher(function(h,s,b){return Snap.hsb2rgb(h,s,b).hex}),Snap.hsl=cacher(function(h,s,l){return Snap.hsl2rgb(h,s,l).hex}),Snap.rgb=cacher(function(r,g,b,o){if(is(o,"finite")){var round=math.round;return"rgba("+[round(r),round(g),round(b),+o.toFixed(2)]+")"}return"#"+(16777216|b|g<<8|r<<16).toString(16).slice(1)});var toHex=function(color){var i=glob.doc.getElementsByTagName("head")[0]||glob.doc.getElementsByTagName("svg")[0],red="rgb(255, 0, 0)";return(toHex=cacher(function(color){if("red"==color.toLowerCase())return red;i.style.color=red,i.style.color=color;var out=glob.doc.defaultView.getComputedStyle(i,E).getPropertyValue("color");return out==red?null:out}))(color)},hsbtoString=function(){return"hsb("+[this.h,this.s,this.b]+")"},hsltoString=function(){return"hsl("+[this.h,this.s,this.l]+")"},rgbtoString=function(){return 1==this.opacity||null==this.opacity?this.hex:"rgba("+[this.r,this.g,this.b,this.opacity]+")"},prepareRGB=function(r,g,b){if(null==g&&is(r,"object")&&"r"in r&&"g"in r&&"b"in r&&(b=r.b,g=r.g,r=r.r),null==g&&is(r,string)){var clr=Snap.getRGB(r);r=clr.r,g=clr.g,b=clr.b}return(r>1||g>1||b>1)&&(r/=255,g/=255,b/=255),[r,g,b]},packageRGB=function(r,g,b,o){r=math.round(255*r),g=math.round(255*g),b=math.round(255*b);var rgb={r:r,g:g,b:b,opacity:is(o,"finite")?o:1,hex:Snap.rgb(r,g,b),toString:rgbtoString};return is(o,"finite")&&(rgb.opacity=o),rgb};Snap.color=function(clr){var rgb;return is(clr,"object")&&"h"in clr&&"s"in clr&&"b"in clr?(rgb=Snap.hsb2rgb(clr),clr.r=rgb.r,clr.g=rgb.g,clr.b=rgb.b,clr.opacity=1,clr.hex=rgb.hex):is(clr,"object")&&"h"in clr&&"s"in clr&&"l"in clr?(rgb=Snap.hsl2rgb(clr),clr.r=rgb.r,clr.g=rgb.g,clr.b=rgb.b,clr.opacity=1,clr.hex=rgb.hex):(is(clr,"string")&&(clr=Snap.getRGB(clr)),is(clr,"object")&&"r"in clr&&"g"in clr&&"b"in clr&&!("error"in clr)?(rgb=Snap.rgb2hsl(clr),clr.h=rgb.h,clr.s=rgb.s,clr.l=rgb.l,rgb=Snap.rgb2hsb(clr),clr.v=rgb.b):(clr={hex:"none"},clr.r=clr.g=clr.b=clr.h=clr.s=clr.v=clr.l=-1,clr.error=1)),clr.toString=rgbtoString,clr},Snap.hsb2rgb=function(h,s,v,o){is(h,"object")&&"h"in h&&"s"in h&&"b"in h&&(v=h.b,s=h.s,h=h.h,o=h.o),h*=360;var R,G,B,X,C;return h=h%360/60,C=v*s,X=C*(1-abs(h%2-1)),R=G=B=v-C,h=~~h,R+=[C,X,0,0,X,C][h],G+=[X,C,C,X,0,0][h],B+=[0,0,X,C,C,X][h],packageRGB(R,G,B,o)},Snap.hsl2rgb=function(h,s,l,o){is(h,"object")&&"h"in h&&"s"in h&&"l"in h&&(l=h.l,s=h.s,h=h.h),(h>1||s>1||l>1)&&(h/=360,s/=100,l/=100),h*=360;var R,G,B,X,C;return h=h%360/60,C=2*s*(l<.5?l:1-l),X=C*(1-abs(h%2-1)),R=G=B=l-C/2,h=~~h,R+=[C,X,0,0,X,C][h],G+=[X,C,C,X,0,0][h],B+=[0,0,X,C,C,X][h],packageRGB(R,G,B,o)},Snap.rgb2hsb=function(r,g,b){b=prepareRGB(r,g,b),r=b[0],g=b[1],b=b[2];var H,S,V,C;return V=mmax(r,g,b),C=V-mmin(r,g,b),H=0==C?null:V==r?(g-b)/C:V==g?(b-r)/C+2:(r-g)/C+4,H=(H+360)%6*60/360,S=0==C?0:C/V,{h:H,s:S,b:V,toString:hsbtoString}},Snap.rgb2hsl=function(r,g,b){b=prepareRGB(r,g,b),r=b[0],g=b[1],b=b[2];var H,S,L,M,m,C;return M=mmax(r,g,b),m=mmin(r,g,b),C=M-m,H=0==C?null:M==r?(g-b)/C:M==g?(b-r)/C+2:(r-g)/C+4,H=(H+360)%6*60/360,L=(M+m)/2,S=0==C?0:L<.5?C/(2*L):C/(2-2*L),{h:H,s:S,l:L,toString:hsltoString}},Snap.parsePathString=function(pathString){if(!pathString)return null;var pth=Snap.path(pathString);if(pth.arr)return Snap.path.clone(pth.arr);var paramCounts={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},data=[];return is(pathString,"array")&&is(pathString[0],"array")&&(data=Snap.path.clone(pathString)),data.length||Str(pathString).replace(pathCommand,function(a,b,c){var params=[],name=b.toLowerCase();if(c.replace(pathValues,function(a,b){b&&params.push(+b)}),"m"==name&&params.length>2&&(data.push([b].concat(params.splice(0,2))),name="l",b="m"==b?"l":"L"),"o"==name&&1==params.length&&data.push([b,params[0]]),"r"==name)data.push([b].concat(params));else for(;params.length>=paramCounts[name]&&(data.push([b].concat(params.splice(0,paramCounts[name]))),paramCounts[name]););}),data.toString=Snap.path.toString,pth.arr=Snap.path.clone(data),data};var parseTransformString=Snap.parseTransformString=function(TString){if(!TString)return null;var data=[];return is(TString,"array")&&is(TString[0],"array")&&(data=Snap.path.clone(TString)),data.length||Str(TString).replace(tCommand,function(a,b,c){var params=[];b.toLowerCase();c.replace(pathValues,function(a,b){b&&params.push(+b)}),data.push([b].concat(params))}),data.toString=Snap.path.toString,data};Snap._.svgTransform2string=svgTransform2string,Snap._.rgTransform=/^[a-z][\s]*-?\.?\d/i,Snap._.transform2matrix=transform2matrix,Snap._unit2px=unit2px;glob.doc.contains||glob.doc.compareDocumentPosition;Snap._.getSomeDefs=getSomeDefs,Snap._.getSomeSVG=getSomeSVG,Snap.select=function(query){return query=Str(query).replace(/([^\\]):/g,"$1\\:"),wrap(glob.doc.querySelector(query))},Snap.selectAll=function(query){for(var nodelist=glob.doc.querySelectorAll(query),set=(Snap.set||Array)(),i=0;i<nodelist.length;i++)set.push(wrap(nodelist[i]));return set},setInterval(function(){for(var key in hub)if(hub[has](key)){var el=hub[key],node=el.node;("svg"!=el.type&&!node.ownerSVGElement||"svg"==el.type&&(!node.parentNode||"ownerSVGElement"in node.parentNode&&!node.ownerSVGElement))&&delete hub[key]}},1e4),Element.prototype.attr=function(params,value){var el=this;el.node;if(!params)return el;if(is(params,"string")){if(!(arguments.length>1))return eve("snap.util.getattr."+params,el).firstDefined();var json={};json[params]=value,params=json}for(var att in params)params[has](att)&&eve("snap.util.attr."+att,el,params[att]);return el},Snap.parse=function(svg){var f=glob.doc.createDocumentFragment(),full=!0,div=glob.doc.createElement("div");if(svg=Str(svg),svg.match(/^\s*<\s*svg(?:\s|>)/)||(svg="<svg>"+svg+"</svg>",full=!1),div.innerHTML=svg,svg=div.getElementsByTagName("svg")[0])if(full)f=svg;else{for(;svg.firstChild;)f.appendChild(svg.firstChild);div.innerHTML=E}return new Fragment(f)},Snap.fragment=function(){for(var args=Array.prototype.slice.call(arguments,0),f=glob.doc.createDocumentFragment(),i=0,ii=args.length;i<ii;i++){var item=args[i];item.node&&item.node.nodeType&&f.appendChild(item.node),item.nodeType&&f.appendChild(item),"string"==typeof item&&f.appendChild(Snap.parse(item).node)}return new Fragment(f)},Snap._.make=make,Snap._.wrap=wrap,Paper.prototype.el=function(name,attr){var el=make(name,this.node);return attr&&el.attr(attr),el},eve.on("snap.util.getattr",function(){var att=eve.nt();att=att.substring(att.lastIndexOf(".")+1);var css=att.replace(/[A-Z]/g,function(letter){return"-"+letter.toLowerCase()});return cssAttr[has](css)?this.node.ownerDocument.defaultView.getComputedStyle(this.node,null).getPropertyValue(css):$(this.node,att)});var cssAttr={"alignment-baseline":0,"baseline-shift":0,clip:0,"clip-path":0,"clip-rule":0,color:0,"color-interpolation":0,"color-interpolation-filters":0,"color-profile":0,"color-rendering":0,cursor:0,direction:0,display:0,"dominant-baseline":0,"enable-background":0,fill:0,"fill-opacity":0,"fill-rule":0,filter:0,"flood-color":0,"flood-opacity":0,font:0,"font-family":0,"font-size":0,"font-size-adjust":0,"font-stretch":0,"font-style":0,"font-variant":0,"font-weight":0,"glyph-orientation-horizontal":0,"glyph-orientation-vertical":0,"image-rendering":0,kerning:0,"letter-spacing":0,"lighting-color":0,marker:0,"marker-end":0,"marker-mid":0,"marker-start":0,mask:0,opacity:0,overflow:0,"pointer-events":0,"shape-rendering":0,"stop-color":0,"stop-opacity":0,stroke:0,"stroke-dasharray":0,"stroke-dashoffset":0,"stroke-linecap":0,"stroke-linejoin":0,"stroke-miterlimit":0,"stroke-opacity":0,"stroke-width":0,"text-anchor":0,"text-decoration":0,"text-rendering":0,"unicode-bidi":0,visibility:0,"word-spacing":0,"writing-mode":0};eve.on("snap.util.attr",function(value){var att=eve.nt(),attr={};att=att.substring(att.lastIndexOf(".")+1),attr[att]=value;var style=att.replace(/-(\w)/gi,function(all,letter){return letter.toUpperCase()}),css=att.replace(/[A-Z]/g,function(letter){return"-"+letter.toLowerCase()});cssAttr[has](css)?this.node.style[style]=null==value?E:value:$(this.node,attr)}),Paper.prototype,Snap.ajax=function(url,postData,callback,scope){var req=new XMLHttpRequest,id=ID();if(req){if(is(postData,"function"))scope=callback,callback=postData,postData=null;else if(is(postData,"object")){var pd=[];for(var key in postData)postData.hasOwnProperty(key)&&pd.push(encodeURIComponent(key)+"="+encodeURIComponent(postData[key]));postData=pd.join("&")}return req.open(postData?"POST":"GET",url,!0),(postData&&(req.setRequestHeader("X-Requested-With","XMLHttpRequest"),req.setRequestHeader("Content-type","application/x-www-form-urlencoded")),callback&&(eve.once("snap.ajax."+id+".0",callback),eve.once("snap.ajax."+id+".200",callback),eve.once("snap.ajax."+id+".304",callback)),req.onreadystatechange=function(){4==req.readyState&&eve("snap.ajax."+id+"."+req.status,scope,req)},4==req.readyState)?req:(req.send(postData),req)}},Snap.load=function(url,callback,scope){Snap.ajax(url,function(req){var f=Snap.parse(req.responseText);scope?callback.call(scope,f):callback(f)})};var getOffset=function(elem){var box=elem.getBoundingClientRect(),doc=elem.ownerDocument,body=doc.body,docElem=doc.documentElement,clientTop=docElem.clientTop||body.clientTop||0,clientLeft=docElem.clientLeft||body.clientLeft||0;return{y:box.top+(g.win.pageYOffset||docElem.scrollTop||body.scrollTop)-clientTop,x:box.left+(g.win.pageXOffset||docElem.scrollLeft||body.scrollLeft)-clientLeft}};return Snap.getElementByPoint=function(x,y){var paper=this,target=(paper.canvas,glob.doc.elementFromPoint(x,y));if(glob.win.opera&&"svg"==target.tagName){var so=getOffset(target),sr=target.createSVGRect();sr.x=x-so.x,sr.y=y-so.y,sr.width=sr.height=1;var hits=target.getIntersectionList(sr,null);hits.length&&(target=hits[hits.length-1])}return target?wrap(target):null},Snap.plugin=function(f){f(Snap,Element,Paper,glob,Fragment)},glob.win.Snap=Snap,Snap}(window||this);return Snap.plugin(function(Snap,Element,Paper,glob,Fragment){function extractTransform(el,tstr){if(null==tstr){var doReturn=!0;if(!(tstr="linearGradient"==el.type||"radialGradient"==el.type?el.node.getAttribute("gradientTransform"):"pattern"==el.type?el.node.getAttribute("patternTransform"):el.node.getAttribute("transform")))return new Snap.Matrix;tstr=Snap._.svgTransform2string(tstr)}else tstr=Snap._.rgTransform.test(tstr)?Str(tstr).replace(/\.{3}|\u2026/g,el._.transform||E):Snap._.svgTransform2string(tstr),is(tstr,"array")&&(tstr=Snap.path?Snap.path.toString.call(tstr):Str(tstr)),el._.transform=tstr;var m=Snap._.transform2matrix(tstr,el.getBBox(1));if(doReturn)return m;el.matrix=m}function fixids(el){function urltest(it,name){var val=$(it.node,name);val=val&&val.match(url),(val=val&&val[2])&&"#"==val.charAt()&&(val=val.substring(1))&&(uses[val]=(uses[val]||[]).concat(function(id){var attr={};attr[name]=URL(id),$(it.node,attr)}))}for(var it,els=el.selectAll("*"),url=/^\s*url\(("|'|)(.*)\1\)\s*$/,ids=[],uses={},i=0,ii=els.length;i<ii;i++){it=els[i],urltest(it,"fill"),urltest(it,"stroke"),urltest(it,"filter"),urltest(it,"mask"),urltest(it,"clip-path"),function(it){var val=$(it.node,"xlink:href");val&&"#"==val.charAt()&&(val=val.substring(1))&&(uses[val]=(uses[val]||[]).concat(function(id){it.attr("xlink:href","#"+id)}))}(it);var oldid=$(it.node,"id");oldid&&($(it.node,{id:it.id}),ids.push({old:oldid,id:it.id}))}for(i=0,ii=ids.length;i<ii;i++){var fs=uses[ids[i].old];if(fs)for(var j=0,jj=fs.length;j<jj;j++)fs[j](ids[i].id)}}function slice(from,to,f){return function(arr){var res=arr.slice(from,to);return 1==res.length&&(res=res[0]),f?f(res):res}}function toString(type){return function(){var res=type?"<"+this.type:"",attr=this.node.attributes,chld=this.node.childNodes;if(type)for(var i=0,ii=attr.length;i<ii;i++)res+=" "+attr[i].name+'="'+attr[i].value.replace(/"/g,'\\"')+'"';if(chld.length){for(type&&(res+=">"),i=0,ii=chld.length;i<ii;i++)3==chld[i].nodeType?res+=chld[i].nodeValue:1==chld[i].nodeType&&(res+=wrap(chld[i]).toString());type&&(res+="</"+this.type+">")}else type&&(res+="/>");return res}}var elproto=Element.prototype,is=Snap.is,Str=String,unit2px=Snap._unit2px,$=Snap._.$,make=Snap._.make,getSomeDefs=Snap._.getSomeDefs,has="hasOwnProperty",wrap=Snap._.wrap;elproto.getBBox=function(isWithoutTransform){if(!Snap.Matrix||!Snap.path)return this.node.getBBox();var el=this,m=new Snap.Matrix;if(el.removed)return Snap._.box();for(;"use"==el.type;)if(isWithoutTransform||(m=m.add(el.transform().localMatrix.translate(el.attr("x")||0,el.attr("y")||0))),el.original)el=el.original;else{var href=el.attr("xlink:href");el=el.original=el.node.ownerDocument.getElementById(href.substring(href.indexOf("#")+1))}var _=el._,pathfinder=Snap.path.get[el.type]||Snap.path.get.deflt;try{return isWithoutTransform?(_.bboxwt=pathfinder?Snap.path.getBBox(el.realPath=pathfinder(el)):Snap._.box(el.node.getBBox()),Snap._.box(_.bboxwt)):(el.realPath=pathfinder(el),el.matrix=el.transform().localMatrix,_.bbox=Snap.path.getBBox(Snap.path.map(el.realPath,m.add(el.matrix))),Snap._.box(_.bbox))}catch(e){return Snap._.box()}};var propString=function(){return this.string};elproto.transform=function(tstr){var _=this._;if(null==tstr){for(var i,papa=this,global=new Snap.Matrix(this.node.getCTM()),local=extractTransform(this),ms=[local],m=new Snap.Matrix,localString=local.toTransformString(),string=Str(local)==Str(this.matrix)?Str(_.transform):localString;"svg"!=papa.type&&(papa=papa.parent());)ms.push(extractTransform(papa));for(i=ms.length;i--;)m.add(ms[i]);return{string:string,globalMatrix:global,totalMatrix:m,localMatrix:local,diffMatrix:global.clone().add(local.invert()),global:global.toTransformString(),total:m.toTransformString(),local:localString,toString:propString}}return tstr instanceof Snap.Matrix?(this.matrix=tstr,this._.transform=tstr.toTransformString()):extractTransform(this,tstr),this.node&&("linearGradient"==this.type||"radialGradient"==this.type?$(this.node,{gradientTransform:this.matrix}):"pattern"==this.type?$(this.node,{patternTransform:this.matrix}):$(this.node,{transform:this.matrix})),this},elproto.parent=function(){return wrap(this.node.parentNode)},elproto.append=elproto.add=function(el){if(el){if("set"==el.type){var it=this;return el.forEach(function(el){it.add(el)}),this}el=wrap(el),this.node.appendChild(el.node),el.paper=this.paper}return this},elproto.appendTo=function(el){return el&&(el=wrap(el),el.append(this)),this},elproto.prepend=function(el){if(el){if("set"==el.type){var first,it=this;return el.forEach(function(el){first?first.after(el):it.prepend(el),first=el}),this}el=wrap(el);var parent=el.parent();this.node.insertBefore(el.node,this.node.firstChild),this.add&&this.add(),el.paper=this.paper,this.parent()&&this.parent().add(),parent&&parent.add()}return this},elproto.prependTo=function(el){return el=wrap(el),el.prepend(this),this},elproto.before=function(el){if("set"==el.type){var it=this;return el.forEach(function(el){var parent=el.parent();it.node.parentNode.insertBefore(el.node,it.node),parent&&parent.add()}),this.parent().add(),this}el=wrap(el);var parent=el.parent();return this.node.parentNode.insertBefore(el.node,this.node),this.parent()&&this.parent().add(),parent&&parent.add(),el.paper=this.paper,this},elproto.after=function(el){el=wrap(el);var parent=el.parent();return this.node.nextSibling?this.node.parentNode.insertBefore(el.node,this.node.nextSibling):this.node.parentNode.appendChild(el.node),this.parent()&&this.parent().add(),parent&&parent.add(),el.paper=this.paper,this},elproto.insertBefore=function(el){el=wrap(el);var parent=this.parent();return el.node.parentNode.insertBefore(this.node,el.node),this.paper=el.paper,parent&&parent.add(),el.parent()&&el.parent().add(),this},elproto.insertAfter=function(el){el=wrap(el);var parent=this.parent();return el.node.parentNode.insertBefore(this.node,el.node.nextSibling),this.paper=el.paper,parent&&parent.add(),el.parent()&&el.parent().add(),this},elproto.remove=function(){var parent=this.parent();return this.node.parentNode&&this.node.parentNode.removeChild(this.node),delete this.paper,this.removed=!0,parent&&parent.add(),this},elproto.select=function(query){return query=Str(query).replace(/([^\\]):/g,"$1\\:"),wrap(this.node.querySelector(query))},elproto.selectAll=function(query){for(var nodelist=this.node.querySelectorAll(query),set=(Snap.set||Array)(),i=0;i<nodelist.length;i++)set.push(wrap(nodelist[i]));return set},elproto.asPX=function(attr,value){return null==value&&(value=this.attr(attr)),+unit2px(this,attr,value)},elproto.use=function(){var use,id=this.node.id;return id||(id=this.id,$(this.node,{id:id})),use="linearGradient"==this.type||"radialGradient"==this.type||"pattern"==this.type?make(this.type,this.node.parentNode):make("use",this.node.parentNode),$(use.node,{"xlink:href":"#"+id}),use.original=this,use},elproto.clone=function(){var clone=wrap(this.node.cloneNode(!0));return $(clone.node,"id")&&$(clone.node,{id:clone.id}),fixids(clone),clone.insertAfter(this),clone},elproto.toDefs=function(){return getSomeDefs(this).appendChild(this.node),this},elproto.pattern=elproto.toPattern=function(x,y,width,height){var p=make("pattern",getSomeDefs(this));return null==x&&(x=this.getBBox()),is(x,"object")&&"x"in x&&(y=x.y,width=x.width,height=x.height,x=x.x),$(p.node,{x:x,y:y,width:width,height:height,patternUnits:"userSpaceOnUse",id:p.id,viewBox:[x,y,width,height].join(" ")}),
p.node.appendChild(this.node),p},elproto.marker=function(x,y,width,height,refX,refY){var p=make("marker",getSomeDefs(this));return null==x&&(x=this.getBBox()),is(x,"object")&&"x"in x&&(y=x.y,width=x.width,height=x.height,refX=x.refX||x.cx,refY=x.refY||x.cy,x=x.x),$(p.node,{viewBox:[x,y,width,height].join(" "),markerWidth:width,markerHeight:height,orient:"auto",refX:refX||0,refY:refY||0,id:p.id}),p.node.appendChild(this.node),p};var Animation=function(attr,ms,easing,callback){"function"!=typeof easing||easing.length||(callback=easing,easing=mina.linear),this.attr=attr,this.dur=ms,easing&&(this.easing=easing),callback&&(this.callback=callback)};Snap._.Animation=Animation,Snap.animation=function(attr,ms,easing,callback){return new Animation(attr,ms,easing,callback)},elproto.inAnim=function(){var el=this,res=[];for(var id in el.anims)el.anims[has](id)&&function(a){res.push({anim:new Animation(a._attrs,a.dur,a.easing,a._callback),mina:a,curStatus:a.status(),status:function(val){return a.status(val)},stop:function(){a.stop()}})}(el.anims[id]);return res},Snap.animate=function(from,to,setter,ms,easing,callback){"function"!=typeof easing||easing.length||(callback=easing,easing=mina.linear);var now=mina.time(),anim=mina(from,to,now,now+ms,mina.time,setter,easing);return callback&&eve.once("mina.finish."+anim.id,callback),anim},elproto.stop=function(){for(var anims=this.inAnim(),i=0,ii=anims.length;i<ii;i++)anims[i].stop();return this},elproto.animate=function(attrs,ms,easing,callback){"function"!=typeof easing||easing.length||(callback=easing,easing=mina.linear),attrs instanceof Animation&&(callback=attrs.callback,easing=attrs.easing,ms=easing.dur,attrs=attrs.attr);var from,to,f,eq,fkeys=[],tkeys=[],keys={},el=this;for(var key in attrs)if(attrs[has](key)){el.equal?(eq=el.equal(key,Str(attrs[key])),from=eq.from,to=eq.to,f=eq.f):(from=+el.attr(key),to=+attrs[key]);var len=is(from,"array")?from.length:1;keys[key]=slice(fkeys.length,fkeys.length+len,f),fkeys=fkeys.concat(from),tkeys=tkeys.concat(to)}var now=mina.time(),anim=mina(fkeys,tkeys,now,now+ms,mina.time,function(val){var attr={};for(var key in keys)keys[has](key)&&(attr[key]=keys[key](val));el.attr(attr)},easing);return el.anims[anim.id]=anim,anim._attrs=attrs,anim._callback=callback,eve("snap.animcreated."+el.id,anim),eve.once("mina.finish."+anim.id,function(){delete el.anims[anim.id],callback&&callback.call(el)}),eve.once("mina.stop."+anim.id,function(){delete el.anims[anim.id]}),el};var eldata={};elproto.data=function(key,value){var data=eldata[this.id]=eldata[this.id]||{};if(0==arguments.length)return eve("snap.data.get."+this.id,this,data,null),data;if(1==arguments.length){if(Snap.is(key,"object")){for(var i in key)key[has](i)&&this.data(i,key[i]);return this}return eve("snap.data.get."+this.id,this,data[key],key),data[key]}return data[key]=value,eve("snap.data.set."+this.id,this,value,key),this},elproto.removeData=function(key){return null==key?eldata[this.id]={}:eldata[this.id]&&delete eldata[this.id][key],this},elproto.outerSVG=elproto.toString=toString(1),elproto.innerSVG=toString(),elproto.toDataURL=function(){if(window&&window.btoa){var bb=this.getBBox(),svg=Snap.format('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="{width}" height="{height}" viewBox="{x} {y} {width} {height}">{contents}</svg>',{x:+bb.x.toFixed(3),y:+bb.y.toFixed(3),width:+bb.width.toFixed(3),height:+bb.height.toFixed(3),contents:this.outerSVG()});return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(svg)))}},Fragment.prototype.select=elproto.select,Fragment.prototype.selectAll=elproto.selectAll}),Snap.plugin(function(Snap,Element,Paper,glob,Fragment){function Matrix(a,b,c,d,e,f){if(null==b&&"[object SVGMatrix]"==objectToString.call(a))return this.a=a.a,this.b=a.b,this.c=a.c,this.d=a.d,this.e=a.e,void(this.f=a.f);null!=a?(this.a=+a,this.b=+b,this.c=+c,this.d=+d,this.e=+e,this.f=+f):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}var objectToString=Object.prototype.toString,Str=String,math=Math;!function(matrixproto){function norm(a){return a[0]*a[0]+a[1]*a[1]}function normalize(a){var mag=math.sqrt(norm(a));a[0]&&(a[0]/=mag),a[1]&&(a[1]/=mag)}matrixproto.add=function(a,b,c,d,e,f){var x,y,z,res,out=[[],[],[]],m=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],matrix=[[a,c,e],[b,d,f],[0,0,1]];for(a&&a instanceof Matrix&&(matrix=[[a.a,a.c,a.e],[a.b,a.d,a.f],[0,0,1]]),x=0;x<3;x++)for(y=0;y<3;y++){for(res=0,z=0;z<3;z++)res+=m[x][z]*matrix[z][y];out[x][y]=res}return this.a=out[0][0],this.b=out[1][0],this.c=out[0][1],this.d=out[1][1],this.e=out[0][2],this.f=out[1][2],this},matrixproto.invert=function(){var me=this,x=me.a*me.d-me.b*me.c;return new Matrix(me.d/x,-me.b/x,-me.c/x,me.a/x,(me.c*me.f-me.d*me.e)/x,(me.b*me.e-me.a*me.f)/x)},matrixproto.clone=function(){return new Matrix(this.a,this.b,this.c,this.d,this.e,this.f)},matrixproto.translate=function(x,y){return this.add(1,0,0,1,x,y)},matrixproto.scale=function(x,y,cx,cy){return null==y&&(y=x),(cx||cy)&&this.add(1,0,0,1,cx,cy),this.add(x,0,0,y,0,0),(cx||cy)&&this.add(1,0,0,1,-cx,-cy),this},matrixproto.rotate=function(a,x,y){a=Snap.rad(a),x=x||0,y=y||0;var cos=+math.cos(a).toFixed(9),sin=+math.sin(a).toFixed(9);return this.add(cos,sin,-sin,cos,x,y),this.add(1,0,0,1,-x,-y)},matrixproto.x=function(x,y){return x*this.a+y*this.c+this.e},matrixproto.y=function(x,y){return x*this.b+y*this.d+this.f},matrixproto.get=function(i){return+this[Str.fromCharCode(97+i)].toFixed(4)},matrixproto.toString=function(){return"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")"},matrixproto.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},matrixproto.determinant=function(){return this.a*this.d-this.b*this.c},matrixproto.split=function(){var out={};out.dx=this.e,out.dy=this.f;var row=[[this.a,this.c],[this.b,this.d]];out.scalex=math.sqrt(norm(row[0])),normalize(row[0]),out.shear=row[0][0]*row[1][0]+row[0][1]*row[1][1],row[1]=[row[1][0]-row[0][0]*out.shear,row[1][1]-row[0][1]*out.shear],out.scaley=math.sqrt(norm(row[1])),normalize(row[1]),out.shear/=out.scaley,this.determinant()<0&&(out.scalex=-out.scalex);var sin=-row[0][1],cos=row[1][1];return cos<0?(out.rotate=Snap.deg(math.acos(cos)),sin<0&&(out.rotate=360-out.rotate)):out.rotate=Snap.deg(math.asin(sin)),out.isSimple=!(+out.shear.toFixed(9)||out.scalex.toFixed(9)!=out.scaley.toFixed(9)&&out.rotate),out.isSuperSimple=!+out.shear.toFixed(9)&&out.scalex.toFixed(9)==out.scaley.toFixed(9)&&!out.rotate,out.noRotation=!+out.shear.toFixed(9)&&!out.rotate,out},matrixproto.toTransformString=function(shorter){var s=shorter||this.split();return+s.shear.toFixed(9)?"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]:(s.scalex=+s.scalex.toFixed(4),s.scaley=+s.scaley.toFixed(4),s.rotate=+s.rotate.toFixed(4),(s.dx||s.dy?"t"+[+s.dx.toFixed(4),+s.dy.toFixed(4)]:"")+(1!=s.scalex||1!=s.scaley?"s"+[s.scalex,s.scaley,0,0]:"")+(s.rotate?"r"+[+s.rotate.toFixed(4),0,0]:""))}}(Matrix.prototype),Snap.Matrix=Matrix,Snap.matrix=function(a,b,c,d,e,f){return new Matrix(a,b,c,d,e,f)}}),Snap.plugin(function(Snap,Element,Paper,glob,Fragment){function fillStroke(name){return function(value){if(eve.stop(),value instanceof Fragment&&1==value.node.childNodes.length&&("radialGradient"==value.node.firstChild.tagName||"linearGradient"==value.node.firstChild.tagName||"pattern"==value.node.firstChild.tagName)&&(value=value.node.firstChild,getSomeDefs(this).appendChild(value),value=wrap(value)),value instanceof Element)if("radialGradient"==value.type||"linearGradient"==value.type||"pattern"==value.type){value.node.id||$(value.node,{id:value.id});var fill=URL(value.node.id)}else fill=value.attr(name);else if(fill=Snap.color(value),fill.error){var grad=Snap(getSomeDefs(this).ownerSVGElement).gradient(value);grad?(grad.node.id||$(grad.node,{id:grad.id}),fill=URL(grad.node.id)):fill=value}else fill=Str(fill);var attrs={};attrs[name]=fill,$(this.node,attrs),this.node.style[name]=E}}function setFontSize(value){eve.stop(),value==+value&&(value+="px"),this.node.style.fontSize=value}function textExtract(node){for(var out=[],children=node.childNodes,i=0,ii=children.length;i<ii;i++){var chi=children[i];3==chi.nodeType&&out.push(chi.nodeValue),"tspan"==chi.tagName&&(1==chi.childNodes.length&&3==chi.firstChild.nodeType?out.push(chi.firstChild.nodeValue):out.push(textExtract(chi)))}return out}function getFontSize(){return eve.stop(),this.node.style.fontSize}var make=Snap._.make,wrap=Snap._.wrap,is=Snap.is,getSomeDefs=Snap._.getSomeDefs,reURLValue=/^url\(#?([^)]+)\)$/,$=Snap._.$,URL=Snap.url,Str=String,separator=Snap._.separator,E="";eve.on("snap.util.attr.mask",function(value){if(value instanceof Element||value instanceof Fragment){if(eve.stop(),value instanceof Fragment&&1==value.node.childNodes.length&&(value=value.node.firstChild,getSomeDefs(this).appendChild(value),value=wrap(value)),"mask"==value.type)var mask=value;else mask=make("mask",getSomeDefs(this)),mask.node.appendChild(value.node);!mask.node.id&&$(mask.node,{id:mask.id}),$(this.node,{mask:URL(mask.id)})}}),function(clipIt){eve.on("snap.util.attr.clip",clipIt),eve.on("snap.util.attr.clip-path",clipIt),eve.on("snap.util.attr.clipPath",clipIt)}(function(value){if(value instanceof Element||value instanceof Fragment){if(eve.stop(),"clipPath"==value.type)var clip=value;else clip=make("clipPath",getSomeDefs(this)),clip.node.appendChild(value.node),!clip.node.id&&$(clip.node,{id:clip.id});$(this.node,{"clip-path":URL(clip.node.id||clip.id)})}}),eve.on("snap.util.attr.fill",fillStroke("fill")),eve.on("snap.util.attr.stroke",fillStroke("stroke"));var gradrg=/^([lr])(?:\(([^)]*)\))?(.*)$/i;eve.on("snap.util.grad.parse",function(string){string=Str(string);var tokens=string.match(gradrg);if(!tokens)return null;var type=tokens[1],params=tokens[2],stops=tokens[3];return params=params.split(/\s*,\s*/).map(function(el){return+el==el?+el:el}),1==params.length&&0==params[0]&&(params=[]),stops=stops.split("-"),stops=stops.map(function(el){el=el.split(":");var out={color:el[0]};return el[1]&&(out.offset=parseFloat(el[1])),out}),{type:type,params:params,stops:stops}}),eve.on("snap.util.attr.d",function(value){eve.stop(),is(value,"array")&&is(value[0],"array")&&(value=Snap.path.toString.call(value)),value=Str(value),value.match(/[ruo]/i)&&(value=Snap.path.toAbsolute(value)),$(this.node,{d:value})})(-1),eve.on("snap.util.attr.#text",function(value){eve.stop(),value=Str(value);for(var txt=glob.doc.createTextNode(value);this.node.firstChild;)this.node.removeChild(this.node.firstChild);this.node.appendChild(txt)})(-1),eve.on("snap.util.attr.path",function(value){eve.stop(),this.attr({d:value})})(-1),eve.on("snap.util.attr.class",function(value){eve.stop(),this.node.className.baseVal=value})(-1),eve.on("snap.util.attr.viewBox",function(value){var vb;vb=is(value,"object")&&"x"in value?[value.x,value.y,value.width,value.height].join(" "):is(value,"array")?value.join(" "):value,$(this.node,{viewBox:vb}),eve.stop()})(-1),eve.on("snap.util.attr.transform",function(value){this.transform(value),eve.stop()})(-1),eve.on("snap.util.attr.r",function(value){"rect"==this.type&&(eve.stop(),$(this.node,{rx:value,ry:value}))})(-1),eve.on("snap.util.attr.textpath",function(value){if(eve.stop(),"text"==this.type){var id,tp,node;if(!value&&this.textPath){for(tp=this.textPath;tp.node.firstChild;)this.node.appendChild(tp.node.firstChild);return tp.remove(),void delete this.textPath}if(is(value,"string")){var defs=getSomeDefs(this),path=wrap(defs.parentNode).path(value);defs.appendChild(path.node),id=path.id,path.attr({id:id})}else(value=wrap(value))instanceof Element&&((id=value.attr("id"))||(id=value.id,value.attr({id:id})));if(id)if(tp=this.textPath,node=this.node,tp)tp.attr({"xlink:href":"#"+id});else{for(tp=$("textPath",{"xlink:href":"#"+id});node.firstChild;)tp.appendChild(node.firstChild);node.appendChild(tp),this.textPath=wrap(tp)}}})(-1),eve.on("snap.util.attr.text",function(value){if("text"==this.type){for(var node=this.node,tuner=function(chunk){var out=$("tspan");if(is(chunk,"array"))for(var i=0;i<chunk.length;i++)out.appendChild(tuner(chunk[i]));else out.appendChild(glob.doc.createTextNode(chunk));return out.normalize&&out.normalize(),out};node.firstChild;)node.removeChild(node.firstChild);for(var tuned=tuner(value);tuned.firstChild;)node.appendChild(tuned.firstChild)}eve.stop()})(-1),eve.on("snap.util.attr.fontSize",setFontSize)(-1),eve.on("snap.util.attr.font-size",setFontSize)(-1),eve.on("snap.util.getattr.transform",function(){return eve.stop(),this.transform()})(-1),eve.on("snap.util.getattr.textpath",function(){return eve.stop(),this.textPath})(-1),function(){function getter(end){return function(){eve.stop();var style=glob.doc.defaultView.getComputedStyle(this.node,null).getPropertyValue("marker-"+end);return"none"==style?style:Snap(glob.doc.getElementById(style.match(reURLValue)[1]))}}function setter(end){return function(value){eve.stop();var name="marker"+end.charAt(0).toUpperCase()+end.substring(1);if(""==value||!value)return void(this.node.style[name]="none");if("marker"==value.type){var id=value.node.id;return id||$(value.node,{id:value.id}),void(this.node.style[name]=URL(id))}}}eve.on("snap.util.getattr.marker-end",getter("end"))(-1),eve.on("snap.util.getattr.markerEnd",getter("end"))(-1),eve.on("snap.util.getattr.marker-start",getter("start"))(-1),eve.on("snap.util.getattr.markerStart",getter("start"))(-1),eve.on("snap.util.getattr.marker-mid",getter("mid"))(-1),eve.on("snap.util.getattr.markerMid",getter("mid"))(-1),eve.on("snap.util.attr.marker-end",setter("end"))(-1),eve.on("snap.util.attr.markerEnd",setter("end"))(-1),eve.on("snap.util.attr.marker-start",setter("start"))(-1),eve.on("snap.util.attr.markerStart",setter("start"))(-1),eve.on("snap.util.attr.marker-mid",setter("mid"))(-1),eve.on("snap.util.attr.markerMid",setter("mid"))(-1)}(),eve.on("snap.util.getattr.r",function(){if("rect"==this.type&&$(this.node,"rx")==$(this.node,"ry"))return eve.stop(),$(this.node,"rx")})(-1),eve.on("snap.util.getattr.text",function(){if("text"==this.type||"tspan"==this.type){eve.stop();var out=textExtract(this.node);return 1==out.length?out[0]:out}})(-1),eve.on("snap.util.getattr.#text",function(){return this.node.textContent})(-1),eve.on("snap.util.getattr.viewBox",function(){eve.stop();var vb=$(this.node,"viewBox");return vb?(vb=vb.split(separator),Snap._.box(+vb[0],+vb[1],+vb[2],+vb[3])):void 0})(-1),eve.on("snap.util.getattr.points",function(){var p=$(this.node,"points");return eve.stop(),p?p.split(separator):void 0})(-1),eve.on("snap.util.getattr.path",function(){var p=$(this.node,"d");return eve.stop(),p})(-1),eve.on("snap.util.getattr.class",function(){return this.node.className.baseVal})(-1),eve.on("snap.util.getattr.fontSize",getFontSize)(-1),eve.on("snap.util.getattr.font-size",getFontSize)(-1)}),Snap.plugin(function(Snap,Element,Paper,glob,Fragment){var proto=Paper.prototype,is=Snap.is;proto.rect=function(x,y,w,h,rx,ry){var attr;return null==ry&&(ry=rx),is(x,"object")&&"[object Object]"==x?attr=x:null!=x&&(attr={x:x,y:y,width:w,height:h},null!=rx&&(attr.rx=rx,attr.ry=ry)),this.el("rect",attr)},proto.circle=function(cx,cy,r){var attr;return is(cx,"object")&&"[object Object]"==cx?attr=cx:null!=cx&&(attr={cx:cx,cy:cy,r:r}),this.el("circle",attr)};var preload=function(){function onerror(){this.parentNode.removeChild(this)}return function(src,f){var img=glob.doc.createElement("img"),body=glob.doc.body;img.style.cssText="position:absolute;left:-9999em;top:-9999em",img.onload=function(){f.call(img),img.onload=img.onerror=null,body.removeChild(img)},img.onerror=onerror,body.appendChild(img),img.src=src}}();proto.image=function(src,x,y,width,height){var el=this.el("image");if(is(src,"object")&&"src"in src)el.attr(src);else if(null!=src){var set={"xlink:href":src,preserveAspectRatio:"none"};null!=x&&null!=y&&(set.x=x,set.y=y),null!=width&&null!=height?(set.width=width,set.height=height):preload(src,function(){Snap._.$(el.node,{width:this.offsetWidth,height:this.offsetHeight})}),Snap._.$(el.node,set)}return el},proto.ellipse=function(cx,cy,rx,ry){var attr;return is(cx,"object")&&"[object Object]"==cx?attr=cx:null!=cx&&(attr={cx:cx,cy:cy,rx:rx,ry:ry}),this.el("ellipse",attr)},proto.path=function(d){var attr;return is(d,"object")&&!is(d,"array")?attr=d:d&&(attr={d:d}),this.el("path",attr)},proto.group=proto.g=function(first){var el=this.el("g");return 1==arguments.length&&first&&!first.type?el.attr(first):arguments.length&&el.add(Array.prototype.slice.call(arguments,0)),el},proto.svg=function(x,y,width,height,vbx,vby,vbw,vbh){var attrs={};return is(x,"object")&&null==y?attrs=x:(null!=x&&(attrs.x=x),null!=y&&(attrs.y=y),null!=width&&(attrs.width=width),null!=height&&(attrs.height=height),null!=vbx&&null!=vby&&null!=vbw&&null!=vbh&&(attrs.viewBox=[vbx,vby,vbw,vbh])),this.el("svg",attrs)},proto.mask=function(first){var el=this.el("mask");return 1==arguments.length&&first&&!first.type?el.attr(first):arguments.length&&el.add(Array.prototype.slice.call(arguments,0)),el},proto.ptrn=function(x,y,width,height,vx,vy,vw,vh){if(is(x,"object"))var attr=x;else attr={patternUnits:"userSpaceOnUse"},x&&(attr.x=x),y&&(attr.y=y),null!=width&&(attr.width=width),null!=height&&(attr.height=height),null!=vx&&null!=vy&&null!=vw&&null!=vh&&(attr.viewBox=[vx,vy,vw,vh]);return this.el("pattern",attr)},proto.use=function(id){return null!=id?(id instanceof Element&&(id.attr("id")||id.attr({id:Snap._.id(id)}),id=id.attr("id")),"#"==String(id).charAt()&&(id=id.substring(1)),this.el("use",{"xlink:href":"#"+id})):Element.prototype.use.call(this)},proto.symbol=function(vx,vy,vw,vh){var attr={};return null!=vx&&null!=vy&&null!=vw&&null!=vh&&(attr.viewBox=[vx,vy,vw,vh]),this.el("symbol",attr)},proto.text=function(x,y,text){var attr={};return is(x,"object")?attr=x:null!=x&&(attr={x:x,y:y,text:text||""}),this.el("text",attr)},proto.line=function(x1,y1,x2,y2){var attr={};return is(x1,"object")?attr=x1:null!=x1&&(attr={x1:x1,x2:x2,y1:y1,y2:y2}),this.el("line",attr)},proto.polyline=function(points){arguments.length>1&&(points=Array.prototype.slice.call(arguments,0));var attr={};return is(points,"object")&&!is(points,"array")?attr=points:null!=points&&(attr={points:points}),this.el("polyline",attr)},proto.polygon=function(points){arguments.length>1&&(points=Array.prototype.slice.call(arguments,0));var attr={};return is(points,"object")&&!is(points,"array")?attr=points:null!=points&&(attr={points:points}),this.el("polygon",attr)},function(){function Gstops(){return this.selectAll("stop")}function GaddStop(color,offset){var stop=$("stop"),attr={offset:+offset+"%"};return color=Snap.color(color),attr["stop-color"]=color.hex,color.opacity<1&&(attr["stop-opacity"]=color.opacity),$(stop,attr),this.node.appendChild(stop),this}function GgetBBox(){if("linearGradient"==this.type){var x1=$(this.node,"x1")||0,x2=$(this.node,"x2")||1,y1=$(this.node,"y1")||0,y2=$(this.node,"y2")||0;return Snap._.box(x1,y1,math.abs(x2-x1),math.abs(y2-y1))}var cx=this.node.cx||.5,cy=this.node.cy||.5,r=this.node.r||0;return Snap._.box(cx-r,cy-r,2*r,2*r)}function gradient(defs,str){function seed(i,end){for(var step=(end-start)/(i-j),k=j;k<i;k++)stops[k].offset=+(+start+step*(k-j)).toFixed(2);j=i,start=end}var el,grad=eve("snap.util.grad.parse",null,str).firstDefined();if(!grad)return null;grad.params.unshift(defs),el="l"==grad.type.toLowerCase()?gradientLinear.apply(0,grad.params):gradientRadial.apply(0,grad.params),grad.type!=grad.type.toLowerCase()&&$(el.node,{gradientUnits:"userSpaceOnUse"});var stops=grad.stops,len=stops.length,start=0,j=0;len--;for(var i=0;i<len;i++)"offset"in stops[i]&&seed(i,stops[i].offset);for(stops[len].offset=stops[len].offset||100,seed(len,stops[len].offset),i=0;i<=len;i++){var stop=stops[i];el.addStop(stop.color,stop.offset)}return el}function gradientLinear(defs,x1,y1,x2,y2){var el=Snap._.make("linearGradient",defs);return el.stops=Gstops,el.addStop=GaddStop,el.getBBox=GgetBBox,null!=x1&&$(el.node,{x1:x1,y1:y1,x2:x2,y2:y2}),el}function gradientRadial(defs,cx,cy,r,fx,fy){var el=Snap._.make("radialGradient",defs);return el.stops=Gstops,el.addStop=GaddStop,el.getBBox=GgetBBox,null!=cx&&$(el.node,{cx:cx,cy:cy,r:r}),null!=fx&&null!=fy&&$(el.node,{fx:fx,fy:fy}),el}var $=Snap._.$;proto.gradient=function(str){return gradient(this.defs,str)},proto.gradientLinear=function(x1,y1,x2,y2){return gradientLinear(this.defs,x1,y1,x2,y2)},proto.gradientRadial=function(cx,cy,r,fx,fy){return gradientRadial(this.defs,cx,cy,r,fx,fy)},proto.toString=function(){var res,doc=this.node.ownerDocument,f=doc.createDocumentFragment(),d=doc.createElement("div"),svg=this.node.cloneNode(!0);return f.appendChild(d),d.appendChild(svg),Snap._.$(svg,{xmlns:"http://www.w3.org/2000/svg"}),res=d.innerHTML,f.removeChild(f.firstChild),res},proto.toDataURL=function(){if(window&&window.btoa)return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(this)))},proto.clear=function(){for(var next,node=this.node.firstChild;node;)next=node.nextSibling,"defs"!=node.tagName?node.parentNode.removeChild(node):proto.clear.call({node:node}),node=next}}()}),Snap.plugin(function(Snap,Element,Paper,glob){function paths(ps){var p=paths.ps=paths.ps||{};return p[ps]?p[ps].sleep=100:p[ps]={sleep:100},setTimeout(function(){for(var key in p)p[has](key)&&key!=ps&&!--p[key].sleep&&delete p[key]}),p[ps]}function box(x,y,width,height){return null==x&&(x=y=width=height=0),null==y&&(y=x.y,width=x.width,height=x.height,x=x.x),{x:x,y:y,width:width,w:width,height:height,h:height,x2:x+width,y2:y+height,cx:x+width/2,cy:y+height/2,r1:math.min(width,height)/2,r2:math.max(width,height)/2,r0:math.sqrt(width*width+height*height)/2,path:rectPath(x,y,width,height),vb:[x,y,width,height].join(" ")}}function toString(){return this.join(",").replace(p2s,"$1")}function pathClone(pathArray){var res=clone(pathArray);return res.toString=toString,res}function getPointAtSegmentLength(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,length){return null==length?bezlen(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y):findDotsAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,getTotLen(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,length))}function getLengthFactory(istotal,subpath){function O(val){return+(+val).toFixed(3)}return Snap._.cacher(function(path,length,onlystart){path instanceof Element&&(path=path.attr("d")),path=path2curve(path);for(var x,y,p,l,point,sp="",subpaths={},len=0,i=0,ii=path.length;i<ii;i++){if(p=path[i],"M"==p[0])x=+p[1],y=+p[2];else{if(l=getPointAtSegmentLength(x,y,p[1],p[2],p[3],p[4],p[5],p[6]),len+l>length){if(subpath&&!subpaths.start){if(point=getPointAtSegmentLength(x,y,p[1],p[2],p[3],p[4],p[5],p[6],length-len),sp+=["C"+O(point.start.x),O(point.start.y),O(point.m.x),O(point.m.y),O(point.x),O(point.y)],onlystart)return sp;subpaths.start=sp,sp=["M"+O(point.x),O(point.y)+"C"+O(point.n.x),O(point.n.y),O(point.end.x),O(point.end.y),O(p[5]),O(p[6])].join(),len+=l,x=+p[5],y=+p[6];continue}if(!istotal&&!subpath)return point=getPointAtSegmentLength(x,y,p[1],p[2],p[3],p[4],p[5],p[6],length-len)}len+=l,x=+p[5],y=+p[6]}sp+=p.shift()+p}return subpaths.end=sp,point=istotal?len:subpath?subpaths:findDotsAtSegment(x,y,p[0],p[1],p[2],p[3],p[4],p[5],1)},null,Snap._.clone)}function findDotsAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t){var t1=1-t,t13=pow(t1,3),t12=pow(t1,2),t2=t*t,t3=t2*t,x=t13*p1x+3*t12*t*c1x+3*t1*t*t*c2x+t3*p2x,y=t13*p1y+3*t12*t*c1y+3*t1*t*t*c2y+t3*p2y,mx=p1x+2*t*(c1x-p1x)+t2*(c2x-2*c1x+p1x),my=p1y+2*t*(c1y-p1y)+t2*(c2y-2*c1y+p1y),nx=c1x+2*t*(c2x-c1x)+t2*(p2x-2*c2x+c1x),ny=c1y+2*t*(c2y-c1y)+t2*(p2y-2*c2y+c1y);return{x:x,y:y,m:{x:mx,y:my},n:{x:nx,y:ny},start:{x:t1*p1x+t*c1x,y:t1*p1y+t*c1y},end:{x:t1*c2x+t*p2x,y:t1*c2y+t*p2y},alpha:90-180*math.atan2(mx-nx,my-ny)/PI}}function bezierBBox(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y){Snap.is(p1x,"array")||(p1x=[p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y]);var bbox=curveDim.apply(null,p1x);return box(bbox.min.x,bbox.min.y,bbox.max.x-bbox.min.x,bbox.max.y-bbox.min.y)}function isPointInsideBBox(bbox,x,y){return x>=bbox.x&&x<=bbox.x+bbox.width&&y>=bbox.y&&y<=bbox.y+bbox.height}function isBBoxIntersect(bbox1,bbox2){return bbox1=box(bbox1),bbox2=box(bbox2),isPointInsideBBox(bbox2,bbox1.x,bbox1.y)||isPointInsideBBox(bbox2,bbox1.x2,bbox1.y)||isPointInsideBBox(bbox2,bbox1.x,bbox1.y2)||isPointInsideBBox(bbox2,bbox1.x2,bbox1.y2)||isPointInsideBBox(bbox1,bbox2.x,bbox2.y)||isPointInsideBBox(bbox1,bbox2.x2,bbox2.y)||isPointInsideBBox(bbox1,bbox2.x,bbox2.y2)||isPointInsideBBox(bbox1,bbox2.x2,bbox2.y2)||(bbox1.x<bbox2.x2&&bbox1.x>bbox2.x||bbox2.x<bbox1.x2&&bbox2.x>bbox1.x)&&(bbox1.y<bbox2.y2&&bbox1.y>bbox2.y||bbox2.y<bbox1.y2&&bbox2.y>bbox1.y)}function base3(t,p1,p2,p3,p4){return t*(t*(-3*p1+9*p2-9*p3+3*p4)+6*p1-12*p2+6*p3)-3*p1+3*p2}function bezlen(x1,y1,x2,y2,x3,y3,x4,y4,z){null==z&&(z=1),z=z>1?1:z<0?0:z;for(var z2=z/2,Tvalues=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],Cvalues=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],sum=0,i=0;i<12;i++){var ct=z2*Tvalues[i]+z2,xbase=base3(ct,x1,x2,x3,x4),ybase=base3(ct,y1,y2,y3,y4),comb=xbase*xbase+ybase*ybase;sum+=Cvalues[i]*math.sqrt(comb)}return z2*sum}function getTotLen(x1,y1,x2,y2,x3,y3,x4,y4,ll){if(!(ll<0||bezlen(x1,y1,x2,y2,x3,y3,x4,y4)<ll)){var l,step=.5,t2=1-step;for(l=bezlen(x1,y1,x2,y2,x3,y3,x4,y4,t2);abs(l-ll)>.01;)step/=2,t2+=(l<ll?1:-1)*step,l=bezlen(x1,y1,x2,y2,x3,y3,x4,y4,t2);return t2}}function intersect(x1,y1,x2,y2,x3,y3,x4,y4){if(!(mmax(x1,x2)<mmin(x3,x4)||mmin(x1,x2)>mmax(x3,x4)||mmax(y1,y2)<mmin(y3,y4)||mmin(y1,y2)>mmax(y3,y4))){var nx=(x1*y2-y1*x2)*(x3-x4)-(x1-x2)*(x3*y4-y3*x4),ny=(x1*y2-y1*x2)*(y3-y4)-(y1-y2)*(x3*y4-y3*x4),denominator=(x1-x2)*(y3-y4)-(y1-y2)*(x3-x4);if(denominator){var px=nx/denominator,py=ny/denominator,px2=+px.toFixed(2),py2=+py.toFixed(2);if(!(px2<+mmin(x1,x2).toFixed(2)||px2>+mmax(x1,x2).toFixed(2)||px2<+mmin(x3,x4).toFixed(2)||px2>+mmax(x3,x4).toFixed(2)||py2<+mmin(y1,y2).toFixed(2)||py2>+mmax(y1,y2).toFixed(2)||py2<+mmin(y3,y4).toFixed(2)||py2>+mmax(y3,y4).toFixed(2)))return{x:px,y:py}}}}function interHelper(bez1,bez2,justCount){if(!isBBoxIntersect(bezierBBox(bez1),bezierBBox(bez2)))return justCount?0:[];for(var l1=bezlen.apply(0,bez1),l2=bezlen.apply(0,bez2),n1=~~(l1/8),n2=~~(l2/8),dots1=[],dots2=[],xy={},res=justCount?0:[],i=0;i<n1+1;i++){var p=findDotsAtSegment.apply(0,bez1.concat(i/n1));dots1.push({x:p.x,y:p.y,t:i/n1})}for(i=0;i<n2+1;i++)p=findDotsAtSegment.apply(0,bez2.concat(i/n2)),dots2.push({x:p.x,y:p.y,t:i/n2});for(i=0;i<n1;i++)for(var j=0;j<n2;j++){var di=dots1[i],di1=dots1[i+1],dj=dots2[j],dj1=dots2[j+1],ci=abs(di1.x-di.x)<.001?"y":"x",cj=abs(dj1.x-dj.x)<.001?"y":"x",is=intersect(di.x,di.y,di1.x,di1.y,dj.x,dj.y,dj1.x,dj1.y);if(is){if(xy[is.x.toFixed(4)]==is.y.toFixed(4))continue;xy[is.x.toFixed(4)]=is.y.toFixed(4);var t1=di.t+abs((is[ci]-di[ci])/(di1[ci]-di[ci]))*(di1.t-di.t),t2=dj.t+abs((is[cj]-dj[cj])/(dj1[cj]-dj[cj]))*(dj1.t-dj.t);t1>=0&&t1<=1&&t2>=0&&t2<=1&&(justCount?res++:res.push({x:is.x,y:is.y,t1:t1,t2:t2}))}}return res}function pathIntersection(path1,path2){return interPathHelper(path1,path2)}function pathIntersectionNumber(path1,path2){return interPathHelper(path1,path2,1)}function interPathHelper(path1,path2,justCount){path1=path2curve(path1),path2=path2curve(path2);for(var x1,y1,x2,y2,x1m,y1m,x2m,y2m,bez1,bez2,res=justCount?0:[],i=0,ii=path1.length;i<ii;i++){var pi=path1[i];if("M"==pi[0])x1=x1m=pi[1],y1=y1m=pi[2];else{"C"==pi[0]?(bez1=[x1,y1].concat(pi.slice(1)),x1=bez1[6],y1=bez1[7]):(bez1=[x1,y1,x1,y1,x1m,y1m,x1m,y1m],x1=x1m,y1=y1m);for(var j=0,jj=path2.length;j<jj;j++){var pj=path2[j];if("M"==pj[0])x2=x2m=pj[1],y2=y2m=pj[2];else{"C"==pj[0]?(bez2=[x2,y2].concat(pj.slice(1)),x2=bez2[6],y2=bez2[7]):(bez2=[x2,y2,x2,y2,x2m,y2m,x2m,y2m],x2=x2m,y2=y2m);var intr=interHelper(bez1,bez2,justCount);if(justCount)res+=intr;else{for(var k=0,kk=intr.length;k<kk;k++)intr[k].segment1=i,intr[k].segment2=j,intr[k].bez1=bez1,intr[k].bez2=bez2;res=res.concat(intr)}}}}}return res}function isPointInsidePath(path,x,y){var bbox=pathBBox(path);return isPointInsideBBox(bbox,x,y)&&interPathHelper(path,[["M",x,y],["H",bbox.x2+10]],1)%2==1}function pathBBox(path){var pth=paths(path);if(pth.bbox)return clone(pth.bbox);if(!path)return box();path=path2curve(path);for(var p,x=0,y=0,X=[],Y=[],i=0,ii=path.length;i<ii;i++)if(p=path[i],"M"==p[0])x=p[1],y=p[2],X.push(x),Y.push(y);else{var dim=curveDim(x,y,p[1],p[2],p[3],p[4],p[5],p[6]);X=X.concat(dim.min.x,dim.max.x),Y=Y.concat(dim.min.y,dim.max.y),x=p[5],y=p[6]}var xmin=mmin.apply(0,X),ymin=mmin.apply(0,Y),xmax=mmax.apply(0,X),ymax=mmax.apply(0,Y),bb=box(xmin,ymin,xmax-xmin,ymax-ymin);return pth.bbox=clone(bb),bb}function rectPath(x,y,w,h,r){if(r)return[["M",+x+ +r,y],["l",w-2*r,0],["a",r,r,0,0,1,r,r],["l",0,h-2*r],["a",r,r,0,0,1,-r,r],["l",2*r-w,0],["a",r,r,0,0,1,-r,-r],["l",0,2*r-h],["a",r,r,0,0,1,r,-r],["z"]];var res=[["M",x,y],["l",w,0],["l",0,h],["l",-w,0],["z"]];return res.toString=toString,res}function ellipsePath(x,y,rx,ry,a){if(null==a&&null==ry&&(ry=rx),x=+x,y=+y,rx=+rx,ry=+ry,null!=a)var rad=Math.PI/180,x1=x+rx*Math.cos(-ry*rad),x2=x+rx*Math.cos(-a*rad),y1=y+rx*Math.sin(-ry*rad),y2=y+rx*Math.sin(-a*rad),res=[["M",x1,y1],["A",rx,rx,0,+(a-ry>180),0,x2,y2]];else res=[["M",x,y],["m",0,-ry],["a",rx,ry,0,1,1,0,2*ry],["a",rx,ry,0,1,1,0,-2*ry],["z"]];return res.toString=toString,res}function pathToRelative(pathArray){var pth=paths(pathArray),lowerCase=String.prototype.toLowerCase;if(pth.rel)return pathClone(pth.rel);Snap.is(pathArray,"array")&&Snap.is(pathArray&&pathArray[0],"array")||(pathArray=Snap.parsePathString(pathArray));var res=[],x=0,y=0,mx=0,my=0,start=0;"M"==pathArray[0][0]&&(x=pathArray[0][1],y=pathArray[0][2],mx=x,my=y,start++,res.push(["M",x,y]));for(var i=start,ii=pathArray.length;i<ii;i++){var r=res[i]=[],pa=pathArray[i];if(pa[0]!=lowerCase.call(pa[0]))switch(r[0]=lowerCase.call(pa[0]),r[0]){case"a":r[1]=pa[1],r[2]=pa[2],r[3]=pa[3],r[4]=pa[4],r[5]=pa[5],r[6]=+(pa[6]-x).toFixed(3),r[7]=+(pa[7]-y).toFixed(3);break;case"v":r[1]=+(pa[1]-y).toFixed(3);break;case"m":mx=pa[1],my=pa[2];default:for(var j=1,jj=pa.length;j<jj;j++)r[j]=+(pa[j]-(j%2?x:y)).toFixed(3)}else{r=res[i]=[],"m"==pa[0]&&(mx=pa[1]+x,my=pa[2]+y);for(var k=0,kk=pa.length;k<kk;k++)res[i][k]=pa[k]}var len=res[i].length;switch(res[i][0]){case"z":x=mx,y=my;break;case"h":x+=+res[i][len-1];break;case"v":y+=+res[i][len-1];break;default:x+=+res[i][len-2],y+=+res[i][len-1]}}return res.toString=toString,pth.rel=pathClone(res),res}function pathToAbsolute(pathArray){var pth=paths(pathArray);if(pth.abs)return pathClone(pth.abs);if(is(pathArray,"array")&&is(pathArray&&pathArray[0],"array")||(pathArray=Snap.parsePathString(pathArray)),!pathArray||!pathArray.length)return[["M",0,0]];var pa0,res=[],x=0,y=0,mx=0,my=0,start=0;"M"==pathArray[0][0]&&(x=+pathArray[0][1],y=+pathArray[0][2],mx=x,my=y,start++,res[0]=["M",x,y]);for(var r,pa,crz=3==pathArray.length&&"M"==pathArray[0][0]&&"R"==pathArray[1][0].toUpperCase()&&"Z"==pathArray[2][0].toUpperCase(),i=start,ii=pathArray.length;i<ii;i++){if(res.push(r=[]),pa=pathArray[i],(pa0=pa[0])!=pa0.toUpperCase())switch(r[0]=pa0.toUpperCase(),r[0]){case"A":r[1]=pa[1],r[2]=pa[2],r[3]=pa[3],r[4]=pa[4],r[5]=pa[5],r[6]=+pa[6]+x,r[7]=+pa[7]+y;break;case"V":r[1]=+pa[1]+y;break;case"H":r[1]=+pa[1]+x;break;case"R":for(var dots=[x,y].concat(pa.slice(1)),j=2,jj=dots.length;j<jj;j++)dots[j]=+dots[j]+x,dots[++j]=+dots[j]+y;res.pop(),res=res.concat(catmullRom2bezier(dots,crz));break;case"O":res.pop(),dots=ellipsePath(x,y,pa[1],pa[2]),dots.push(dots[0]),res=res.concat(dots);break;case"U":res.pop(),res=res.concat(ellipsePath(x,y,pa[1],pa[2],pa[3])),r=["U"].concat(res[res.length-1].slice(-2));break;case"M":mx=+pa[1]+x,my=+pa[2]+y;default:for(j=1,jj=pa.length;j<jj;j++)r[j]=+pa[j]+(j%2?x:y)}else if("R"==pa0)dots=[x,y].concat(pa.slice(1)),res.pop(),res=res.concat(catmullRom2bezier(dots,crz)),
r=["R"].concat(pa.slice(-2));else if("O"==pa0)res.pop(),dots=ellipsePath(x,y,pa[1],pa[2]),dots.push(dots[0]),res=res.concat(dots);else if("U"==pa0)res.pop(),res=res.concat(ellipsePath(x,y,pa[1],pa[2],pa[3])),r=["U"].concat(res[res.length-1].slice(-2));else for(var k=0,kk=pa.length;k<kk;k++)r[k]=pa[k];if("O"!=(pa0=pa0.toUpperCase()))switch(r[0]){case"Z":x=+mx,y=+my;break;case"H":x=r[1];break;case"V":y=r[1];break;case"M":mx=r[r.length-2],my=r[r.length-1];default:x=r[r.length-2],y=r[r.length-1]}}return res.toString=toString,pth.abs=pathClone(res),res}function l2c(x1,y1,x2,y2){return[x1,y1,x2,y2,x2,y2]}function q2c(x1,y1,ax,ay,x2,y2){return[1/3*x1+2/3*ax,1/3*y1+2/3*ay,1/3*x2+2/3*ax,1/3*y2+2/3*ay,x2,y2]}function a2c(x1,y1,rx,ry,angle,large_arc_flag,sweep_flag,x2,y2,recursive){var xy,_120=120*PI/180,rad=PI/180*(+angle||0),res=[],rotate=Snap._.cacher(function(x,y,rad){return{x:x*math.cos(rad)-y*math.sin(rad),y:x*math.sin(rad)+y*math.cos(rad)}});if(recursive)f1=recursive[0],f2=recursive[1],cx=recursive[2],cy=recursive[3];else{xy=rotate(x1,y1,-rad),x1=xy.x,y1=xy.y,xy=rotate(x2,y2,-rad),x2=xy.x,y2=xy.y;var x=(math.cos(PI/180*angle),math.sin(PI/180*angle),(x1-x2)/2),y=(y1-y2)/2,h=x*x/(rx*rx)+y*y/(ry*ry);h>1&&(h=math.sqrt(h),rx*=h,ry*=h);var rx2=rx*rx,ry2=ry*ry,k=(large_arc_flag==sweep_flag?-1:1)*math.sqrt(abs((rx2*ry2-rx2*y*y-ry2*x*x)/(rx2*y*y+ry2*x*x))),cx=k*rx*y/ry+(x1+x2)/2,cy=k*-ry*x/rx+(y1+y2)/2,f1=math.asin(((y1-cy)/ry).toFixed(9)),f2=math.asin(((y2-cy)/ry).toFixed(9));f1=x1<cx?PI-f1:f1,f2=x2<cx?PI-f2:f2,f1<0&&(f1=2*PI+f1),f2<0&&(f2=2*PI+f2),sweep_flag&&f1>f2&&(f1-=2*PI),!sweep_flag&&f2>f1&&(f2-=2*PI)}var df=f2-f1;if(abs(df)>_120){var f2old=f2,x2old=x2,y2old=y2;f2=f1+_120*(sweep_flag&&f2>f1?1:-1),x2=cx+rx*math.cos(f2),y2=cy+ry*math.sin(f2),res=a2c(x2,y2,rx,ry,angle,0,sweep_flag,x2old,y2old,[f2,f2old,cx,cy])}df=f2-f1;var c1=math.cos(f1),s1=math.sin(f1),c2=math.cos(f2),s2=math.sin(f2),t=math.tan(df/4),hx=4/3*rx*t,hy=4/3*ry*t,m1=[x1,y1],m2=[x1+hx*s1,y1-hy*c1],m3=[x2+hx*s2,y2-hy*c2],m4=[x2,y2];if(m2[0]=2*m1[0]-m2[0],m2[1]=2*m1[1]-m2[1],recursive)return[m2,m3,m4].concat(res);res=[m2,m3,m4].concat(res).join().split(",");for(var newres=[],i=0,ii=res.length;i<ii;i++)newres[i]=i%2?rotate(res[i-1],res[i],rad).y:rotate(res[i],res[i+1],rad).x;return newres}function curveDim(x0,y0,x1,y1,x2,y2,x3,y3){for(var a,b,c,t,t1,t2,b2ac,sqrtb2ac,tvalues=[],bounds=[[],[]],i=0;i<2;++i)if(0==i?(b=6*x0-12*x1+6*x2,a=-3*x0+9*x1-9*x2+3*x3,c=3*x1-3*x0):(b=6*y0-12*y1+6*y2,a=-3*y0+9*y1-9*y2+3*y3,c=3*y1-3*y0),abs(a)<1e-12){if(abs(b)<1e-12)continue;0<(t=-c/b)&&t<1&&tvalues.push(t)}else b2ac=b*b-4*c*a,sqrtb2ac=math.sqrt(b2ac),b2ac<0||(t1=(-b+sqrtb2ac)/(2*a),0<t1&&t1<1&&tvalues.push(t1),0<(t2=(-b-sqrtb2ac)/(2*a))&&t2<1&&tvalues.push(t2));for(var mt,j=tvalues.length,jlen=j;j--;)t=tvalues[j],mt=1-t,bounds[0][j]=mt*mt*mt*x0+3*mt*mt*t*x1+3*mt*t*t*x2+t*t*t*x3,bounds[1][j]=mt*mt*mt*y0+3*mt*mt*t*y1+3*mt*t*t*y2+t*t*t*y3;return bounds[0][jlen]=x0,bounds[1][jlen]=y0,bounds[0][jlen+1]=x3,bounds[1][jlen+1]=y3,bounds[0].length=bounds[1].length=jlen+2,{min:{x:mmin.apply(0,bounds[0]),y:mmin.apply(0,bounds[1])},max:{x:mmax.apply(0,bounds[0]),y:mmax.apply(0,bounds[1])}}}function path2curve(path,path2){var pth=!path2&&paths(path);if(!path2&&pth.curve)return pathClone(pth.curve);for(var p=pathToAbsolute(path),p2=path2&&pathToAbsolute(path2),attrs={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},attrs2={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},processPath=(function(path,d,pcom){var nx,ny;if(!path)return["C",d.x,d.y,d.x,d.y,d.x,d.y];switch(!(path[0]in{T:1,Q:1})&&(d.qx=d.qy=null),path[0]){case"M":d.X=path[1],d.Y=path[2];break;case"A":path=["C"].concat(a2c.apply(0,[d.x,d.y].concat(path.slice(1))));break;case"S":"C"==pcom||"S"==pcom?(nx=2*d.x-d.bx,ny=2*d.y-d.by):(nx=d.x,ny=d.y),path=["C",nx,ny].concat(path.slice(1));break;case"T":"Q"==pcom||"T"==pcom?(d.qx=2*d.x-d.qx,d.qy=2*d.y-d.qy):(d.qx=d.x,d.qy=d.y),path=["C"].concat(q2c(d.x,d.y,d.qx,d.qy,path[1],path[2]));break;case"Q":d.qx=path[1],d.qy=path[2],path=["C"].concat(q2c(d.x,d.y,path[1],path[2],path[3],path[4]));break;case"L":path=["C"].concat(l2c(d.x,d.y,path[1],path[2]));break;case"H":path=["C"].concat(l2c(d.x,d.y,path[1],d.y));break;case"V":path=["C"].concat(l2c(d.x,d.y,d.x,path[1]));break;case"Z":path=["C"].concat(l2c(d.x,d.y,d.X,d.Y))}return path}),fixArc=function(pp,i){if(pp[i].length>7){pp[i].shift();for(var pi=pp[i];pi.length;)pcoms1[i]="A",p2&&(pcoms2[i]="A"),pp.splice(i++,0,["C"].concat(pi.splice(0,6)));pp.splice(i,1),ii=mmax(p.length,p2&&p2.length||0)}},fixM=function(path1,path2,a1,a2,i){path1&&path2&&"M"==path1[i][0]&&"M"!=path2[i][0]&&(path2.splice(i,0,["M",a2.x,a2.y]),a1.bx=0,a1.by=0,a1.x=path1[i][1],a1.y=path1[i][2],ii=mmax(p.length,p2&&p2.length||0))},pcoms1=[],pcoms2=[],pfirst="",pcom="",i=0,ii=mmax(p.length,p2&&p2.length||0);i<ii;i++){p[i]&&(pfirst=p[i][0]),"C"!=pfirst&&(pcoms1[i]=pfirst,i&&(pcom=pcoms1[i-1])),p[i]=processPath(p[i],attrs,pcom),"A"!=pcoms1[i]&&"C"==pfirst&&(pcoms1[i]="C"),fixArc(p,i),p2&&(p2[i]&&(pfirst=p2[i][0]),"C"!=pfirst&&(pcoms2[i]=pfirst,i&&(pcom=pcoms2[i-1])),p2[i]=processPath(p2[i],attrs2,pcom),"A"!=pcoms2[i]&&"C"==pfirst&&(pcoms2[i]="C"),fixArc(p2,i)),fixM(p,p2,attrs,attrs2,i),fixM(p2,p,attrs2,attrs,i);var seg=p[i],seg2=p2&&p2[i],seglen=seg.length,seg2len=p2&&seg2.length;attrs.x=seg[seglen-2],attrs.y=seg[seglen-1],attrs.bx=toFloat(seg[seglen-4])||attrs.x,attrs.by=toFloat(seg[seglen-3])||attrs.y,attrs2.bx=p2&&(toFloat(seg2[seg2len-4])||attrs2.x),attrs2.by=p2&&(toFloat(seg2[seg2len-3])||attrs2.y),attrs2.x=p2&&seg2[seg2len-2],attrs2.y=p2&&seg2[seg2len-1]}return p2||(pth.curve=pathClone(p)),p2?[p,p2]:p}function mapPath(path,matrix){if(!matrix)return path;var x,y,i,j,ii,jj,pathi;for(path=path2curve(path),i=0,ii=path.length;i<ii;i++)for(pathi=path[i],j=1,jj=pathi.length;j<jj;j+=2)x=matrix.x(pathi[j],pathi[j+1]),y=matrix.y(pathi[j],pathi[j+1]),pathi[j]=x,pathi[j+1]=y;return path}function catmullRom2bezier(crp,z){for(var d=[],i=0,iLen=crp.length;iLen-2*!z>i;i+=2){var p=[{x:+crp[i-2],y:+crp[i-1]},{x:+crp[i],y:+crp[i+1]},{x:+crp[i+2],y:+crp[i+3]},{x:+crp[i+4],y:+crp[i+5]}];z?i?iLen-4==i?p[3]={x:+crp[0],y:+crp[1]}:iLen-2==i&&(p[2]={x:+crp[0],y:+crp[1]},p[3]={x:+crp[2],y:+crp[3]}):p[0]={x:+crp[iLen-2],y:+crp[iLen-1]}:iLen-4==i?p[3]=p[2]:i||(p[0]={x:+crp[i],y:+crp[i+1]}),d.push(["C",(-p[0].x+6*p[1].x+p[2].x)/6,(-p[0].y+6*p[1].y+p[2].y)/6,(p[1].x+6*p[2].x-p[3].x)/6,(p[1].y+6*p[2].y-p[3].y)/6,p[2].x,p[2].y])}return d}var elproto=Element.prototype,is=Snap.is,clone=Snap._.clone,has="hasOwnProperty",p2s=/,?([a-z]),?/gi,toFloat=parseFloat,math=Math,PI=math.PI,mmin=math.min,mmax=math.max,pow=math.pow,abs=math.abs,getTotalLength=getLengthFactory(1),getPointAtLength=getLengthFactory(),getSubpathsAtLength=getLengthFactory(0,1),unit2px=Snap._unit2px,getPath={path:function(el){return el.attr("path")},circle:function(el){var attr=unit2px(el);return ellipsePath(attr.cx,attr.cy,attr.r)},ellipse:function(el){var attr=unit2px(el);return ellipsePath(attr.cx||0,attr.cy||0,attr.rx,attr.ry)},rect:function(el){var attr=unit2px(el);return rectPath(attr.x||0,attr.y||0,attr.width,attr.height,attr.rx,attr.ry)},image:function(el){var attr=unit2px(el);return rectPath(attr.x||0,attr.y||0,attr.width,attr.height)},line:function(el){return"M"+[el.attr("x1")||0,el.attr("y1")||0,el.attr("x2"),el.attr("y2")]},polyline:function(el){return"M"+el.attr("points")},polygon:function(el){return"M"+el.attr("points")+"z"},deflt:function(el){var bbox=el.node.getBBox();return rectPath(bbox.x,bbox.y,bbox.width,bbox.height)}};Snap.path=paths,Snap.path.getTotalLength=getTotalLength,Snap.path.getPointAtLength=getPointAtLength,Snap.path.getSubpath=function(path,from,to){if(this.getTotalLength(path)-to<1e-6)return getSubpathsAtLength(path,from).end;var a=getSubpathsAtLength(path,to,1);return from?getSubpathsAtLength(a,from).end:a},elproto.getTotalLength=function(){if(this.node.getTotalLength)return this.node.getTotalLength()},elproto.getPointAtLength=function(length){return getPointAtLength(this.attr("d"),length)},elproto.getSubpath=function(from,to){return Snap.path.getSubpath(this.attr("d"),from,to)},Snap._.box=box,Snap.path.findDotsAtSegment=findDotsAtSegment,Snap.path.bezierBBox=bezierBBox,Snap.path.isPointInsideBBox=isPointInsideBBox,Snap.path.isBBoxIntersect=isBBoxIntersect,Snap.path.intersection=pathIntersection,Snap.path.intersectionNumber=pathIntersectionNumber,Snap.path.isPointInside=isPointInsidePath,Snap.path.getBBox=pathBBox,Snap.path.get=getPath,Snap.path.toRelative=pathToRelative,Snap.path.toAbsolute=pathToAbsolute,Snap.path.toCubic=path2curve,Snap.path.map=mapPath,Snap.path.toString=toString,Snap.path.clone=pathClone}),Snap.plugin(function(Snap,Element,Paper,glob){for(var elproto=Element.prototype,supportsTouch=("createTouch"in glob.doc),events=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","touchstart","touchmove","touchend","touchcancel"],touchMap={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},getScroll=(function(xy,el){var name="y"==xy?"scrollTop":"scrollLeft",doc=el&&el.node?el.node.ownerDocument:glob.doc;return doc[name in doc.documentElement?"documentElement":"body"][name]}),preventDefault=function(){this.returnValue=!1},preventTouch=function(){return this.originalEvent.preventDefault()},stopPropagation=function(){this.cancelBubble=!0},stopTouch=function(){return this.originalEvent.stopPropagation()},addEvent=function(){return glob.doc.addEventListener?function(obj,type,fn,element){var realName=supportsTouch&&touchMap[type]?touchMap[type]:type,f=function(e){var scrollY=getScroll("y",element),scrollX=getScroll("x",element);if(supportsTouch&&touchMap.hasOwnProperty(type))for(var i=0,ii=e.targetTouches&&e.targetTouches.length;i<ii;i++)if(e.targetTouches[i].target==obj||obj.contains(e.targetTouches[i].target)){var olde=e;e=e.targetTouches[i],e.originalEvent=olde,e.preventDefault=preventTouch,e.stopPropagation=stopTouch;break}var x=e.clientX+scrollX,y=e.clientY+scrollY;return fn.call(element,e,x,y)};return type!==realName&&obj.addEventListener(type,f,!1),obj.addEventListener(realName,f,!1),function(){return type!==realName&&obj.removeEventListener(type,f,!1),obj.removeEventListener(realName,f,!1),!0}}:glob.doc.attachEvent?function(obj,type,fn,element){var f=function(e){e=e||element.node.ownerDocument.window.event;var scrollY=getScroll("y",element),scrollX=getScroll("x",element),x=e.clientX+scrollX,y=e.clientY+scrollY;return e.preventDefault=e.preventDefault||preventDefault,e.stopPropagation=e.stopPropagation||stopPropagation,fn.call(element,e,x,y)};return obj.attachEvent("on"+type,f),function(){return obj.detachEvent("on"+type,f),!0}}:void 0}(),drag=[],dragMove=function(e){for(var dragi,x=e.clientX,y=e.clientY,scrollY=getScroll("y"),scrollX=getScroll("x"),j=drag.length;j--;){if(dragi=drag[j],supportsTouch){for(var touch,i=e.touches&&e.touches.length;i--;)if(touch=e.touches[i],touch.identifier==dragi.el._drag.id||dragi.el.node.contains(touch.target)){x=touch.clientX,y=touch.clientY,(e.originalEvent?e.originalEvent:e).preventDefault();break}}else e.preventDefault();var node=dragi.el.node;node.nextSibling,node.parentNode,node.style.display;x+=scrollX,y+=scrollY,eve("snap.drag.move."+dragi.el.id,dragi.move_scope||dragi.el,x-dragi.el._drag.x,y-dragi.el._drag.y,x,y,e)}},dragUp=function(e){Snap.unmousemove(dragMove).unmouseup(dragUp);for(var dragi,i=drag.length;i--;)dragi=drag[i],dragi.el._drag={},eve("snap.drag.end."+dragi.el.id,dragi.end_scope||dragi.start_scope||dragi.move_scope||dragi.el,e);drag=[]},i=events.length;i--;)!function(eventName){Snap[eventName]=elproto[eventName]=function(fn,scope){return Snap.is(fn,"function")&&(this.events=this.events||[],this.events.push({name:eventName,f:fn,unbind:addEvent(this.node||document,eventName,fn,scope||this)})),this},Snap["un"+eventName]=elproto["un"+eventName]=function(fn){for(var events=this.events||[],l=events.length;l--;)if(events[l].name==eventName&&(events[l].f==fn||!fn))return events[l].unbind(),events.splice(l,1),!events.length&&delete this.events,this;return this}}(events[i]);elproto.hover=function(f_in,f_out,scope_in,scope_out){return this.mouseover(f_in,scope_in).mouseout(f_out,scope_out||scope_in)},elproto.unhover=function(f_in,f_out){return this.unmouseover(f_in).unmouseout(f_out)};var draggable=[];elproto.drag=function(onmove,onstart,onend,move_scope,start_scope,end_scope){function start(e,x,y){(e.originalEvent||e).preventDefault(),this._drag.x=x,this._drag.y=y,this._drag.id=e.identifier,!drag.length&&Snap.mousemove(dragMove).mouseup(dragUp),drag.push({el:this,move_scope:move_scope,start_scope:start_scope,end_scope:end_scope}),onstart&&eve.on("snap.drag.start."+this.id,onstart),onmove&&eve.on("snap.drag.move."+this.id,onmove),onend&&eve.on("snap.drag.end."+this.id,onend),eve("snap.drag.start."+this.id,start_scope||move_scope||this,x,y,e)}if(!arguments.length){var origTransform;return this.drag(function(dx,dy){this.attr({transform:origTransform+(origTransform?"T":"t")+[dx,dy]})},function(){origTransform=this.transform().local})}return this._drag={},draggable.push({el:this,start:start}),this.mousedown(start),this},elproto.undrag=function(){for(var i=draggable.length;i--;)draggable[i].el==this&&(this.unmousedown(draggable[i].start),draggable.splice(i,1),eve.unbind("snap.drag.*."+this.id));return!draggable.length&&Snap.unmousemove(dragMove).unmouseup(dragUp),this}}),Snap.plugin(function(Snap,Element,Paper,glob){var pproto=(Element.prototype,Paper.prototype),rgurl=/^\s*url\((.+)\)/,Str=String,$=Snap._.$;Snap.filter={},pproto.filter=function(filstr){var paper=this;"svg"!=paper.type&&(paper=paper.paper);var f=Snap.parse(Str(filstr)),id=Snap._.id(),filter=(paper.node.offsetWidth,paper.node.offsetHeight,$("filter"));return $(filter,{id:id,filterUnits:"userSpaceOnUse"}),filter.appendChild(f.node),paper.defs.appendChild(filter),new Element(filter)},eve.on("snap.util.getattr.filter",function(){eve.stop();var p=$(this.node,"filter");if(p){var match=Str(p).match(rgurl);return match&&Snap.select(match[1])}}),eve.on("snap.util.attr.filter",function(value){if(value instanceof Element&&"filter"==value.type){eve.stop();var id=value.node.id;id||($(value.node,{id:value.id}),id=value.id),$(this.node,{filter:Snap.url(id)})}value&&"none"!=value||(eve.stop(),this.node.removeAttribute("filter"))}),Snap.filter.blur=function(x,y){null==x&&(x=2);var def=null==y?x:[x,y];return Snap.format('<feGaussianBlur stdDeviation="{def}"/>',{def:def})},Snap.filter.blur.toString=function(){return this()},Snap.filter.shadow=function(dx,dy,blur,color,opacity){return"string"==typeof blur&&(color=blur,opacity=color,blur=4),"string"!=typeof color&&(opacity=color,color="#000"),color=color||"#000",null==blur&&(blur=4),null==opacity&&(opacity=1),null==dx&&(dx=0,dy=2),null==dy&&(dy=dx),color=Snap.color(color),Snap.format('<feGaussianBlur in="SourceAlpha" stdDeviation="{blur}"/><feOffset dx="{dx}" dy="{dy}" result="offsetblur"/><feFlood flood-color="{color}"/><feComposite in2="offsetblur" operator="in"/><feComponentTransfer><feFuncA type="linear" slope="{opacity}"/></feComponentTransfer><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>',{color:color,dx:dx,dy:dy,blur:blur,opacity:opacity})},Snap.filter.shadow.toString=function(){return this()},Snap.filter.grayscale=function(amount){return null==amount&&(amount=1),Snap.format('<feColorMatrix type="matrix" values="{a} {b} {c} 0 0 {d} {e} {f} 0 0 {g} {b} {h} 0 0 0 0 0 1 0"/>',{a:.2126+.7874*(1-amount),b:.7152-.7152*(1-amount),c:.0722-.0722*(1-amount),d:.2126-.2126*(1-amount),e:.7152+.2848*(1-amount),f:.0722-.0722*(1-amount),g:.2126-.2126*(1-amount),h:.0722+.9278*(1-amount)})},Snap.filter.grayscale.toString=function(){return this()},Snap.filter.sepia=function(amount){return null==amount&&(amount=1),Snap.format('<feColorMatrix type="matrix" values="{a} {b} {c} 0 0 {d} {e} {f} 0 0 {g} {h} {i} 0 0 0 0 0 1 0"/>',{a:.393+.607*(1-amount),b:.769-.769*(1-amount),c:.189-.189*(1-amount),d:.349-.349*(1-amount),e:.686+.314*(1-amount),f:.168-.168*(1-amount),g:.272-.272*(1-amount),h:.534-.534*(1-amount),i:.131+.869*(1-amount)})},Snap.filter.sepia.toString=function(){return this()},Snap.filter.saturate=function(amount){return null==amount&&(amount=1),Snap.format('<feColorMatrix type="saturate" values="{amount}"/>',{amount:1-amount})},Snap.filter.saturate.toString=function(){return this()},Snap.filter.hueRotate=function(angle){return angle=angle||0,Snap.format('<feColorMatrix type="hueRotate" values="{angle}"/>',{angle:angle})},Snap.filter.hueRotate.toString=function(){return this()},Snap.filter.invert=function(amount){return null==amount&&(amount=1),Snap.format('<feComponentTransfer><feFuncR type="table" tableValues="{amount} {amount2}"/><feFuncG type="table" tableValues="{amount} {amount2}"/><feFuncB type="table" tableValues="{amount} {amount2}"/></feComponentTransfer>',{amount:amount,amount2:1-amount})},Snap.filter.invert.toString=function(){return this()},Snap.filter.brightness=function(amount){return null==amount&&(amount=1),Snap.format('<feComponentTransfer><feFuncR type="linear" slope="{amount}"/><feFuncG type="linear" slope="{amount}"/><feFuncB type="linear" slope="{amount}"/></feComponentTransfer>',{amount:amount})},Snap.filter.brightness.toString=function(){return this()},Snap.filter.contrast=function(amount){return null==amount&&(amount=1),Snap.format('<feComponentTransfer><feFuncR type="linear" slope="{amount}" intercept="{amount2}"/><feFuncG type="linear" slope="{amount}" intercept="{amount2}"/><feFuncB type="linear" slope="{amount}" intercept="{amount2}"/></feComponentTransfer>',{amount:amount,amount2:.5-amount/2})},Snap.filter.contrast.toString=function(){return this()}}),Snap})},{447:447}],631:[function(_dereq_,module,exports){!function(global){"use strict";function TinyStack(){this.data=[null],this.top=0}function factory(){return new TinyStack}TinyStack.prototype.clear=function(){return this.data=[null],this.top=0,this},TinyStack.prototype.length=function(){return this.top},TinyStack.prototype.peek=function(){return this.data[this.top]},TinyStack.prototype.pop=function(){return this.top>0?(this.top--,this.data.pop()):void 0},TinyStack.prototype.push=function(arg){return this.data[++this.top]=arg,this},void 0!==exports?module.exports=factory:"function"==typeof define?define(function(){return factory}):global.stack=factory}(this)},{}],632:[function(_dereq_,module,exports){"use strict";function SoupeBpmnModeler(options){Modeler.call(this,options)}var inherits=_dereq_(641),Modeler=_dereq_(188);inherits(SoupeBpmnModeler,Modeler),module.exports=SoupeBpmnModeler;var customTranslate={translate:["value",_dereq_(633)]},bpmnPropertiesPanel=_dereq_(1),bpmnPropertiesProvider=_dereq_(46),bpmnModdleDescriptor=_dereq_(187),droolsModdleDescriptor=_dereq_(186);SoupeBpmnModeler.prototype._customizedModules=[bpmnPropertiesPanel,bpmnPropertiesProvider,customTranslate],SoupeBpmnModeler.prototype._modules=[].concat(SoupeBpmnModeler.prototype._modules,SoupeBpmnModeler.prototype._customizedModules),SoupeBpmnModeler.prototype._moddleExtensions={jbpm:bpmnModdleDescriptor,drools:droolsModdleDescriptor}},{1:1,186:186,187:187,188:188,46:46,633:633,641:641}],633:[function(_dereq_,module,exports){"use strict";var translations=_dereq_(634);module.exports=function(template,replacements){return replacements=replacements||{},template=translations[template]||template,template.replace(/{([^}]+)}/g,function(_,key){return replacements[key]||"{"+key+"}"})}},{634:634}],634:[function(_dereq_,module,exports){"use strict";module.exports={"Append {type}":"追加{type}","Add Lane above":"在上方添加泳道","Divide into two Lanes":"拆分为2条泳道","Divide into three Lanes":"拆分为3条泳道","Add Lane below":"在下方添加泳道","Append compensation activity":"追加补偿活动","Change type":"更改类型","Connect using Association":"建立关联","Connect using Sequence/MessageFlow or Association":"建立关联","Connect using DataInputAssociation":"建立关联",Remove:"移除","Activate the hand tool":"激活手型工具 (用于移动画布)","Activate the lasso tool":"激活选择工具 (用于选择元素)","Activate the create/remove space tool":"激活工作空间创建或移除工具","Activate the global connect tool":"激活连接工具","Create IntermediateThrowEvent/BoundaryEvent":"创建过渡异常抛出事件/边界事件","Create expanded SubProcess":"创建展开的子流程","Create Pool/Participant":"创建池/道","Parallel Multi Instance":"多实例并行","Sequential Multi Instance":"多实例串行",Loop:"循环","Ad-hoc":"特别指定","Create {type}":"创建{type}",Task:"任务","Send Task":"发送性任务","Receive Task":"接收性任务","User Task":"用户交互性任务","Manual Task":"线下手动性任务","Business Rule Task":"业务规则性任务","Service Task":"服务性任务","Script Task":"脚本性任务","Call Activity":"呼叫性任务","Sub Process (collapsed)":"子流程 (折叠的)","Start Event":"启动事件",StartEvent:"启动事件","Intermediate Throw Event":"过渡异常抛出事件",IntermediateThrowEvent:"过渡异常抛出事件","End Event":"结束事件",EndEvent:"结束事件","Message Start Event":"消息性启动事件","Timer Start Event":"定时启动事件","Conditional Start Event":"条件性启动事件","Signal Start Event":"信号性启动事件","Error Start Event":"错误性启动事件","Escalation Start Event":"上升性启动事件","Compensation Start Event":"补偿性启动事件","Message Start Event (non-interrupting)":"消息性启动事件 (不可中断)","Timer Start Event (non-interrupting)":"定时启动事件 (不可中断)","Conditional Start Event (non-interrupting)":"条件性启动事件 (不可中断)","Signal Start Event (non-interrupting)":"信号性启动事件 (不可中断)","Escalation Start Event (non-interrupting)":"上升性启动事件 (不可中断)","Message Intermediate Catch Event":"消息性过渡异常捕捉事件","Message Intermediate Throw Event":"消息性过渡异常抛出事件","Timer Intermediate Catch Event":"定时过渡异常捕捉事件","Escalation Intermediate Throw Event":"上升性过渡异常抛出事件","Conditional Intermediate Catch Event":"条件性过渡异常捕捉事件","Link Intermediate Catch Event":"链接性过渡异常捕捉事件","Link Intermediate Throw Event":"链接性过渡异常抛出事件","Compensation Intermediate Throw Event":"补偿性过渡异常抛出事件","Signal Intermediate Catch Event":"信号性过渡异常捕捉事件","Signal Intermediate Throw Event":"信号性过渡异常抛出事件","Message End Event":"消息性结束事件","Escalation End Event":"上升性结束事件","Error End Event":"错误性结束事件","Cancel End Event":"撤销性结束事件","Compensation End Event":"补偿性结束事件","Signal End Event":"信号性结束事件","Terminate End Event":"终止性结束事件","Message Boundary Event":"消息性边界事件","Message Boundary Event (non-interrupting)":"消息性边界事件 (不可中断)","Timer Boundary Event":"定时边界事件","Timer Boundary Event (non-interrupting)":"定时边界 (不可中断)","Escalation Boundary Event":"上升性边界事件","Escalation Boundary Event (non-interrupting)":"上升性边界事件 (不可中断)","Conditional Boundary Event":"条件性边界事件","Conditional Boundary Event (non-interrupting)":"条件性边界事件 (不可中断)","Error Boundary Event":"错误性边界事件","Cancel Boundary Event":"撤销性边界事件","Signal Boundary Event":"信号性边界事件","Signal Boundary Event (non-interrupting)":"信号性边界事件 (不可中断)","Compensation Boundary Event":"补偿性边界事件","Exclusive Gateway":"排他性关口",ExclusiveGateway:"排他性关口","Parallel Gateway":"并行关口","Inclusive Gateway":"包容性关口","Complex Gateway":"复合性关口","Event based Gateway":"基于事件的关口",Transaction:"事务","Sub Process":"子流程","Event Sub Process":"事件子流程","Collapsed Pool":"折叠的池子","Expanded Pool":"展开的池子",DataObjectReference:"数据对象引用",DataStoreReference:"数据存储引用",TextAnnotation:"文本注释","Press SHIFT+Enter for line feed":"按下SHIFT+Enter来换行","no parent for {element} in {parent}":"在{parent}中不存在{element}的父级关系","no shape type specified":"未指定类型","flow elements must be children of pools/participants":"流程元素必须在池/道里面","out of bounds release":"超出边界","more than {count} child lanes":"超过{count}个子道","element required":"必需的元素","diagram not part of bpmn:Definitions":"不是有效的BPMN图表","no diagram to display":"没有可显示的图表","no process or collaboration to display":"没有可显示的流程或协作","element {element} referenced by {referenced}#{property} not yet drawn":"被{referenced}#{property}引用的{element}没有绘制","already rendered {element}":"已经存在{element}","failed to import {element}":"{element}导入失败",General:"通用",Id:"标识",Name:"名称",Value:"值","ToDo Url":"待办地址",Yes:"是",No:"否","Process Id":"流程标识","Process Name":"流程名称",Executable:"可执行","Imports & Globals":"类型与全局变量",Imports:"类型","Add Import":"添加类型",Globals:"全局变量","Add Global":"添加变量",Identifier:"标识(必须唯一)",Type:"变量类型","Type Name":"类型名称(任意Class Name)","Actor Id":"分配给","Actor of the User Task":"指定任务的执行者","Group Id":"用户组标识","Content Id":"","Comment Id":"",Skippable:"是否可跳过",Priority:"优先级","Organization Level":"组织级别","Role Codes":"角色编码(多个用逗号分开)","Roles of this User Task":"可执行任务的角色","Multi-User":"是否会签","Input/Output Parameters":"输入/输出参数","Input Parameters":"输入参数","Output Parameters":"输出参数",Parameters:"","Parameter Detail":"参数详情","Condition Type":"条件类型",Expression:"表达式",Script:"脚本","Script Format":"脚本语言","Script Type":"脚本类型","Inline Script":"内嵌脚本","External Resource":"外部文件",Resource:"文件路径","Gateway Direction":"关口方向类型",Diverging:"分叉",Converging:"汇聚",Mixed:"混合",Unspecified:"未指定"}},{}],635:[function(_dereq_,module,exports){"use strict";function placeHoldersCount(b64){var len=b64.length;if(len%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===b64[len-2]?2:"="===b64[len-1]?1:0}function byteLength(b64){return 3*b64.length/4-placeHoldersCount(b64)}function toByteArray(b64){var i,l,tmp,placeHolders,arr,len=b64.length;placeHolders=placeHoldersCount(b64),arr=new Arr(3*len/4-placeHolders),l=placeHolders>0?len-4:len;var L=0;for(i=0;i<l;i+=4)tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)],arr[L++]=tmp>>16&255,arr[L++]=tmp>>8&255,arr[L++]=255&tmp;return 2===placeHolders?(tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4,arr[L++]=255&tmp):1===placeHolders&&(tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2,arr[L++]=tmp>>8&255,arr[L++]=255&tmp),arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[63&num]}function encodeChunk(uint8,start,end){for(var tmp,output=[],i=start;i<end;i+=3)tmp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2],output.push(tripletToBase64(tmp));return output.join("")}function fromByteArray(uint8){for(var tmp,len=uint8.length,extraBytes=len%3,output="",parts=[],i=0,len2=len-extraBytes;i<len2;i+=16383)parts.push(encodeChunk(uint8,i,i+16383>len2?len2:i+16383));return 1===extraBytes?(tmp=uint8[len-1],output+=lookup[tmp>>2],output+=lookup[tmp<<4&63],output+="=="):2===extraBytes&&(tmp=(uint8[len-2]<<8)+uint8[len-1],output+=lookup[tmp>>10],output+=lookup[tmp>>4&63],output+=lookup[tmp<<2&63],output+="="),parts.push(output),parts.join("")}exports.byteLength=byteLength,exports.toByteArray=toByteArray,exports.fromByteArray=fromByteArray;for(var lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63},{}],636:[function(_dereq_,module,exports){},{}],637:[function(_dereq_,module,exports){(function(global){"use strict";function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(that,length){if(kMaxLength()<length)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(that=new Uint8Array(length),that.__proto__=Buffer.prototype):(null===that&&(that=new Buffer(length)),that.length=length),that}function Buffer(arg,encodingOrOffset,length){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(arg,encodingOrOffset,length);if("number"==typeof arg){if("string"==typeof encodingOrOffset)throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,arg)}return from(this,arg,encodingOrOffset,length)}function from(that,value,encodingOrOffset,length){if("number"==typeof value)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&value instanceof ArrayBuffer?fromArrayBuffer(that,value,encodingOrOffset,length):"string"==typeof value?fromString(that,value,encodingOrOffset):fromObject(that,value)}function assertSize(size){if("number"!=typeof size)throw new TypeError('"size" argument must be a number');if(size<0)throw new RangeError('"size" argument must not be negative')}function alloc(that,size,fill,encoding){return assertSize(size),size<=0?createBuffer(that,size):void 0!==fill?"string"==typeof encoding?createBuffer(that,size).fill(fill,encoding):createBuffer(that,size).fill(fill):createBuffer(that,size)}function allocUnsafe(that,size){if(assertSize(size),that=createBuffer(that,size<0?0:0|checked(size)),!Buffer.TYPED_ARRAY_SUPPORT)for(var i=0;i<size;++i)that[i]=0;return that}function fromString(that,string,encoding){if("string"==typeof encoding&&""!==encoding||(encoding="utf8"),!Buffer.isEncoding(encoding))throw new TypeError('"encoding" must be a valid string encoding');var length=0|byteLength(string,encoding);that=createBuffer(that,length);var actual=that.write(string,encoding);return actual!==length&&(that=that.slice(0,actual)),that}function fromArrayLike(that,array){var length=array.length<0?0:0|checked(array.length);that=createBuffer(that,length);for(var i=0;i<length;i+=1)that[i]=255&array[i];return that}function fromArrayBuffer(that,array,byteOffset,length){if(array.byteLength,byteOffset<0||array.byteLength<byteOffset)throw new RangeError("'offset' is out of bounds");if(array.byteLength<byteOffset+(length||0))throw new RangeError("'length' is out of bounds");return array=void 0===byteOffset&&void 0===length?new Uint8Array(array):void 0===length?new Uint8Array(array,byteOffset):new Uint8Array(array,byteOffset,length),Buffer.TYPED_ARRAY_SUPPORT?(that=array,that.__proto__=Buffer.prototype):that=fromArrayLike(that,array),that}function fromObject(that,obj){if(Buffer.isBuffer(obj)){var len=0|checked(obj.length);return that=createBuffer(that,len),0===that.length?that:(obj.copy(that,0,0,len),that)}if(obj){if("undefined"!=typeof ArrayBuffer&&obj.buffer instanceof ArrayBuffer||"length"in obj)return"number"!=typeof obj.length||isnan(obj.length)?createBuffer(that,0):fromArrayLike(that,obj);if("Buffer"===obj.type&&isArray(obj.data))return fromArrayLike(that,obj.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(length){if(length>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|length}function SlowBuffer(length){return+length!=length&&(length=0),Buffer.alloc(+length)}function byteLength(string,encoding){if(Buffer.isBuffer(string))return string.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(string)||string instanceof ArrayBuffer))return string.byteLength;"string"!=typeof string&&(string=""+string);var len=string.length;if(0===len)return 0;for(var loweredCase=!1;;)switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":case void 0:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}function slowToString(encoding,start,end){var loweredCase=!1;if((void 0===start||start<0)&&(start=0),start>this.length)return"";if((void 0===end||end>this.length)&&(end=this.length),end<=0)return"";if(end>>>=0,start>>>=0,end<=start)return"";for(encoding||(encoding="utf8");;)switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}function swap(b,n,m){var i=b[n];b[n]=b[m],b[m]=i}function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(0===buffer.length)return-1
;if("string"==typeof byteOffset?(encoding=byteOffset,byteOffset=0):byteOffset>2147483647?byteOffset=2147483647:byteOffset<-2147483648&&(byteOffset=-2147483648),byteOffset=+byteOffset,isNaN(byteOffset)&&(byteOffset=dir?0:buffer.length-1),byteOffset<0&&(byteOffset=buffer.length+byteOffset),byteOffset>=buffer.length){if(dir)return-1;byteOffset=buffer.length-1}else if(byteOffset<0){if(!dir)return-1;byteOffset=0}if("string"==typeof val&&(val=Buffer.from(val,encoding)),Buffer.isBuffer(val))return 0===val.length?-1:arrayIndexOf(buffer,val,byteOffset,encoding,dir);if("number"==typeof val)return val&=255,Buffer.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?dir?Uint8Array.prototype.indexOf.call(buffer,val,byteOffset):Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset):arrayIndexOf(buffer,[val],byteOffset,encoding,dir);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){function read(buf,i){return 1===indexSize?buf[i]:buf.readUInt16BE(i*indexSize)}var indexSize=1,arrLength=arr.length,valLength=val.length;if(void 0!==encoding&&("ucs2"===(encoding=String(encoding).toLowerCase())||"ucs-2"===encoding||"utf16le"===encoding||"utf-16le"===encoding)){if(arr.length<2||val.length<2)return-1;indexSize=2,arrLength/=2,valLength/=2,byteOffset/=2}var i;if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++)if(read(arr,i)===read(val,-1===foundIndex?0:i-foundIndex)){if(-1===foundIndex&&(foundIndex=i),i-foundIndex+1===valLength)return foundIndex*indexSize}else-1!==foundIndex&&(i-=i-foundIndex),foundIndex=-1}else for(byteOffset+valLength>arrLength&&(byteOffset=arrLength-valLength),i=byteOffset;i>=0;i--){for(var found=!0,j=0;j<valLength;j++)if(read(arr,i+j)!==read(val,j)){found=!1;break}if(found)return i}return-1}function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;length?(length=Number(length))>remaining&&(length=remaining):length=remaining;var strLen=string.length;if(strLen%2!=0)throw new TypeError("Invalid hex string");length>strLen/2&&(length=strLen/2);for(var i=0;i<length;++i){var parsed=parseInt(string.substr(2*i,2),16);if(isNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}function base64Slice(buf,start,end){return 0===start&&end===buf.length?base64.fromByteArray(buf):base64.fromByteArray(buf.slice(start,end))}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);for(var res=[],i=start;i<end;){var firstByte=buf[i],codePoint=null,bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:firstByte<128&&(codePoint=firstByte);break;case 2:secondByte=buf[i+1],128==(192&secondByte)&&(tempCodePoint=(31&firstByte)<<6|63&secondByte)>127&&(codePoint=tempCodePoint);break;case 3:secondByte=buf[i+1],thirdByte=buf[i+2],128==(192&secondByte)&&128==(192&thirdByte)&&(tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte)>2047&&(tempCodePoint<55296||tempCodePoint>57343)&&(codePoint=tempCodePoint);break;case 4:secondByte=buf[i+1],thirdByte=buf[i+2],fourthByte=buf[i+3],128==(192&secondByte)&&128==(192&thirdByte)&&128==(192&fourthByte)&&(tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte)>65535&&tempCodePoint<1114112&&(codePoint=tempCodePoint)}}null===codePoint?(codePoint=65533,bytesPerSequence=1):codePoint>65535&&(codePoint-=65536,res.push(codePoint>>>10&1023|55296),codePoint=56320|1023&codePoint),res.push(codePoint),i+=bytesPerSequence}return decodeCodePointsArray(res)}function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,codePoints);for(var res="",i=0;i<len;)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH));return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(127&buf[i]);return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(buf[i]);return ret}function hexSlice(buf,start,end){var len=buf.length;(!start||start<0)&&(start=0),(!end||end<0||end>len)&&(end=len);for(var out="",i=start;i<end;++i)out+=toHex(buf[i]);return out}function utf16leSlice(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}function checkOffset(offset,ext,length){if(offset%1!=0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}function objectWriteUInt16(buf,value,offset,littleEndian){value<0&&(value=65535+value+1);for(var i=0,j=Math.min(buf.length-offset,2);i<j;++i)buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>8*(littleEndian?i:1-i)}function objectWriteUInt32(buf,value,offset,littleEndian){value<0&&(value=4294967295+value+1);for(var i=0,j=Math.min(buf.length-offset,4);i<j;++i)buf[offset+i]=value>>>8*(littleEndian?i:3-i)&255}function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}function base64clean(str){if(str=stringtrim(str).replace(INVALID_BASE64_RE,""),str.length<2)return"";for(;str.length%4!=0;)str+="=";return str}function stringtrim(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,"")}function toHex(n){return n<16?"0"+n.toString(16):n.toString(16)}function utf8ToBytes(string,units){units=units||1/0;for(var codePoint,length=string.length,leadSurrogate=null,bytes=[],i=0;i<length;++i){if((codePoint=string.charCodeAt(i))>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){(units-=3)>-1&&bytes.push(239,191,189);continue}if(i+1===length){(units-=3)>-1&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){(units-=3)>-1&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=65536+(leadSurrogate-55296<<10|codePoint-56320)}else leadSurrogate&&(units-=3)>-1&&bytes.push(239,191,189);if(leadSurrogate=null,codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(codePoint<1114112))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function asciiToBytes(str){for(var byteArray=[],i=0;i<str.length;++i)byteArray.push(255&str.charCodeAt(i));return byteArray}function utf16leToBytes(str,units){for(var c,hi,lo,byteArray=[],i=0;i<str.length&&!((units-=2)<0);++i)c=str.charCodeAt(i),hi=c>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length&&!(i+offset>=dst.length||i>=src.length);++i)dst[i+offset]=src[i];return i}function isnan(val){return val!==val}var base64=_dereq_(635),ieee754=_dereq_(640),isArray=_dereq_(643);exports.Buffer=Buffer,exports.SlowBuffer=SlowBuffer,exports.INSPECT_MAX_BYTES=50,Buffer.TYPED_ARRAY_SUPPORT=void 0!==global.TYPED_ARRAY_SUPPORT?global.TYPED_ARRAY_SUPPORT:function(){try{var arr=new Uint8Array(1);return arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===arr.foo()&&"function"==typeof arr.subarray&&0===arr.subarray(1,1).byteLength}catch(e){return!1}}(),exports.kMaxLength=kMaxLength(),Buffer.poolSize=8192,Buffer._augment=function(arr){return arr.__proto__=Buffer.prototype,arr},Buffer.from=function(value,encodingOrOffset,length){return from(null,value,encodingOrOffset,length)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0})),Buffer.alloc=function(size,fill,encoding){return alloc(null,size,fill,encoding)},Buffer.allocUnsafe=function(size){return allocUnsafe(null,size)},Buffer.allocUnsafeSlow=function(size){return allocUnsafe(null,size)},Buffer.isBuffer=function(b){return!(null==b||!b._isBuffer)},Buffer.compare=function(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);i<len;++i)if(a[i]!==b[i]){x=a[i],y=b[i];break}return x<y?-1:y<x?1:0},Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(list,length){if(!isArray(list))throw new TypeError('"list" argument must be an Array of Buffers');if(0===list.length)return Buffer.alloc(0);var i;if(void 0===length)for(length=0,i=0;i<list.length;++i)length+=list[i].length;var buffer=Buffer.allocUnsafe(length),pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(!Buffer.isBuffer(buf))throw new TypeError('"list" argument must be an Array of Buffers');buf.copy(buffer,pos),pos+=buf.length}return buffer},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var len=this.length;if(len%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var i=0;i<len;i+=2)swap(this,i,i+1);return this},Buffer.prototype.swap32=function(){var len=this.length;if(len%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var i=0;i<len;i+=4)swap(this,i,i+3),swap(this,i+1,i+2);return this},Buffer.prototype.swap64=function(){var len=this.length;if(len%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var i=0;i<len;i+=8)swap(this,i,i+7),swap(this,i+1,i+6),swap(this,i+2,i+5),swap(this,i+3,i+4);return this},Buffer.prototype.toString=function(){var length=0|this.length;return 0===length?"":0===arguments.length?utf8Slice(this,0,length):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b||0===Buffer.compare(this,b)},Buffer.prototype.inspect=function(){var str="",max=exports.INSPECT_MAX_BYTES;return this.length>0&&(str=this.toString("hex",0,max).match(/.{2}/g).join(" "),this.length>max&&(str+=" ... ")),"<Buffer "+str+">"},Buffer.prototype.compare=function(target,start,end,thisStart,thisEnd){if(!Buffer.isBuffer(target))throw new TypeError("Argument must be a Buffer");if(void 0===start&&(start=0),void 0===end&&(end=target?target.length:0),void 0===thisStart&&(thisStart=0),void 0===thisEnd&&(thisEnd=this.length),start<0||end>target.length||thisStart<0||thisEnd>this.length)throw new RangeError("out of range index");if(thisStart>=thisEnd&&start>=end)return 0;if(thisStart>=thisEnd)return-1;if(start>=end)return 1;if(start>>>=0,end>>>=0,thisStart>>>=0,thisEnd>>>=0,this===target)return 0;for(var x=thisEnd-thisStart,y=end-start,len=Math.min(x,y),thisCopy=this.slice(thisStart,thisEnd),targetCopy=target.slice(start,end),i=0;i<len;++i)if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i],y=targetCopy[i];break}return x<y?-1:y<x?1:0},Buffer.prototype.includes=function(val,byteOffset,encoding){return-1!==this.indexOf(val,byteOffset,encoding)},Buffer.prototype.indexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!0)},Buffer.prototype.lastIndexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!1)},Buffer.prototype.write=function(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else{if(!isFinite(offset))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");offset|=0,isFinite(length)?(length|=0,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0)}var remaining=this.length-offset;if((void 0===length||length>remaining)&&(length=remaining),string.length>0&&(length<0||offset<0)||offset>this.length)throw new RangeError("Attempt to write outside buffer bounds");encoding||(encoding="utf8");for(var loweredCase=!1;;)switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;Buffer.prototype.slice=function(start,end){var len=this.length;start=~~start,end=void 0===end?len:~~end,start<0?(start+=len)<0&&(start=0):start>len&&(start=len),end<0?(end+=len)<0&&(end=0):end>len&&(end=len),end<start&&(end=start);var newBuf;if(Buffer.TYPED_ARRAY_SUPPORT)newBuf=this.subarray(start,end),newBuf.__proto__=Buffer.prototype;else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,void 0);for(var i=0;i<sliceLen;++i)newBuf[i]=this[i+start]}return newBuf},Buffer.prototype.readUIntLE=function(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUIntBE=function(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset+--byteLength],mul=1;byteLength>0&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readIntLE=function(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function(offset,byteLength,noAssert){offset|=0,byteLength|=0,noAssert||checkOffset(offset,byteLength,this.length);for(var i=byteLength,mul=1,val=this[offset+--i];i>0&&(mul*=256);)val+=this[offset+--i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt16BE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUIntLE=function(value,offset,byteLength,noAssert){if(value=+value,offset|=0,byteLength|=0,!noAssert){checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0)}var mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUIntBE=function(value,offset,byteLength,noAssert){if(value=+value,offset|=0,byteLength|=0,!noAssert){checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0)}var i=byteLength-1,mul=1;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUInt8=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),this[offset]=255&value,offset+1},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=255&value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=255&value):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeIntLE=function(value,offset,byteLength,noAssert){if(value=+value,offset|=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0,mul=1,sub=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i-1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function(value,offset,byteLength,noAssert){if(value=+value,offset|=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1,mul=1,sub=0;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i+1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),value<0&&(value=255+value+1),this[offset]=255&value,offset+1},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=255&value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return value=+value,offset|=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),value<0&&(value=4294967295+value+1),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function(target,targetStart,start,end){if(start||(start=0),end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),targetStart||(targetStart=0),end>0&&end<start&&(end=start),end===start)return 0;if(0===target.length||0===this.length)return 0;if(targetStart<0)throw new RangeError("targetStart out of bounds");if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length),target.length-targetStart<end-start&&(end=target.length-targetStart+start);var i,len=end-start;if(this===target&&start<targetStart&&targetStart<end)for(i=len-1;i>=0;--i)target[i+targetStart]=this[i+start];else if(len<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(i=0;i<len;++i)target[i+targetStart]=this[i+start];else Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart);return len},Buffer.prototype.fill=function(val,start,end,encoding){if("string"==typeof val){if("string"==typeof start?(encoding=start,start=0,end=this.length):"string"==typeof end&&(encoding=end,end=this.length),1===val.length){var code=val.charCodeAt(0);code<256&&(val=code)}if(void 0!==encoding&&"string"!=typeof encoding)throw new TypeError("encoding must be a string");if("string"==typeof encoding&&!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding)}else"number"==typeof val&&(val&=255);if(start<0||this.length<start||this.length<end)throw new RangeError("Out of range index");if(end<=start)return this;start>>>=0,end=void 0===end?this.length:end>>>0,val||(val=0);var i;if("number"==typeof val)for(i=start;i<end;++i)this[i]=val;else{var bytes=Buffer.isBuffer(val)?val:utf8ToBytes(new Buffer(val,encoding).toString()),len=bytes.length;for(i=0;i<end-start;++i)this[i+start]=bytes[i%len]}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{635:635,640:640,643:643}],638:[function(_dereq_,module,exports){(function(Buffer){function isArray(arg){return Array.isArray?Array.isArray(arg):"[object Array]"===objectToString(arg)}function isBoolean(arg){return"boolean"==typeof arg}function isNull(arg){return null===arg}function isNullOrUndefined(arg){return null==arg}function isNumber(arg){return"number"==typeof arg}function isString(arg){return"string"==typeof arg}function isSymbol(arg){return"symbol"==typeof arg}function isUndefined(arg){return void 0===arg}function isRegExp(re){return"[object RegExp]"===objectToString(re)}function isObject(arg){return"object"==typeof arg&&null!==arg}function isDate(d){return"[object Date]"===objectToString(d)}function isError(e){return"[object Error]"===objectToString(e)||e instanceof Error}function isFunction(arg){return"function"==typeof arg}function isPrimitive(arg){return null===arg||"boolean"==typeof arg||"number"==typeof arg||"string"==typeof arg||"symbol"==typeof arg||void 0===arg}function objectToString(o){return Object.prototype.toString.call(o)}exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=Buffer.isBuffer}).call(this,{isBuffer:_dereq_(642)})},{642:642}],639:[function(_dereq_,module,exports){function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(arg){return"function"==typeof arg}function isNumber(arg){return"number"==typeof arg}function isObject(arg){return"object"==typeof arg&&null!==arg}function isUndefined(arg){return void 0===arg}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");return this._maxListeners=n,this},EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(this._events||(this._events={}),"error"===type&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if((er=arguments[1])instanceof Error)throw er;var err=new Error('Uncaught, unspecified "error" event. ('+er+")");throw err.context=er,err}if(handler=this._events[type],isUndefined(handler))return!1;if(isFunction(handler))switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1),handler.apply(this,args)}else if(isObject(handler))for(args=Array.prototype.slice.call(arguments,1),listeners=handler.slice(),len=listeners.length,i=0;i<len;i++)listeners[i].apply(this,args);return!0},EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener),this._events[type]?isObject(this._events[type])?this._events[type].push(listener):this._events[type]=[this._events[type],listener]:this._events[type]=listener,isObject(this._events[type])&&!this._events[type].warned&&(m=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners)&&m>0&&this._events[type].length>m&&(this._events[type].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[type].length),"function"==typeof console.trace&&console.trace()),this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(type,listener){function g(){this.removeListener(type,g),fired||(fired=!0,listener.apply(this,arguments))}if(!isFunction(listener))throw TypeError("listener must be a function");var fired=!1;return g.listener=listener,this.on(type,g),this},EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;if(list=this._events[type],length=list.length,position=-1,list===listener||isFunction(list.listener)&&list.listener===listener)delete this._events[type],this._events.removeListener&&this.emit("removeListener",type,listener);else if(isObject(list)){for(i=length;i-- >0;)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(position<0)return this;1===list.length?(list.length=0,delete this._events[type]):list.splice(position,1),this._events.removeListener&&this.emit("removeListener",type,listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[type]&&delete this._events[type],this;if(0===arguments.length){for(key in this._events)"removeListener"!==key&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events={},this}if(listeners=this._events[type],isFunction(listeners))this.removeListener(type,listeners);else if(listeners)for(;listeners.length;)this.removeListener(type,listeners[listeners.length-1]);return delete this._events[type],this},EventEmitter.prototype.listeners=function(type){return this._events&&this._events[type]?isFunction(this._events[type])?[this._events[type]]:this._events[type].slice():[]},EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;if(evlistener)return evlistener.length}return 0},EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type)}},{}],640:[function(_dereq_,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:1/0*(s?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=value<0||0===value&&1/value<0?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,
e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias),value*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},{}],641:[function(_dereq_,module,exports){arguments[4][84][0].apply(exports,arguments)},{84:84}],642:[function(_dereq_,module,exports){function isBuffer(obj){return!!obj.constructor&&"function"==typeof obj.constructor.isBuffer&&obj.constructor.isBuffer(obj)}function isSlowBuffer(obj){return"function"==typeof obj.readFloatLE&&"function"==typeof obj.slice&&isBuffer(obj.slice(0,0))}module.exports=function(obj){return null!=obj&&(isBuffer(obj)||isSlowBuffer(obj)||!!obj._isBuffer)}},{}],643:[function(_dereq_,module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return"[object Array]"==toString.call(arr)}},{}],644:[function(_dereq_,module,exports){(function(process){"use strict";function nextTick(fn,arg1,arg2,arg3){if("function"!=typeof fn)throw new TypeError('"callback" argument must be a function');var args,i,len=arguments.length;switch(len){case 0:case 1:return process.nextTick(fn);case 2:return process.nextTick(function(){fn.call(null,arg1)});case 3:return process.nextTick(function(){fn.call(null,arg1,arg2)});case 4:return process.nextTick(function(){fn.call(null,arg1,arg2,arg3)});default:for(args=new Array(len-1),i=0;i<args.length;)args[i++]=arguments[i];return process.nextTick(function(){fn.apply(null,args)})}}!process.version||0===process.version.indexOf("v0.")||0===process.version.indexOf("v1.")&&0!==process.version.indexOf("v1.8.")?module.exports=nextTick:module.exports=process.nextTick}).call(this,void 0)},{}],645:[function(_dereq_,module,exports){module.exports=_dereq_(646)},{646:646}],646:[function(_dereq_,module,exports){"use strict";function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options),Writable.call(this,options),options&&!1===options.readable&&(this.readable=!1),options&&!1===options.writable&&(this.writable=!1),this.allowHalfOpen=!0,options&&!1===options.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",onend)}function onend(){this.allowHalfOpen||this._writableState.ended||processNextTick(onEndNT,this)}function onEndNT(self){self.end()}var processNextTick=_dereq_(644),objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)keys.push(key);return keys};module.exports=Duplex;var util=_dereq_(638);util.inherits=_dereq_(641);var Readable=_dereq_(648),Writable=_dereq_(650);util.inherits(Duplex,Readable);for(var keys=objectKeys(Writable.prototype),v=0;v<keys.length;v++){var method=keys[v];Duplex.prototype[method]||(Duplex.prototype[method]=Writable.prototype[method])}Object.defineProperty(Duplex.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(value){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=value,this._writableState.destroyed=value)}}),Duplex.prototype._destroy=function(err,cb){this.push(null),this.end(),processNextTick(cb,err)}},{638:638,641:641,644:644,648:648,650:650}],647:[function(_dereq_,module,exports){"use strict";function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}module.exports=PassThrough;var Transform=_dereq_(649),util=_dereq_(638);util.inherits=_dereq_(641),util.inherits(PassThrough,Transform),PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{638:638,641:641,649:649}],648:[function(_dereq_,module,exports){(function(process,global){"use strict";function _uint8ArrayToBuffer(chunk){return Buffer.from(chunk)}function _isUint8Array(obj){return Buffer.isBuffer(obj)||obj instanceof OurUint8Array}function prependListener(emitter,event,fn){if("function"==typeof emitter.prependListener)return emitter.prependListener(event,fn);emitter._events&&emitter._events[event]?isArray(emitter._events[event])?emitter._events[event].unshift(fn):emitter._events[event]=[fn,emitter._events[event]]:emitter.on(event,fn)}function ReadableState(options,stream){Duplex=Duplex||_dereq_(646),options=options||{},this.objectMode=!!options.objectMode,stream instanceof Duplex&&(this.objectMode=this.objectMode||!!options.readableObjectMode);var hwm=options.highWaterMark,defaultHwm=this.objectMode?16:16384;this.highWaterMark=hwm||0===hwm?hwm:defaultHwm,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new BufferList,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=options.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,options.encoding&&(StringDecoder||(StringDecoder=_dereq_(654).StringDecoder),this.decoder=new StringDecoder(options.encoding),this.encoding=options.encoding)}function Readable(options){if(Duplex=Duplex||_dereq_(646),!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this),this.readable=!0,options&&("function"==typeof options.read&&(this._read=options.read),"function"==typeof options.destroy&&(this._destroy=options.destroy)),Stream.call(this)}function readableAddChunk(stream,chunk,encoding,addToFront,skipChunkCheck){var state=stream._readableState;if(null===chunk)state.reading=!1,onEofChunk(stream,state);else{var er;skipChunkCheck||(er=chunkInvalid(state,chunk)),er?stream.emit("error",er):state.objectMode||chunk&&chunk.length>0?("string"==typeof chunk||state.objectMode||Object.getPrototypeOf(chunk)===Buffer.prototype||(chunk=_uint8ArrayToBuffer(chunk)),addToFront?state.endEmitted?stream.emit("error",new Error("stream.unshift() after end event")):addChunk(stream,state,chunk,!0):state.ended?stream.emit("error",new Error("stream.push() after EOF")):(state.reading=!1,state.decoder&&!encoding?(chunk=state.decoder.write(chunk),state.objectMode||0!==chunk.length?addChunk(stream,state,chunk,!1):maybeReadMore(stream,state)):addChunk(stream,state,chunk,!1))):addToFront||(state.reading=!1)}return needMoreData(state)}function addChunk(stream,state,chunk,addToFront){state.flowing&&0===state.length&&!state.sync?(stream.emit("data",chunk),stream.read(0)):(state.length+=state.objectMode?1:chunk.length,addToFront?state.buffer.unshift(chunk):state.buffer.push(chunk),state.needReadable&&emitReadable(stream)),maybeReadMore(stream,state)}function chunkInvalid(state,chunk){var er;return _isUint8Array(chunk)||"string"==typeof chunk||void 0===chunk||state.objectMode||(er=new TypeError("Invalid non-string/buffer chunk")),er}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||0===state.length)}function computeNewHighWaterMark(n){return n>=MAX_HWM?n=MAX_HWM:(n--,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,n|=n>>>16,n++),n}function howMuchToRead(n,state){return n<=0||0===state.length&&state.ended?0:state.objectMode?1:n!==n?state.flowing&&state.length?state.buffer.head.data.length:state.length:(n>state.highWaterMark&&(state.highWaterMark=computeNewHighWaterMark(n)),n<=state.length?n:state.ended?state.length:(state.needReadable=!0,0))}function onEofChunk(stream,state){if(!state.ended){if(state.decoder){var chunk=state.decoder.end();chunk&&chunk.length&&(state.buffer.push(chunk),state.length+=state.objectMode?1:chunk.length)}state.ended=!0,emitReadable(stream)}}function emitReadable(stream){var state=stream._readableState;state.needReadable=!1,state.emittedReadable||(debug("emitReadable",state.flowing),state.emittedReadable=!0,state.sync?processNextTick(emitReadable_,stream):emitReadable_(stream))}function emitReadable_(stream){debug("emit readable"),stream.emit("readable"),flow(stream)}function maybeReadMore(stream,state){state.readingMore||(state.readingMore=!0,processNextTick(maybeReadMore_,stream,state))}function maybeReadMore_(stream,state){for(var len=state.length;!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark&&(debug("maybeReadMore read 0"),stream.read(0),len!==state.length);)len=state.length;state.readingMore=!1}function pipeOnDrain(src){return function(){var state=src._readableState;debug("pipeOnDrain",state.awaitDrain),state.awaitDrain&&state.awaitDrain--,0===state.awaitDrain&&EElistenerCount(src,"data")&&(state.flowing=!0,flow(src))}}function nReadingNextTick(self){debug("readable nexttick read 0"),self.read(0)}function resume(stream,state){state.resumeScheduled||(state.resumeScheduled=!0,processNextTick(resume_,stream,state))}function resume_(stream,state){state.reading||(debug("resume read 0"),stream.read(0)),state.resumeScheduled=!1,state.awaitDrain=0,stream.emit("resume"),flow(stream),state.flowing&&!state.reading&&stream.read(0)}function flow(stream){var state=stream._readableState;for(debug("flow",state.flowing);state.flowing&&null!==stream.read(););}function fromList(n,state){if(0===state.length)return null;var ret;return state.objectMode?ret=state.buffer.shift():!n||n>=state.length?(ret=state.decoder?state.buffer.join(""):1===state.buffer.length?state.buffer.head.data:state.buffer.concat(state.length),state.buffer.clear()):ret=fromListPartial(n,state.buffer,state.decoder),ret}function fromListPartial(n,list,hasStrings){var ret;return n<list.head.data.length?(ret=list.head.data.slice(0,n),list.head.data=list.head.data.slice(n)):ret=n===list.head.data.length?list.shift():hasStrings?copyFromBufferString(n,list):copyFromBuffer(n,list),ret}function copyFromBufferString(n,list){var p=list.head,c=1,ret=p.data;for(n-=ret.length;p=p.next;){var str=p.data,nb=n>str.length?str.length:n;if(nb===str.length?ret+=str:ret+=str.slice(0,n),0===(n-=nb)){nb===str.length?(++c,p.next?list.head=p.next:list.head=list.tail=null):(list.head=p,p.data=str.slice(nb));break}++c}return list.length-=c,ret}function copyFromBuffer(n,list){var ret=Buffer.allocUnsafe(n),p=list.head,c=1;for(p.data.copy(ret),n-=p.data.length;p=p.next;){var buf=p.data,nb=n>buf.length?buf.length:n;if(buf.copy(ret,ret.length-n,0,nb),0===(n-=nb)){nb===buf.length?(++c,p.next?list.head=p.next:list.head=list.tail=null):(list.head=p,p.data=buf.slice(nb));break}++c}return list.length-=c,ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error('"endReadable()" called on non-empty stream');state.endEmitted||(state.ended=!0,processNextTick(endReadableNT,state,stream))}function endReadableNT(state,stream){state.endEmitted||0!==state.length||(state.endEmitted=!0,stream.readable=!1,stream.emit("end"))}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++)if(xs[i]===x)return i;return-1}var processNextTick=_dereq_(644);module.exports=Readable;var Duplex,isArray=_dereq_(643);Readable.ReadableState=ReadableState;var EElistenerCount=(_dereq_(639).EventEmitter,function(emitter,type){return emitter.listeners(type).length}),Stream=_dereq_(653),Buffer=_dereq_(659).Buffer,OurUint8Array=global.Uint8Array||function(){},util=_dereq_(638);util.inherits=_dereq_(641);var debugUtil=_dereq_(636),debug=void 0;debug=debugUtil&&debugUtil.debuglog?debugUtil.debuglog("stream"):function(){};var StringDecoder,BufferList=_dereq_(651),destroyImpl=_dereq_(652);util.inherits(Readable,Stream);var kProxyEvents=["error","close","destroy","pause","resume"];Object.defineProperty(Readable.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(value){this._readableState&&(this._readableState.destroyed=value)}}),Readable.prototype.destroy=destroyImpl.destroy,Readable.prototype._undestroy=destroyImpl.undestroy,Readable.prototype._destroy=function(err,cb){this.push(null),cb(err)},Readable.prototype.push=function(chunk,encoding){var skipChunkCheck,state=this._readableState;return state.objectMode?skipChunkCheck=!0:"string"==typeof chunk&&(encoding=encoding||state.defaultEncoding,encoding!==state.encoding&&(chunk=Buffer.from(chunk,encoding),encoding=""),skipChunkCheck=!0),readableAddChunk(this,chunk,encoding,!1,skipChunkCheck)},Readable.prototype.unshift=function(chunk){return readableAddChunk(this,chunk,null,!0,!1)},Readable.prototype.isPaused=function(){return!1===this._readableState.flowing},Readable.prototype.setEncoding=function(enc){return StringDecoder||(StringDecoder=_dereq_(654).StringDecoder),this._readableState.decoder=new StringDecoder(enc),this._readableState.encoding=enc,this};var MAX_HWM=8388608;Readable.prototype.read=function(n){debug("read",n),n=parseInt(n,10);var state=this._readableState,nOrig=n;if(0!==n&&(state.emittedReadable=!1),0===n&&state.needReadable&&(state.length>=state.highWaterMark||state.ended))return debug("read: emitReadable",state.length,state.ended),0===state.length&&state.ended?endReadable(this):emitReadable(this),null;if(0===(n=howMuchToRead(n,state))&&state.ended)return 0===state.length&&endReadable(this),null;var doRead=state.needReadable;debug("need readable",doRead),(0===state.length||state.length-n<state.highWaterMark)&&(doRead=!0,debug("length less than watermark",doRead)),state.ended||state.reading?(doRead=!1,debug("reading or ended",doRead)):doRead&&(debug("do read"),state.reading=!0,state.sync=!0,0===state.length&&(state.needReadable=!0),this._read(state.highWaterMark),state.sync=!1,state.reading||(n=howMuchToRead(nOrig,state)));var ret;return ret=n>0?fromList(n,state):null,null===ret?(state.needReadable=!0,n=0):state.length-=n,0===state.length&&(state.ended||(state.needReadable=!0),nOrig!==n&&state.ended&&endReadable(this)),null!==ret&&this.emit("data",ret),ret},Readable.prototype._read=function(n){this.emit("error",new Error("_read() is not implemented"))},Readable.prototype.pipe=function(dest,pipeOpts){function onunpipe(readable,unpipeInfo){debug("onunpipe"),readable===src&&unpipeInfo&&!1===unpipeInfo.hasUnpiped&&(unpipeInfo.hasUnpiped=!0,cleanup())}function onend(){debug("onend"),dest.end()}function cleanup(){debug("cleanup"),dest.removeListener("close",onclose),dest.removeListener("finish",onfinish),dest.removeListener("drain",ondrain),dest.removeListener("error",onerror),dest.removeListener("unpipe",onunpipe),src.removeListener("end",onend),src.removeListener("end",unpipe),src.removeListener("data",ondata),cleanedUp=!0,!state.awaitDrain||dest._writableState&&!dest._writableState.needDrain||ondrain()}function ondata(chunk){debug("ondata"),increasedAwaitDrain=!1,!1!==dest.write(chunk)||increasedAwaitDrain||((1===state.pipesCount&&state.pipes===dest||state.pipesCount>1&&-1!==indexOf(state.pipes,dest))&&!cleanedUp&&(debug("false write response, pause",src._readableState.awaitDrain),src._readableState.awaitDrain++,increasedAwaitDrain=!0),src.pause())}function onerror(er){debug("onerror",er),unpipe(),dest.removeListener("error",onerror),0===EElistenerCount(dest,"error")&&dest.emit("error",er)}function onclose(){dest.removeListener("finish",onfinish),unpipe()}function onfinish(){debug("onfinish"),dest.removeListener("close",onclose),unpipe()}function unpipe(){debug("unpipe"),src.unpipe(dest)}var src=this,state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest)}state.pipesCount+=1,debug("pipe count=%d opts=%j",state.pipesCount,pipeOpts);var doEnd=(!pipeOpts||!1!==pipeOpts.end)&&dest!==process.stdout&&dest!==process.stderr,endFn=doEnd?onend:unpipe;state.endEmitted?processNextTick(endFn):src.once("end",endFn),dest.on("unpipe",onunpipe);var ondrain=pipeOnDrain(src);dest.on("drain",ondrain);var cleanedUp=!1,increasedAwaitDrain=!1;return src.on("data",ondata),prependListener(dest,"error",onerror),dest.once("close",onclose),dest.once("finish",onfinish),dest.emit("pipe",src),state.flowing||(debug("pipe resume"),src.resume()),dest},Readable.prototype.unpipe=function(dest){var state=this._readableState,unpipeInfo={hasUnpiped:!1};if(0===state.pipesCount)return this;if(1===state.pipesCount)return dest&&dest!==state.pipes?this:(dest||(dest=state.pipes),state.pipes=null,state.pipesCount=0,state.flowing=!1,dest&&dest.emit("unpipe",this,unpipeInfo),this);if(!dest){var dests=state.pipes,len=state.pipesCount;state.pipes=null,state.pipesCount=0,state.flowing=!1;for(var i=0;i<len;i++)dests[i].emit("unpipe",this,unpipeInfo);return this}var index=indexOf(state.pipes,dest);return-1===index?this:(state.pipes.splice(index,1),state.pipesCount-=1,1===state.pipesCount&&(state.pipes=state.pipes[0]),dest.emit("unpipe",this,unpipeInfo),this)},Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if("data"===ev)!1!==this._readableState.flowing&&this.resume();else if("readable"===ev){var state=this._readableState;state.endEmitted||state.readableListening||(state.readableListening=state.needReadable=!0,state.emittedReadable=!1,state.reading?state.length&&emitReadable(this):processNextTick(nReadingNextTick,this))}return res},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.resume=function(){var state=this._readableState;return state.flowing||(debug("resume"),state.flowing=!0,resume(this,state)),this},Readable.prototype.pause=function(){return debug("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(debug("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Readable.prototype.wrap=function(stream){var state=this._readableState,paused=!1,self=this;stream.on("end",function(){if(debug("wrapped end"),state.decoder&&!state.ended){var chunk=state.decoder.end();chunk&&chunk.length&&self.push(chunk)}self.push(null)}),stream.on("data",function(chunk){if(debug("wrapped data"),state.decoder&&(chunk=state.decoder.write(chunk)),(!state.objectMode||null!==chunk&&void 0!==chunk)&&(state.objectMode||chunk&&chunk.length)){self.push(chunk)||(paused=!0,stream.pause())}});for(var i in stream)void 0===this[i]&&"function"==typeof stream[i]&&(this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i));for(var n=0;n<kProxyEvents.length;n++)stream.on(kProxyEvents[n],self.emit.bind(self,kProxyEvents[n]));return self._read=function(n){debug("wrapped _read",n),paused&&(paused=!1,stream.resume())},self},Readable._fromList=fromList}).call(this,void 0,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{636:636,638:638,639:639,641:641,643:643,644:644,646:646,651:651,652:652,653:653,654:654,659:659}],649:[function(_dereq_,module,exports){"use strict";function TransformState(stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=!1;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("write callback called multiple times"));ts.writechunk=null,ts.writecb=null,null!==data&&void 0!==data&&stream.push(data),cb(er);var rs=stream._readableState;rs.reading=!1,(rs.needReadable||rs.length<rs.highWaterMark)&&stream._read(rs.highWaterMark)}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options),this._transformState=new TransformState(this);var stream=this;this._readableState.needReadable=!0,this._readableState.sync=!1,options&&("function"==typeof options.transform&&(this._transform=options.transform),"function"==typeof options.flush&&(this._flush=options.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(er,data){done(stream,er,data)}):done(stream)})}function done(stream,er,data){if(er)return stream.emit("error",er);null!==data&&void 0!==data&&stream.push(data);var ws=stream._writableState,ts=stream._transformState;if(ws.length)throw new Error("Calling transform done when ws.length != 0");if(ts.transforming)throw new Error("Calling transform done when still transforming");return stream.push(null)}module.exports=Transform;var Duplex=_dereq_(646),util=_dereq_(638);util.inherits=_dereq_(641),util.inherits(Transform,Duplex),Transform.prototype.push=function(chunk,encoding){return this._transformState.needTransform=!1,Duplex.prototype.push.call(this,chunk,encoding)},Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("_transform() is not implemented")},Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;if(ts.writecb=cb,ts.writechunk=chunk,ts.writeencoding=encoding,!ts.transforming){var rs=this._readableState;(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)&&this._read(rs.highWaterMark)}},Transform.prototype._read=function(n){var ts=this._transformState;null!==ts.writechunk&&ts.writecb&&!ts.transforming?(ts.transforming=!0,this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)):ts.needTransform=!0},Transform.prototype._destroy=function(err,cb){var _this=this;Duplex.prototype._destroy.call(this,err,function(err2){cb(err2),_this.emit("close")})}},{638:638,641:641,646:646}],650:[function(_dereq_,module,exports){(function(process,global){"use strict";function CorkedRequest(state){var _this=this;this.next=null,this.entry=null,this.finish=function(){onCorkedFinish(_this,state)}}function _uint8ArrayToBuffer(chunk){return Buffer.from(chunk)}function _isUint8Array(obj){return Buffer.isBuffer(obj)||obj instanceof OurUint8Array}function nop(){}function WritableState(options,stream){Duplex=Duplex||_dereq_(646),options=options||{},this.objectMode=!!options.objectMode,stream instanceof Duplex&&(this.objectMode=this.objectMode||!!options.writableObjectMode);var hwm=options.highWaterMark,defaultHwm=this.objectMode?16:16384;this.highWaterMark=hwm||0===hwm?hwm:defaultHwm,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var noDecode=!1===options.decodeStrings;this.decodeStrings=!noDecode,this.defaultEncoding=options.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(er){onwrite(stream,er)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new CorkedRequest(this)}function Writable(options){if(Duplex=Duplex||_dereq_(646),!(realHasInstance.call(Writable,this)||this instanceof Duplex))return new Writable(options);this._writableState=new WritableState(options,this),this.writable=!0,options&&("function"==typeof options.write&&(this._write=options.write),"function"==typeof options.writev&&(this._writev=options.writev),"function"==typeof options.destroy&&(this._destroy=options.destroy),"function"==typeof options.final&&(this._final=options.final)),Stream.call(this)}function writeAfterEnd(stream,cb){var er=new Error("write after end");stream.emit("error",er),processNextTick(cb,er)}function validChunk(stream,state,chunk,cb){var valid=!0,er=!1;return null===chunk?er=new TypeError("May not write null values to stream"):"string"==typeof chunk||void 0===chunk||state.objectMode||(er=new TypeError("Invalid non-string/buffer chunk")),er&&(stream.emit("error",er),processNextTick(cb,er),valid=!1),valid}function decodeChunk(state,chunk,encoding){return state.objectMode||!1===state.decodeStrings||"string"!=typeof chunk||(chunk=Buffer.from(chunk,encoding)),chunk}function writeOrBuffer(stream,state,isBuf,chunk,encoding,cb){if(!isBuf){var newChunk=decodeChunk(state,chunk,encoding);chunk!==newChunk&&(isBuf=!0,encoding="buffer",chunk=newChunk)}var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(ret||(state.needDrain=!0),state.writing||state.corked){var last=state.lastBufferedRequest;state.lastBufferedRequest={chunk:chunk,encoding:encoding,isBuf:isBuf,callback:cb,next:null},last?last.next=state.lastBufferedRequest:state.bufferedRequest=state.lastBufferedRequest,state.bufferedRequestCount+=1}else doWrite(stream,state,!1,len,chunk,encoding,cb);return ret}function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len,state.writecb=cb,state.writing=!0,state.sync=!0,writev?stream._writev(chunk,state.onwrite):stream._write(chunk,encoding,state.onwrite),state.sync=!1}function onwriteError(stream,state,sync,er,cb){--state.pendingcb,sync?(processNextTick(cb,er),processNextTick(finishMaybe,stream,state),stream._writableState.errorEmitted=!0,stream.emit("error",er)):(cb(er),stream._writableState.errorEmitted=!0,stream.emit("error",er),finishMaybe(stream,state))}function onwriteStateUpdate(state){state.writing=!1,state.writecb=null,state.length-=state.writelen,state.writelen=0}function onwrite(stream,er){var state=stream._writableState,sync=state.sync,cb=state.writecb;if(onwriteStateUpdate(state),er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(state);finished||state.corked||state.bufferProcessing||!state.bufferedRequest||clearBuffer(stream,state),sync?asyncWrite(afterWrite,stream,state,finished,cb):afterWrite(stream,state,finished,cb)}}function afterWrite(stream,state,finished,cb){finished||onwriteDrain(stream,state),state.pendingcb--,cb(),finishMaybe(stream,state)}function onwriteDrain(stream,state){0===state.length&&state.needDrain&&(state.needDrain=!1,stream.emit("drain"))}function clearBuffer(stream,state){state.bufferProcessing=!0;var entry=state.bufferedRequest;if(stream._writev&&entry&&entry.next){var l=state.bufferedRequestCount,buffer=new Array(l),holder=state.corkedRequestsFree;holder.entry=entry;for(var count=0,allBuffers=!0;entry;)buffer[count]=entry,entry.isBuf||(allBuffers=!1),entry=entry.next,count+=1;buffer.allBuffers=allBuffers,doWrite(stream,state,!0,state.length,buffer,"",holder.finish),state.pendingcb++,state.lastBufferedRequest=null,holder.next?(state.corkedRequestsFree=holder.next,holder.next=null):state.corkedRequestsFree=new CorkedRequest(state)}else{for(;entry;){var chunk=entry.chunk,encoding=entry.encoding,cb=entry.callback;if(doWrite(stream,state,!1,state.objectMode?1:chunk.length,chunk,encoding,cb),entry=entry.next,state.writing)break}null===entry&&(state.lastBufferedRequest=null)}state.bufferedRequestCount=0,state.bufferedRequest=entry,state.bufferProcessing=!1}function needFinish(state){return state.ending&&0===state.length&&null===state.bufferedRequest&&!state.finished&&!state.writing}function callFinal(stream,state){stream._final(function(err){state.pendingcb--,err&&stream.emit("error",err),state.prefinished=!0,stream.emit("prefinish"),finishMaybe(stream,state)})}function prefinish(stream,state){state.prefinished||state.finalCalled||("function"==typeof stream._final?(state.pendingcb++,state.finalCalled=!0,processNextTick(callFinal,stream,state)):(state.prefinished=!0,stream.emit("prefinish")))}function finishMaybe(stream,state){var need=needFinish(state);return need&&(prefinish(stream,state),0===state.pendingcb&&(state.finished=!0,stream.emit("finish"))),need}function endWritable(stream,state,cb){state.ending=!0,finishMaybe(stream,state),cb&&(state.finished?processNextTick(cb):stream.once("finish",cb)),state.ended=!0,stream.writable=!1}function onCorkedFinish(corkReq,state,err){var entry=corkReq.entry;for(corkReq.entry=null;entry;){var cb=entry.callback;state.pendingcb--,cb(err),entry=entry.next}state.corkedRequestsFree?state.corkedRequestsFree.next=corkReq:state.corkedRequestsFree=corkReq}var processNextTick=_dereq_(644);module.exports=Writable;var Duplex,asyncWrite=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:processNextTick;Writable.WritableState=WritableState;var util=_dereq_(638);util.inherits=_dereq_(641);var internalUtil={deprecate:_dereq_(662)},Stream=_dereq_(653),Buffer=_dereq_(659).Buffer,OurUint8Array=global.Uint8Array||function(){},destroyImpl=_dereq_(652);util.inherits(Writable,Stream),WritableState.prototype.getBuffer=function(){for(var current=this.bufferedRequest,out=[];current;)out.push(current),current=current.next;return out},function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:internalUtil.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(_){}}();var realHasInstance;"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(realHasInstance=Function.prototype[Symbol.hasInstance],Object.defineProperty(Writable,Symbol.hasInstance,{value:function(object){return!!realHasInstance.call(this,object)||object&&object._writableState instanceof WritableState}})):realHasInstance=function(object){return object instanceof this},Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState,ret=!1,isBuf=_isUint8Array(chunk)&&!state.objectMode;return isBuf&&!Buffer.isBuffer(chunk)&&(chunk=_uint8ArrayToBuffer(chunk)),"function"==typeof encoding&&(cb=encoding,encoding=null),isBuf?encoding="buffer":encoding||(encoding=state.defaultEncoding),"function"!=typeof cb&&(cb=nop),state.ended?writeAfterEnd(this,cb):(isBuf||validChunk(this,state,chunk,cb))&&(state.pendingcb++,ret=writeOrBuffer(this,state,isBuf,chunk,encoding,cb)),ret},Writable.prototype.cork=function(){this._writableState.corked++},Writable.prototype.uncork=function(){var state=this._writableState;state.corked&&(state.corked--,state.writing||state.corked||state.finished||state.bufferProcessing||!state.bufferedRequest||clearBuffer(this,state))},Writable.prototype.setDefaultEncoding=function(encoding){if("string"==typeof encoding&&(encoding=encoding.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((encoding+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+encoding);return this._writableState.defaultEncoding=encoding,this},Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("_write() is not implemented"))},Writable.prototype._writev=null,Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;"function"==typeof chunk?(cb=chunk,chunk=null,encoding=null):"function"==typeof encoding&&(cb=encoding,encoding=null),null!==chunk&&void 0!==chunk&&this.write(chunk,encoding),state.corked&&(state.corked=1,this.uncork()),state.ending||state.finished||endWritable(this,state,cb)},Object.defineProperty(Writable.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(value){this._writableState&&(this._writableState.destroyed=value)}}),Writable.prototype.destroy=destroyImpl.destroy,Writable.prototype._undestroy=destroyImpl.undestroy,Writable.prototype._destroy=function(err,cb){this.end(),cb(err)}}).call(this,void 0,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{638:638,641:641,644:644,646:646,652:652,653:653,659:659,662:662}],651:[function(_dereq_,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function copyBuffer(src,target,offset){src.copy(target,offset)}var Buffer=_dereq_(659).Buffer;module.exports=function(){function BufferList(){_classCallCheck(this,BufferList),this.head=null,this.tail=null,this.length=0}return BufferList.prototype.push=function(v){var entry={data:v,next:null};this.length>0?this.tail.next=entry:this.head=entry,this.tail=entry,
++this.length},BufferList.prototype.unshift=function(v){var entry={data:v,next:this.head};0===this.length&&(this.tail=entry),this.head=entry,++this.length},BufferList.prototype.shift=function(){if(0!==this.length){var ret=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,ret}},BufferList.prototype.clear=function(){this.head=this.tail=null,this.length=0},BufferList.prototype.join=function(s){if(0===this.length)return"";for(var p=this.head,ret=""+p.data;p=p.next;)ret+=s+p.data;return ret},BufferList.prototype.concat=function(n){if(0===this.length)return Buffer.alloc(0);if(1===this.length)return this.head.data;for(var ret=Buffer.allocUnsafe(n>>>0),p=this.head,i=0;p;)copyBuffer(p.data,ret,i),i+=p.data.length,p=p.next;return ret},BufferList}()},{659:659}],652:[function(_dereq_,module,exports){"use strict";function destroy(err,cb){var _this=this,readableDestroyed=this._readableState&&this._readableState.destroyed,writableDestroyed=this._writableState&&this._writableState.destroyed;if(readableDestroyed||writableDestroyed)return void(cb?cb(err):!err||this._writableState&&this._writableState.errorEmitted||processNextTick(emitErrorNT,this,err));this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(err||null,function(err){!cb&&err?(processNextTick(emitErrorNT,_this,err),_this._writableState&&(_this._writableState.errorEmitted=!0)):cb&&cb(err)})}function undestroy(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function emitErrorNT(self,err){self.emit("error",err)}var processNextTick=_dereq_(644);module.exports={destroy:destroy,undestroy:undestroy}},{644:644}],653:[function(_dereq_,module,exports){module.exports=_dereq_(639).EventEmitter},{639:639}],654:[function(_dereq_,module,exports){"use strict";function _normalizeEncoding(enc){if(!enc)return"utf8";for(var retried;;)switch(enc){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return enc;default:if(retried)return;enc=(""+enc).toLowerCase(),retried=!0}}function normalizeEncoding(enc){var nenc=_normalizeEncoding(enc);if("string"!=typeof nenc&&(Buffer.isEncoding===isEncoding||!isEncoding(enc)))throw new Error("Unknown encoding: "+enc);return nenc||enc}function StringDecoder(encoding){this.encoding=normalizeEncoding(encoding);var nb;switch(this.encoding){case"utf16le":this.text=utf16Text,this.end=utf16End,nb=4;break;case"utf8":this.fillLast=utf8FillLast,nb=4;break;case"base64":this.text=base64Text,this.end=base64End,nb=3;break;default:return this.write=simpleWrite,void(this.end=simpleEnd)}this.lastNeed=0,this.lastTotal=0,this.lastChar=Buffer.allocUnsafe(nb)}function utf8CheckByte(byte){return byte<=127?0:byte>>5==6?2:byte>>4==14?3:byte>>3==30?4:-1}function utf8CheckIncomplete(self,buf,i){var j=buf.length-1;if(j<i)return 0;var nb=utf8CheckByte(buf[j]);return nb>=0?(nb>0&&(self.lastNeed=nb-1),nb):--j<i?0:(nb=utf8CheckByte(buf[j]))>=0?(nb>0&&(self.lastNeed=nb-2),nb):--j<i?0:(nb=utf8CheckByte(buf[j]),nb>=0?(nb>0&&(2===nb?nb=0:self.lastNeed=nb-3),nb):0)}function utf8CheckExtraBytes(self,buf,p){if(128!=(192&buf[0]))return self.lastNeed=0,"�".repeat(p);if(self.lastNeed>1&&buf.length>1){if(128!=(192&buf[1]))return self.lastNeed=1,"�".repeat(p+1);if(self.lastNeed>2&&buf.length>2&&128!=(192&buf[2]))return self.lastNeed=2,"�".repeat(p+2)}}function utf8FillLast(buf){var p=this.lastTotal-this.lastNeed,r=utf8CheckExtraBytes(this,buf,p);return void 0!==r?r:this.lastNeed<=buf.length?(buf.copy(this.lastChar,p,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(buf.copy(this.lastChar,p,0,buf.length),void(this.lastNeed-=buf.length))}function utf8Text(buf,i){var total=utf8CheckIncomplete(this,buf,i);if(!this.lastNeed)return buf.toString("utf8",i);this.lastTotal=total;var end=buf.length-(total-this.lastNeed);return buf.copy(this.lastChar,0,end),buf.toString("utf8",i,end)}function utf8End(buf){var r=buf&&buf.length?this.write(buf):"";return this.lastNeed?r+"�".repeat(this.lastTotal-this.lastNeed):r}function utf16Text(buf,i){if((buf.length-i)%2==0){var r=buf.toString("utf16le",i);if(r){var c=r.charCodeAt(r.length-1);if(c>=55296&&c<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=buf[buf.length-2],this.lastChar[1]=buf[buf.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=buf[buf.length-1],buf.toString("utf16le",i,buf.length-1)}function utf16End(buf){var r=buf&&buf.length?this.write(buf):"";if(this.lastNeed){var end=this.lastTotal-this.lastNeed;return r+this.lastChar.toString("utf16le",0,end)}return r}function base64Text(buf,i){var n=(buf.length-i)%3;return 0===n?buf.toString("base64",i):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=buf[buf.length-1]:(this.lastChar[0]=buf[buf.length-2],this.lastChar[1]=buf[buf.length-1]),buf.toString("base64",i,buf.length-n))}function base64End(buf){var r=buf&&buf.length?this.write(buf):"";return this.lastNeed?r+this.lastChar.toString("base64",0,3-this.lastNeed):r}function simpleWrite(buf){return buf.toString(this.encoding)}function simpleEnd(buf){return buf&&buf.length?this.write(buf):""}var Buffer=_dereq_(659).Buffer,isEncoding=Buffer.isEncoding||function(encoding){switch((encoding=""+encoding)&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};exports.StringDecoder=StringDecoder,StringDecoder.prototype.write=function(buf){if(0===buf.length)return"";var r,i;if(this.lastNeed){if(void 0===(r=this.fillLast(buf)))return"";i=this.lastNeed,this.lastNeed=0}else i=0;return i<buf.length?r?r+this.text(buf,i):this.text(buf,i):r||""},StringDecoder.prototype.end=utf8End,StringDecoder.prototype.text=utf8Text,StringDecoder.prototype.fillLast=function(buf){if(this.lastNeed<=buf.length)return buf.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);buf.copy(this.lastChar,this.lastTotal-this.lastNeed,0,buf.length),this.lastNeed-=buf.length}},{659:659}],655:[function(_dereq_,module,exports){module.exports=_dereq_(656).PassThrough},{656:656}],656:[function(_dereq_,module,exports){exports=module.exports=_dereq_(648),exports.Stream=exports,exports.Readable=exports,exports.Writable=_dereq_(650),exports.Duplex=_dereq_(646),exports.Transform=_dereq_(649),exports.PassThrough=_dereq_(647)},{646:646,647:647,648:648,649:649,650:650}],657:[function(_dereq_,module,exports){module.exports=_dereq_(656).Transform},{656:656}],658:[function(_dereq_,module,exports){module.exports=_dereq_(650)},{650:650}],659:[function(_dereq_,module,exports){function copyProps(src,dst){for(var key in src)dst[key]=src[key]}function SafeBuffer(arg,encodingOrOffset,length){return Buffer(arg,encodingOrOffset,length)}var buffer=_dereq_(637),Buffer=buffer.Buffer;Buffer.from&&Buffer.alloc&&Buffer.allocUnsafe&&Buffer.allocUnsafeSlow?module.exports=buffer:(copyProps(buffer,exports),exports.Buffer=SafeBuffer),copyProps(Buffer,SafeBuffer),SafeBuffer.from=function(arg,encodingOrOffset,length){if("number"==typeof arg)throw new TypeError("Argument must not be a number");return Buffer(arg,encodingOrOffset,length)},SafeBuffer.alloc=function(size,fill,encoding){if("number"!=typeof size)throw new TypeError("Argument must be a number");var buf=Buffer(size);return void 0!==fill?"string"==typeof encoding?buf.fill(fill,encoding):buf.fill(fill):buf.fill(0),buf},SafeBuffer.allocUnsafe=function(size){if("number"!=typeof size)throw new TypeError("Argument must be a number");return Buffer(size)},SafeBuffer.allocUnsafeSlow=function(size){if("number"!=typeof size)throw new TypeError("Argument must be a number");return buffer.SlowBuffer(size)}},{637:637}],660:[function(_dereq_,module,exports){function Stream(){EE.call(this)}module.exports=Stream;var EE=_dereq_(639).EventEmitter;_dereq_(641)(Stream,EE),Stream.Readable=_dereq_(656),Stream.Writable=_dereq_(658),Stream.Duplex=_dereq_(645),Stream.Transform=_dereq_(657),Stream.PassThrough=_dereq_(655),Stream.Stream=Stream,Stream.prototype.pipe=function(dest,options){function ondata(chunk){dest.writable&&!1===dest.write(chunk)&&source.pause&&source.pause()}function ondrain(){source.readable&&source.resume&&source.resume()}function onend(){didOnEnd||(didOnEnd=!0,dest.end())}function onclose(){didOnEnd||(didOnEnd=!0,"function"==typeof dest.destroy&&dest.destroy())}function onerror(er){if(cleanup(),0===EE.listenerCount(this,"error"))throw er}function cleanup(){source.removeListener("data",ondata),dest.removeListener("drain",ondrain),source.removeListener("end",onend),source.removeListener("close",onclose),source.removeListener("error",onerror),dest.removeListener("error",onerror),source.removeListener("end",cleanup),source.removeListener("close",cleanup),dest.removeListener("close",cleanup)}var source=this;source.on("data",ondata),dest.on("drain",ondrain),dest._isStdio||options&&!1===options.end||(source.on("end",onend),source.on("close",onclose));var didOnEnd=!1;return source.on("error",onerror),dest.on("error",onerror),source.on("end",cleanup),source.on("close",cleanup),dest.on("close",cleanup),dest.emit("pipe",source),dest}},{639:639,641:641,645:645,655:655,656:656,657:657,658:658}],661:[function(_dereq_,module,exports){function assertEncoding(encoding){if(encoding&&!isBufferEncoding(encoding))throw new Error("Unknown encoding: "+encoding)}function passThroughWrite(buffer){return buffer.toString(this.encoding)}function utf16DetectIncompleteChar(buffer){this.charReceived=buffer.length%2,this.charLength=this.charReceived?2:0}function base64DetectIncompleteChar(buffer){this.charReceived=buffer.length%3,this.charLength=this.charReceived?3:0}var Buffer=_dereq_(637).Buffer,isBufferEncoding=Buffer.isEncoding||function(encoding){switch(encoding&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},StringDecoder=exports.StringDecoder=function(encoding){switch(this.encoding=(encoding||"utf8").toLowerCase().replace(/[-_]/,""),assertEncoding(encoding),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=base64DetectIncompleteChar;break;default:return void(this.write=passThroughWrite)}this.charBuffer=new Buffer(6),this.charReceived=0,this.charLength=0};StringDecoder.prototype.write=function(buffer){for(var charStr="";this.charLength;){var available=buffer.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:buffer.length;if(buffer.copy(this.charBuffer,this.charReceived,0,available),this.charReceived+=available,this.charReceived<this.charLength)return"";buffer=buffer.slice(available,buffer.length),charStr=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var charCode=charStr.charCodeAt(charStr.length-1);if(!(charCode>=55296&&charCode<=56319)){if(this.charReceived=this.charLength=0,0===buffer.length)return charStr;break}this.charLength+=this.surrogateSize,charStr=""}this.detectIncompleteChar(buffer);var end=buffer.length;this.charLength&&(buffer.copy(this.charBuffer,0,buffer.length-this.charReceived,end),end-=this.charReceived),charStr+=buffer.toString(this.encoding,0,end);var end=charStr.length-1,charCode=charStr.charCodeAt(end);if(charCode>=55296&&charCode<=56319){var size=this.surrogateSize;return this.charLength+=size,this.charReceived+=size,this.charBuffer.copy(this.charBuffer,size,0,size),buffer.copy(this.charBuffer,0,0,size),charStr.substring(0,end)}return charStr},StringDecoder.prototype.detectIncompleteChar=function(buffer){for(var i=buffer.length>=3?3:buffer.length;i>0;i--){var c=buffer[buffer.length-i];if(1==i&&c>>5==6){this.charLength=2;break}if(i<=2&&c>>4==14){this.charLength=3;break}if(i<=3&&c>>3==30){this.charLength=4;break}}this.charReceived=i},StringDecoder.prototype.end=function(buffer){var res="";if(buffer&&buffer.length&&(res=this.write(buffer)),this.charReceived){var cr=this.charReceived,buf=this.charBuffer,enc=this.encoding;res+=buf.slice(0,cr).toString(enc)}return res}},{637:637}],662:[function(_dereq_,module,exports){(function(global){function deprecate(fn,msg){function deprecated(){if(!warned){if(config("throwDeprecation"))throw new Error(msg);config("traceDeprecation")?console.trace(msg):console.warn(msg),warned=!0}return fn.apply(this,arguments)}if(config("noDeprecation"))return fn;var warned=!1;return deprecated}function config(name){try{if(!global.localStorage)return!1}catch(_){return!1}var val=global.localStorage[name];return null!=val&&"true"===String(val).toLowerCase()}module.exports=deprecate}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[632])(632)});